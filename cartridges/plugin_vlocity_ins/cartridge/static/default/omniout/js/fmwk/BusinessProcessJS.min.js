!function(){var fileNsPrefix=function(){"use strict";var scripts=document.getElementsByTagName("script"),scriptName=scripts[scripts.length-1].src,parts=scriptName.split("/"),partsLength=parts.length-1,thisScript=parts[partsLength--];if(""===thisScript&&(thisScript=parts[partsLength--]),-1!=scriptName.indexOf("__"))for(;-1==thisScript.indexOf("__")&&partsLength>=0;)thisScript=parts[partsLength],partsLength--;var lowerCasePrefix=-1==thisScript.indexOf("__")?"":thisScript.substring(0,thisScript.indexOf("__")+2);if(""!==(lowerCasePrefix=""===lowerCasePrefix&&localStorage.getItem("nsPrefix")?localStorage.getItem("nsPrefix"):lowerCasePrefix)&&(lowerCasePrefix=/__$/.test(lowerCasePrefix)?lowerCasePrefix:lowerCasePrefix+"__"),0===lowerCasePrefix.length)return function(){return""!==(lowerCasePrefix=window.nsPrefix?window.nsPrefix:lowerCasePrefix)&&(lowerCasePrefix=/__$/.test(lowerCasePrefix)?lowerCasePrefix:lowerCasePrefix+"__"),lowerCasePrefix};var resolvedNs=null;return function(){if(resolvedNs)return resolvedNs;try{var name,tofind=lowerCasePrefix.replace("__",""),scanObjectForNs=function(object,alreadySeen){if(object&&object!==window&&-1==alreadySeen.indexOf(object)&&(alreadySeen.push(object),Object.keys(object).forEach(function(key){if("ns"===key&&"string"==typeof object[key]&&object[key].toLowerCase()===tofind)return name=object[key]+"__",!1;if("[object Array]"===Object.prototype.toString.call(object[key]))object[key].forEach(function(value){var result=scanObjectForNs(value,alreadySeen);if(result)return name=result,!1});else if("object"==typeof object[key]){var result=scanObjectForNs(object[key],alreadySeen);if(result)return name=result,!1}return!name&&void 0}),name))return name};return"undefined"==typeof Visualforce?lowerCasePrefix:(scanObjectForNs(Visualforce.remoting.Manager.providers,[]),resolvedNs=name||lowerCasePrefix)}catch(e){return lowerCasePrefix}}}(),fileNsPrefixDot=function(){var prefix=fileNsPrefix();return prefix.length>1?prefix.replace("__","."):prefix};!function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}}()({1:[function(require,module,exports){require("./polyfills/Object.assign.js"),angular.module("vlocity-oui-common",[]),require("./modules/omni-out/main.js"),require("./modules/omni-knowledge/main.js"),require("./modules/common/shared/osLabelSet.js"),require("./modules/common/shared/misc.js"),require("./modules/common/shared/miscBP.js"),require("./sharedObjectService.js"),require("./modules/common/factory/baseService.js"),require("./modules/common/directives/baseChainup.js"),require("./modules/player/factory/uiStateService.js"),require("./modules/player/factory/bpService.js"),require("./modules/common/controller/OmniFormController.js"),require("./modules/player/main/busProcess"),require("./modules/common/directives/vlcSldsValChecker.js"),require("./modules/common/directives/vlcSldsNgPattern.js"),require("./modules/common/directives/vlcSldsMinMaxLen.js"),require("./modules/common/directives/vlcSldsCheckValChecker.js"),require("./modules/common/directives/vlcSldsBubbleCanceller.js"),require("./modules/common/directives/vlcSldsValCheckCurrency.js"),require("./modules/common/directives/vlcBindHtml.js"),require("./modules/common/directives/appFileReader.js"),require("./modules/common/directives/vlcSldsMuValChecker.js"),require("./modules/common/directives/vlcSldsFileSelect.js"),require("./modules/common/directives/vlcSldsNumValChecker.js"),require("./modules/common/directives/vlcSldsOnlyNumeric.js"),require("./modules/common/directives/vlcRangeSlider.js"),require("./modules/common/directives/vlcLookupControl.js"),require("./modules/common/directives/vlcSldsToolTip.js"),require("./modules/common/directives/vlcDateTimeFormatVal.js"),require("./modules/player/directives/ngConfirmClick.js"),require("./modules/player/directives/vlcRightPanel.js"),require("./modules/player/directives/vlcSldsBanner.js"),require("./modules/player/directives/vlcSldsDatePicker.js"),require("./modules/player/directives/vlcSldsDisableAutocomplete.js"),require("./modules/player/directives/vlcSldsEmbeddedArticle.js"),require("./modules/player/directives/vlcSldsHelpText.js"),require("./modules/player/directives/vlcSldsInclude.js"),require("./modules/player/directives/vlcSldsInstruction.js"),require("./modules/player/directives/vlcSldsLightningBanner.js"),require("./modules/player/directives/vlcSldsModal.js"),require("./modules/player/directives/vlcSldsPopOver.js"),require("./modules/player/directives/vlcSldsReadOnly.js"),require("./modules/player/directives/vlcSldsSpinner.js"),require("./modules/player/directives/vlcSldsStep.js"),require("./modules/player/directives/vlcSldsSvgSize.js"),require("./modules/player/directives/vlcSldsTimePicker.js"),require("./modules/player/directives/vlcSldsToggle.js"),require("./modules/player/directives/vlcSldsToggleHelpText.js"),require("./modules/player/directives/vlcSldsWindowScroll.js"),require("./modules/player/directives/vlcTimePicker.js"),require("./modules/player/directives/vlcSldsRemoveItem.js"),require("./modules/player/directives/vlcSldsValWatchProdConf.js"),require("./modules/player/directives/vlcSldsTypeaheadPrefill.js"),require("./modules/player/directives/vlcPreventParentScroll.js"),require("./modules/player/directives/vlcSldsChangeInlineTemplates.js"),require("./modules/player/directives/vlcSldsModelUpdate.js"),require("./modules/player/directives/vlcSldsEditBlockModal.js"),require("./modules/player/directives/preventEnterSubmit.js"),require("./modules/player/directives/vlcSldsInlineEditBlock.js"),require("./modules/common/factory/currencySymbol.js"),require("./modules/player/config/alertConfig.js"),require("./modules/player/config/cardframeworkConfig.js"),require("./modules/player/config/httpInterceptor.js"),require("./modules/player/config/forceTkConfig.js"),require("./modules/player/config/bpServiceConfig.js"),require("./modules/player/config/xhrConfig.js"),require("./modules/player/config/lazyLoadDirectives.js"),require("./modules/player/config/locationProviderConfig.js")},{"./modules/common/controller/OmniFormController.js":2,"./modules/common/directives/appFileReader.js":3,"./modules/common/directives/baseChainup.js":4,"./modules/common/directives/vlcBindHtml.js":5,"./modules/common/directives/vlcDateTimeFormatVal.js":6,"./modules/common/directives/vlcLookupControl.js":7,"./modules/common/directives/vlcRangeSlider.js":8,"./modules/common/directives/vlcSldsBubbleCanceller.js":9,"./modules/common/directives/vlcSldsCheckValChecker.js":10,"./modules/common/directives/vlcSldsFileSelect.js":11,"./modules/common/directives/vlcSldsMinMaxLen.js":12,"./modules/common/directives/vlcSldsMuValChecker.js":13,"./modules/common/directives/vlcSldsNgPattern.js":14,"./modules/common/directives/vlcSldsNumValChecker.js":15,"./modules/common/directives/vlcSldsOnlyNumeric.js":16,"./modules/common/directives/vlcSldsToolTip.js":17,"./modules/common/directives/vlcSldsValCheckCurrency.js":18,"./modules/common/directives/vlcSldsValChecker.js":19,"./modules/common/factory/baseService.js":20,"./modules/common/factory/currencySymbol.js":21,"./modules/common/shared/misc.js":22,"./modules/common/shared/miscBP.js":23,"./modules/common/shared/osLabelSet.js":24,"./modules/omni-knowledge/main.js":26,"./modules/omni-out/main.js":29,"./modules/player/config/alertConfig.js":31,"./modules/player/config/bpServiceConfig.js":32,"./modules/player/config/cardframeworkConfig.js":33,"./modules/player/config/forceTkConfig.js":34,"./modules/player/config/httpInterceptor.js":35,"./modules/player/config/lazyLoadDirectives.js":36,"./modules/player/config/locationProviderConfig.js":37,"./modules/player/config/xhrConfig.js":38,"./modules/player/directives/ngConfirmClick.js":39,"./modules/player/directives/preventEnterSubmit.js":40,"./modules/player/directives/vlcPreventParentScroll.js":41,"./modules/player/directives/vlcRightPanel.js":42,"./modules/player/directives/vlcSldsBanner.js":43,"./modules/player/directives/vlcSldsChangeInlineTemplates.js":44,"./modules/player/directives/vlcSldsDatePicker.js":45,"./modules/player/directives/vlcSldsDisableAutocomplete.js":46,"./modules/player/directives/vlcSldsEditBlockModal.js":47,"./modules/player/directives/vlcSldsEmbeddedArticle.js":48,"./modules/player/directives/vlcSldsHelpText.js":49,"./modules/player/directives/vlcSldsInclude.js":50,"./modules/player/directives/vlcSldsInlineEditBlock.js":51,"./modules/player/directives/vlcSldsInstruction.js":52,"./modules/player/directives/vlcSldsLightningBanner.js":53,"./modules/player/directives/vlcSldsModal.js":54,"./modules/player/directives/vlcSldsModelUpdate.js":55,"./modules/player/directives/vlcSldsPopOver.js":56,"./modules/player/directives/vlcSldsReadOnly.js":57,"./modules/player/directives/vlcSldsRemoveItem.js":58,"./modules/player/directives/vlcSldsSpinner.js":59,"./modules/player/directives/vlcSldsStep.js":60,"./modules/player/directives/vlcSldsSvgSize.js":61,"./modules/player/directives/vlcSldsTimePicker.js":62,"./modules/player/directives/vlcSldsToggle.js":63,"./modules/player/directives/vlcSldsToggleHelpText.js":64,"./modules/player/directives/vlcSldsTypeaheadPrefill.js":65,"./modules/player/directives/vlcSldsValWatchProdConf.js":66,"./modules/player/directives/vlcSldsWindowScroll.js":67,"./modules/player/directives/vlcTimePicker.js":68,"./modules/player/factory/bpService.js":69,"./modules/player/factory/uiStateService.js":70,"./modules/player/main/busProcess":71,"./polyfills/Object.assign.js":72,"./sharedObjectService.js":73}],2:[function(require,module,exports){window.VOUINS=window.VOUINS||{},VOUINS.OmniFormCtrl=function($scope,ouiBaseService,$timeout,$rootScope,$q,currencySymbol,$window,force,$filter){function setActionStatus(status,response,callSuccess){$scope.output=$scope.output||{},$scope.output.vlcOmniFormResp=response,$scope.output.callSuccess=callSuccess,$scope.output.vlcOmniFormStatus=status,$scope.actionStatus.callSuccess=callSuccess,$scope.actionStatus.vlcOmniFormStatus=status}$scope.customLabels=customLabels,$scope.ouiBaseService=ouiBaseService,$scope.isSforce="undefined"!=typeof sforce&&null!=sforce,$scope.sforce="undefined"!=typeof sforce?sforce:null,$scope.actionStatus={},$scope.isFormValid=!0,VOUINS.initiateForce($scope,force),$scope.reset=function(){$scope.bpTree.readOnly=!1,$scope.submitted=!1,$scope.actionStatus={}},$scope.cancel=function(){setActionStatus("cancelling",null,null),$scope.processAction($scope.cancelParams,"cancel")},$scope.submit=function(){$scope.isFormValid=!$scope.checkValidity($scope,0,0,"Submit",null,!0),$scope.isFormValid&&(setActionStatus("submitting",null,null),$scope.submitted=!0,$scope.processAction($scope.submitParams,"submit"))},$scope.processAction=function(params,type){var IPKey;params=params||{};var payload={},option={},namespace=sfdcVars.sNS;if($scope.bpTree||($scope.bpTree={}),params.vlcOmniFormClose=$scope.bpTree.vlcOmniFormClose,"submit"===type&&$scope.omniInput.OmniPostAction&&(IPKey=$scope.omniInput.OmniPostAction),IPKey||(IPKey=params.inputIP),IPKey){payload=(payload=params.extraInput)||{},$scope.bpTree.response&&(_.mergeWith||_.merge)(payload,$scope.bpTree.response,VOUINS.mergeJSONLogic),$scope.bpTree.filesMap&&(option.vlcFilesMap=VOUINS.getFilesMap($scope.bpTree.filesMap,$scope.isSforce,$scope.sforce));var configObj={sClassName:namespace+".IntegrationProcedureService",sMethodName:IPKey,input:angular.toJson(payload),options:angular.toJson(option),iTimeout:12e4,label:""};if($scope.bpTree.debug){var dbgConfigObj={sClassName:namespace+".IntegrationProcedureService",sMethodName:IPKey,input:payload,options:option,iTimeout:12e4,label:""};$scope.bpTree.debugArray.push("TO SERVER: "+JSON.stringify(dbgConfigObj,null,2))}$scope.remoteAction(configObj,params,type)}$scope.bpTree.readOnly=!0,IPKey||(setActionStatus(type,$scope.bpTree.response,!0),params.vlcOmniFormClose&&VOUINS.ClearData($scope))},$scope.remoteAction=function(configObj,params,type){ouiBaseService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);$scope.bpTree.debug&&$scope.bpTree.debugArray.push("FROM SERVER: "+JSON.stringify(angular.copy(remoteResp),null,2)),setActionStatus(type,remoteResp,"OK"===remoteResp.error),"OK"===remoteResp.error&&remoteResp.IPResult.fileAttachmentSyncData&&VOUINS.syncFileAttachmentData(remoteResp.IPResult,!1,$scope,$q,null,$scope.bpTree.filesMap,ouiBaseService,$window).then(function(result){$timeout(function(){},0)})},function(error){$scope.bpTree.debug&&$scope.bpTree.debugArray.push("FROM SERVER: "+JSON.stringify(angular.copy(error),null,2)),setActionStatus(type,error,!1)}).then(function(){params.vlcOmniFormClose&&VOUINS.ClearData($scope)})},$scope.getOptions=function(control,scp){if(ouiBaseService.bPLSeeding&&$rootScope.VlocPicklistSeeding&&("SObject"===control.propSetMap.optionSource.type||"Custom"===control.propSetMap.optionSource.type)){var key=control.propSetMap.optionSource.source;"Multi-select"===control.type&&key&&$rootScope.VlocPicklistSeeding[key]&&void 0===$rootScope.VlocPicklistSeeding[control.name+":"+control.$$hashKey+":"+key]&&($rootScope.VlocPicklistSeeding[control.name+":"+control.$$hashKey+":"+key]=angular.copy($rootScope.VlocPicklistSeeding[key]));var plKey="Multi-select"===control.type?control.name+":"+control.$$hashKey+":"+key:key;VOUINS.resetOptions(control,$rootScope.VlocPicklistSeeding[plKey])}return control.propSetMap.options},$scope.aggregate=function(scp,arrayIndex,indexInParent,bUIUpdate,removeIndex){ouiBaseService.miniForm=!0,ouiBaseService.aggregate(scp,arrayIndex,indexInParent,bUIUpdate,removeIndex)},$scope.applyCallResp=function(resp,bValidation,bKnowledge,element,editBlockElementIndex){switch("string"==typeof resp&&(resp=JSON.parse(resp)),ouiBaseService.invokeResp={},$scope.topBPDom||($scope.topBPDom=VOUINS.getTopBPDom($scope)),$scope.applyCallRespAux(resp,$scope.topBPDom,bValidation,editBlockElementIndex),bValidation){case!0:break;default:if(null!==resp&&void 0!==resp&&resp.constructor===Object&&Object.keys(resp).length>0&&(!0!==ouiBaseService.previewMode&&(delete resp.ContextId,delete resp.userId,delete resp.userName,delete resp.userProfile,delete resp.timeStamp),Object.keys(resp).length>0))if(element&&angular.equals(element.type,"DocuSign Envelope Action")){var eleName=element.name;angular.isUndefined($scope.bpTree.response[eleName])&&($scope.bpTree.response[eleName]=[]),$scope.bpTree.response[eleName].unshift(resp[eleName])}else(_.mergeWith||_.merge)($scope.bpTree.response,resp,VOUINS.mergeJSONLogic)}},$scope.applyCallRespAux=function(resp,parentDomEle,bValidation,editBlockElementIndex){if(void 0!==resp&&null!==resp&&resp.constructor===Object)for(var key in resp)if(resp.hasOwnProperty(key)){var data=resp[key];void 0===data&&(data=null),$scope.applyDatatoElement(parentDomEle,data,key,resp,bValidation,editBlockElementIndex)}},$scope.applyDatatoElement=function(parentDomEle,data,key,parentResp,bValidation,editBlockElementIndex){var scope,bConvertToArray=!1;if(angular.isArray(data)||$scope.bpTree.pcId&&!($scope.bpTree.pcId.indexOf(key)<0)||(data=[data],bConvertToArray=!0),data){var domEle=$scope.getDomElementV2(parentDomEle,key);if(0!==domEle.length){var element=angular.element(domEle[0]),size=1;if(element&&(scope=element.scope())&&scope.control)if(void 0!==scope.control.propSetMap.repeatLimit&&null!==scope.control.propSetMap.repeatLimit&&scope.control.propSetMap.repeatLimit.constructor===Number&&angular.isArray(data)&&scope.control.propSetMap.repeatLimit+1<data.length&&(data=data.slice(0,scope.control.propSetMap.repeatLimit+1)),("Multi-select"===scope.control.type||"Radio"===scope.control.type||"Filter"===scope.control.type&&"Multi-select"===scope.control.propSetMap.type)&&scope.control.propSetMap.options&&angular.isArray(scope.control.propSetMap.options)){if((size=scope.control.propSetMap.options.length)<=0)return}else if("Edit Block"===scope.control.type&&(!parentResp[key]||0===parentResp[key].length)&&null==editBlockElementIndex){if(scope.control.children.length>0){var ebScope,ebRec,i;for(i=domEle.length-1;i>=0;i--)(ebRec=angular.element(domEle[i]))&&(ebScope=ebRec.scope())&&ebScope.control&&ebScope.$parent&&ebScope.$parent.child&&ebScope.deleteRecordFromDom(ebScope.$parent.child,i,ebScope,ebScope.$parent);ebRec=null,ebScope=null}return void delete parentResp[key]}var eleScope,control,controlType,domLength=domEle.length/size,min=domLength>=data.length?data.length:domLength,max=domLength>=data.length?domLength:data.length;scope&&(scope.control&&ouiBaseService.repeatEleTypeList.indexOf(scope.control.type)<0||scope.bpTree.pcId&&scope.bpTree.pcId.indexOf(key)>=0)&&(min=1,max=1),void 0!==editBlockElementIndex&&null!==editBlockElementIndex&&(min=max=1);for(var ind=0;ind<min;ind++)if(eleScope=$scope.getEleAngularScope(domEle[ind*size]))if(scope.bpTree.pcId&&scope.bpTree.pcId.indexOf(key)>=0||key.match("_Top")&&scope.bpTree.pcId&&scope.bpTree.pcId.indexOf(key.substring(0,key.indexOf("_Top")))>=0)switch(bValidation){case!0:break;default:var jsFunc;(jsFunc=ouiBaseService.dataPreprocessorMap[key])&&jsFunc.constructor===Function?scope.bpTree.response.vlcPersistentComponent[key]=jsFunc(data):scope.bpTree.response.vlcPersistentComponent[key]=data,delete parentResp[key]}else if(controlType=(control=eleScope.control?eleScope.control:eleScope.child).type,control&&-1===ouiBaseService.applyRespSkipTypeList.indexOf(controlType)){var dataToBeApplied=data[ind];switch(ouiBaseService.placeholderEleTypeList.indexOf(controlType)>=0&&(dataToBeApplied=bConvertToArray?data[0]:data),bValidation){case!0:if(dataToBeApplied&&dataToBeApplied.constructor===String){control.srvErr=dataToBeApplied;var invalidStepIndex=$scope.findStepIndex(eleScope,control.index,control.indexInParent);void 0!==invalidStepIndex&&null!==invalidStepIndex&&($scope.children[invalidStepIndex].tInvalid=!0,$scope.children[invalidStepIndex].inValid=!!$scope.children[invalidStepIndex].propSetMap.validationRequired,$scope.children[invalidStepIndex].bSrvErr=!0,(void 0===$scope.invalidStepIndex||null===$scope.invalidStepIndex||$scope.invalidStepIndex>invalidStepIndex)&&($scope.invalidStepIndex=invalidStepIndex))}break;default:$scope.setElementValue(control,dataToBeApplied,!1)&&(ouiBaseService.placeholderEleTypeList.indexOf(controlType)<0&&(ouiBaseService.invokeResp[control.name+control.$$hashKey]=control.response),"Selectable Items"===controlType&&eleScope.aggregate(eleScope,control.index,control.indexInParent,!0,-1)),delete parentResp[key]}}else control&&ouiBaseService.groupEleTypeList.indexOf(controlType)>=0&&(/Edit Block$/.test(controlType)?void 0!==editBlockElementIndex&&null!==editBlockElementIndex?$scope.applyCallRespAux(data[ind],domEle[editBlockElementIndex],bValidation):control.childrenC||$scope.applyCallRespAux(data[ind],domEle[ind],bValidation):/Type Ahead Block$/.test(controlType)&&void 0!==editBlockElementIndex&&null!==editBlockElementIndex?$scope.applyCallRespAux(data[ind],domEle[editBlockElementIndex],bValidation):$scope.applyCallRespAux(data[ind],domEle[ind],bValidation));switch(bValidation){case!0:break;default:var ebApply=!1;if(/Edit Block$/.test(controlType)&&control.childrenC&&(control.children=angular.copy(control.childrenC),domLength--,min--),data.length>domLength&&eleScope&&control&&(!$scope.bpTree.rMap||$scope.bpTree.rMap&&$scope.bpTree.rMap.hasOwnProperty(control.name))&&-1===ouiBaseService.actionEleTypes.indexOf(controlType)&&"Step"!==controlType&&"Filter Block"!==controlType&&"Filter"!==controlType){var index=eleScope.control.index;for(ind=min;ind<max;ind++){var bIncreaseIndex=!eleScope.child.eleArray[index].childrenC;$scope.addElement(eleScope,eleScope.child,index,angular.copy(data[ind]),data[ind]),bIncreaseIndex&&index++,"Edit Block"===controlType&&(ebApply=!0)}}var remainder=parentResp[key];null!==remainder&&void 0!==remainder?(remainder.constructor===Object&&0===Object.keys(remainder).length||angular.isArray(remainder)&&$scope.bpTree.labelMap.hasOwnProperty(key)||ebApply)&&delete parentResp[key]:delete parentResp[key]}}}},$scope.getDomElementV2=function(parentDomEle,path){var domEle=[];try{var tempEle;if($scope.bpTree.rMap)if($scope.bpTree.rMap.hasOwnProperty(path)||/\s/g.test(path)||!parentDomEle.getElementById)if($scope.bpTree.rMap.hasOwnProperty(path))domEle=parentDomEle.querySelectorAll("[id='"+path+"']");else(tempEle=parentDomEle.querySelector("[id='"+path+"']"))&&(domEle=[tempEle]);else(tempEle=parentDomEle.getElementById(path))&&(domEle=[tempEle]);else domEle=parentDomEle.querySelectorAll("[id='"+path+"']");return domEle}catch(err){return console.log(err),[]}return[]},$scope.getEleAngularScope=function(domEle){var scope=null,element=angular.element(domEle);return element&&(scope=element.scope()),scope},$scope.findStepIndex=function(scp,arrayIndex,indexInParent){var stepIndex;if(scp&&scp.$parent){var parent="lightning"===ouiBaseService.layout||"newport"===ouiBaseService.layout?scp.$parent:scp.$parent.$parent;parent&&(parent.child&&parent.child.eleArray?stepIndex=this.findStepIndex(parent.$parent,arrayIndex,parent.child.indexInParent):(parent.child&&(stepIndex=parent.child.indexInParent),parent.step&&(stepIndex=parent.step.indexInParent)))}return stepIndex},$scope.setElementValue=function(control,eleVal,bNew,setOrigVal){var bSet=!1,oldVal=control.response,cType=control.type;"Filter"===cType&&(cType+=" "+control.propSetMap.type);var newVal=eleVal;if("Radio"!==cType&&"Select"!==cType&&"Filter Select"!==cType&&"Multi-select"!==cType&&"Filter Multi-select"!==cType&&"Lookup"!==cType||(void 0!==eleVal&&null!==eleVal&&eleVal.constructor===Object&&(newVal=eleVal.name),void 0!==oldVal&&null!==oldVal&&(oldVal.constructor!==Object||"Radio"!==cType&&"Select"!==cType&&"Filter Select"!==cType&&"Lookup"!==cType||(oldVal=oldVal.name),!angular.isArray(oldVal)||"Multi-select"!==cType&&"Filter Multi-select"!==cType||(oldVal=ouiBaseService.handleSelect(cType,oldVal)))),angular.equals(newVal,oldVal)&&ouiBaseService.placeholderEleTypeList.indexOf(cType)<0)return bNew&&setOrigVal&&(setOrigVal.bSet=!0),bSet;var node="Selectable Items"===cType?"vlcSI":"vlcInputBlock";try{switch(cType){case"Selectable Items":case"Input Block":control.compDisable=!1,control.response=null,control[node]={};var jsFunc=ouiBaseService.dataPreprocessorMap[control.name];jsFunc&&jsFunc.constructor===Function&&(eleVal=jsFunc(eleVal)),void 0!==eleVal&&null!==eleVal&&(angular.isArray(eleVal)&&"Selectable Items"===cType?control.vlcSI[control.itemsKey]=eleVal:"Selectable Items"!==cType||eleVal[control.itemsKey]&&angular.isArray(eleVal[control.itemsKey])?eleVal.constructor===Object&&(control[node]=eleVal):control.vlcSI[control.itemsKey]=[eleVal]),bSet=!0;break;case"Select":case"Filter Select":if(void 0!==eleVal&&null!==eleVal&&(eleVal.constructor===Object&&eleVal.name||eleVal.constructor===String&&""!==eleVal))if(control.propSetMap.dependency&&"Select"===control.type)eleVal.constructor===Object?control.response=eleVal:control.response={name:eleVal,value:eleVal},control.propSetMap.options=null,bSet=!0;else{var nameString=eleVal.constructor===Object&&eleVal.name?eleVal.name:eleVal;if(void 0!==(options=angular.copy(control.propSetMap.options))&&null!==options&&angular.isArray(options))for(var i=0;i<options.length;i++)if(options[i].name===nameString){control.response=options[i],bSet=!0;break}}break;case"Checkbox":case"Disclosure":void 0!==eleVal&&null!==eleVal&&eleVal.constructor===Boolean&&(control.response=eleVal,bSet=!0);break;case"Email":case"URL":case"Type Ahead":void 0!==eleVal&&null!==eleVal&&eleVal.constructor===String&&(control.response=eleVal,bSet=!0);break;case"Password":case"Signature":case"Text":case"Text Area":if(void 0!==eleVal&&null!==eleVal&&eleVal.constructor===String){var bValid=!0;void 0!==control.propSetMap.minLength&&null!==control.propSetMap.minLength&&control.propSetMap.minLength.constructor===Number&&eleVal.length<control.propSetMap.minLength&&(bValid=!1),void 0!==control.propSetMap.maxLength&&null!==control.propSetMap.maxLength&&control.propSetMap.maxLength.constructor===Number&&eleVal.length>control.propSetMap.maxLength&&(bValid=!1),bValid&&(control.response=eleVal,bSet=!0)}break;case"Lookup":if(void 0!==eleVal&&null!==eleVal&&(eleVal.constructor===Object&&eleVal.name||eleVal.constructor===String&&""!==eleVal)){nameString=eleVal.constructor===Object&&eleVal.name?eleVal.name:eleVal;if(void 0!==(options=angular.copy(control.propSetMap.options))&&null!==options&&angular.isArray(options))for(i=0;i<options.length;i++)options[i].name===nameString&&(control.response=options[i].name,bSet=!0);bSet||(control.propSetMap.options=control.propSetMap.options||[],angular.isObject(eleVal)&&(control.propSetMap.options.push(eleVal),control.response=eleVal.name||""),angular.isString(eleVal)&&(control.propSetMap.options.push({name:eleVal,value:eleVal}),control.response=eleVal),bSet=!0)}break;case"Radio":if(void 0!==eleVal&&null!==eleVal&&(eleVal.constructor===Object&&eleVal.name||eleVal.constructor===String&&""!==eleVal))if(control.propSetMap.dependency)control.response=eleVal.constructor===Object?eleVal.name:eleVal,control.propSetMap.options=null,bSet=!0;else{nameString=eleVal.constructor===Object&&eleVal.name?eleVal.name:eleVal;if(void 0!==(options=angular.copy(control.propSetMap.options))&&null!==options&&angular.isArray(options))for(i=0;i<options.length;i++)options[i].name===nameString&&(control.response=options[i].name,bSet=!0)}break;case"Currency":if(void 0!==eleVal&&null!==eleVal&&eleVal.constructor===Number){bValid=!0;void 0!==control.propSetMap.min&&null!==control.propSetMap.min&&control.propSetMap.min.constructor===Number&&eleVal<control.propSetMap.min&&(bValid=!1),void 0!==control.propSetMap.max&&null!==control.propSetMap.max&&control.propSetMap.max.constructor===Number&&eleVal>control.propSetMap.max&&(bValid=!1),bValid&&(control.response=eleVal,bSet=!0)}break;case"Number":void 0!==eleVal&&null!==eleVal&&eleVal.constructor===Number&&(control.response=eleVal,bSet=!0);break;case"Telephone":if(void 0!==eleVal&&null!==eleVal&&eleVal.constructor===String){bValid=!0;void 0!==control.propSetMap.minLength&&null!==control.propSetMap.minLength&&control.propSetMap.minLength.constructor===Number&&eleVal.length<control.propSetMap.minLength&&(bValid=!1),void 0!==control.propSetMap.maxLength&&null!==control.propSetMap.maxLength&&control.propSetMap.maxLength.constructor===Number&&eleVal.length>control.propSetMap.maxLength&&(bValid=!1),bValid&&(control.response=eleVal,bSet=!0)}break;case"Range":bValid=!1;void 0!==eleVal&&null!==eleVal&&eleVal.constructor===Number&&(bValid=!0,eleVal<control.propSetMap.rangeLow&&(bValid=!1),eleVal>control.propSetMap.rangeHigh&&(bValid=!1)),control.response=bValid?eleVal:control.propSetMap.rangeLow,bSet=!0;break;case"Date":var dateVal=eleVal;void 0!==(eleVal="today"===eleVal?moment():"string"==control.propSetMap.dateType?moment(eleVal,control.propSetMap.modelDateFormat.toUpperCase()):moment.utc(eleVal))&&null!==eleVal&&eleVal.isValid()&&("string"===control.propSetMap.dateType?control.response=eleVal.format(control.propSetMap.modelDateFormat.toUpperCase()):dateVal.match(/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/)?control.response=dateVal:(eleVal=new Date(eleVal.format("YYYY-MM-DD")),eleVal=(eleVal=new Date(eleVal.getTime()+6e4*eleVal.getTimezoneOffset())).toISOString(),control.response=eleVal),bSet=!0);break;case"Date/Time (Local)":void 0!==(eleVal="today"===eleVal||"now"===eleVal?moment.utc():moment.utc(eleVal))&&null!==eleVal&&eleVal.isValid()&&(eleVal=eleVal.toISOString(),control.response=eleVal,bSet=!0);break;case"Time":var temp;"now"===eleVal?eleVal=(temp=moment.utc())._d:(temp=/^(\d\d):(\d\d):(\d\d)\.(\d\d\d)Z$/.exec(eleVal))?((eleVal=new Date(Date.UTC(70,0,1))).setHours(temp[1],temp[2],temp[3],temp[4]),temp=moment(eleVal)):temp=moment.utc(eleVal),void 0!==temp&&null!==temp&&temp.isValid()&&(temp=new Date(eleVal),temp=new Date(70,0,1,temp.getHours(),temp.getMinutes(),temp.getSeconds(),temp.getMilliseconds()),"string"===control.propSetMap.timeType?control.response=$filter("date")(eleVal,control.propSetMap.modelTimeFormat):control.response=temp.toISOString(),bSet=!0);break;case"Multi-select":case"Filter Multi-select":if(void 0!==eleVal&&null!==eleVal&&(eleVal.constructor===Object&&eleVal.name||eleVal.constructor===String&&""!==eleVal)){var names=(nameString=eleVal.constructor===Object&&eleVal.name?eleVal.name:eleVal).split(";");if(control.propSetMap.dependency){if(names&&names.length>0){for(var resp=[],j=0;j<names.length;j++)resp.push({name:names[j],value:names[j],selected:!0});control.response=resp,control.propSetMap.options=null,bSet=!0}}else{var msResp=angular.copy(control.propSetMap.options);if(names&&names.length>0&&void 0!==msResp&&null!==msResp&&angular.isArray(msResp))for(i=0;i<msResp.length;i++)names.indexOf(msResp[i].name)>=0?(msResp[i].selected=!0,control.propSetMap.options[i].selected=!0):(msResp[i].selected=!1,delete control.propSetMap.options[i].selected);control.response=msResp,bSet=!0}}break;case"Radio Group":if(void 0!==eleVal&&null!==eleVal&&eleVal.constructor===Object){var options,radioGroup={};if(void 0!==(options=angular.copy(control.propSetMap.options))&&null!==options&&angular.isArray(options)){var keys=Object.keys(eleVal);for(i=0;i<keys.length;i++)for(var oindex=0;oindex<options.length;oindex++)options[oindex].name===eleVal[keys[i]]&&(radioGroup[keys[i]]=options[oindex].name,bSet=!0);control.response=radioGroup}}}}catch(err){console.log(err)}if(bSet)return bNew&&setOrigVal&&(setOrigVal.bSet=!0),bSet;if(bNew||!bSet){newVal=null;if("Checkbox"===cType||"Disclosure"===cType)newVal=!1;else if("Multi-select"===cType||"Filter Multi-select"===cType){if((newVal=angular.copy(control.response))&&angular.isArray(newVal))for(var ind=0;ind<newVal.length;ind++)delete newVal[ind].selected;if(control.propSetMap.options&&angular.isArray(control.propSetMap.options))for(i=0;i<control.propSetMap.options.length;i++)delete control.propSetMap.options[i].selected}else ouiBaseService.placeholderEleTypeList.indexOf(cType)>=0&&(newVal={});if((angular.equals(newVal,oldVal)||("Multi-select"===cType||"Filter Multi-select"===cType)&&null===oldVal)&&ouiBaseService.placeholderEleTypeList.indexOf(cType)<0)return bNew&&setOrigVal&&(setOrigVal.bSet=bSet),bSet;ouiBaseService.placeholderEleTypeList.indexOf(cType)<0&&(control.response=newVal),ouiBaseService.placeholderEleTypeList.indexOf(control.type)>=0&&(control[node]={}),bSet=!0,bNew&&setOrigVal&&(setOrigVal.bSet=!1)}return bSet},$scope.addElement=function(scp,control,index,data,dataCopy){var newItem=angular.copy(control.eleArray[index]);if(control.eleArray[index].childrenC)control.eleArray.splice(index,1,newItem),delete newItem.childrenC;else{newItem.index=index+1,control.eleArray.splice(index+1,0,newItem);for(var i=index+2;i<control.eleArray.length;i++)control.eleArray[i].index=control.eleArray[i].index+1}$timeout(function(){$scope.setResponse(newItem,data,dataCopy),ouiBaseService.blockEleTypeList.indexOf(control.eleArray[0].type)>=0&&scp.$parent?scp.aggregate(scp.$parent,control.index,control.indexInParent,!1,index):scp.aggregate(scp,control.index,control.indexInParent,!1,index)},0)},$scope.setResponse=function(eleNode,data,dataCopy){if(eleNode){if(-1===ouiBaseService.applyRespSkipTypeList.indexOf(eleNode.type)){var setOrigVal={};$scope.setElementValue(eleNode,data,!0,setOrigVal);return setOrigVal.bSet&&(ouiBaseService.invokeResp[eleNode.name+eleNode.$$hashKey]=eleNode.response),setOrigVal.bSet}for(var realData={},bAllNull=!0,i=0;i<eleNode.children.length;i++)if(!(ouiBaseService.noneDataControlTypeListV2.indexOf(eleNode.children[i].eleArray[0].type)>=0)){var eleData,bHasKey=!1;data?(bHasKey=data.hasOwnProperty(eleNode.children[i].eleArray[0].name),eleData=data[eleNode.children[i].eleArray[0].name]):eleData=null,void 0===eleData&&(eleData=null);var eleDataArray=eleData;angular.isArray(eleDataArray)||(eleDataArray=[eleData]);for(var min=eleNode.children[i].eleArray.length>=eleDataArray.length?eleDataArray.length:eleNode.children[i].eleArray.length,max=eleNode.children[i].eleArray.length<=eleDataArray.length?eleDataArray.length:eleNode.children[i].eleArray.length,k=0;k<min;k++)$scope.setResponse(eleNode.children[i].eleArray[k],eleDataArray[k],angular.copy(eleDataArray[k]))||(eleDataArray[k]=eleNode.children[i].eleArray[k].response);if(eleDataArray.length<eleNode.children[i].eleArray.length)eleNode.children[i].eleArray.splice(min,max-min);else if(eleDataArray.length>eleNode.children[i].eleArray.length)for(k=min;k<max;k++){var temp=angular.copy(eleNode.children[i].eleArray[0]);eleNode.children[i].eleArray.splice(k,0,temp),eleNode.children[i].eleArray[k].index=k,$scope.setResponse(eleNode.children[i].eleArray[k],eleDataArray[k],angular.copy(eleDataArray[k]))||(eleDataArray[k]=eleNode.children[i].eleArray[k].response)}1===eleDataArray.length&&(eleDataArray=eleDataArray[0]),eleNode.children[i].response=eleDataArray,realData[eleNode.children[i].eleArray[0].name]=eleNode.children[i].response,void 0!==eleNode.children[i].response&&null!==eleNode.children[i].response&&(bAllNull=!1),bHasKey&&delete dataCopy[eleNode.children[i].eleArray[0].name]}return!bAllNull||"Edit Block"===eleNode.type||"Block"===eleNode.type&&eleNode.propSetMap.ebp?eleNode.response=realData:eleNode.response=null,!1}},$scope.init=function(scp,control,option){var initInterval;switch(control.type){case"Select":case"Radio":case"Multi-select":ouiBaseService.bPLSeeding?initInterval=setInterval(function(){!0!==$rootScope.seedingDone&&!0!==$rootScope.seedingFailed||(clearInterval(initInterval),$scope.initAux(scp,control,option))},10):$scope.initAux(scp,control,option);break;default:$scope.initAux(scp,control,option)}},$scope.initAux=function(scp,control,option){if(void 0===control.response||null===control.response)try{if(-1===ouiBaseService.applyRespSkipTypeList.indexOf(control.type)&&ouiBaseService.pfJSON&&Object.getOwnPropertyNames(ouiBaseService.pfJSON).length>0&&ouiBaseService.pfJSON.hasOwnProperty(control.name)||control.propSetMap.hasOwnProperty("defaultValue")&&null!=control.propSetMap.defaultValue){var eleVal=ouiBaseService.pfJSON[control.name];null==eleVal&&control.propSetMap.hasOwnProperty("defaultValue")&&null!=control.propSetMap.defaultValue&&(eleVal=control.propSetMap.defaultValue),void 0!==eleVal&&null!==eleVal&&$scope.setElementValue(control,eleVal,!1)&&(ouiBaseService.pfJSONFill[control.name]=eleVal),delete scp.bpTree.response[control.name],delete ouiBaseService.pfJSON[control.name]}else"Multi-select"===control.type&&control.req&&!control.response?scp.loopform.$setValidity("required",!1):"Radio Group"===control.type&&control.req&&!control.response&&scp.loopform.$setValidity("required",!1);"Checkbox"!==control.type&&"Disclosure"!==control.type||null!==control.response?"Multi-select"===control.type?scp.onMultiSelect(scp,control,option,!0):"Range"!==control.type||null!==control.response||isNaN(control.propSetMap.rangeLow)||(control.response=parseFloat(control.propSetMap.rangeLow)):(control.response=!1,scp.aggregate(scp,control.index,control.indexInParent,!0,-1))}catch(err){console.log(err.message)}},$scope.onMultiSelect=function(scp,control,option,bInit){bInit&&control.propSetMap.dependency||(control.response=control.propSetMap.options);var validForm=!1;"Multi-select"===control.type&&(validForm=!control.req||(!(!option||!option.selected)||$scope.MultiSelectFilled(control)),"lightning"!==ouiBaseService.layout&&"newport"!==ouiBaseService.layout||!bInit?scp.$parent.loopform.$setValidity("required",validForm):scp.loopform.$setValidity("required",validForm)),scp.aggregate(scp,control.index,control.indexInParent,!0,-1)},$scope.MultiSelectFilled=function(control){if(control.propSetMap.options&&void 0!==control.response&&null!==control.response)for(var i=0;i<control.response.length;i++)if(control.response[i].selected)return!0;return!1},$scope.setAllRadioGroup=function(scp,newValue){for(var radiolabels=scp.control.propSetMap.radioLabels,radioGroup={},i=0;i<radiolabels.length;i++)radioGroup[radiolabels[i].name]=newValue;scp.control.response=radioGroup},$scope.onRadioGroupSelect=function(scp,control,option,bInit){var validForm=!1;"Radio Group"===control.type&&(validForm=!control.req||$scope.radioGroupFilled(control),"lightning"!==ouiBaseService.layout&&"newport"!==ouiBaseService.layout||!bInit?scp.$parent.loopform.$setValidity("required",validForm):scp.loopform.$setValidity("required",validForm)),scp.aggregate(scp,control.index,control.indexInParent,!0,-1)},$scope.radioGroupFilled=function(control){if(control.propSetMap.options&&void 0!==control.response&&null!==control.response){for(var ctrlKeys=Object.keys(control.response),ctrlVals=Object.values(control.response),rLabels=control.propSetMap.radioLabels,options=(control.propSetMap.radioLabels,control.propSetMap.options),rKeyCheck={},rValueCheck={},i=0;i<rLabels.length;i++)rKeyCheck[rLabels[i].name]=0;for(i=0;i<ctrlKeys.length;i++)ctrlKeys[i]in rKeyCheck&&(rKeyCheck[ctrlKeys[i]]+=1);if(Object.values(rKeyCheck).reduce(function(a,b){return a+b})!==rLabels.length)return!1;for(i=0;i<options.length;i++)rValueCheck[options[i].name]=!0;for(i=0;i<ctrlVals.length;i++)if(!(ctrlVals[i]in rValueCheck))return!1;return!0}return!1},$scope.validateRequired=function(scp,control,bInit){if(scp.loopform)return control.req||scp.miniForm&&control.propSetMap.required?"Radio Group"===control.type?scp.loopform.$setValidity("required",$scope.radioGroupFilled(control)):"Multi-select"===control.type?scp.loopform.$setValidity("required",$scope.MultiSelectFilled(control)):"Disclosure"===control.type&&scp.loopform.$setValidity("required",!0===control.response):scp.loopform.$setValidity("required",!0),!0},$scope.removeFile=function(scp,control,index){if(control&&control.response){var dataBeingDeleted=control.response[index],toDelete=scp.bpTree.filesMap[control.response[index].data];if(delete scp.bpTree.filesMap[control.response[index].data],control.response.splice(index,1),control.propSetMap.uploadContDoc&&toDelete&&18==toDelete.length){var configObj={sClassName:ouiBaseService.sNSC+"BusinessProcessDisplayController.BusinessProcessDisplayControllerOpen",sMethodName:"DeleteOSContentDocument",input:angular.toJson({contentDocumentId:toDelete}),options:"{}"};ouiBaseService.OmniRemoteInvoke(configObj).then(function(){if(control.propSetMap.remoteClass&&$scope.remoteCallInvoke){var controlClone=angular.copy(control);controlClone.propSetMap.remoteOptions.vlcFileDeleted=toDelete,controlClone.propSetMap.remoteOptions.vlcFileKey=control.name,controlClone.ui={};var input={};input[control.name]=[dataBeingDeleted],$scope.remoteCallInvoke(input,controlClone,!1,null,scp,null,"contentDocumentDelete")}})}}scp.aggregate(scp,control.index,control.indexInParent,!0,index)},$scope.uploadContentVersions=function(scp,control){if(control&&control.response){var promiseArray=[],documentFiles=[];control.response.forEach(function(file){var bodyData=scp.bpTree.filesMap[file.data];if(bodyData&&bodyData.length>18){bodyData=bodyData.substr(bodyData.indexOf(",")+1);var actualParentIds=[];control.propSetMap.contentParentId.forEach(function(parentId){try{var asArray=angular.fromJson(scp.handleMergeField(angular.toJson(parentId),null,null,null,null,null,!0));actualParentIds=actualParentIds.concat(asArray)}catch(e){actualParentIds.push(scp.handleMergeField(parentId))}}),$rootScope.loading=!0,$rootScope.loadingMessage="";var configObj={sClassName:"Vlocity CreateOSContentVersion",sMethodName:"CreateOSContentVersion",bodyData:bodyData,parentId:angular.toJson(actualParentIds),filename:file.filename,options:angular.toJson(control.propSetMap)},promise=ouiBaseService.CreateOSContentVersion(configObj).then(function(result){"string"==typeof result&&(result=angular.fromJson(result)),scp.bpTree.filesMap[file.data]=result.contentDocumentId,scp.bpTree.contentVersions||(scp.bpTree.contentVersions={}),documentFiles.push(file),scp.bpTree.contentVersions[file.data]=result.contentVersionId},function(error){delete scp.bpTree.filesMap[file.data],control.response=control.response.filter(function(resFile){return resFile.data!=file.data});var errorMsg=$scope.errorReplace(error.error,control);$window.alert(new Error(errorMsg))});promiseArray.push(promise)}}),promiseArray.length?$q.all(promiseArray).then(function(results){if(documentFiles.length>0&&control.propSetMap.remoteClass&&$scope.remoteCallInvoke){var input={};input[control.name]=documentFiles;var controlClone=angular.copy(control);controlClone.propSetMap.remoteOptions.vlcFileKey=control.name,controlClone.ui={},$scope.remoteCallInvoke(input,controlClone,!1,null,scp,null,"contentDocumentAdd",null,null,null,null,function(result){$rootScope.loading=!1})}else $rootScope.loading=!1},function(error){$rootScope.loading=!1;var errorMsg=$scope.errorReplace(error.error,control);$window.alert(new Error(errorMsg))}):$rootScope.loading=!1}},$scope.isFileRemovable=function(scp,control,index){if(control&&control.response){var fileData=scp.bpTree.filesMap[control.response[index].data];if(fileData&&"data"!==fileData.substring(0,4)&&"review"==ouiBaseService.scriptState)return!1;if(null!==fileData)return!0}return!1},$scope.getLookupOptions=function(control,scp){var className,methodName;control.propSetMap.options=[],!1!==control.propSetMap.clearValue&&(control.response=null,scp.aggregate(scp,control.index,control.indexInParent,!0,-1));var input={},type=control.propSetMap.dataSource.type,index=$scope.findRepeatIndex(control),option={};if("SObject"===type){className=ouiBaseService.sNSC+"DefaultFetchPicklistOptionsImpl",methodName="fetchLookupOptions";var mapItems=control.propSetMap.dataSource.mapItems;if(mapItems&&mapItems.phase1MapItems&&mapItems.phase2MapItems&&angular.isArray(mapItems.phase1MapItems)&&angular.isArray(mapItems.phase2MapItems)&&mapItems.phase1MapItems.length>0&&mapItems.phase2MapItems.length>0){input.MapItems=mapItems.phase1MapItems.concat(mapItems.phase2MapItems);var inputParams=control.propSetMap.dataSource.mapItems.inputParameters,queryCriteria={};if(inputParams&&angular.isArray(inputParams)){for(var i=0;i<inputParams.length;i++){var eleName=inputParams[i].element;angular.equals(index,NaN)||(eleName=$scope.replaceNIndex(eleName,index+1)),queryCriteria[inputParams[i].inputParam]=$scope.getElementValue(eleName)}input.DRParams=queryCriteria}}}else if("Custom"===type){var source=control.propSetMap.dataSource.source;if(source){var strArray=source.split(".");strArray&&(2===strArray.length?(className=strArray[0],methodName=strArray[1]):3===strArray.length&&(className=strArray[0]+"."+strArray[1],methodName=strArray[2])),(input=$scope.bpTree.response)||(input={})}}else if("PicklistFilteredbyRecordType"===type){className=ouiBaseService.sNSC+"DefaultOmniScriptSObjectPicklist",methodName="GetSObjectPicklistValues";var picklistObjectAndField=control.propSetMap.dataSource.picklistObjectAndField.split(".");option.picklistObject=picklistObjectAndField[0],option.picklistField=picklistObjectAndField[1],option.picklistRecordType=scp.handleMergeField(control.propSetMap.dataSource.picklistRecordType,!1,null,control),input=$scope.bpTree.response}if(void 0!==className&&null!==className&&void 0!==methodName&&null!==methodName&&input&&0!==Object.getOwnPropertyNames(input).length){$rootScope.loading=!0,$rootScope.loadingMessage="",option.useQueueableApexRemoting=!0===control.propSetMap.useQueueableApexRemoting;var deferred=$q.defer(),configObj={sClassName:className,sMethodName:methodName,input:angular.toJson(input),options:angular.toJson(option),iTimeout:void 0,label:{label:control&&control.name}};return ouiBaseService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);if(remoteResp)if("OK"!==remoteResp.error){$rootScope.loading=!1;var errorMsg=$scope.errorReplace(remoteResp.error,control);$window.alert(new Error(errorMsg))}else $rootScope.loading=!1,remoteResp.options?(angular.isArray(remoteResp.options)||remoteResp.options.constructor!==Object||(Object.keys(remoteResp.options).length>0?remoteResp.options=[remoteResp.options]:remoteResp.options=[]),control.propSetMap.options=remoteResp.options):control.propSetMap.options=[];else $rootScope.loading=!1;deferred.resolve()},function(error){$rootScope.loading=!1;var errorMsg=$scope.errorReplace(error,control);$window.alert(new Error(errorMsg)),deferred.reject()}),deferred.promise}},$scope.findRepeatIndex=function(control){$scope.topBPDom||($scope.topBPDom=VOUINS.getTopBPDom($scope));var domEle=$scope.topBPDom;if(void 0!==control.rootIndex&&null!==control.rootIndex&&(domEle=!/\s/g.test($scope.bpTree.children[control.rootIndex].name)&&$scope.topBPDom.getElementById?$scope.topBPDom.getElementById($scope.bpTree.children[control.rootIndex].name):$scope.topBPDom.querySelector("[id='"+$scope.bpTree.children[control.rootIndex].name+"']")),domEle){var eleArray=[];if($scope.bpTree.rMap)if($scope.bpTree.rMap.hasOwnProperty(control.name))eleArray=domEle.querySelectorAll("[id='"+control.name+"']");else{var tempEle=domEle.querySelector("[id='"+control.name+"']");tempEle&&(eleArray=[tempEle])}else eleArray=domEle.querySelectorAll("[id='"+control.name+"']");if(eleArray&&eleArray.length>0)for(var i=0;i<eleArray.length;i++){var element=angular.element(eleArray[i]);if(element){var scp=element.scope();if(scp){var ctrl=scp.control;if(ctrl&&ctrl.$$hashKey===control.$$hashKey)return i}}}}return NaN},$scope.onSelectItem=function(control,option,index,scp,bFlip){if(void 0!==control&&null!==control&&void 0!==option&&null!==option){var bSetVal=!0,response=[];bFlip&&(void 0===option.vlcSelected||null===option.vlcSelected?option.vlcSelected=bSetVal:(bSetVal=!option.vlcSelected,option.vlcSelected=bSetVal));for(var recSet=control.vlcSI[control.itemsKey],i=0;i<recSet.length;i++)!0===option.vlcSelected&&option.$$hashKey!==recSet[i].$$hashKey&&"Single"===control.propSetMap.selectMode&&(recSet[i].vlcSelected=!1),!0===recSet[i].vlcSelected&&response.push(recSet[i]);response.length>0?control.response=response:control.response=null,!0===control.propSetMap.dataJSON&&scp.aggregate(scp,control.index,control.indexInParent,!0,-1)}},$scope.handleMergeField=function(inputStr,bReplaceIndex,index,element,display,editBlkIndex,bEscape){if(void 0===inputStr||null===inputStr)return"";void 0!==index&&null!==index||(index=NaN),void 0!==editBlkIndex&&null!==editBlkIndex?index=editBlkIndex:VOUINS.isRepeatNotation(inputStr)&&element&&(index=$scope.findRepeatIndex(element));var fields=inputStr.match(/%([^[%]+)%/g),resultName=inputStr;if(fields)for(var i=0;i<fields.length;i++){var elem=fields[i].replace(/%/g,"");if(angular.equals(index,NaN)||(elem=$scope.replaceNIndex(elem,index+1)),!0!==bReplaceIndex){var elemValue=$scope.getElementValue(elem,!!display&&"Display");null===elemValue||void 0===elemValue?resultName=resultName.split(fields[i]).join(""):(bEscape&&elemValue.constructor===String&&(elemValue=(elemValue=(elemValue=elemValue.replace(/\\/g,"\\\\")).replace(/\"/g,'\\"')).replace(/[\n]/g,"\\n")),resultName=elemValue.constructor===String?resultName.split(fields[i]).join(elemValue):elemValue.constructor===Object||elemValue.constructor===Array?(resultName=resultName.split('"'+fields[i]+'"').join(angular.toJson(elemValue))).split(fields[i]).join(angular.toJson(elemValue)):1===fields.length&&inputStr.match("^%")&&inputStr.match("%$")?elemValue:(resultName=resultName.split('"'+fields[i]+'"').join(elemValue)).split(fields[i]).join(elemValue))}else angular.equals(index,NaN)||null!==elem&&void 0!==elem&&(resultName=resultName.split(fields[i]).join("%"+elem+"%"))}return resultName&&"string"==typeof resultName&&resultName.indexOf("$Vlocity.Percent")>-1&&(resultName=resultName.replace(/\$Vlocity.Percent/g,"%")),resultName=null===resultName||void 0===resultName?"":resultName},$scope.replaceNIndex=function(prop,index){try{var propArray=$scope.preprocessElementInput(prop),concatStr="";if(propArray&&propArray.length>0)for(var idx=0;idx<propArray.length;idx++){if(propArray[idx].length>0&&(concatStr+=propArray[idx][0],propArray[idx].length>1)){var n=index;concatStr+="|"+eval(propArray[idx][1])}idx<propArray.length-1&&(concatStr+=":")}return concatStr}catch(e){}return prop},$scope.getElementValue=function(prop,returnType){try{var propArray=$scope.preprocessElementInput(prop),scope=$scope.getElement(prop);if(scope){if(scope.length>0){if(1===scope.length)return $scope.getSingleElementValueAux(scope[0],returnType);for(var returnVal=[],i=0;i<scope.length;i++){var contrl=scope[i].control;if(("Multi-select"===contrl.type||"Radio"===contrl.type||"Filter"===contrl.type&&"Multi-select"===contrl.propSetMap.type||"Radio Group"===contrl.type)&&contrl.propSetMap.options&&angular.isArray(contrl.propSetMap.options))i%contrl.propSetMap.options.length==0&&returnVal.push($scope.getSingleElementValueAux(scope[i],returnType));else returnVal.push($scope.getSingleElementValueAux(scope[i],returnType))}return 1===returnVal.length&&(returnVal=returnVal[0]),returnVal}return}return"timeStamp"===prop||"userId"===prop||"userName"===prop||"userProfile"===prop?$scope.bpTree[prop]:$scope.getJSONNode($scope.bpTree.response,propArray)}catch(err){return void console.log(err)}},$scope.getJSONNode=function(data,propArray){data=[data];var bArray=!1;if(propArray&&propArray.length>0){for(var idx1=0;idx1<propArray.length;idx1++){for(var returnData=[],i=0;i<data.length;i++){var tmp=$scope.getJSONDataByPath(data[i],propArray[idx1]);angular.isArray(tmp)&&(bArray=!0),null!==tmp&&void 0!==tmp&&(returnData=returnData.concat(tmp))}if(data=returnData,!returnData||0===returnData.length)break}if(data){if(1===data.length)return null===data[0]||void 0===data[0]||angular.equals(data[0],NaN)?null:bArray?data:data[0];if(data.length>1)return data}}else;},$scope.getJSONDataByPath=function(data,path){if(0===path.length)return null;if(!data)return null;try{if(void 0===(data=data[path[0]])||null===data||angular.equals(data,NaN))return null;var index=NaN;return 1!==path.length||angular.isArray(data)?(path.length>1&&!angular.isArray(data)&&(data=[data]),path.length>1&&(index=VOUINS.isDigit(path[1])?parseInt(path[1],10)-1:NaN),angular.equals(index,NaN)?data:index<data.length&&index>=0?void 0===(data=data[index])||null===data||angular.equals(data,NaN)?null:data:null):data}catch(err){return console.log(err),null}return null},$scope.preprocessElementInput=function(prop){if(!prop)return null;var substrArray=prop.split(":");if(substrArray)for(var ind=0;ind<substrArray.length;ind++)substrArray[ind]=substrArray[ind].split("|");return substrArray},$scope.getSingleElementValueAux=function(scope,returnType){var dateAsDate="Date"==returnType||1==returnType;if(!scope||!scope.control)return scope&&scope.child&&"Step"===scope.child.type?scope.child.response:null;if(!1===scope.control.show)return null;var cType=scope.control.type;if("Filter"===scope.control.type&&(cType+=" "+scope.control.propSetMap.type),"Display"==returnType){if(scope.loopform&&scope.loopform.loopname&&null!==scope.loopform.loopname.$viewValue){var out="";switch(cType){case"Password":if(null===scope.loopform.loopname.$viewValue){out=null;break}for(var i=0;i<(scope.loopform.loopname.$viewValue.value||scope.loopform.loopname.$viewValue).length;i++)out+="*";break;case"Date/Time (Local)":if(angular.isString(scope.loopform.loopname.$viewValue)){out=void 0!==scope.loopform.timectrl&&"string"==typeof scope.loopform.timectrl.$viewValue?scope.loopform.loopname.$viewValue+" "+scope.loopform.timectrl.$viewValue:angular.isString(scope.control.response)?new Date(scope.control.response):scope.control.response;break}default:out=scope.loopform.loopname.$viewValue&&scope.loopform.loopname.$viewValue.value||scope.loopform.loopname.$viewValue}return out}if(scope.control.response&&null!=scope.control.response.value)return scope.control.response.value}switch(cType){case"Radio":case"Select":case"Filter Select":case"Lookup":return void 0!==scope.control.response&&null!==scope.control.response?"Display"==returnType?scope.control.propSetMap.options.find(function(opt){return opt.name==scope.control.response||opt.name==scope.control.response.name}).value:void 0!==scope.control.response.name&&null!==scope.control.response.name&&""!==scope.control.response.name?scope.control.response.name:scope.control.response:null;case"Radio Group":return null!==scope.control.response?scope.control.response[scope.label.name]:null;case"Checkbox":case"Disclosure":return void 0!==scope.control.response&&null!==scope.control.response&&scope.control.response;case"Email":case"Password":case"Signature":case"Telephone":case"Text":case"Text Area":case"URL":case"Type Ahead":case"File":case"Image":return void 0!==scope.control.response&&null!==scope.control.response&&""!==scope.control.response?scope.control.response:null;case"Currency":case"Number":case"Range":return isNaN(scope.control.response)||null==scope.control.response?null:Number(scope.control.response);case"Date":case"Date/Time (Local)":case"Time":if(void 0===scope.control.response||null===scope.control.response)return null;if("string"===(scope.control.propSetMap.timeType||scope.control.propSetMap.dateType))return scope.control.response;var temp=moment.utc(scope.control.response);if(temp.isValid())return dateAsDate?temp.toDate():temp.toISOString();break;case"Multi-select":case"Filter Multi-select":return void 0!==scope.control.response&&null!==scope.control.response&&""!==scope.control.response?ouiBaseService.handleSelect(cType,scope.control.response,"Display"==returnType):null;case"Formula":case"Aggregate":case"Validation":return"Date"===scope.control.propSetMap.dataType&&scope.control.response?scope.control.response.toISOString():scope.control.response;case"Selectable Items":case"Input Block":case"Filter Block":case"Block":case"Type Ahead Block":case"Edit Block":return scope.control.response;default:return null}},$scope.getElement=function(prop){var scope=[];if(!prop)return null;var propArray=$scope.preprocessElementInput(prop);$scope.topBPDom||($scope.topBPDom=VOUINS.getTopBPDom($scope));var domEleArray=[[$scope.topBPDom]];if(propArray&&propArray.length>0)for(var idx=0;idx<propArray.length;idx++){for(var returnDomArray=[],dIdx=0;dIdx<domEleArray.length;dIdx++)for(var tmp=domEleArray[dIdx],i=0;i<tmp.length;i++){var tempArray=$scope.getDomElement(tmp[i],propArray[idx]);tempArray&&tempArray.length>0&&returnDomArray.push(tempArray)}if(domEleArray=returnDomArray,!returnDomArray||0===returnDomArray.length)break}if(domEleArray&&domEleArray.length>0)for(i=0;i<domEleArray.length;i++){tmp=domEleArray[i];for(var j=0;j<tmp.length;j++){var element=angular.element(tmp[j]);element&&scope.push(element.scope())}}return scope&&scope.length>0?scope:null},$scope.getDomElement=function(parentDomEle,path){if(0===path.length)return null;var optionLength,domEleArray=[],bAdjust=!1;try{var eleArray=[];if($scope.bpTree.rMap)if($scope.bpTree.rMap.hasOwnProperty(path[0])||/\s/g.test(path[0])||!parentDomEle.getElementById)$scope.bpTree.rMap.hasOwnProperty(path[0])?eleArray=parentDomEle.querySelectorAll("[id='"+path[0]+"']"):(eleArray=parentDomEle.querySelector("[id='"+path[0]+"']"))&&(eleArray=[eleArray]);else{var tempEle=parentDomEle.getElementById(path[0]);tempEle&&(eleArray=[tempEle])}else eleArray=parentDomEle.querySelectorAll("[id='"+path[0]+"']");if(eleArray&&eleArray.length>0){var element=angular.element(eleArray[0]);element&&(scope=element.scope(),scope&&scope.control&&("Multi-select"===scope.control.type||"Radio"===scope.control.type||"Filter"===scope.control.type&&"Multi-select"===scope.control.propSetMap.type)&&scope.control.propSetMap.options&&angular.isArray(scope.control.propSetMap.options)&&(bAdjust=!0,optionLength=scope.control.propSetMap.options.length));var index=NaN;return path.length>1&&(index=VOUINS.isDigit(path[1])?parseInt(path[1],10)-1:NaN),angular.equals(index,NaN)?eleArray:index<eleArray.length&&index>=0&&(bAdjust&&(index*=optionLength),index<eleArray.length&&index>=0)?(domEleArray.push(eleArray[index]),domEleArray):null}}catch(err){return console.log(err),null}return null},$scope.getCurrencySymbol=function(scope,scpService){try{if(!scope.bpTree.hasOwnProperty("oSCurrencySymbol")){var curSymbol;if(scpService||(scpService={}),!scope.bpTree.propSetMap.hasOwnProperty("currencyCode"))return void(scope.bpTree.oSCurrencySymbol=null);(curSymbol=currencySymbol[scpService.oSCurrencyCode]||currencySymbol[scpService.oSCurrencyCodeAttr]||currencySymbol[scope.bpTree.propSetMap.currencyCode]||currencySymbol[scope.bpTree.userCurrencyCode])||(curSymbol=currencySymbol.USD),scope.bpTree.oSCurrencySymbol=curSymbol.text,scope.bpTree.oSCurrencySetting=curSymbol,scope.bpTree.cpqCurrencySymbol=currencySymbol[scope.bpTree.userCurrencyCode]?currencySymbol[scope.bpTree.userCurrencyCode].text:currencySymbol.USD.text}}catch(err){console.log(err)}},$scope.checkValidity=function(scp,arrayIndex,indexInParent,validationRequired,ngformId,bNoAlert){var isInvalid=!1,isTruelyInvalid=!1,stepValidationReq={},hasClass=function(element,cls){return(" "+element.className+" ").indexOf(" "+cls+" ")>-1};if("Submit"===validationRequired&&scp.bpTree&&scp.bpTree.children)for(var i=0;i<scp.bpTree.children.length;i++){var formId=scp.bpTree.sOmniScriptId+"-"+i;if((form=document.getElementById(formId))&&!0===(isInvalid=hasClass(form,"ng-invalid")))break}if("Step"===validationRequired||"StepNext"===validationRequired){var form;formId="Step"===validationRequired?$scope.findStep(scp,arrayIndex,indexInParent,stepValidationReq):ngformId;(form=document.getElementById(formId))&&(isInvalid=isTruelyInvalid=hasClass(form,"ng-invalid")),!1===stepValidationReq.validationRequired&&(isInvalid=!1),!0===stepValidationReq.truelyInvalid&&(isTruelyInvalid=!0),scp.child&&"Step"===scp.child.type&&(scp.child.tInvalid=isTruelyInvalid,scp.child.inValid=isInvalid)}return isInvalid&&!bNoAlert&&window.alert(new Error(customLabels.OmniStepValidationError)),$scope.miniForm?isInvalid:!bNoAlert&&isInvalid},$scope.findStep=function(scp,arrayIndex,indexInParent,stepValidationReqProp){var formId;if(scp&&scp.$parent){var parent="lightning"===ouiBaseService.layout||"newport"===ouiBaseService.layout?scp.$parent:scp.$parent.$parent;if(parent)if(parent.child&&parent.child.eleArray)formId=$scope.findStep(parent.$parent,arrayIndex,parent.child.indexInParent,stepValidationReqProp);else{var root=parent.child?parent.child:parent.step;if(root){var stepIndex=root.indexInParent;formId=scp.bpTree.sOmniScriptId+"-"+stepIndex,root.propSetMap.validationRequired||(stepValidationReqProp.validationRequired=!1),!0===root.bSrvErr&&(stepValidationReqProp.truelyInvalid=!0)}}}return formId},$scope.errorReplace=function(inputError,control){var customError=control&&control.propSetMap?control.propSetMap.errorMessage:null,error=function(err){try{return angular.fromJson(err)}catch(e){return err}}(inputError),newError=error,headerError=$scope.bpTree&&$scope.bpTree.propSetMap?$scope.bpTree.propSetMap.errorMessage:null;return headerError&&(newError=$scope.performErrorReplace(error,headerError.custom)),newError===error&&customError&&(newError=$scope.performErrorReplace(error,customError.custom)),newError===error&&customError&&customError.default?newError=customError.default:"object"==typeof newError&&(newError=angular.toJson(error)),newError},$scope.performErrorReplace=function(error,customError){if(!customError)return error;if("string"==typeof error){for(var i=0;i<customError.length;i++)if(error===customError[i].value){error=customError[i].message;break}}else if("object"==typeof error)for(i=0;i<customError.length;i++){var path=customError[i].path,propArray=$scope.preprocessElementInput(path),node=$scope.getJSONNode(error,propArray)||null;if(node){if(path&&!customError[i].value&&!customError[i].message){error=node;break}if(node===customError[i].value){error=customError[i].message;break}}}return error}}},{}],3:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("appFilereader",function($q,ouiBaseService){var slice=Array.prototype.slice;return{restrict:"A",require:"ngModel",priority:10,link:function(scope,element,attrs,ngModel){ngModel&&("miniForm"===attrs.appFilereader&&(ouiBaseService.miniForm=!0),ngModel.$render=function(){},element.bind("change",function(e){var element=e.target;element.value&&(element.disabled=!0,$q.all(slice.call(element.files,0).map(function(file){var deferred=$q.defer(),reader=new FileReader;return reader.onload=function(e){deferred.resolve(e.target.result)},reader.onerror=function(e){deferred.reject(e)},reader.readAsDataURL(file),deferred.promise})).then(function(values){if(element.multiple||element){var fileArray=ngModel.$viewValue;VOUINS.isEmpty(fileArray)&&(fileArray=[]);for(var i=0;i<element.files.length;i++){var f={};f.filename=element.files[i].name,f.size=element.files[i].size,f.data=VOUINS.generateUUID(),scope.bpTree.filesMap||(scope.bpTree.filesMap={}),scope.bpTree.filesMap[f.data]=values[i],fileArray.push(f)}ngModel.$setViewValue(fileArray)}element.value=null,element.disabled=!1,ouiBaseService.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),scope.control.propSetMap.uploadContDoc&&scope.uploadContentVersions(scope,scope.control)}))}))}}})}()},{}],4:[function(require,module,exports){angular.module("vlocity-oui-common").directive("chainup",function(ouiBaseService){"use strict";return{restrict:"A",require:"ngModel",priority:1,link:function(scope,element,attrs,ngModel){ngModel&&("miniForm"===attrs.chainup&&(ouiBaseService.miniForm=!0),scope.control&&(void 0===scope.control.propSetMap.mask||null===scope.control.propSetMap.mask||""===scope.control.propSetMap.mask?element.bind("change",function(){ouiBaseService.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1)}):element.bind("change blur",function(){ouiBaseService.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1)})))}}})},{}],5:[function(require,module,exports){!function(){"use strict";if("{!$Api.Session_ID}"===window.sessionId)var omniout=!0;angular.module("vlocity-oui-common").directive("vlcBindHtml",["$sce","$parse","$compile",function($sce,$parse,$compile){return{restrict:"A",compile:function(tElement,tAttrs){$parse(tAttrs.vlcBindHtml),$parse(tAttrs.vlcBindHtml,function(val){return $sce.valueOf(val)});return $compile.$$addBindingClass(tElement),function(scope,element,attrs){$compile.$$addBindingInfo(element,attrs.vlcBindHtml);var control=scope.control;function bindHtml(value){omniout?element.html($compile($sce.getTrustedHtml(value))(scope)||""):element.html($sce.getTrustedHtml(value)||"")}if("Disclosure"!==control.type)if(scope.miniForm){if(!(value=control.propSetMap.value))return;bindHtml(value)}else scope.$watch(function(){return scope.refresh(control,!0)},function(val){bindHtml($sce.trustAsHtml(val))});else{var value;if(!(value=control.propSetMap.text))return;bindHtml(value=$sce.trustAsHtml(value))}}}}}])}()},{}],6:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("dateFormat",function(){var dateFormatPtrn=/Y(?!ear)|D(?!ate)|m/g,dateTimeFormatPtrn=/Y(?!ear)|D(?!ate)/g,dateFormatFn=function(match){return/^[YD]$/.test(match)?match.toLowerCase():/^[m]$/.test(match)?match.toUpperCase():match};return{restrict:"A",link:function(scope,el,attrs){var formatKey=attrs.hasOwnProperty("dateFormat")?"dateFormat":"modelDateFormat",formatPtrn=scope.control&&"Formula"!==scope.control.type?dateFormatPtrn:dateTimeFormatPtrn;attrs[formatKey]&&angular.isString(attrs[formatKey])&&(attrs[formatKey]=attrs[formatKey].replace(formatPtrn,dateFormatFn),scope.control&&(scope.control.propSetMap[formatKey]=attrs[formatKey]))}}}),angular.module("vlocity-oui-common").directive("timeFormat",function(){var time1224Ptrn=/(h)([^Aa]*?$)/g,time1224Fn=function(match){return match.replace(/h/g,"H")};return{restrict:"A",link:function(scope,el,attrs){attrs.timeFormat&&angular.isString(attrs.timeFormat)&&(attrs.timeFormat=attrs.timeFormat.replace(time1224Ptrn,time1224Fn),scope.control&&(scope.control.propSetMap.timeFormat=attrs.timeFormat))}}})}()},{}],7:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("vlcSldsLookupControl",["$rootScope","$window",function($rootScope,$window){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){var bodyEl=angular.element($window.document.body);ngModelCtrl.$validators.validateValLookup=function(modelValue){return!(!modelValue&&null!==modelValue)};var progMessage=scope.customLabels.OmniLoading||" - loading list from the server .....";function onBodyClick(evt){if(element[0]!==evt.target&&!$.contains(element[0],evt.target)&&!$.contains(element[0].nextElementSibling,evt.target))return hide(),!0}function hide(){bodyEl.off("click",onBodyClick),scope.control.showSubList=!1,function(scope){scope.$$phase||scope.$root&&scope.$root.$$phase||scope.$digest()}(scope)}ngModelCtrl.$formatters.unshift(function(modelValue){var vObjects=scope.control.viewObjects||scope.control.propSetMap.options,index=_.findIndex(vObjects,{name:modelValue});return modelValue&&vObjects&&index>=0?(ngModelCtrl.$setTouched(),ngModelCtrl.$setDirty(),scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),vObjects[index].value):(null===modelValue&&scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),null)}),scope.convertToObject=function(flag){flag&&(bodyEl.on("click",onBodyClick),scope.control.showSubList=!0),scope.control.viewObjects=[];var options=scope.control.propSetMap.options;(!options||!options.length)&&(scope.loadingData=progMessage);var optPromise=scope.getLookupOptions(scope.control,scope);optPromise&&optPromise.then&&optPromise.then(function(){scope.control.viewObjects=scope.control.propSetMap.options,scope.loadingData=""})},scope.setViewValue=function(obj){scope.control.response=obj.name,hide()}}}}])}()},{}],8:[function(require,module,exports){!function(){"use strict";function parseFloatIfNum(x){return""===x?0:isNaN(x)?0:parseFloat(x)}angular.module("vlocity-oui-common").provider("$vlcRangeSlider",function(){var defaults=this.defaults={animate:!1,animationDuration:100,behaviour:"drag",orientation:"horizontal",range:{min:5,max:10},step:1,start:5,direction:"ltr"};this.$get=function($rootScope,$window){var isNative=/(ip[ao]d|iphone|android)/gi.test($window.navigator.userAgent);"createTouch"in $window.document||$window.document;function VlcRangeSliderFactory(element,controller,config){var $vlcRangeSlider=noUiSlider.create(element[0],angular.extend({},defaults,config)),options=$vlcRangeSlider.options,scope=$vlcRangeSlider.$scope=options.scope&&options.scope.$new()||$rootScope.$new(),keyMap={37:"ltr"!=options.direction,38:1,39:"ltr"==options.direction,40:0};options.scope.control.prevScrollval=null!=options.scope.control.propSetMap.defaultValue?options.scope.control.propSetMap.defaultValue:options.range.min,null!=options.scope.control.response&&(options.scope.control.prevScrollval=options.scope.control.response),scope.commitSliderVal=function(event,ui){if(null!=event&&null!=event[ui]&&event[ui]-options.scope.control.prevScrollval>=0&&event[ui]-options.scope.control.prevScrollval!=options.step&&event[ui]+options.step>options.range.max)return $vlcRangeSlider.set(options.scope.control.prevScrollval),!1;options.scope.control.prevScrollval=null!=event&&null!=event[ui]?event[ui]:options.scope.control.prevScrollval,controller.$setViewValue($vlcRangeSlider.get()),(angular.isFunction(controller.$oldRender)?controller.$oldRender:controller.$render)()},$vlcRangeSlider.init=function(){$vlcRangeSlider.on("slide",scope.commitSliderVal),element.children().children().on("keydown",$vlcRangeSlider.$onKeyDown),controller.$render()};var _destroy=$vlcRangeSlider.destroy;return $vlcRangeSlider.destroy=function(){$vlcRangeSlider.off(),element.children().children().off("keydown"),scope.$destroy(),_destroy()},$vlcRangeSlider.$onKeyDown=function(evt){if(!element.attr("disabled")){var offset=$vlcRangeSlider.steps()[0][1*keyMap[evt.keyCode]];"number"!=typeof offset||isNaN(offset)||(evt.preventDefault(),evt.stopPropagation(),controller.$setViewValue(1*$vlcRangeSlider.get()+offset*(2*keyMap[evt.keyCode]-1)),controller.$render())}},$vlcRangeSlider}return VlcRangeSliderFactory.defaults=defaults,VlcRangeSliderFactory}}).directive("vlcRangeSlider",function($window,$vlcRangeSlider,ngIfDirective){$vlcRangeSlider.defaults;var format="function"==typeof $window.format?$window.format:function(mask,input){return input},isNative=/(ip[ao]d|iphone|android)/gi.test($window.navigator.userAgent),isTouch=("createTouch"in $window.document||"ontouchstart"in $window.document)&&isNative,ngIf=ngIfDirective[0];return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,controller,$rootScope){var mergeLowVal,mergeHighVal,slider,updateOpt,repeatCloneResp,options={scope:scope},rangeLowVal=scope.control.propSetMap.rangeLow,rangeHighVal=scope.control.propSetMap.rangeHigh,repeatClone=scope.control.propSetMap.repeatClone,defaultValue=scope.control.propSetMap.defaultValue,rangeLow=5,rangeHigh=10;function updateRangeOptions(mergeLVal,mergeHVal){if(rangeLow!==mergeLVal||rangeHigh!==mergeHVal){if((rangeLow=mergeLVal)==(rangeHigh=mergeHVal))return;null==scope.control.response&&(scope.control.response=rangeLow),updateOpt={range:{min:rangeLow,max:rangeHigh},start:rangeLow},repeatClone||null==scope.control.response&&(scope.control.response=null==defaultValue?rangeLow:defaultValue),null!=repeatCloneResp&&(scope.control.response=repeatCloneResp,repeatCloneResp=null),options.range.min=rangeLow,options.range.max=rangeHigh,options.scope.control.prevScrollval=null!=scope.control.response?scope.control.response:rangeLow,element.attr("min",rangeLow),element.attr("max",rangeHigh),element.attr("aria-valuemin",rangeLow),element.attr("aria-valuemax",rangeHigh),slider.updateOptions(updateOpt),slider.set(rangeLow),slider.init()}}function formatDisplayVal(x){return String(format(options.mask,roundToStep(x)))}function roundToStep(x){var rVal=Math.round((parseFloatIfNum(x)-options.range.min)/options.step)*options.step+options.range.min;return options.range.max>=rVal?rVal:options.range.max}if(angular.forEach(["mask"],function(key){angular.isDefined(attrs[key])&&(options[key]=attrs[key])}),angular.forEach(["min","max","step"],function(key){angular.isDefined(attrs[key])&&(options[key]=parseFloatIfNum(attrs[key]))}),void 0!==rangeLowVal&&null!==rangeLowVal||(scope.control.propSetMap.rangeLow=5,rangeLowVal=5),void 0!==rangeHighVal&&null!==rangeHighVal||(scope.control.propSetMap.rangeHigh=10,rangeHighVal=10),"string"==typeof rangeLowVal&&/^[%].*?[%]$/.test(rangeLowVal)&&!repeatClone?null==scope.control.response&&(scope.control.response=null==defaultValue?rangeLow:defaultValue):repeatClone?repeatClone&&(rangeLow=isNaN(rangeLowVal)?5:parseFloatIfNum(rangeLowVal),null==scope.control.response&&(scope.control.response=null==defaultValue?rangeLow:defaultValue),repeatCloneResp=scope.control.response):(rangeLow=isNaN(rangeLowVal)?5:parseFloatIfNum(rangeLowVal),null==scope.control.response&&(scope.control.response=null==defaultValue?rangeLow:defaultValue)),"string"==typeof rangeHighVal&&/^[%].*?[%]$/.test(rangeHighVal)||(rangeHigh=parseFloatIfNum(rangeHighVal)),attrs.ngIf=function(){if("string"==typeof rangeLowVal&&/^[%].*?[%]$/.test(rangeLowVal)||"string"==typeof rangeHighVal&&/^[%].*?[%]$/.test(rangeHighVal)){var element=scope.$parent&&scope.$parent.control?scope.$parent.control:scope.control;mergeLowVal="string"!=typeof rangeLowVal?rangeLowVal:scope.handleMergeField(rangeLowVal,!1,null,element),mergeHighVal="string"!=typeof rangeHighVal?rangeHighVal:scope.handleMergeField(rangeHighVal,!1,null,element),(isNaN(mergeLowVal)||null==mergeLowVal)&&(mergeLowVal=5),(isNaN(mergeHighVal)||null==mergeHighVal)&&(mergeHighVal=10),mergeLowVal=parseFloatIfNum(mergeLowVal),mergeHighVal=parseFloatIfNum(mergeHighVal),updateRangeOptions(mergeLowVal,mergeHighVal)}},ngIf.link.apply(ngIf,arguments),angular.isDefined(options.start)||(options.start=parseFloatIfNum(rangeLow)?parseFloatIfNum(rangeLow):5),options=angular.extend({},options,{direction:"rtl"===element.css("direction")?"rtl":"ltr",range:{min:angular.isDefined(rangeLow)?parseFloatIfNum(rangeLow):5,max:angular.isDefined(rangeHigh)?parseFloatIfNum(rangeHigh):10},step:angular.isDefined(attrs.step)?parseFloatIfNum(attrs.step):1,tooltips:{to:formatDisplayVal},format:{to:roundToStep,from:parseFloatIfNum}}),isTouch){element.after("<span vlc-range-slider-generated></span>");var sliderTooltip=element.next(),updateToolTip=function(){sliderTooltip.text(formatDisplayVal(controller.$viewValue))};controller.$oldRender=controller.$render,controller.$render=function(){controller.$oldRender(),updateToolTip()},controller.$viewChangeListeners.push(updateToolTip)}else{element.after('<div class="noUISlider" vlc-range-slider-generated></div>');var noUiEle=element.next();element.css("display","none"),attrs.ngDisabled&&scope.$watch(attrs.ngDisabled,function(newValue,oldValue){slider&&angular.isDefined(newValue)&&(!0===newValue?noUiEle.attr("disabled",!0):noUiEle.removeAttr("disabled"))}),slider=$vlcRangeSlider(noUiEle,controller,options),scope.$evalAsync(function(){controller.$oldRender=controller.$render,controller.$render=function(){controller.$oldRender(),slider.set(controller.$viewValue)},controller.$formatters.push(function(modelValue){return null===modelValue?options.start:modelValue}),slider.init()}),scope.$on("$destroy",function(){slider&&slider.destroy(),options=null,slider=null})}}}}).directive("vlcNewportRangeSlider",function($window,ngIfDirective){var ngIf=ngIfDirective[0],format="function"==typeof $window.format?$window.format:function(mask,input){return input};return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,controller){var mergeLowVal,mergeHighVal,repeatCloneResp,rangeLowVal=scope.control.propSetMap.rangeLow,rangeHighVal=scope.control.propSetMap.rangeHigh,repeatClone=scope.control.propSetMap.repeatClone,defaultValue=scope.control.propSetMap.defaultValue,rangeLow=5,rangeHigh=10;function updateRangeOptions(mergeLVal,mergeHVal){if(rangeLow!==mergeLVal||rangeHigh!==mergeHVal){if((rangeLow=mergeLVal)==(rangeHigh=mergeHVal))return;null==scope.control.response&&(scope.control.response=rangeLow),repeatClone||null!=scope.control.response||(scope.control.response=null==defaultValue?rangeLow:defaultValue),null!=repeatCloneResp&&(scope.control.response=repeatCloneResp,repeatCloneResp=null),element.attr("min",rangeLow),element.attr("max",rangeHigh),element.attr("aria-valuemin",rangeLow),element.attr("aria-valuemax",rangeHigh),rangeLow>scope.control.response&&(scope.control.response=rangeLow),rangeHigh<scope.control.response&&(scope.control.response=rangeHigh)}}void 0!==rangeLowVal&&null!==rangeLowVal||(scope.control.propSetMap.rangeLow=5,rangeLowVal=5),void 0!==rangeHighVal&&null!==rangeHighVal||(scope.control.propSetMap.rangeHigh=10,rangeHighVal=10),"string"==typeof rangeLowVal&&/^[%].*?[%]$/.test(rangeLowVal)&&!repeatClone?null==scope.control.response&&(scope.control.response=null==defaultValue?rangeLow:defaultValue):repeatClone?repeatClone&&(rangeLow=isNaN(rangeLowVal)?5:parseFloatIfNum(rangeLowVal),null==scope.control.response&&(scope.control.response=null==defaultValue?rangeLow:defaultValue),repeatCloneResp=scope.control.response):(rangeLow=isNaN(rangeLowVal)?5:parseFloatIfNum(rangeLowVal),null==scope.control.response&&(scope.control.response=null==defaultValue?rangeLow:defaultValue)),"string"==typeof rangeHighVal&&/^[%].*?[%]$/.test(rangeHighVal)||(rangeHigh=parseFloatIfNum(rangeHighVal)),element.attr("min",rangeLow),element.attr("max",rangeHigh),element.attr("aria-valuemin",rangeLow),element.attr("aria-valuemax",rangeHigh),attrs.ngIf=function(){if("string"==typeof rangeLowVal&&/^[%].*?[%]$/.test(rangeLowVal)||"string"==typeof rangeHighVal&&/^[%].*?[%]$/.test(rangeHighVal)){var element=scope.$parent&&scope.$parent.control?scope.$parent.control:scope.control;mergeLowVal="string"!=typeof rangeLowVal?rangeLowVal:scope.handleMergeField(rangeLowVal,!1,null,element),mergeHighVal="string"!=typeof rangeHighVal?rangeHighVal:scope.handleMergeField(rangeHighVal,!1,null,element),(isNaN(mergeLowVal)||null==mergeLowVal)&&(mergeLowVal=5),(isNaN(mergeHighVal)||null==mergeHighVal)&&(mergeHighVal=10),mergeLowVal=parseFloatIfNum(mergeLowVal),mergeHighVal=parseFloatIfNum(mergeHighVal),updateRangeOptions(mergeLowVal,mergeHighVal)}},ngIf.link.apply(ngIf,arguments),scope.formatDisplayVal=function(){return attrs.mask?String(format(attrs.mask,(x=scope.control.response,step=angular.isDefined(attrs.step)?parseFloatIfNum(attrs.step):1,rVal=Math.round((parseFloatIfNum(x)-rangeLow)/step)*step+rangeLow,rangeHigh>=rVal?rVal:rangeHigh))):scope.control.response;var x,step,rVal}}}})}()},{}],9:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("vlcBubbleCanceller",function(){return{restrict:"A",scope:!1,link:function(scope,elem,attrs){elem.bind("click keydown",function(e){var keyCode=e.which||e.keyCode;if("click"==e.type||32===keyCode||13===keyCode)return e.stopPropagation(),"true"===attrs.vlcBubbleCanceller&&e.preventDefault(),"keydown"==e.type&&"button"===e.target.type&&e.target.attributes.hasOwnProperty("ng-click")&&e.target.click(),!1})}}})}()},{}],10:[function(require,module,exports){!function(){"use strict";function setViewValue(mask,value,elem){mask&&(elem[0].value=value)}angular.module("vlocity-oui-common").directive("vlcSldsCheckValChecker",function(){return{restrict:"A",scope:!1,require:"ngModel",link:function(scope,elem,attrs,ngModelCtrl){!0!==scope.bpTree.readOnly&&ngModelCtrl.$formatters.unshift(function(modelValue){ngModelCtrl.$$runValidators(modelValue,modelValue,angular.noop);return ngModelCtrl.$valid?(scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),ngModelCtrl.$setTouched(),ngModelCtrl.$setDirty(),setViewValue(scope.control.propSetMap.mask,modelValue,elem),modelValue):(null!==scope.control.response&&(scope.control.response=null),scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),setViewValue(scope.control.propSetMap.mask,modelValue,elem),null)})}}})}()},{}],11:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("vlcSldsFileSelect",function($compile){return{restrict:"A",link:function(scope,element,attrs){"true"===attrs.vlcSldsFileSelect&&element.attr("multiple","")}}})}()},{}],12:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("vlcSldsMinMaxLen",function($parse,$compile){return{restrict:"A",require:"ngModel",priority:999,link:function(scope,element,attrs,ngModelCtrl){attrs.uiMask&&scope.control.propSetMap.mask&&(delete ngModelCtrl.$validators.minlength,delete ngModelCtrl.$validators.maxlength)}}})}()},{}],13:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("vlcSldsMuValChecker",function(){return{restrict:"A",scope:!1,require:["^form","ngModel"],link:function(scope,elem,attrs,ctrls){if(!0!==scope.bpTree.readOnly){var ngModelCtrl=ctrls[1],formCtrl=ctrls[0];ngModelCtrl.$formatters.unshift(function(modelValue){ngModelCtrl.$$runValidators(modelValue,modelValue,angular.noop);return ngModelCtrl.$valid?("Multi-select"===scope.control.type?scope.onMultiSelect(scope,scope.control,scope.option,!0):"Radio Group"===scope.control.type&&scope.onRadioGroupSelect(scope,scope.control,scope.option,!0),ngModelCtrl.$setTouched(),ngModelCtrl.$setDirty(),formCtrl&&formCtrl.$setDirty(),modelValue):(scope.control.req&&null!==scope.control.response&&(scope.control.response=null),scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),null)})}}}})}()},{}],14:[function(require,module,exports){!function(){"use strict";var REG_EMAIL=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)+$/;angular.module("vlocity-oui-common").directive("vlcSldsNgPattern",function($timeout){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var regex,regexp=attr.vlcSldsNgPattern;"email"===attr.type&&0===attr.vlcSldsNgPattern.length?regex=REG_EMAIL:angular.isString(regexp)&&regexp.length>0&&(regex=(regex=/^\s*\/(.*)\/([gimuy]*)\s*$/.exec(regexp))?new RegExp(regex[1],regex[2]):new RegExp("^"+regexp+"$"))&&!regex.test&&console.error("invalid regular expression "+regex),regexp=regex||void 0,angular.isUndefined(regex)||(ctrl.$validators.pattern=function(modelValue,viewValue){return modelValue!==viewValue&&(viewValue=modelValue),ctrl.$isEmpty(viewValue)||angular.isUndefined(regexp)||function(viewValue,ctrl){return!!regexp.test(viewValue)}(viewValue)})}}}})}()},{}],15:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("vlcSldsNumValChecker",function(){return{restrict:"A",scope:!1,require:"ngModel",link:function(scope,elem,attrs,ngModelCtrl){var valObjBackUp;!0!==scope.bpTree.readOnly&&(ngModelCtrl.runAllValidators=function(required,modelValue){var result=!0;if(!required)for(var key in this.$validators)this.$validators.hasOwnProperty(key)&&"required"!==key&&(result=result&&this.$validators[key](""+ngModelCtrl.$modelValue,""+ngModelCtrl.$modelValue));return result},attrs.viaMask&&(ngModelCtrl.$formatters.unshift(function(modelValue){var editBlockParent="lightning"==scope.ouiBaseService.layout?".vlc-slds-edit-block--child":".nds-edit-block_child";if(("true"===scope.control.noformatterebmodal||scope.$parent&&scope.$parent.control&&"true"===scope.$parent.control.noformatterebmodal)&&"true"===$(elem).parents(editBlockParent).attr("noformattereb"))return modelValue;if(0===Object.keys(ngModelCtrl.$validators).length&&valObjBackUp&&!scope.control.req&&(ngModelCtrl.$validators=valObjBackUp),ngModelCtrl.runAllValidators(scope.control.req,modelValue)?ngModelCtrl.$$runValidators(""+ngModelCtrl.$modelValue,""+ngModelCtrl.$modelValue,angular.noop):modelValue=null,modelValue&&ngModelCtrl.$valid)return ngModelCtrl.$setTouched(),ngModelCtrl.$setDirty(),scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),modelValue;null!==scope.control.response&&(scope.control.response=null,ngModelCtrl.$setPristine(),ngModelCtrl.$setUntouched(),(void 0===scope.control.req?scope.control.propSetMap.required:scope.control.req)||(valObjBackUp=ngModelCtrl.$validators,ngModelCtrl.$validators={},setTimeout(function(){ngModelCtrl.$validators=valObjBackUp})));return scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),function(mask,value,elem){mask&&(elem[0].value=value)}(scope.control.propSetMap.mask,modelValue,elem),null}),scope.init(scope,scope.control)))}}})}()},{}],16:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("vlcSldsOnlyNumeric",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){var decimalSeperator=".";try{var sep=parseFloat(1.5).toLocaleString().substring(1,2);"."!==sep&&","!==sep||(decimalSeperator=sep)}catch(e){}var decimalKeyCode="."===decimalSeperator?".":",";element.on("keypress",function(evt){var _ref=evt.key,_ref1=evt.key;"ArrowLeft"===_ref||"ArrowRight"===_ref||"."===_ref||"Backspace"===_ref||"Tab"===_ref||"End"===_ref||"Home"===_ref||"Delete"===_ref?"ArrowRight"==evt.key&&0==this.selectionStart&&(this.selectionStart=0,this.selectionEnd=1):(_ref1!==decimalKeyCode&&"1"!==_ref1&&"2"!==_ref1&&"3"!==_ref1&&"4"!==_ref1&&"5"!==_ref1&&"6"!==_ref1&&"7"!==_ref1&&"8"!==_ref1&&"9"!==_ref1&&"0"!==_ref1&&"-"!==_ref1||(_ref===decimalKeyCode||_ref1===decimalKeyCode)&&evt.target.value.indexOf(decimalSeperator)>-1||("-"===_ref||"-"===_ref1)&&(0!==evt.target.selectionStart||evt.target.value.indexOf("-")>-1)||0===evt.target.selectionStart&&evt.target.value.indexOf("-")>-1&&0===evt.target.selectionEnd)&&evt.preventDefault()})}}})}()},{}],17:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").provider("$vlcSldsToolTip",function(){var defaults=this.defualts={templateUrl:"vlcSldsOmniToolTip.html",placement:"auto bottom",nubbinDirection:"top-right",tooltip:"true",trigger:"hover focus"};this.$get=function($sldsPopover){function VlcSldsToolTipFactory(element,config){var $vlcSldsToolTip=$sldsPopover(element,angular.extend({},defaults,config));config.scope,$vlcSldsToolTip.$options,$vlcSldsToolTip.$scope;return $vlcSldsToolTip}return VlcSldsToolTipFactory.defaults=defaults,VlcSldsToolTipFactory}}).directive("vlcSldsToolTip",["$vlcSldsToolTip","$aria",function($vlcSldsToolTip,$aria){$vlcSldsToolTip.defaults;return{restrict:"A",scope:!0,link:function(scope,element,attr){var options={scope:scope};angular.forEach(["template","templateUrl","controller","controllerAs","contentTemplate","placement","container","delay","trigger","html","nubbinDirection","tooltip","animation","id","prefixClass","prefixEvent"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])}),$aria.config("tabindex")&&!element.attr("tabindex")&&element.attr("tabindex",0);var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["html","container"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)}),angular.forEach(["onBeforeShow","onShow","onBeforeHide","onHide"],function(key){var bsKey="bs"+key.charAt(0).toUpperCase()+key.slice(1);angular.isDefined(attr[bsKey])&&(options[key]=scope.$eval(attr[bsKey]))});var toolTip=$vlcSldsToolTip(element,options);options=toolTip.$options,scope.nubbinDirection=options.nubbinDirection,scope.$on("$destroy",function(){toolTip&&toolTip.destroy(),options=null,toolTip=null})}}}])}()},{}],18:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").directive("vlcSldsValCheckCurrency",function(){return{restrict:"A",scope:!1,require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){if(!0!==scope.bpTree.readOnly){var min=scope.control.propSetMap.min||null;ngModelCtrl.$validators.min=function(modelValue,viewValue){return angular.isUndefined(min)||null===min||ngModelCtrl.$isEmpty(ngModelCtrl.$$rawModelValue)||Number(ngModelCtrl.$$rawModelValue)>=min};var max=scope.control.propSetMap.max||null;ngModelCtrl.$validators.max=function(modelValue,viewValue){return angular.isUndefined(max)||null===max||ngModelCtrl.$isEmpty(ngModelCtrl.$$rawModelValue)||Number(ngModelCtrl.$$rawModelValue)<=max},ngModelCtrl.$parsers.push(function(value){return""===value?null:value})}}}})}()},{}],19:[function(require,module,exports){!function(){"use strict";function setViewValue(mask,value,elem){mask&&(elem[0].value=value||"")}var valChecker=function(inputObj,modelValue){var elem=inputObj.elem,scope=inputObj.scope,ngModelCtrl=inputObj.ngModelCtrl,attrs=inputObj.attrs,formIndex=inputObj.formIndex;if(!0===scope.bpTree.readOnly)return modelValue;if("Disclosure"===scope.control.type&&!0===scope.control.req&&!1===scope.control.response)return ngModelCtrl.$setValidity("required",!1),modelValue;var editBlockParent="lightning"==scope.ouiBaseService.layout?".vlc-slds-edit-block--child":".nds-edit-block_child";if(("true"===scope.control.noformatterebmodal||scope.$parent&&scope.$parent.control&&"true"===scope.$parent.control.noformatterebmodal)&&"true"===$(elem).parents(editBlockParent).attr("noformattereb"))return modelValue;if(scope.$parent&&scope.$parent.control&&scope.$parent.control.propSetMap&&!scope.$parent.control.propSetMap.isNewInlineBlock&&"true"===scope.control.noformatterebmodal&&(null===modelValue||void 0===modelValue))return modelValue;if(modelValue&&"telControl"===attrs.vlcSldsValChecker&&ngModelCtrl.$viewValue===ngModelCtrl.$modelValue&&modelValue===ngModelCtrl.$viewValue)return modelValue;ngModelCtrl.$$runValidators(modelValue,modelValue,angular.noop);if(attrs.uiMask&&scope.control.propSetMap.mask&&modelValue){modelValue+="";var mValue=ngModelCtrl.$formatters[formIndex](modelValue),maxLength=scope.control.propSetMap.maxLength,minLength=scope.control.propSetMap.minLength;maxLength=null===maxLength?255:maxLength,minLength=null===minLength?0:minLength,mValue||(modelValue=null),mValue&&(mValue.length>maxLength||mValue.length<minLength)&&(modelValue=null)}return modelValue&&ngModelCtrl.$valid?(scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),ngModelCtrl.$setTouched(),ngModelCtrl.$setDirty(),setViewValue(scope.control.propSetMap.mask,modelValue,elem),modelValue):(null!==scope.control.response&&(/Disclosure/.test(scope.control.type)?scope.control.response=!1:/Date\/Time \(Local\)/.test(scope.control.type)&&document.activeElement.closest('*[name="loopform"]')==elem[0].closest('*[name="loopform"]')||(scope.control.response=null)),scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),setViewValue(scope.control.propSetMap.mask,modelValue,elem),null)};angular.module("vlocity-oui-common").directive("vlcSldsValChecker",function(){return{restrict:"A",scope:!1,require:"ngModel",priority:440,link:function(scope,elem,attrs,ngModelCtrl){var editBlockParent="lightning"==scope.ouiBaseService.layout?".vlc-slds-edit-block--child":".nds-edit-block_child";return("true"===scope.control.noformatterebmodal||scope.$parent&&scope.$parent.control&&"true"===scope.$parent.control.noformatterebmodal)&&"true"===$(elem).parents(editBlockParent).attr("noformattereb")?null:"Type Ahead"===scope.control.type&&scope.control.propSetMap.enableLookup?(ngModelCtrl.$formatters.push(valChecker.bind(null,{elem:elem,ngModelCtrl:ngModelCtrl,formIndex:0,scope:scope,attrs:attrs})),null):(scope.control.propSetMap.mask&&"uiMask"in attrs&&ngModelCtrl.$$attr&&ngModelCtrl.$$attr.$$observers&&ngModelCtrl.$$attr.$$observers.uiMask&&ngModelCtrl.$$attr.$$observers.uiMask[0]&&ngModelCtrl.$$attr.$$observers.uiMask[0](attrs.uiMask),scope.control.propSetMap.mask&&"uiMask"in attrs&&scope.control.propSetMap.pattern?ngModelCtrl.$formatters.push(valChecker.bind(null,{elem:elem,ngModelCtrl:ngModelCtrl,formIndex:0,scope:scope,attrs:attrs})):ngModelCtrl.$formatters.unshift(valChecker.bind(null,{elem:elem,ngModelCtrl:ngModelCtrl,formIndex:1,scope:scope,attrs:attrs})),void("uiMask"in attrs&&scope.init(scope,scope.control)))}}})}()},{}],20:[function(require,module,exports){angular.module("vlocity-oui-common").factory("ouiBaseService",function($q,$rootScope){var factory={};return factory.GenericInvoke=function(sClassName,sMethodName,input,options,iTimeout){var deferred=$q.defer();return VOUINS.GenericInvoke(sClassName,sMethodName,input,options,iTimeout,function(result,event){$rootScope.$apply(function(){event.status?deferred.resolve(result):deferred.reject(event)})}),deferred.promise},factory.OmniRemoteInvokeAux=function(configObj,src){var called=!1;return window.customVOmniRemoteInvoke&&window.customVOmniRemoteInvoke.constructor===Function?(called=!0,window.customVOmniRemoteInvoke(configObj,src)):window.OmniOut&&window.OmniForce&&window.OmniForce.isAuthenticated()&&("Vlocity BuildJSONWithPrefill"!==configObj.sClassName||!window.forceLocalDef)?(called=!0,window.OmniForce.apexrest({path:"/"+this.sNS+"/v1/GenericInvoke/",params:configObj.params,data:configObj,method:"POST"})):called},factory.OmniRemoteInvoke=function(configObj){var prom=this.OmniRemoteInvokeAux(configObj,this);return!1===prom?this.GenericInvoke(configObj.sClassName,configObj.sMethodName,configObj.input,configObj.options,configObj.iTimeout,configObj.label):prom},factory.miniForm=!1,factory.previewMode=sfdcVars.previewMode,factory.dataPreprocessorMap={},factory.pfJSON={},factory.scriptState=sfdcVars.scriptState,factory.sNS=sfdcVars.sNS,factory.sNSC=factory.sNS?factory.sNS+".":factory.sNS,factory.layout=sfdcVars.layout,factory.rootEleTypes=["Step","Remote Action","Rest Action","DataRaptor Extract Action","DataRaptor Post Action","Post to Object Action","Review Action","Done Action","Calculation Action","PDF Action","Set Values","Set Errors","DocuSign Envelope Action","Email Action","DataRaptor Transform Action","Matrix Action","Integration Procedure Action","Delete Action"],factory.actionEleTypes=VOUINS.actionEleTypes,factory.remoteInvokePrePostEleTypes=["Remote Action","Rest Action","Calculation Action","Integration Procedure Action"],factory.remoteInvokePostEleTypes=["DataRaptor Post Action","Post to Object Action","Matrix Action"],factory.remoteInvokePreEleTypes=["PDF Action"],factory.noneDataControlTypeListV2=sfdcVars.noneDataControlTypeListV2,"default"===factory.noneDataControlTypeListV2&&(factory.noneDataControlTypeListV2=["Button","Submit","Headline","Text Block","Remote Action","Rest Action","DataRaptor Extract Action","DataRaptor Post Action","Post to Object Action","Review Action","Done Action","Calculation Action","PDF Action","Set Values","Set Errors","DocuSign Envelope Action","DocuSign Signature Action","Line Break","Email Action","DataRaptor Transform Action","Matrix Action","Integration Procedure Action","Delete Action"]),factory.applyRespSkipTypeList=["Block","Edit Block","Step","Type Ahead Block","File","Button","Headline","Text Block","Remote Action","Rest Action","DataRaptor Extract Action","DataRaptor Post Action","Post to Object Action","Review Action","Done Action","Filter Block","Calculation Action","PDF Action","Image","Geolocation","Formula","Aggregate","Validation","Set Values","Set Errors","DocuSign Envelope Action","DocuSign Signature Action","Line Break","Email Action","DataRaptor Transform Action","Matrix Action","Integration Procedure Action","Delete Action"],factory.groupEleTypeList=["Step","Block","Edit Block","Filter Block","Type Ahead Block"],factory.readOnlyReqEleTypeList=["Checkbox","Currency","Date","Date/Time (Local)","Disclosure","Email","Lookup","Multi-select","Number","Password","Radio","Radio Group","Range","Select","Signature","Telephone","Text","Text Area","Time","URL","Type Ahead"],factory.repeatEleTypeList=["Block","Edit Block","Checkbox","Currency","Date","Date/Time (Local)","Email","Lookup","Multi-select","Number","Password","Radio","Range","Select","Signature","Telephone","Text","Text Area","Time","URL"],factory.selectTypeList=["Select","Multi-select"],factory.placeholderEleTypeList=["Selectable Items","Input Block"],factory.blockEleTypeList=["Block","Edit Block"],factory.elementTypeToHTMLMap={Checkbox:"vlcCheckbox.html",Currency:"vlcCurrency.html",Date:"vlcDate.html","Date/Time (Local)":"vlcDatetime-local.html",Disclosure:"vlcDisclosure.html",Email:"vlcEmail.html",File:"vlcFile.html",Image:"vlcImage.html",Headline:"vlcHeadline.html",Lookup:"vlcLookup.html","Multi-select":"vlcMulti-select.html",Number:"vlcNumber.html",Password:"vlcPassword.html",Radio:"vlcRadio.html",Range:"vlcRange.html",Step:"vlcStep.html",Select:"vlcSelect.html",Signature:"vlcSignature.html",Telephone:"vlcTel.html",Text:"vlcText.html","Text Area":"vlcTextarea.html","Text Block":"vlcTextblock.html",Time:"vlcTime.html",URL:"vlcURL.html","Selectable Items":"vlcSelectableItems.html","Line Break":"vlcLineBreak.html","Error Sub Block":"vlcErrorSubBlock.html","Selectable Item":"vlcEmpty.html"},factory.elementTypeToHTMLMapOW=angular.copy(factory.elementTypeToHTMLMap),(_.mergeWith||_.merge)(factory.elementTypeToHTMLMapOW,sfdcVars.eleTypeToHTMLTemplateMap,VOUINS.mergeJSONLogic),factory.aggregate=function(scp,arrayIndex,indexInParent,bUIUpdate,addOrRemoveIndex,notFirstTime){var key,eleType,newArrayIndex=arrayIndex;if(scp){scp.bpTree.propSetMap&&!0===scp.bpTree.propSetMap.enableKnowledge&&null!==scp.bpTree.asIndex&&!0!==notFirstTime&&scp.searchKnowledgeArticle(scp.bpTree.children[scp.bpTree.asIndex]);var ctrlLevel=-10;scp.control&&(ctrlLevel=scp.control.level);var level=-10;if(scp.children&&scp.children.length>0&&(level=scp.children[0].level),level===ctrlLevel+1&&scp.control){if("Filter Block"===scp.control.type)this.handleFilterBlock(scp.control);else if(VOUINS.isEmpty(scp.control.response)){scp.control.response={};for(var j=0;j<scp.children.length;j++)-1===this.noneDataControlTypeListV2.indexOf(scp.children[j].eleArray[0].type)&&(this.placeholderEleTypeList.indexOf(scp.children[j].eleArray[0].type)<0||this.placeholderEleTypeList.indexOf(scp.children[j].eleArray[0].type)>=0&&!0===scp.children[j].eleArray[0].propSetMap.dataJSON)&&(key=scp.children[j].eleArray[0].name,scp.control.response[key]=scp.children[j].response)}else-1===this.noneDataControlTypeListV2.indexOf(scp.children[indexInParent].eleArray[0].type)&&(this.placeholderEleTypeList.indexOf(scp.children[indexInParent].eleArray[0].type)<0||this.placeholderEleTypeList.indexOf(scp.children[indexInParent].eleArray[0].type)>=0&&!0===scp.children[indexInParent].eleArray[0].propSetMap.dataJSON)&&(key=scp.children[indexInParent].eleArray[0].name,scp.control.response[key]=scp.children[indexInParent].response);newArrayIndex=scp.control.index}if(scp.$parent)if(scp.$parent.child&&scp.$parent.child.eleArray){if(scp.$parent.child.eleArray.length>0)if(1==scp.$parent.child.eleArray.length){if(VOUINS.isEmpty(scp.$parent.child.response)&&!bUIUpdate)return;if(eleType=scp.$parent.child.eleArray[0].type,this.selectTypeList.indexOf(eleType)>=0)scp.$parent.child.response=this.handleSelect(eleType,scp.$parent.child.eleArray[0].response);else if("Date"===eleType||"Date/Time (Local)"===eleType||"Time"===eleType){void 0!==(tempResp=scp.$parent.child.eleArray[0].response)&&null!==tempResp&&tempResp.constructor===Date&&(tempResp=tempResp.toISOString()),scp.$parent.child.response=tempResp}else scp.$parent.child.response=scp.$parent.child.eleArray[0].response}else if(bUIUpdate){if(VOUINS.isEmpty(scp.$parent.child.response)){scp.$parent.child.response=[];for(var i=0;i<scp.$parent.child.eleArray.length;i++)if(eleType=scp.$parent.child.eleArray[i].type,this.selectTypeList.indexOf(eleType)>=0)scp.$parent.child.response.push(this.handleSelect(eleType,scp.$parent.child.eleArray[i].response));else if("Date"===eleType||"Time"===eleType||"Date/Time (Local)"===eleType){void 0!==(tempResp=scp.$parent.child.eleArray[i].response)&&null!==tempResp&&tempResp.constructor===Date&&(tempResp=tempResp.toISOString()),scp.$parent.child.response.push(tempResp)}else scp.$parent.child.response.push(scp.$parent.child.eleArray[i].response)}else if(scp.$parent.child.eleArray[arrayIndex]&&scp.$parent.child.eleArray[arrayIndex].type)if(eleType=scp.$parent.child.eleArray[arrayIndex].type,angular.isArray(scp.$parent.child.response)||(scp.$parent.child.response=[scp.$parent.child.response]),this.selectTypeList.indexOf(eleType)>=0)scp.$parent.child.response[arrayIndex]=this.handleSelect(eleType,scp.$parent.child.eleArray[arrayIndex].response);else if("Date"===eleType||"Time"===eleType||"Date/Time (Local)"===eleType){var tempResp;void 0!==(tempResp=scp.$parent.child.eleArray[arrayIndex].response)&&null!==tempResp&&tempResp.constructor===Date&&(tempResp=tempResp.toISOString()),scp.$parent.child.response[arrayIndex]=tempResp}else scp.$parent.child.response[arrayIndex]=scp.$parent.child.eleArray[arrayIndex].response}else{if(VOUINS.isEmpty(scp.$parent.child.response))return;if(angular.isArray(scp.$parent.child.response))if(scp.$parent.child.response.length<scp.$parent.child.eleArray.length){if(null!==addOrRemoveIndex){var newItemResp=scp.$parent.child.eleArray[addOrRemoveIndex+1].response;eleType=scp.$parent.child.eleArray[addOrRemoveIndex+1].type,this.selectTypeList.indexOf(eleType)>=0&&(newItemResp=this.handleSelect(eleType,newItemResp)),scp.$parent.child.response.splice(addOrRemoveIndex+1,0,newItemResp)}}else scp.$parent.child.response.length>scp.$parent.child.eleArray.length&&null!==addOrRemoveIndex&&(scp.$parent.child.response.splice(addOrRemoveIndex,1),1===scp.$parent.child.response.length&&(scp.$parent.child.response=scp.$parent.child.response[0]));else{var resp=scp.$parent.child.response;if(scp.$parent.child.eleArray.length>1){scp.$parent.child.response=[];newItemResp=scp.$parent.child.eleArray[1].response;eleType=scp.$parent.child.eleArray[1].type,this.selectTypeList.indexOf(eleType)>=0&&(newItemResp=this.handleSelect(eleType,newItemResp)),scp.$parent.child.response.splice(0,0,resp,newItemResp)}}}this.aggregate(scp.$parent.$parent,newArrayIndex,scp.$parent.child.indexInParent,bUIUpdate,null,!0)}else if(function(scp,miniForm){return miniForm?scp.child&&scp.$parent&&scp.$parent.children:scp.$parent.$parent&&scp.$parent.$parent.$parent&&scp.$parent.$parent.$parent.child&&scp.$parent.$parent.$parent.children}(scp,this.miniForm)){var root,children;if(this.miniForm?(children=scp.$parent.$parent.children,root=scp.$parent.child,children||(children=scp.$parent.children,root=scp.child)):(root="lightning"!==this.layout&&"newport"!==this.layout?scp.$parent.$parent.$parent.child:scp.$parent.child,children=scp.$parent.$parent.$parent.children),scp.children.length>0)if(VOUINS.isEmpty(root.response)){root.response={};for(var k=0;k<scp.children.length;k++)-1===this.noneDataControlTypeListV2.indexOf(scp.children[k].eleArray[0].type)&&(this.placeholderEleTypeList.indexOf(scp.children[k].eleArray[0].type)<0||this.placeholderEleTypeList.indexOf(scp.children[k].eleArray[0].type)>=0&&!0===scp.children[k].eleArray[0].propSetMap.dataJSON)&&(key=scp.children[k].eleArray[0].name,root.response[key]=scp.children[k].response,scp.children[k].bHasAttachment&&scp.children[k].response&&scp.children[k].response.length>0&&(root.bHasAttachment=!0)),"Filter Block"===scp.children[k].eleArray[0].type&&(scp.children[k].eleArray[0].vlcJSONPath=root.name+":"+scp.children[k].eleArray[0].name)}else-1===this.noneDataControlTypeListV2.indexOf(scp.children[indexInParent].eleArray[0].type)&&(this.placeholderEleTypeList.indexOf(scp.children[indexInParent].eleArray[0].type)<0||this.placeholderEleTypeList.indexOf(scp.children[indexInParent].eleArray[0].type)>=0&&!0===scp.children[indexInParent].eleArray[0].propSetMap.dataJSON)&&(key=scp.children[indexInParent].eleArray[0].name,root.response[key]=scp.children[indexInParent].response,scp.children[indexInParent].bHasAttachment&&scp.children[indexInParent].response&&scp.children[indexInParent].response.length>0&&(root.bHasAttachment=!0));if(VOUINS.isEmpty(scp.bpTree.response)){scp.bpTree.response={};for(var m=0;m<children.length;m++)-1===this.noneDataControlTypeListV2.indexOf(children[m].type)&&(key=children[m].name,scp.bpTree.response[key]=children[m].response,children[m].bHasAttachment&&(scp.bpTree.bHasAttachment=!0))}else{if(!(key=root.name))return;var tempNode={};tempNode[key]=children[root.indexInParent].response,(_.mergeWith||_.merge)(scp.bpTree.response,tempNode,VOUINS.mergeJSONLogic),children[root.indexInParent].bHasAttachment&&(scp.bpTree.bHasAttachment=!0)}}}($rootScope.tabKey||this.previewMode)&&scp.$evalAsync(function(){scp.bpTree.responseAsText=JSON.stringify(scp.bpTree.response,null,4)})},factory.handleFilterBlock=function(element){for(var filters=[],i=0;i<element.children.length;i++){var filter=element.children[i].eleArray[0].response;if(filter){var filterEle={},attributes=[];if(angular.isArray(filter))for(var j=0;j<filter.length;j++)filter[j]&&!0===filter[j].selected&&attributes.push(filter[j].name);else attributes.push(filter.name);attributes.length>0&&(filterEle.category=element.children[i].eleArray[0].propSetMap.attributeCategoryCode,filterEle.attributes=attributes,filters.push(filterEle))}}filters.length>0?element.response=filters:element.response=null},factory.handleSelect=function(eleType,response,display){if("Select"===eleType)return response&&response.constructor===Object?display?response.value:response.name:null;if("Multi-select"!==eleType&&"Filter Multi-select"!==eleType||!angular.isArray(response))return null;for(var name="",value="",reformattedResp={},ind=0;ind<response.length;ind++)response[ind].selected&&(""!==name&&(name+=";"),name+=response[ind].name,""!=value&&(value+=";"),value+=response[ind].value);return reformattedResp.name=name,reformattedResp.value=value,""===name&&(name=null),display?value:name},factory.UpdateOSAttachment=function(bodyData,attachmentId,options,callback){var deferred=$q.defer();return VOUINS.UpdateOSAttachment(bodyData,attachmentId,options,function(result,event){$rootScope.$apply(function(){event.status?deferred.resolve(result):deferred.reject(null)})}),deferred.promise},factory.CreateOSContentVersion=function(configObj){var prom=this.OmniRemoteInvokeAux(configObj,this);if(!1===prom){var deferred=$q.defer();return VOUINS.CreateOSContentVersion(configObj.bodyData,configObj.filename,configObj.parentId,configObj.options,function(result,event){event.status?deferred.resolve(result):result?deferred.reject(result):deferred.reject({error:event.message})}),deferred.promise}return prom},factory})},{}],21:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-oui-common").factory("currencySymbol",function(){return{ALL:{text:"Lek",uniDec:"76, 101, 107",uniHex:"4c, 65, 6b",decimal:",",group:".",format:"!##,###.00"},AFN:{text:"؋",uniDec:"1547",uniHex:"60b",decimal:"٫",group:"٬",format:"##,###.00!"},ARS:{text:"$",uniDec:"36",uniHex:"24",decimal:",",group:".",format:"!##,###.00"},AWG:{text:"ƒ",uniDec:"402",uniHex:"192",decimal:",",group:".",format:"! ##,###.00"},AUD:{text:"$",uniDec:"36",uniHex:"24",format:"!##,###.00"},AZN:{text:"ман",uniDec:"1084, 1072, 1085",uniHex:"43c, 430, 43d",decimal:",",group:".",format:"! ##,###.00"},BSD:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},BBD:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},BYR:{text:"p.",uniDec:"112, 46",uniHex:"70, 2e",decimal:",",group:" ",format:"!#,###.00"},BZD:{text:"BZ$",uniDec:"66, 90, 36",uniHex:"42, 5a, 24",format:"!#,###.00"},BMD:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},BOB:{text:"$b",uniDec:"36, 98",uniHex:"24, 62",decimal:",",group:".",format:"!##,###.00"},BAM:{text:"KM",uniDec:"75, 77",uniHex:"4b, 4d",decimal:",",group:".",format:"##,###.00 !"},BWP:{text:"P",uniDec:"80",uniHex:"50",format:"!#,###.00"},BGN:{text:"лв",uniDec:"1083, 1074",uniHex:"43b, 432",decimal:",",group:" ",format:"##,###.00 !"},BRL:{text:"R$",uniDec:"82, 36",uniHex:"52, 24",decimal:",",group:".",format:"! ##,###.00"},BND:{text:"$",uniDec:"36",uniHex:"24",decimal:",",group:".",format:"!##,###.00"},KHR:{text:"៛",uniDec:"6107",uniHex:"17db",decimal:",",group:".",format:"!##,###.00"},CAD:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},KYD:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},CLP:{text:"$",uniDec:"36",uniHex:"24",decimal:",",group:".",format:"!##,###.00"},CNY:{text:"¥",uniDec:"165",uniHex:"a5",format:"! #,###.00"},COP:{text:"$",uniDec:"36",uniHex:"24",decimal:",",group:".",format:"!##,###.00"},CRC:{text:"₡",uniDec:"8353",uniHex:"20a1",format:"!##,###.00"},HRK:{text:"kn",uniDec:"107, 110",uniHex:"6b, 6e",decimal:",",group:".",format:"! ##,###.00"},CUP:{text:"₱",uniDec:"8369",uniHex:"20b1",decimal:",",group:".",format:"!##,###.00"},CZK:{text:"Kč",uniDec:"75, 269",uniHex:"4b, 10d",decimal:",",group:" ",format:"##,###.00 !"},DKK:{text:"kr",uniDec:"107, 114",uniHex:"6b, 72",decimal:",",group:".",format:"! ##,###.00"},DOP:{text:"RD$",uniDec:"82, 68, 36",uniHex:"52, 44, 24",format:"!##,###.00"},XCD:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},EGP:{text:"£",uniDec:"163",uniHex:"a3",decimal:"٫",group:"٬",format:"##,###.00 !"},SVC:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},EUR:{text:"€",uniDec:"8364",uniHex:"20ac",decimal:",",group:" ",format:"##,###.00 !"},FKP:{text:"£",uniDec:"163",uniHex:"a3",format:"!##,###.00"},FJD:{text:"$",uniDec:"36",uniHex:"24",format:"!##,###.00"},GHS:{text:"¢",uniDec:"162",uniHex:"a2",format:"!#,###.00"},GIP:{text:"£",uniDec:"163",uniHex:"a3",format:"!#,###.00"},GTQ:{text:"Q",uniDec:"81",uniHex:"51",format:"!#,###.00"},GYD:{text:"$",uniDec:"36",uniHex:"24",format:"!##,###.00"},HNL:{text:"L",uniDec:"76",uniHex:"4c",format:"!#,###.00"},HKD:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},HUF:{text:"Ft",uniDec:"70, 116",uniHex:"46, 74",decimal:",",group:" ",format:"##,###.00 !"},ISK:{text:"kr",uniDec:"107, 114",uniHex:"6b, 72",decimal:",",group:".",format:"##,###.00 !"},INR:{text:"₹",uniDec:"8377",uniHex:"20B9",decimal:".",group:",",format:"!##,###.00"},IDR:{text:"Rp",uniDec:"82, 112",uniHex:"52, 70",decimal:",",group:".",format:"!##,###.00"},IRR:{text:"ریال",uniDec:"65020",uniHex:"fdfc",decimal:"٫",group:"٬",format:"##,###.00!"},ILS:{text:"₪",uniDec:"8362",uniHex:"20aa",decimal:",",group:".",format:"##,###.00 !"},IQD:{text:"د.ع.‏",uniDec:"",uniHex:"",decimal:"٫",group:"٬",format:"##,###.00 !"},JMD:{text:"J$",uniDec:"74, 36",uniHex:"4a, 24",format:"!#,###.00"},JPY:{text:"¥",uniDec:"165",uniHex:"a5",format:"!#,###.00"},KZT:{text:"лв",uniDec:"1083, 1074",uniHex:"43b, 432",decimal:",",group:" ",format:"##,###.00!"},KPW:{text:"₩",uniDec:"8361",uniHex:"20a9",format:"!##,###.00"},KRW:{text:"₩",uniDec:"8361",uniHex:"20a9",format:"!##,###.00"},KGS:{text:"лв",uniDec:"1083, 1074",uniHex:"43b, 432",decimal:",",group:" ",format:"##,###.00 !"},LAK:{text:"₭",uniDec:"8365",uniHex:"20ad",decimal:",",group:".",format:"!##,###.00"},LBP:{text:"£",uniDec:"163",uniHex:"a3",decimal:"٫",group:"٬",format:"##,###.00 !"},LRD:{text:"$",uniDec:"36",uniHex:"24",format:"!##,###.00"},MKD:{text:"ден",uniDec:"1076, 1077, 1085",uniHex:"434, 435, 43d",decimal:",",group:".",format:"! ##,###.00"},MYR:{text:"RM",uniDec:"82, 77",uniHex:"52, 4d",format:"!#,###.00"},MUR:{text:"Rs",uniDec:"8360",uniHex:"20a8",format:"!#,###.00"},MXN:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},MZN:{text:"MT",uniDec:"77, 84",uniHex:"4d, 54",decimal:",",group:" ",format:"##,###.00 !"},NAD:{text:"$",uniDec:"36",uniHex:"24",format:"!##,###.00"},NPR:{text:"Rs",uniDec:"8360",uniHex:"20a8",format:"! #,###.00"},ANG:{text:"ƒ",uniDec:"402",uniHex:"192",format:"!#,###.00"},NZD:{text:"$",uniDec:"36",uniHex:"24",format:"!#,###.00"},NIO:{text:"C$",uniDec:"67, 36",uniHex:"43, 24",format:"!#,###.00"},NGN:{text:"₦",uniDec:"8358",uniHex:"20a6",format:"!#,###.00"},NOK:{text:"kr",uniDec:"107, 114",uniHex:"6b, 72",decimal:",",group:" ",format:"! ##,###.00"},OMR:{text:"ریال",uniDec:"65020",uniHex:"fdfc",decimal:"٫",group:"٬",format:"##,###.00 !"},PKR:{text:"Rs",uniDec:"8360",uniHex:"20a8",format:"!#,###.00"},PAB:{text:"B/.",uniDec:"66, 47, 46",uniHex:"42, 2f, 2e",format:"!#,###.00"},PYG:{text:"Gs",uniDec:"71, 115",uniHex:"47, 73",decimal:",",group:".",format:"!##,###.00"},PEN:{text:"S/.",uniDec:"83, 47, 46",uniHex:"53, 2f, 2e",decimal:",",group:".",format:"!##,###.00"},PHP:{text:"₱",uniDec:"8369",uniHex:"20b1",format:"! ##,###.00"},PLN:{text:"zł",uniDec:"122, 322",uniHex:"7a, 142",decimal:",",group:" ",format:"##,###.00 !"},QAR:{text:"ریال",uniDec:"65020",uniHex:"fdfc",decimal:"٫",group:"٬",format:"##,###.00 !"},RON:{text:"lei",uniDec:"108, 101, 105",uniHex:"6c, 65, 69",decimal:",",group:".",format:"##,###.00 !"},RUB:{text:"руб",uniDec:"1088, 1091, 1073",uniHex:"440, 443, 431",decimal:",",group:" ",format:"##,###.00 !"},SHP:{text:"£",uniDec:"163",uniHex:"a3",format:"!#,###.00"},SAR:{text:"ریال",uniDec:"65020",uniHex:"fdfc",decimal:"٫",group:"٬",format:"##,###.00 !"},RSD:{text:"Дин.",uniDec:"1044, 1080, 1085, 46",uniHex:"414, 438, 43d, 2e",decimal:",",group:".",format:"! ##,###.00"},SCR:{text:"Rs",uniDec:"8360",uniHex:"20a8",format:"!##,###.00"},SGD:{text:"$",uniDec:"36",uniHex:"24",format:"!##,###.00"},SBD:{text:"$",uniDec:"36",uniHex:"24",format:"!##,###.00"},SOS:{text:"S",uniDec:"83",uniHex:"53",format:"!##,###.00"},ZAR:{text:"R",uniDec:"82",uniHex:"52",format:"!##,###.00"},LKR:{text:"Rs",uniDec:"8360",uniHex:"20a8",format:"! ##,###.00"},SEK:{text:"kr",uniDec:"107, 114",uniHex:"6b, 72",decimal:",",group:" ",format:"##,###.00 !"},CHF:{text:"CHF",uniDec:"67, 72, 70",uniHex:"43, 48, 46",decimal:".",group:"'",format:"! ##,###.00"},SRD:{text:"$",uniDec:"36",uniHex:"24",decimal:",",group:".",format:"! ##,###.00"},SYP:{text:"£",uniDec:"163",uniHex:"a3",decimal:"٫",group:"٬",format:"##,###.00 !"},TWD:{text:"NT$",uniDec:"78, 84, 36",uniHex:"4e, 54, 24",format:"!##,###.00"},THB:{text:"฿",uniDec:"3647",uniHex:"e3f",format:"!#,###.00"},TTD:{text:"TT$",uniDec:"84, 84, 36",uniHex:"54, 54, 24",format:"!##,###.00"},TRY:{text:"₺",uniDec:"8378",uniHex:"20ba",group:".",decimal:",",format:"!#,###.00"},TVD:{text:"$",uniDec:"36",uniHex:"24",group:",",decimal:".",format:"!#,###.00"},UAH:{text:"₴",uniDec:"8372",uniHex:"20b4",group:" ",decimal:",",format:"#,###.00 !"},GBP:{text:"£",uniDec:"163",uniHex:"a3",group:",",decimal:".",format:"!#,###.00"},USD:{text:"$",uniDec:"36",uniHex:"24",group:",",decimal:".",format:"!#,###.00"},UYU:{text:"$U",uniDec:"36, 85",uniHex:"24, 55",group:".",decimal:",",format:"! #,###.00"},UZS:{text:"soʻm",uniDec:"1083, 1074",uniHex:"43b, 432",group:",",decimal:".",format:"#,###.00 !"},VEF:{text:"Bs",uniDec:"66, 115",uniHex:"42, 73",decimal:",",group:".",format:"!#,###.00"},VND:{text:"₫",uniDec:"8363",uniHex:"20ab",decimal:",",group:".",format:"#,###.00 !"},XOF:{text:"CFA",uniDec:"8363",uniHex:"20ab",decimal:".",group:",",format:"!#,###.00"},YER:{text:"ر.ي.",uniDec:"65020",uniHex:"fdfc",decimal:".",group:",",format:"#,###.00 !"},ZWD:{text:"Z$",uniDec:"90, 36",uniHex:"5a, 24",format:"# ###.##"},AED:{text:"د.إ"},AOA:{text:"Kz"},BDT:{text:"Tk"},BHD:{text:"BD"},ETB:{text:"Br"},HTG:{text:"G"},KES:{text:"KSh"},KWD:{text:"ك"},LYD:{text:"LD"},MGA:{text:"Ar"},MMK:{text:"K"},MNT:{text:"₮"},MOP:{text:"MOP$"},MWK:{text:"MK"},PGK:{text:"K"},SLL:{text:"Le"},TOP:{text:"T$"},UGX:{text:"UGX"},VUV:{text:"VT"},MAD:{text:"MAD",format:"!##,###.00"}}})}()},{}],22:[function(require,module,exports){window.VOUINS=window.VOUINS||{},VOUINS.GenericInvoke=function(sClassName,sMethodName,input,options,iTimeout,callback){var optionsJson=JSON.parse(options);if(void 0!==optionsJson.customAjaxFunction)(0,window[optionsJson.customAjaxFunction])(sClassName,sMethodName,input,options,iTimeout,callback);else{var remoteOptions={escape:!1,buffer:!1};void 0!=iTimeout&&null!==iTimeout&&3e4!==iTimeout&&(remoteOptions.timeout=iTimeout),void 0!==sClassName&&null!==sClassName||(sClassName=""),void 0!==sMethodName&&null!==sMethodName||(sMethodName="");var totalLength=input.length+options.length;if((!0===optionsJson.useQueueableApexRemoting||totalLength>7e5)&&"undefined"!=typeof vlocityVFActionFunctionControllerHandlers&&"function"==typeof vlocityVFActionFunctionControllerHandlers.runServerMethod){var isQueueable=!0===optionsJson.useQueueableApexRemoting;vlocityVFActionFunctionControllerHandlers.runServerMethod(sClassName,sMethodName,input,options,isQueueable,callback)}else if("undefined"!=typeof Visualforce){Visualforce.remoting.Manager.invokeAction(remoteActionMap.GenericInvoke2,sClassName,sMethodName,input,options,function(result,event){event.message&&!event.error&&(event.message.indexOf("Input too long.")>-1?event.error=customLabels.RequestTooLarge:event.error=event.message),callback(result,event)},remoteOptions)}else VOUINS.fakeAjax(callback)}},VOUINS.isEmpty=function(obj){return void 0===obj||null===obj||""===obj||obj.constructor===Object&&0===Object.keys(obj).length},VOUINS.mergeJSONLogic=function(a,b){return _.isArray(a)||_.isArray(b)||null===a||null===b?b:void 0===b?null:void 0},VOUINS.fakeAjax=function(callback){setTimeout(function(){callback({error:customLabels.OmniNoSFDCConnection},{status:!0})},0)},VOUINS.generateUUID=function(){var d=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:3&r|8).toString(16)})},VOUINS.getQueryParams=function(queryString){var query=(queryString||window.location.search).substring(1);if(!query)return!1;function decode(s){return s?s=(s=(s=(s=s.replace(/\+/g," ")).replace(/%([EF][0-9A-F])%([89AB][0-9A-F])%([89AB][0-9A-F])/gi,function(code,hex1,hex2,hex3){var n1=parseInt(hex1,16)-224,n2=parseInt(hex2,16)-128;if(0==n1&&n2<32)return code;var n=(n1<<12)+(n2<<6)+(parseInt(hex3,16)-128);return n>65535?code:String.fromCharCode(n)})).replace(/%([CD][0-9A-F])%([89AB][0-9A-F])/gi,function(code,hex1,hex2){var n1=parseInt(hex1,16)-192;if(n1<2)return code;var n2=parseInt(hex2,16)-128;return String.fromCharCode((n1<<6)+n2)})).replace(/%([0-7][0-9A-F])/gi,function(code,hex){return String.fromCharCode(parseInt(hex,16))}):""}var tmp0=_.chain(query.split("&")).map(function(params){var p=params.split("=");if(!(p[0]&&unescape(p[0])&&unescape(p[0]).toLowerCase().indexOf("</script")>=0||decode(p[1])&&unescape(decode(p[1]))&&unescape(decode(p[1])).toLowerCase().indexOf("</script")>=0))return[p[0],decode(p[1])]});return tmp0.fromPairs&&"function"==typeof tmp0.fromPairs?tmp0.fromPairs().value():tmp0.object().value()},VOUINS.initiateForce=function(scope,force){if(scope.instanceHost="..",null!=sfdcVars&&null!=sfdcVars.instanceHost&&(scope.instanceHost=sfdcVars.instanceHost),window.OmniForce=force,"{!$Api.Session_ID}"===window.sessionId)if(window.customVOmniAuth&&window.customVOmniAuth.constructor===Function)window.customVOmniAuth(scope);else{if(window.parent.VlocOmniOut&&window.parent.VlocOmniOut.force){window.parent.VlocOmniOut.forceLocalDef&&(window.forceLocalDef=window.parent.VlocOmniOut.forceLocalDef),window.parent.VlocOmniOut.callUserInfo&&(window.callUserInfo=window.parent.VlocOmniOut.callUserInfo);var oauth=window.parent.VlocOmniOut.force.getOAuth(),urls=window.parent.VlocOmniOut.force.getURLs();oauth&&urls&&window.OmniForce.init({useProxy:urls.useProxy,proxyURL:urls.proxyURL,oauthCallbackURL:urls.oauthCallbackURL,accessToken:oauth.access_token,instanceURL:oauth.instance_url})}else if(window.parent.sfdccredentials){var accessToken=window.parent.sfdccredentials.accessToken,instanceURL=window.parent.sfdccredentials.instanceURL;accessToken&&instanceURL&&window.OmniForce.init({accessToken:accessToken,instanceURL:instanceURL,useProxy:!1})}if(!window.OmniForce||!window.OmniForce.getOAuth())return;scope.instanceHost=window.OmniForce.getOAuth().instance_url,scope.$root.instanceHost=window.OmniForce.getOAuth().instance_url}},VOUINS.loadCustomHTMLJS=function(scope){var htmlMarkup=null;if(scope.bpTree&&void 0!==scope.bpTree.testTemplates&&null!==scope.bpTree.testTemplates&&(htmlMarkup=scope.bpTree.testTemplates),scope.bpTree&&void 0!==scope.bpTree.customJS&&null!==scope.bpTree.customJS){var customJS=document.createElement("SCRIPT"),customJSCode=document.createTextNode(scope.bpTree.customJS);customJS.appendChild(customJSCode),document.body.appendChild(customJS)}return htmlMarkup},VOUINS.loadHeaderHTML=function(scope,compile){for(var headerMarkup="",headerScripts=window.document.head.getElementsByTagName("script"),length=headerScripts.length,i=0;i<length;i++)"text/ng-template"==headerScripts[i].getAttribute("type")&&(headerMarkup+=headerScripts[i].outerHTML);""!=headerMarkup&&compile(headerMarkup)},VOUINS.getTopBPDom=function(scp){var returnDom=scp.miniForm?document.getElementById(scp.bpTree.sOmniScriptId):document;return returnDom||(returnDom=document),returnDom},VOUINS.isDigit=function(s){return/[\d()+]/.test(s)},VOUINS.isRepeatNotation=function(key){if(void 0!==key&&null!==key){var parseFlds=key.match(/[|]( *)[n]/g);if(parseFlds&&parseFlds.length>0)return!0}return!1},VOUINS.getFilesMap=function(filesMap,bSforce,sf){if(filesMap){if(bSforce&&sf.connection){var filesMapReduced={};if(angular.toJson(filesMap).length>1e6){filesMapReduced={};return angular.forEach(filesMap,function(value,fileKey){filesMapReduced[fileKey]=fileKey}),filesMapReduced}return filesMap}return filesMap}return{}},VOUINS.syncFileAttachmentData=function(response,block,rootScp,qSrv,scp,filesMap,injSrc,winSrv){var deferred=qSrv.defer();return block?rootScp.loading=!0:scp&&scp.bpTree&&(scp.bpTree.savingAttachments=!0),setTimeout(function(){var attachmentSyncData;if(response&&(attachmentSyncData=response.fileAttachmentSyncData),attachmentSyncData){var allAttachmentPromises=[];angular.forEach(attachmentSyncData,function(attachmentId,fileMapKey){rootScp.isSforce&&filesMap&&filesMap[fileMapKey]&&"string"==typeof filesMap[fileMapKey]&&allAttachmentPromises.push(injSrc.UpdateOSAttachment(filesMap[fileMapKey].substr(filesMap[fileMapKey].indexOf(",")+1),attachmentId,{ContentType:filesMap[fileMapKey].substring(5,filesMap[fileMapKey].indexOf(";"))}))});var onSyncComplete=function(results){console.log("results",results),block?rootScp.loading=!1:scp&&scp.bpTree&&(scp.bpTree.savingAttachments=!1),results||winSrv.alert(customLabels.OmniScriptSavingAttachmentsFailed),deferred.resolve({status:!0})};qSrv.all(allAttachmentPromises).then(onSyncComplete,onSyncComplete)}else block?rootScp.loading=!1:scp.bpTree.savingAttachments=!1,deferred.resolve({status:!0})}),deferred.promise},VOUINS.UpdateOSAttachment=function(bodyData,attachmentId,options,callback){sforce.connection.sessionId=window.sessionId;var attachmentSObj=new sforce.SObject("Attachment");attachmentSObj.Id=attachmentId,attachmentSObj.Body=bodyData,options.ContentType&&(attachmentSObj.ContentType=options.ContentType),sforce.connection.update([attachmentSObj],{onSuccess:function(result){callback&&callback(attachmentId,{status:result[0].getBoolean("success")})},onFailure:function(result){callback&&callback(attachmentId,{status:!1})}})},VOUINS.propShortNameMap={previousLabel:"ompl",nextLabel:"omnl",cancelLabel:"omcl",saveLabel:"omsl",completeLabel:"omcoml",summaryLabel:"omsul",submitLabel:"omsubl",reviseLabel:"omrl",failureNextLabel:"omfnl",failureAbortLabel:"omfal",failureGoBackLabel:"omfgbl",redirectNextLabel:"omrnl",redirectPreviousLabel:"omrpl",consoleTabLabel:"omctl",newItemLabel:"omnil",newLabel:"omnewl",editLabel:"omel",deleteLabel:"omdl",cancelMessage:"omcm",saveMessage:"omsm",completeMessage:"omcomm",inProgressMessage:"omipm",postMessage:"ompm",failureAbortMessage:"omfam",buttonLabel:"ombl",checkLabel:"omckl","messages|n:text":"omtl","persistentComponent|n:label":"ompcl","options|n:value":"omov","radioLabels|n:value":"omrlv",instructionKey:"omik",labelKey:"omlk",textKey:"omtk",subLabel:"omsbl",remoteConfirmMsg:"omrcm","errorMessage:custom|n:message":"omermc","errorMessage:default":"omerd",ptrnErrText:"ompet"},VOUINS.updatePropJSON=function(propInput,labelMsg,labelKeyMap){var tokenList=labelMsg.split(":"),propToUpdate=VOUINS.getPropToUpdate(propInput,tokenList);if(propToUpdate){var node=tokenList[tokenList.length-1];if(angular.isArray(propToUpdate))for(var j=0;j<propToUpdate.length;j++)void 0===propToUpdate[j][VOUINS.propShortNameMap[labelMsg]]&&(propToUpdate[j][VOUINS.propShortNameMap[labelMsg]]=propToUpdate[j][node]),!propToUpdate[j][VOUINS.propShortNameMap[labelMsg]]&&customLabels.hasOwnProperty("Omni"+labelMsg)?propToUpdate[j][node]=customLabels["Omni"+labelMsg]:propToUpdate[j][node]=labelKeyMap[propToUpdate[j][VOUINS.propShortNameMap[labelMsg]]];else void 0===propToUpdate[VOUINS.propShortNameMap[labelMsg]]&&(propToUpdate[VOUINS.propShortNameMap[labelMsg]]=propToUpdate[node]),!propToUpdate[VOUINS.propShortNameMap[labelMsg]]&&customLabels.hasOwnProperty("Omni"+labelMsg)?propToUpdate[node]=customLabels["Omni"+labelMsg]:propToUpdate[node]=labelKeyMap[propToUpdate[VOUINS.propShortNameMap[labelMsg]]]}},VOUINS.handleMultiLangLabel=function(control,labelKeyMap,scriptHd){if(control){if(VOUINS.picklistEleList.indexOf(control.type)>=0&&("Custom"===control.propSetMap.optionSource.type||"SObject"===control.propSetMap.optionSource.type))return;var labelMsgList=VOUINS.ootbLabelMap[control.type];if(VOUINS.actionEleTypesBase.indexOf(control.type)>=0&&!0===control.propSetMap.confirm&&(labelMsgList=labelMsgList.concat(VOUINS.ootbLabelMap2)),labelMsgList)for(var i=0;i<labelMsgList.length;i++)labelMsgList[i].indexOf(":")<0&&labelMsgList[i].indexOf("|")<0?(void 0===control.propSetMap[VOUINS.propShortNameMap[labelMsgList[i]]]&&(control.propSetMap[VOUINS.propShortNameMap[labelMsgList[i]]]=control.propSetMap[labelMsgList[i]]),!control.propSetMap[VOUINS.propShortNameMap[labelMsgList[i]]]&&customLabels.hasOwnProperty("Omni"+labelMsgList[i])?control.propSetMap[labelMsgList[i]]=customLabels["Omni"+labelMsgList[i]]:control.propSetMap[labelMsgList[i]]=labelKeyMap[control.propSetMap[VOUINS.propShortNameMap[labelMsgList[i]]]]):VOUINS.updatePropJSON(control.propSetMap,labelMsgList[i],labelKeyMap)}if(scriptHd)for(labelMsgList=VOUINS.ootbLabelMap.Script,i=0;i<labelMsgList.length;i++)VOUINS.updatePropJSON(scriptHd,labelMsgList[i],labelKeyMap)},VOUINS.pickListSeeding=function(rootScope,bpSrc,bpTree){if(void 0===bpSrc.bPLSeeding&&(bpSrc.bPLSeeding=!1,(!0===bpTree.propSetMap.rtpSeed||bpSrc.bMultiLang)&&(bpSrc.bPLSeeding=!0)),!1!==bpSrc.bPLSeeding){if(Object.getOwnPropertyNames(bpTree.sobjPL).length<=0&&Object.getOwnPropertyNames(bpTree.cusPL).length<=0&&Object.getOwnPropertyNames(bpTree.depSOPL)<=0&&Object.getOwnPropertyNames(bpTree.depCusPL)<=0)return rootScope.VlocPicklistSeeding={},void(rootScope.seedingDone=!0);var input={sobjPL:Object.keys(bpTree.sobjPL).join(),cusPL:Object.keys(bpTree.cusPL).join(),depSOPL:Object.keys(bpTree.depSOPL).join(),depCusPL:Object.keys(bpTree.depCusPL).join(),LanguageCode:bpSrc.LanguageCode},configObj={sClassName:bpSrc.sNSC+"DefaultFetchPicklistOptionsImpl",sMethodName:"OmniScriptPicklistSeed",input:angular.toJson(input),options:"{}",iTimeout:null,label:{label:"PicklistSeeding",stage:"PicklistSeeding"}};bpSrc.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);remoteResp&&remoteResp.VlocPicklistSeeding?rootScope.VlocPicklistSeeding=angular.fromJson(remoteResp.VlocPicklistSeeding):rootScope.VlocPicklistSeeding={},rootScope.seedingDone=!0,console.log("seeding")},function(error){rootScope.seedingFailed=!0,rootScope.VlocPicklistSeeding={},console.log("Picklist seeding failed "+scope.child.eleArray[0].name)})}},VOUINS.CreateOSContentVersion=function(bodyData,filename,parentId,options,callback){var optionsJson=JSON.parse(options);if(void 0!==optionsJson.customAjaxFunction)(0,window[optionsJson.customAjaxFunction])(bodyData,parentId,filename,options,callback);else if("undefined"!=typeof Visualforce)if(bodyData.length>5e7)callback({error:customLabels.OmniMaxFileSize},{status:!1});else if("undefined"!=typeof sforce&&sforce.connection&&bodyData.length>2e6)VOUINS.CreateOSContentVersionSOAP(bodyData,filename,function(result){"string"==typeof result&&(result=JSON.parse(result)),result.contentVersionId?VOUINS.CreateOSContentVersionCallback(result.contentVersionId,parentId,callback):callback(result,{status:!1})});else if(bodyData.length>7e5&&"undefined"!=typeof vlocityVFActionFunctionControllerHandlers&&"function"==typeof vlocityVFActionFunctionControllerHandlers.runServerMethod){var className="BusinessProcessDisplayController.BusinessProcessDisplayControllerOpen";""!=sfdcVars.sNS&&(className=sfdcVars.sNS+"."+className);var input=angular.toJson({bodyData:bodyData,filename:filename,parentId:parentId});vlocityVFActionFunctionControllerHandlers.runServerMethod(className,"CreateOSContentVersion",input,"{}",!1,function(result,event){result||(result=event),"string"==typeof result&&(result=JSON.parse(result)),result.contentDocumentId?callback(result,{status:!0}):(result.error||(result.error=customLabels.UploadFailed),callback(result,{status:!1}))})}else Visualforce.remoting.Manager.invokeAction(remoteActionMap.CreateOSContentVersion,bodyData,filename,parentId,callback,{escape:!1,buffer:!1});else VOUINS.fakeAjax(callback)},VOUINS.CreateOSContentVersionSOAP=function(bodyData,filename,callback){sforce.connection.sessionId=window.sessionId;var attachmentSObj=new sforce.SObject("ContentVersion");attachmentSObj.VersionData=bodyData,attachmentSObj.Title=filename,attachmentSObj.PathOnClient=filename,sfdcVars.communitiesNetworkId&&(attachmentSObj.NetworkId=sfdcVars.communitiesNetworkId),sforce.connection.create([attachmentSObj],{onSuccess:function(result){callback&&callback({contentVersionId:result[0].id},{status:result[0].getBoolean("success")})},onFailure:function(result){callback&&callback({error:result.faultstring},{status:!1})}})},VOUINS.CreateOSContentVersionCallback=function(contentVersionId,parentId,callback){Visualforce.remoting.Manager.invokeAction(remoteActionMap.ContentVersionAddLink,contentVersionId,parentId,function(result){"string"==typeof result&&(result=angular.fromJson(result)),callback(result,{status:!0})},{escape:!1,buffer:!1})},VOUINS.ClearData=function(scope){scope.bpTree=null,scope.omniInput=null,scope.child={},scope.children=[],scope.submitted=!1,scope.actionStatus={},scope.isFormValid=!0},VOUINS.resetOptions=function(control,newOpt){if("Multi-select"!==control.type)control.propSetMap.options=newOpt;else{var existingOptMap={};if(angular.isArray(control.propSetMap.options))for(var i=0;i<control.propSetMap.options.length;i++)!0===control.propSetMap.options[i].selected&&(existingOptMap[control.propSetMap.options[i].name]="");if(angular.isArray(newOpt)&&Object.getOwnPropertyNames(existingOptMap).length>0)for(i=0;i<newOpt.length;i++)existingOptMap.hasOwnProperty(newOpt[i].name)&&(newOpt[i].selected=!0);control.propSetMap.options=newOpt}},VOUINS.handleEditBlockLabel=function(children,labelKeyMap,labelMap){for(var i=0;i<children.length;i++)for(var j=0;j<children[i].eleArray.length;j++)children[i].eleArray[j].propSetMap.disOnTplt&&(children[i].eleArray[j].propSetMap.label=labelKeyMap[labelMap[children[i].eleArray[j].name]])}},{}],23:[function(require,module,exports){window.VOUINS=window.VOUINS||{},VOUINS.VlocityTrack=function(trackingData){"undefined"!=typeof Visualforce&&Visualforce.remoting.Manager.invokeAction(remoteActionMap.VlocityTrack,trackingData,function(){},{escape:!1,buffer:!0})},VOUINS.BuildJSONV3=function(sId,scriptState,bPreview,multiLangCode,callback){void 0===multiLangCode&&(multiLangCode=null),"undefined"!=typeof Visualforce?Visualforce.remoting.Manager.invokeAction(remoteActionMap.BuildJSONV3,sId,scriptState,bPreview,multiLangCode,callback,{escape:!1,buffer:!1}):VOUINS.fakeAjax(callback)},VOUINS.fakeAjax=function(callback){setTimeout(function(){callback({error:customLabels.OmniNoSFDCConnection},{status:!0})},0)},VOUINS.SaveBP=function(bpTree,files,callback){if(bpTree.length+files.length>7e5&&"undefined"!=typeof vlocityVFActionFunctionControllerHandlers&&"function"==typeof vlocityVFActionFunctionControllerHandlers.runServerMethod){var input=angular.toJson({bpTree:bpTree,files:files}),className="BusinessProcessDisplayController.BusinessProcessDisplayControllerOpen";""!=sfdcVars.sNS&&(className=sfdcVars.sNS+"."+className),vlocityVFActionFunctionControllerHandlers.runServerMethod(className,"SaveBP",input,"{}",!1,callback)}else"undefined"!=typeof Visualforce?Visualforce.remoting.Manager.invokeAction(remoteActionMap.SaveBP,bpTree,files,callback,{escape:!1,buffer:!1}):VOUINS.fakeAjax(callback)},VOUINS.CompleteScript=function(sInstanceId,callback){"undefined"!=typeof Visualforce?Visualforce.remoting.Manager.invokeAction(remoteActionMap.CompleteScript,sInstanceId,callback,{escape:!1,buffer:!1}):VOUINS.fakeAjax(callback)},VOUINS.CreateOSAttachment=function(bodyData,parentId,filename,options,callback){var optionsJson=JSON.parse(options);void 0!==optionsJson.customAjaxFunction?(0,window[optionsJson.customAjaxFunction])(bodyData,parentId,filename,options,callback):"undefined"!=typeof Visualforce?"undefined"!=typeof sforce&&sforce.connection&&bodyData.length>2e6?Visualforce.remoting.Manager.invokeAction(remoteActionMap.CreateOSAttachment,"TEMP BODY",parentId,filename,function(attachmentId){UpdateOSAttachment(bodyData,attachmentId,options,callback)},{escape:!1,buffer:!1}):(!0===optionsJson.useQueueableApexRemoting||bodyData.length>7e5)&&"undefined"!=typeof vlocityVFActionFunctionControllerHandlers&&"function"==typeof vlocityVFActionFunctionControllerHandlers.runAddAttachment?vlocityVFActionFunctionControllerHandlers.runAddAttachment(bodyData,parentId,filename,function(attachmentId){callback(attachmentId,{status:!0})},function(){callback(null,{status:!1})}):Visualforce.remoting.Manager.invokeAction(remoteActionMap.CreateOSAttachment,bodyData,parentId,filename,callback,{escape:!1,buffer:!1}):VOUINS.fakeAjax(callback)},VOUINS.DeleteOSAttachment=function(attachmentId,deleteParent,options,callback){"undefined"!=typeof Visualforce?Visualforce.remoting.Manager.invokeAction(remoteActionMap.DeleteOSAttachment,attachmentId,deleteParent,callback,{escape:!1,buffer:!1}):VOUINS.fakeAjax(callback)},VOUINS.BuildJSONWithPrefill=function(sType,sSubType,sLang,sPfBundle,sDrParams,multiLangCode,callback){void 0===multiLangCode&&(multiLangCode=null),window.OmniOut?VOUINS.BuildJSONWithPrefillLocalDef(sType,sSubType,sLang,sPfBundle,sDrParams,multiLangCode,callback):"undefined"!=typeof Visualforce?Visualforce.remoting.Manager.invokeAction(remoteActionMap.BuildJSONWithPrefill,sType,sSubType,sLang,sPfBundle,sDrParams,multiLangCode,callback,{escape:!1,buffer:!1}):VOUINS.fakeAjax(callback)},VOUINS.BuildJSONWithPrefillLocalDef=function(sType,sSubType,sLang,sPfBundle,sDrParams,multiLangCode,callback){var path="",xhttp=new XMLHttpRequest;path=(path="string"==typeof window.VOmniScriptDefPath?window.VOmniScriptDefPath:"./scripts/")+sType.replace(/\s+/g,"")+"_"+sSubType.replace(/\s+/g,"")+"_"+sLang.replace(/\s+/g,"")+".json",xhttp.onreadystatechange=function(){if(4==this.readyState){var reqObj=this;this.state=this.state||this.status,0===this.status&&this.responseText&&this.responseText.length>0?reqObj=Object.assign({},reqObj,{status:200,state:200}):200!==this.state&&(this.message=this.responseText,this.errType="LocalScriptDefNotFound"),callback(this.responseText.replace(/^{/,'{"refreshUserInfo":true,'),reqObj)}},xhttp.open("GET",path,!0),xhttp.send()},VOUINS.CreateOSDocumentAttachment=function(bodyData,fileName,foldeId,contentType,callback){sforce.connection.sessionId=window.sessionId;var attachmentSObj=new sforce.SObject("Document");attachmentSObj.Body=bodyData,attachmentSObj.Name=fileName,attachmentSObj.FolderId=foldeId,attachmentSObj.ContentType=contentType,sforce.connection.create([attachmentSObj],{onSuccess:function(result){callback&&callback(result[0].id,{status:result[0].getBoolean("success")})},onFailure:function(result){callback&&callback(result.faultstring,{status:!1})}})},VOUINS.constructSFLLink=function(location,service){var link=location.origin+location.pathname+"?",qParam=VOUINS.getQueryParams(location.search);if(qParam)for(var key in qParam)qParam.hasOwnProperty(key)&&service.incQueryParams.hasOwnProperty(key)&&(link+=key+"="+qParam[key]+"&");return link&&"&"==link[link.length-1]&&(link=link.substring(0,link.length-1)),link}},{}],24:[function(require,module,exports){window.VOUINS=window.VOUINS||{},VOUINS.ootbLabelMap={Step:["previousLabel","nextLabel","cancelLabel","saveLabel","completeLabel","cancelMessage","saveMessage","completeMessage","instructionKey","chartLabel","errorMessage:custom|n:message","errorMessage:default"],"Text Block":["textKey"],Headline:["labelKey"],Submit:["summaryLabel","submitLabel","reviseLabel","errorMessage:custom|n:message","errorMessage:default"],"DataRaptor Extract Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"Remote Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"Rest Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"DataRaptor Post Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"Post to Object Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"Done Action":["consoleTabLabel","errorMessage:custom|n:message","errorMessage:default"],"Review Action":["nextLabel","previousLabel","errorMessage:custom|n:message","errorMessage:default"],"Filter Block":["buttonLabel"],"Calculation Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"PDF Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"DocuSign Envelope Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"DocuSign Signature Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"Type Ahead":["newItemLabel"],"Email Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"DataRaptor Transform Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"Matrix Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"Integration Procedure Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","errorMessage:custom|n:message","errorMessage:default"],"Edit Block":["newLabel","editLabel","deleteLabel"],"Delete Action":["failureNextLabel","failureAbortLabel","failureGoBackLabel","redirectNextLabel","redirectPreviousLabel","inProgressMessage","failureAbortMessage","postMessage","remoteConfirmMsg","cancelLabel","subLabel"],Validation:["messages|n:text"],Checkbox:["checkLabel"],Email:["ptrnErrText"],Number:["ptrnErrText"],Password:["ptrnErrText"],Telephone:["ptrnErrText"],Text:["ptrnErrText"],"Text Area":["ptrnErrText"],URL:["ptrnErrText"],Disclosure:["checkLabel","textKey"],Script:["persistentComponent|n:label","consoleTabLabel","errorMessage:custom|n:message"],Radio:["options|n:value"],Select:["options|n:value"],"Multi-select":["options|n:value"],"Radio Group":["options|n:value","radioLabels|n:value"],File:["errorMessage:custom|n:message","errorMessage:default"],Image:["errorMessage:custom|n:message","errorMessage:default"],Lookup:["errorMessage:custom|n:message","errorMessage:default"]},VOUINS.ootbLabelMap2=["subLabel","remoteConfirmMsg","cancelLabel"],VOUINS.actionEleTypesBase=["Remote Action","Rest Action","DataRaptor Extract Action","DataRaptor Post Action","Post to Object Action","Review Action","Done Action","Calculation Action","PDF Action","Set Values","Set Errors","DocuSign Envelope Action","DocuSign Signature Action","Email Action","DataRaptor Transform Action","Matrix Action","Integration Procedure Action"],VOUINS.actionEleTypes=VOUINS.actionEleTypesBase.concat(["Delete Action"]),VOUINS.picklistEleList=["Select","Multi-select","Radio"],VOUINS.getPropToUpdate=function(prop,tokenList){"use strict";for(var ind=0;ind<tokenList.length-1;ind++){tokenList[ind].indexOf("|n")>=0&&(tokenList[ind]=tokenList[ind].slice(0,tokenList[ind].length-2));var buildupArray=[];if(!prop)return null;if(Array.isArray(prop)){for(var j=0;j<prop.length;j++)if(prop[j]=prop[j][tokenList[ind]],Array.isArray(prop[j]))for(var k=0;k<prop[j].length;k++)buildupArray.push(prop[j][k])}else if(prop&&(prop=prop[tokenList[ind]]),Array.isArray(prop))for(var l=0;l<prop.length;l++)buildupArray.push(prop[l]);buildupArray.length>0&&(prop=buildupArray)}return prop},VOUINS.createPropPaths=function(prop,pathStr){"use strict";var pathList=[];if("string"!=typeof pathStr)return pathList;pathStr=(pathStr=pathStr.replace(/[|]n/g,"|\\d")).replace(/[|]/g,"[|]");var pathStrRegex=new RegExp("^"+pathStr+"$"),flatten=function(prop,path){if(!prop)return path;for(var keys=Object.keys(prop),i=0;i<keys.length;i++)if("object"==typeof prop[keys[i]]){var symbol=Array.isArray(prop[keys[i]])?"|":":";flatten(prop[keys[i]],path+keys[i]+symbol)}else{var pathFlat=path+keys[i];pathStrRegex.test(pathFlat)&&pathList.push(pathFlat)}};return flatten(prop,""),pathList}},{}],25:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-omni-knowledge").directive("vlcSldsOpen",function($compile,bpService,$aria){var opInConsole=function(sforce,bpService){return function(article){var url="/articles/"+article.aType+"/"+article.urlName;bpService.isInConsole?sforce.console.getEnclosingPrimaryTabId(function(result){var tabId=result.id;sforce.console.openSubtab(tabId,url,!0,article.title,null,null,"articleSubTab")}):void 0!==sforce&&null!==sforce&&void 0!==sforce.one&&null!==sforce.one?sforce.one.navigateToURL(url,!1):window.open(url,"_blank")}}(window.sforce,bpService);return{restrict:"A",isOmniOut:!1,link:function(scope,element,attrs){$aria&&($aria.config("bindRoleForClick")&&!element.attr("role")&&element.attr("role","button"),$aria.config("tabindex")&&!element.attr("tabindex")&&element.attr("tabindex",0),!$aria.config("bindKeydown")||attrs.ngKeydown||attrs.ngKeypress||attrs.ngKeyup||(element.on("keyup",function(event){32===(event.which||event.keyCode)&&listener(event)}),element.on("keydown",function(event){13===(event.which||event.keyCode)&&listener(event)})));var listener=function(){opInConsole(scope.i)};element.on("click",listener),scope.$on("destroy",function(){element.off("click",listener)})}}})}()},{}],26:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-omni-knowledge",[])}(),require("./directives/vlcSldsOpen.js")},{"./directives/vlcSldsOpen.js":25}],27:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-omni-out").directive("img",["$q",function($q){return{restrict:"E",link:function(scope,element,attrs){scope.$root;var sString=attrs.src||attrs.ngSrc;sString&&(scope.instanceHost||(scope.instanceHost=scope.$root.instanceHost||null),scope.instanceHost&&setTimeout(function(){attrs.$set("src",sString.replace("..",scope.instanceHost))}))}}}])}()},{}],28:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-omni-out").directive("vlcSldsOpen",function(bpService){var opInConsole=function(article,instance){var url="/articles/"+article.aType+"/"+article.urlName;url=instance+url,window.open(url,"_blank")};return{restrict:"A",isOmniOut:!0,link:function(scope,element,attrs){var listener=function(){opInConsole(scope.i,scope.instanceHost)};element.on("click",listener),scope.$on("destroy",function(){element.off("click",listener)})}}})}()},{}],29:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-omni-out",[])}(),require("./directives/vlcSldsImage.js"),require("./directives/vlcSldsOmniOutOpen.js"),require("./run/cordovaKeyboardHandler.js");var a=navigator.userAgent;if(-1!=a.indexOf("Salesforce")&&(-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPad"))&&-1==a.indexOf("Safari")){var s=document.createElement("style");s.innerHTML="html,html body{overflow:scroll;-webkit-overflow-scrolling:touch;zindex:0;}body{position:absolute;left:0;right:0;top:0;bottom:0;}",document.getElementsByTagName("head")[0].appendChild(s)}},{"./directives/vlcSldsImage.js":27,"./directives/vlcSldsOmniOutOpen.js":28,"./run/cordovaKeyboardHandler.js":30}],30:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-omni-out").run(function(){var isNative=/(ip[ao]d|iphone|android)/gi.test(window.navigator.userAgent);if(("createTouch"in window.document||"ontouchstart"in window.document)&&isNative){var list={"Type Ahead":1,Lookup:1};window.addEventListener("click",function(evt){if("input"===evt.target.nodeName.toLowerCase())try{(angular.element(evt.target).scope().control.type||angular.element(evt.target).scope().$parent.control.type)in list&&evt.target.scrollIntoView()}catch(e){}})}})}()},{}],31:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").decorator("$window",["$delegate","$injector",function($delegate,$injector){var windowDecorate={};return $delegate.oldAlert?(windowDecorate.oldAlert=$delegate.oldAlert,windowDecorate.oldConfirm=$delegate.oldConfirm,windowDecorate.oldPrompt=$delegate.oldPrompt):(windowDecorate.oldAlert=$delegate.alert,windowDecorate.oldConfirm=$delegate.confirm,windowDecorate.oldPrompt=$delegate.prompt),windowDecorate.alertPromise=function(message,alertType,resp){return $injector.get("$vlcDialog")({content:message.toString(),scopeVars:{alertType:alertType,resp:resp,message:message}}).deferred.promise},windowDecorate.alert=function(message){return windowDecorate.alertPromise(message,"Alert")},windowDecorate.confirm=function(message){return windowDecorate.alertPromise(message,"Confirm")},windowDecorate.prompt=function(message,resp){return windowDecorate.alertPromise(message,"Prompt",resp)},console.log("Overriding window alert functions, these can still be accessed by prefixing the function name with the word 'old'"),function($delegate){var scrollOffset;$delegate.vlocIFrameResizeHandler||($delegate.sfdcVars.urlParams.scrollOffset&&(""===$delegate.sfdcVars.urlParams.scrollOffset||"undefined"===$delegate.sfdcVars.urlParams.scrollOffset?scrollOffset={x:0,y:90}:isNaN($delegate.sfdcVars.urlParams.scrollOffset)||(scrollOffset={x:0,y:1*$delegate.sfdcVars.urlParams.scrollOffset})),$delegate.vlocIFrameResizeHandler=$delegate.vlocIFrameResizeHandler||{},Object.assign($delegate.vlocIFrameResizeHandler,{scrollTo:function(x,y){return $delegate.scrollTo(x,y)},scrollToEle:function(element){"string"==typeof element&&(element=document.getElementById(element)),element&&this.scrollTo(0,element.getBoundingClientRect().top)},scrollEleToTop:function(element){"string"==typeof element&&(element=document.getElementById(element)),element&&element.scrollIntoView()}}),$delegate.vlocScrollToEle=function(element){return this.vlocIFrameResizeHandler.scrollToEle(element)},$delegate.vlocScrollEleToTop=function(element){return this.vlocIFrameResizeHandler.scrollEleToTop(element)},"parentIFrame"in $delegate?handler():($delegate.iFrameResizer=$delegate.iFrameResizer||{},$delegate.iFrameResizer.readyCallback=wrapReadyCallback));function wrapReadyCallback(){var prev=$delegate.iFrameResizer;prev&&prev.readyCallback&&"function"==typeof prev.readyCallback&&prev.readyCallback!==wrapReadyCallback&&prev.readyCallback(),handler()}function handler(){document.body.classList.add("iframeresizer--child");var styleFixEl=document.createElement("style");styleFixEl.type="text/css",styleFixEl.appendChild(document.createTextNode(".iframeresizer--child .via-nds #alert-container { height: auto; }")),(document.head||document.getElementsByTagName("head")[0]).appendChild(styleFixEl),Object.assign($delegate.vlocIFrameResizeHandler,{scrollTo:function(x,y){return scrollOffset?$delegate.parentIFrame.scrollToOffset(x-scrollOffset.x,y-scrollOffset.y):$delegate.parentIFrame.scrollTo(x,y)}}),"parentIFrame"in window&&("true"==sfdcVars.urlParams.omniIframeEmbedded||1==sfdcVars.urlParams.omniIframeEmbedded)&&"undefined"!=typeof scope&&scope&&scope.bpTree&&scope.bpTree.propSetMap&&(scope.bpTree.propSetMap.consoleTabTitle&&parentIFrame.sendMessage({message:"ltng:setConsoleTabLabel",label:scope.bpTree.propSetMap.consoleTabTitle}),scope.bpTree.propSetMap.consoleTabIcon&&parentIFrame.sendMessage({message:"ltng:setConsoleTabIcon",icon:scope.bpTree.propSetMap.consoleTabIcon}))}}($delegate),Object.assign($delegate,windowDecorate),$delegate}]),"lightning"!==sfdcVars.layout&&"newport"!==sfdcVars.layout||bpModule.decorator("$sldsModal",["$delegate","$window","uiStateService",function($delegate,$window,uiStateService){return function(config){var _onShow=config.onShow;return config.onShow=function($vlcModal){_onShow&&"function"==typeof _onShow&&_onShow($vlcModal),uiStateService.logBlocker($vlcModal),"parentIFrame"in $window&&"vlocIFrameResizeHandler"in $window&&$window.vlocScrollToEle("VlocityBP")},$delegate(config)}}])}()},{}],32:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").config(function($provide){window.oPlayerUtil;$provide.decorator("bpService",function($delegate){var injector=angular.injector(["ng"]),q=injector.get("$q"),rScope=injector.get("$rootScope");if(/previewEmbedded=true/.test(window.location.href)&&($delegate.debug=!0),!$delegate.debug)return console.log("in the normal preview mode do not do anything to the service "),$delegate;var ofunction=$delegate.GenericInvoke;return $delegate.GenericInvoke=function(){var element,deferred=q.defer(),lastObject=arguments[arguments.length-1];if(element=lastObject&&lastObject.label?(element=[].splice.call(arguments,-1,1))[0]:{label:"Element"},$delegate.debug){var requestObject={element:element,args:arguments};window.parent.postMessage(angular.toJson(requestObject),"*")}return ofunction.apply($delegate,arguments).then(function(result){if($delegate.debug){var resultObject={element:element,response:function(){try{var resultObj=angular.fromJson(result);return resultObj.NCCallresp&&angular.fromJson(resultObj.NCCallresp)||resultObj}catch(exception){return console.log("NCCallResp was invalid"),resultObj}}()};element&&window.parent.postMessage(angular.toJson(resultObject),"*")}rScope.$apply(function(){deferred.resolve(result)})},function(error){var errResult={element:element,response:angular.fromJson(error)};element&&window.parent.postMessage(angular.toJson(errResult),"*"),rScope.$apply(function(){deferred.resolve(error)})}),deferred.promise},console.log("bpService was decorated to include the debug feature....."),$delegate})})}()},{}],33:[function(require,module,exports){var bpModule=angular.module("vlocity-business-process");bpModule.config(["$controllerProvider","$windowProvider","$filterProvider","$provide","$compileProvider",function($controllerProvider,$windowProvider,$filterProvider,$provide,$compileProvider){"use strict";$windowProvider.$get().vlocity=$windowProvider.$get().vlocity||{},$windowProvider.$get().vlocity.cardframework=$windowProvider.$get().vlocity.cardframework||{},$windowProvider.$get().vlocity.cardframework.registerModule={controller:$controllerProvider.register,directive:$compileProvider.directive,filter:$filterProvider.register,factory:$provide.factory,service:$provide.service}}]),"lightning"===sfdcVars.layout&&bpModule.config(["$localizableProvider",function($localizableProvider){"use strict";window.customLabels&&$localizableProvider.setLocalizedMap(window.customLabels)}])},{}],34:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").config(function($windowProvider){if(/previewEmbedded=true/.test(window.location.href)){var oSCallback,oECallback,element,q=angular.injector(["ng"]).get("$q"),forceClient=window.forceTKClient;forceClient||console.log("forceTKClient not initiliase globally");var ofunction=forceClient.apexrest;forceClient.apexrest=function(rClassName,sCallback,eCallback,rMethodName,input){var deferred=q.defer();arguments[arguments.length-1]&&arguments[arguments.length-1].label?(element=(element=[].splice.call(arguments,-1,1))[0]).type="apex":element={label:"ApexRestElement",type:"apex"};var requestObject={element:element||"",args:[rClassName,rMethodName,input,""]};return window.parent.postMessage(angular.toJson(requestObject),"*"),oSCallback=sCallback,arguments[1]=function(){console.log("success callback"),postMessageToWindow(arguments[2],element),oSCallback.apply("",arguments)},oECallback=eCallback,arguments[2]=function(){console.log("error callback"),postMessageToWindow(arguments[0],element),oECallback.apply("",arguments)},ofunction.apply(this,arguments).then(function(data){deferred.resolve(data)},function(error){deferred.resolve(error)}),deferred.promise}}else console.log("script is running in the normal mode do not do anything to forcetkClient");function postMessageToWindow(jqXR,object){var resultObject={element:object,response:function(){try{return angular.fromJson(jqXR.responseText)}catch(e){return{error:e.message}}}()};object&&window.parent.postMessage(angular.toJson(resultObject),"*")}})}()},{}],35:[function(require,module,exports){!function(){"use strict";var element;/previewEmbedded=true/.test(window.location.href)?angular.module("vlocity-business-process").factory("vlcInjector",function(){var vlcInjector={request:function(config){if(!config||!config.label)return console.log("no label for the element was passed : skip request transformation"),config;element={label:config.label,type:"web"};var request=angular.extend({params:config.params},{headers:config.headers}),requestObject={element:element,args:[config.url,config.method,request,""]};return console.log("inside debug request"),window.parent.postMessage(angular.toJson(requestObject),"*"),config},responseError:function(response){if(!response.config||!response.config.label)return console.log("no label for the element was passed : skip response transformation"),response;var responseObject={element:element,response:angular.fromJson(response.data)};return console.log("inside debug response error"),window.parent.postMessage(angular.toJson(responseObject),"*"),element=null,response},response:function(response){if(!response.config||!response.config.label)return console.log("no label for the element was passed : skip response transformation"),response;var responseObject={element:element,response:angular.fromJson(response.data)};return console.log("inside debug response new"),window.parent.postMessage(angular.toJson(responseObject),"*"),element=null,response}};return vlcInjector}):console.log("script is running the normal mode do nothing to http service")}(),function(){"use strict";/previewEmbedded=true/.test(window.location.href)?angular.module("vlocity-business-process").config(function($httpProvider){$httpProvider.interceptors.push("vlcInjector")}):console.log("script is running the normal mode do nothing http service interceptor")}()},{}],36:[function(require,module,exports){!function(){"use strict";var bpModule=angular.module("vlocity-business-process");bpModule.config(function($compileProvider){bpModule.directives=$compileProvider})}()},{}],37:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").config(function($locationProvider){$locationProvider.hashPrefix("")})}()},{}],38:[function(require,module,exports){!function(){"use strict";var bpModule=angular.module("vlocity-business-process"),sarissa=window.Sarissa;bpModule.decorator("$xhrFactory",["$delegate","$rootScope",function($delegate,$rootScope){return function(method,url){return sarissa&&sarissa.originalXMLHttpRequest?new sarissa.originalXMLHttpRequest:$delegate(method,url)}}])}()},{}],39:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").provider("$vlcDialog",function(){var defaults=this.defaults={templateUrl:"vlcAlertModal.html",show:!0,size:"lg",msg:"Are you sure?",backdrop:"static",submitLabel:customLabels.OmniOK,cancelLabel:customLabels.OmniCancel};this.$get=function($window,$timeout,$q,$injector,$sce,$rootScope){function VlcDialogFactory(config){var $vlcDialog={},deferred=$q.defer(),scopeVars=config.scopeVars;if("lightning"!==sfdcVars.layout&&"newport"!==sfdcVars.layout)return $timeout(function(){scopeVars.resp=$window["old"+scopeVars.alertType].call($window,config.content,scopeVars.resp),void 0===scopeVars.resp?scopeVars.resp=!0:null===scopeVars.resp&&(scopeVars.resp=!1),deferred.resolve(scopeVars.resp)}),$vlcDialog.deferred=deferred,$vlcDialog;($vlcDialog=$injector.get("$sldsModal")(angular.extend({},defaults,config))).deferred=deferred;var options=$vlcDialog.$options,scope=$vlcDialog.$scope;return angular.forEach(["title","content","titleKey","warning","error","cancelLabel","submitLabel"],function(key){options[key]&&(scope[key]=options[key])}),Object.assign(scope,scopeVars),scope.input=scope.resp,scope.message instanceof Error&&(scope.content=customLabels.OmniError+" : "+scope.message.message,scope.error=!0),scope.title=scope.title||customLabels["Omni"+(scope.titleKey=scope.error?"Error":scope.titleKey||scope.alertType)]||scope.titleKey,scope.submit=function(){scopeVars.resp="Prompt"!=scope.alertType||scope.$$childHead.$$childHead.input,scope.$hide(),deferred.resolve(scopeVars.resp)},scope.cancel=function(){scope.$hide(),deferred.resolve(!1)},$vlcDialog}return VlcDialogFactory.defaults=defaults,VlcDialogFactory}}).directive("ngConfirmClick",["$parse","$window","$vlcDialog","$sce"].concat(/lightning|newport/.test(sfdcVars.layout)?["$aria"]:[]).concat(function($parse,$window,$vlcDialog,$sce,$aria){return{link:function(scope,element,attr){var fn=$parse(attr.confirmedClick,null,!0),msg=attr.ngConfirmClick||"Are you sure?",options={scope:scope};angular.forEach(["templateUrl","contentTemplate","backdrop","keyboard","html","container","id","vlocSlide","vlocSlideCustomClass","vlocSlideMobileClose","vlocSlideHeader","vlocSlideFooter","error","warning","titleKey","prefill","submitLabel","cancelLabel"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var falseValueRegExp=/^(false|0|)$/i;function confirmCallback(event){event.preventDefault(),event.stopPropagation(),$vlcDialog(options).deferred.promise.then(function(resp){resp&&scope.$applyAsync(fn)})}angular.forEach(["backdrop","keyboard","html","container"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)}),angular.forEach(["title","content"],function(key){attr[key]&&attr.$observe(key,function(newValue,oldValue){scope[key]=newValue})}),$aria&&($aria.config("bindRoleForClick")&&!element.attr("role")&&element.attr("role","button"),$aria.config("tabindex")&&!element.attr("tabindex")&&element.attr("tabindex",0),!$aria.config("bindKeydown")||attr.ngKeydown||attr.ngKeypress||attr.ngKeyup||(element.on("keyup",function(event){32===(event.which||event.keyCode)&&confirmCallback(event)}),element.on("keydown",function(event){13===(event.which||event.keyCode)&&confirmCallback(event)}))),options=angular.extend({},options,{content:msg.toString(),scopeVars:{alertType:"Confirm",message:msg,resp:options.prefill}}),element.on("click",confirmCallback)}}}))}()},{}],40:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("preventEnterSubmit",function(bpService){return{restrict:"A",link:function(scope,el,attrs){"lightning"!==bpService.layout&&"newport"!==bpService.layout&&el.bind("keydown",function(event){return"textarea"===event.target.type||!(13==event.which&&!event.target.attributes["vlc-slds-only-numeric"])&&void 0})}}})}()},{}],41:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcPreventParentScroll",function($timeout){return{restrict:"A",link:function(scope,element,attr){var lastYDir,curYDir;function preventScroll(e){return e.stopPropagation(),e.preventDefault(),!1}element.bind("mousewheel",function(e){var $this=$(this),scrollTop=this.scrollTop,scrollHeight=this.scrollHeight,height=$this.height(),deltaScroll="DOMMouseScroll"==e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,upScroll=deltaScroll>0;return!upScroll&&-deltaScroll>scrollHeight-height-scrollTop?($this.scrollTop(scrollHeight),preventScroll(e)):upScroll&&deltaScroll>scrollTop?($this.scrollTop(0),preventScroll(e)):void 0}),element.bind("touchstart",function(e){lastYDir=e.originalEvent.touches[0].clientY}),element.bind("touchmove",function(e){var upScroll,$this=$(this),scrollTop=this.scrollTop,scrollHeight=this.scrollHeight,height=$this.height();if(curYDir=e.originalEvent.touches[0].clientY,/mobile|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()))return curYDir>lastYDir?upScroll=!1:curYDir<lastYDir&&(upScroll=!0),!upScroll&&scrollTop<=0?($this.scrollTop(0),preventScroll(e)):upScroll&&scrollTop+25>=scrollHeight-height?($this.scrollTop(scrollHeight),preventScroll(e)):void 0})}}})}()},{}],42:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsRightPanel",function($sce,$compile){return{restrict:"E",replace:!0,templateUrl:"vlcSldsRightPanel.html"}})}()},{}],43:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsBanner",function(){return{restrict:"E",replace:!0,templateUrl:function(elem,attrs){return attrs.src||"vlcSldsHeadingBanner.html"}}})}()},{}],44:[function(require,module,exports){!function(){"use strict";var templateMaps={cTypes:{"Date/Time (Local)":"Datetime-local",Telephone:"Tel","Text Area":"Textarea",Aggregate:"Formula","Type Ahead":"TypeAhead",Filter:"FilterItemSelect"},type:function(control){return control.type in this.cTypes?this.cTypes[control.type]:control.type}};angular.module("vlocity-business-process").directive("vlcSldsChangeInlineTemplates",function($compile,$parse,$templateCache){return{restrict:"A",priority:"-1",link:function(scope,element,attrs){var bShowInputWidth=!1;bShowInputWidth=!0===scope.bpTree.propSetMap.showInputWidth||$parse(attrs.vlcSldsChangeInlineTemplates)(scope);var control=scope.child.eleArray[0];!0===bShowInputWidth&&(control.propSetMap.HTMLTemplateId=control.propSetMap.HTMLTemplateId||function(){if(!/Filter/.test(control.type)||!/Multi-select/.test(control.propSetMap.type)){var id=["altVlc",templateMaps.type(control),".html"].join("");return $templateCache.get(id)?id:control.propSetMap.HTMLTemplateId}}())}}})}()},{}],45:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsDatePicker",function(dateFilter,$window){var moment=window.moment,isNative=/(ip[ao]d|iphone|android)/gi.test($window.navigator.userAgent),isTouch=("createTouch"in $window.document||"ontouchstart"in $window.document)&&isNative;if(!isTouch){var rtl=angular.element("html").css("direction"),dfn=$.fn.datepicker;dfn.language.customLabels=Object.assign({},dfn.language.en),Object.assign(dfn.language.customLabels,JSON.parse(customLabels.OmniDatepickerConfig))}return{restrict:"A",require:"ngModel",scope:!1,link:function(scope,element,attrs,ngModelCtrl){var temp,rDate,fDate,dFormat=scope.control?scope.control.propSetMap.dateFormat:scope.dateFormat,tFormat=scope.control?scope.control.propSetMap.timeFormat:scope.timeFormat,isDateTimePicker="Date/Time (Local)"===attrs.vlcSldsDatePicker||/hh:mm a/.test(dFormat),modelFormat="string"==typeof(temp=attrs.vlcSldsModelDateFormat)?temp.toUpperCase():temp,isString=/string/.test(attrs.vlcSldsDateType),format=function(dateFormat,timeFormat,isDateTimePicker){var dFormat;return(timeFormat=timeFormat||"hh:mm a").replace(/H/g,"h").replace(/m/gi,"i").replace(/a/i,"$&$&"),void 0!==timeFormat&&"string"==typeof timeFormat&&null===(timeFormat=timeFormat.replace(/M/g,"m")).match(/a/i)&&(timeFormat=timeFormat.replace(/h/gi,"H")),dateFormat?(dFormat=dateFormat.replace(/ hh:mm a$/,""),isDateTimePicker?dFormat.toUpperCase()+" "+timeFormat:dFormat.toUpperCase()):"yyyy/mm/dd".toUpperCase()}(dFormat,tFormat,isDateTimePicker);if(isTouch){element.attr("readonly","readonly"),isDateTimePicker?element.prop("type","datetime-local"):element.prop("type","date"),format=isDateTimePicker?"YYYY-MM-DDTHH:mm":"YYYY-MM-DD",ngModelCtrl.$formatters.unshift(function(modelValue){if(modelValue){var newModelValue=moment(modelValue).format(format);if("Invalid date"!==newModelValue)return newModelValue}return modelValue});var pFunction=isString?function(viewValue){return viewValue||null}:function(viewValue){return viewValue?moment(viewValue).toISOString():null};ngModelCtrl.$parsers.unshift(pFunction)}else{var timeFormat,config={language:"customLabels",position:"rtl"===rtl?"bottom right":"bottom left",autoClose:!1,keyboardNav:!1,startDate:new Date,clearButton:!0,onSelect:function(formattedDate,date,inst){fDate=(rDate=moment(date)).isValid()?rDate.format(format):"",element.val(fDate),ngModelCtrl.$setViewValue(fDate)},timepicker:isDateTimePicker,timeFormat:(timeFormat=tFormat,timeFormat?timeFormat.replace(/H/g,"h").replace(/m/gi,"i").replace(/a/i,"$&$&"):void 0)},datepicker=dfn.call(element,config).data("datepicker");ngModelCtrl.$formatters.unshift(function(modelValue){if(console.log("formatters are running: "+modelValue),modelValue&&null!==modelValue&&"Invalid Date"!==modelValue)return isString?rDate=moment(modelValue,modelFormat,!0):(rDate=moment(modelValue),datepicker.selectDate(modelValue._d)),rDate.format(format)}),ngModelCtrl.$parsers.unshift(function(viewValue){console.log("date parsers run: "+viewValue+" after run");var fromPicker=!0;return rDate.format(format)!=viewValue&&(rDate=moment(viewValue,format,!0),fromPicker=!1),rDate.isValid()?(ngModelCtrl.$setValidity("valid",!0),fromPicker||(datepicker.date=rDate._d,datepicker.selectDate(rDate._d)),isString?rDate.format(modelFormat):rDate._d):(""!==viewValue?ngModelCtrl.$setValidity("valid",!1):ngModelCtrl.$setValidity("valid",!0),null)}),$(element).parents(".vlc-slds-edit-block--modal").length>0&&element.bind("click",function(event){config.position=function(){if($window.editBlockModalDate)if("rtl"===rtl){if("openTop"===$window.editBlockModalDate.position)return"top right";if("openBottom"===$window.editBlockModalDate.position)return"bottom right"}else{if("openTop"===$window.editBlockModalDate.position)return"top left";if("openBottom"===$window.editBlockModalDate.position)return"bottom left"}}(),dfn.call(element,config)})}}}})}()},{}],46:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcDisableAutoComplete",function(){return{restrict:"A",scope:!1,link:function(scope,elem,attrs){elem.attr("autocomplete","off"),elem.attr("readonly","true")}}})}(),function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsDisableAutoComplete",function(){return{restrict:"A",compile:function(element,attrs){element.attr("autocomplete","off"),element.attr("autocorrect","off"),element.attr("autocapitalize","off"),element.attr("spellcheck","false")}}})}()},{}],47:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsEditBlockModal",function($window){return{restrict:"A",scope:!1,link:function(scope,elem,attrs){elem.bind("mousedown",function(event){var modalHeight=$(elem).height(),clickY=event.clientY;$window.editBlockModalDate={},modalHeight/2>=clickY?$window.editBlockModalDate.position="openBottom":modalHeight/2<clickY&&($window.editBlockModalDate.position="openTop")})}}})}()},{}],48:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsEmbeddedArticle",function(){return{restrict:"E",templateUrl:"vlcEmbeddedArticle.html",replace:!0}})}()},{}],49:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("helpText",function(){return{restrict:"C",link:function(scope,element,attrs){scope.control.propSetMap.help||element.remove()}}})}()},{}],50:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsInclude",function($templateCache,bpService,$compile){return{restrict:"A",scope:!1,compile:function(element,attrs){var templateName;if(!(templateName=attrs.vlcSldsInclude))throw new Error("expected template Name");var template=$templateCache.get(templateName);if(element.replaceWith(template),0==templateName.indexOf("altVlc"))var compileFn=$compile(template);return function(scope,element,attrs){0==templateName.indexOf("altVlc")&&compileFn&&compileFn(scope,function(cloned,scope){element.replaceWith(cloned)})}}}})}()},{}],51:[function(require,module,exports){!function(){"use strict";var bpModule=angular.module("vlocity-business-process");bpModule.provider("$sldsInlineBlock",function(){var defaults=this.defaults={templateUrl:"vlcEditBlockInline.html",element:null,show:!0};this.$get=function($window,$rootScope,$sldsInlineBlockCompiler,$animate,$sce,$timeout){angular.forEach,$window.requestAnimationFrame||$window.setTimeout,angular.element($window.document.body),document.activeElement;return function(config){var compileData,modalElement,modalScope,$sldsInlineBlock={},options=$sldsInlineBlock.$options=angular.extend({},defaults,config),promise=$sldsInlineBlock.$promise=$sldsInlineBlockCompiler.compile(options),scope=$sldsInlineBlock.$scope=options.scope&&options.scope.$new()||$rootScope.$new();return config.templateUrl||(config.templateUrl="vlcEditBlockInline.html"),$sldsInlineBlock.$id=options.id||options.element&&options.element.attr("id")||"",config.show&&scope.$$postDigest(function(){$sldsInlineBlock.show()}),$sldsInlineBlock.$isShown=scope.$isShown=!1,promise.then(function(data){compileData=data,$sldsInlineBlock.init()}),$sldsInlineBlock.init=function(){options.show&&scope.$$postDigest(function(){$sldsInlineBlock.show()})},scope.$dismiss=scope.$hide=function(canc,evt){scope.$$postDigest(function(){$sldsInlineBlock.hide(evt)})},scope.$show=function(){scope.$$postDigest(function(){$sldsInlineBlock.show()})},$sldsInlineBlock.show=function(){$sldsInlineBlock.$isShown||(modalScope=$sldsInlineBlock.$scope.$new(),modalElement=$sldsInlineBlock.$element=compileData.link(modalScope,function(clonedElement,scope){}),$(document.activeElement.parentElement).append(modalElement[0]),$sldsInlineBlock.$isShown=scope.$isShown=!0,function(scope){scope.$$phase||scope.$root&&scope.$root.$$phase||scope.$digest()}(scope),modalElement.next())},$sldsInlineBlock.hide=function(evt){if($sldsInlineBlock.$isShown){var clsPrefix=angular.equals(sfdcVars.layout,"lightning")?".slds-":angular.equals(sfdcVars.layout,"newport")?".nds-":"";void 0!==document.getElementsByClassName(modalElement[0].classList[0])[0]&&$(evt.currentTarget).closest(clsPrefix+"edit-block-edit__container").remove()}},$sldsInlineBlock}}}),bpModule.service("$sldsInlineBlockCompiler",function($q,$http,$injector,$compile,$controller,$templateCache){this.compile=function(options){options.template&&/\.html$/.test(options.template)&&(options.templateUrl=options.template,options.template="");var templateUrl=options.templateUrl,template=options.template||"",controller=options.controller,controllerAs=options.controllerAs,resolve=angular.copy(options.resolve||{}),locals=angular.copy(options.locals||{}),transformTemplate=options.transformTemplate||angular.identity,bindToController=options.bindToController;if(angular.forEach(resolve,function(value,key){angular.isString(value)?resolve[key]=$injector.get(value):resolve[key]=$injector.invoke(value)}),angular.extend(resolve,locals),template)resolve.$template=$q.when(template);else{if(!templateUrl)throw new Error("Missing `template` / `templateUrl` option.");resolve.$template=function(template){return fetchPromises[template]?fetchPromises[template]:fetchPromises[template]=$http.get(template,{cache:$templateCache}).then(function(res){return res.data})}(templateUrl)}return $q.all(resolve).then(function(locals){var template=transformTemplate(locals.$template),element=angular.element("<div>").html(template.trim()).contents(),linkFn=$compile(element);return{locals:locals,element:element,link:function(scope){if(locals.$scope=scope,controller){var invokeCtrl=$controller(controller,locals,!0);bindToController&&angular.extend(invokeCtrl.instance,locals);var ctrl=angular.isObject(invokeCtrl)?invokeCtrl:invokeCtrl();controllerAs&&(scope[controllerAs]=ctrl)}return linkFn.apply(null,arguments)}}})};var fetchPromises={}})}()},{}],52:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsInstruction",function(){return{restrict:"E",replace:!0,templateUrl:"vlcSldsInstructions.html"}})}()},{}],53:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsLightningBanner",function($compile,$templateCache,bpService){return{restrict:"E",templateUrl:"vlcEmpty.html",link:function(scope,element,attrs){}}})}()},{}],54:[function(require,module,exports){!function(){"use strict";var bpModule=angular.module("vlocity-business-process");bpModule.directive("modalmove",function($compile,$document){return{restrict:"A",scope:!1,link:function(scope,elem){var startX,startY,x,y;elem[0].offsetWidth,elem[0].offsetHeight;function mousemove(e){y=e.clientY-startY,x=e.clientX-startX,elem.css({top:y+"px",left:x+"px"})}function mouseup(e){$document.unbind("mousemove",mousemove),$document.unbind("mouseup",mouseup)}("lightning"==scope.bpService.layout?elem.find(".slds-modal__header"):elem.find(".nds-modal__header")).on("mousedown",function(e){startX=e.clientX-elem[0].offsetLeft,startY=e.clientY-elem[0].offsetTop,$document.on("mousemove",mousemove),$document.on("mouseup",mouseup)})}}}),bpModule.directive("modalresize",function($document){var startX,startY,x,deltaX;return{restrict:"A",scope:"false",link:function(scope,element,attrs){var layout=scope.bpService.layout;function mousemove($event){if($(".iframe-holder").css({opacity:.3,"z-index":-1}),"width"===attrs.prop){x=$event.pageX,startX=element.offset().left,startX=parseInt(startX),deltaX=x-startX;var top=element.parent();top.css({width:parseInt(top.css("width"))+deltaX+"px"})}else{x=$event.pageX,startX=element.offset().left,startX=parseInt(startX),deltaX=x-startX;var y=$event.pageY;startY=element.offset().top;var delta=y-(startY=parseInt(startY)),topP=element.parent().parent().parent();topP.css({width:parseInt(topP.css("width"))+deltaX+"px",height:parseInt(topP.css("height"))+delta+"px"}),element.parent().parent().parent().find(".slds-modal__container").css({height:parseInt(topP.css("height"))-120+"px"})}}function mouseup($event){$document.unbind("mousemove",mousemove),$document.unbind("mouseup",mouseup),$(".iframe-holder").css({opacity:"initial","z-index":"auto"})}element.bind("mousedown",function(event){event.stopPropagation(),event.preventDefault();var clsName="";"lightning"==layout?clsName="vlc-slds-edit-block--modal_bottom":"newport"==layout&&(clsName="nds-modal_custom-bottom"),$(event.target).parents("."+clsName).length>0&&$(event.target).parents("."+clsName).removeClass(clsName),$(event.target).parents(".vloc-modal-shown").length>0&&$(event.target).parents(".vloc-modal-shown").removeClass("vloc-modal-shown"),$document.on("mousemove",mousemove),$document.on("mouseup",mouseup)})}}})}()},{}],55:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsModelUpdate",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){ngModelCtrl.$formatters.push(function(value){return scope.aggregate(scope,scope.control.index,scope.control.indexInParent,!0,-1),value})}}})}()},{}],56:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsPopOver",function($sce,$compile){return{restrict:"A",link:function(scope,element,attrs){var tTip='<div id="vlc-slds-toolTip" class="slds-popover slds-popover--tooltip  slds-nubbin--bottom-left" role="tooltip"><div class="slds-popover__body"><p>'+attrs.vlcSldsPopOver+"</p></div></div>";element.bind("mouseenter",function($event){element.append(tTip)}),element.bind("mouseleave",function(){document.querySelector("#vlc-slds-toolTip").remove()})}}})}()},{}],57:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsReadonly",function($compile){return{restrict:"A",link:function(scope,element,attrs){element.attr("readonly","readonly"),element.attr("disabled","disabled"),element.attr("cloned","dirty")}}})}()},{}],58:[function(require,module,exports){!function(){"use strict";var dModule=angular.module("vlocity-business-process");dModule.directive("vlcSldsRemoveItem",["bpService","$timeout"].concat(/lightning|newport/.test(sfdcVars.layout)?["$sldsDOMNavigation"]:[]).concat(function(bpService,$timeout,$sldsDOMNavigation){var isNative=/(ip[ao]d|iphone|android)/gi.test(window.navigator.userAgent);return{restrict:"A",scope:!1,link:function($scope,elem,attrs){var selectorString=attrs.vlcSldsRemoveItem;selectorString=selectorString&&selectorString.replace(/ /g,"\\ "),$scope.removeDomElement=function(scp,child,$index){$timeout(function(){var closestElem=elem.closest(selectorString),blockElemLength=child.response.length,elemIndex=scp.control.index;if($sldsDOMNavigation)var newFocus=$sldsDOMNavigation.nextTabbableElement(closestElem[0],0,1);closestElem[0].remove&&closestElem[0].remove()||closestElem.remove(),$scope.removeItem(scp,child,$index),$sldsDOMNavigation&&!isNative&&elemIndex<blockElemLength-1&&$sldsDOMNavigation.simulateTab(newFocus,1)})}}}})),dModule.directive("iconVMinusCircle",function($compile){return{restrict:"C",scope:!1,priority:601,terminal:!0,compile:function(tElement,attrs){tElement.removeAttr("ng-if"),tElement.removeAttr("ng-click"),tElement.attr("ng-if","child.eleArray.length > 1"),tElement.attr("vlc-slds-remove-item","ng-form.vlc-form-group"),tElement.attr("ng-click","removeDomElement(this,child,$index)"),tElement.removeClass("icon-v-minus-circle"),tElement.addClass("ICON-V-Minus-Circle");var fn=$compile(tElement);return function(scope,element,attrs){fn(scope,function(cloned,scope){element.after(cloned)})}}}})}()},{}],59:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsSpinner",function($compile,bpService,$templateCache,$rootScope){return $rootScope.$watch("loading",function(newVal,oldVal,scope){newVal||(scope.loadingMessage="")}),{restrict:"A",compile:function(element,attrs){if("lightning"===bpService.layout||"newport"===bpService.layout){console.log("new spinner");var html="";"lightning"==bpService.layout?html=$templateCache.get("vlcSldsSpinner.html"):"newport"==bpService.layout&&(html=$templateCache.get("vlcNdsSpinner.html"));var fn=$compile(html);return function(scope,element,attrs){element.replaceWith(fn(scope))}}console.log("old spinner")}}})}()},{}],60:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsStepChart",function($templateCache,bpService,$compile){return{restrict:"A",scope:!1,link:function(scope,element,attrs){console.log("link function "+bpService.elementTypeToHTMLMap[attrs.map]);var templateName=bpService.elementTypeToHTMLMap[attrs.map],template=$templateCache.get(templateName);element.html(template),$compile(element.contents())(scope)}}})}(),function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsStepStyler",function($compile,$rootScope){return{restrict:"A",scope:!1,link:function(scope,element,attrs){element.bind("click",function(){$rootScope.$emit("disAnim")}),"newport"==scope.bpService.layout&&angular.element(window).bind("resize",function(){$(".nds-progress-bar").find(".nds-progress-bar__value").css("width",scope.calculateProgressWidth())}),attrs.$observe("state",function(newValue){if("true"===newValue)return element.addClass("active"),void("newport"==scope.bpService.layout&&(element.addClass("nds-progress__visited"),scope.step.visited=!0));"false"===newValue&&scope.step.dirty&&(element.hasClass("active")&&element.removeClass("active"),!0===scope.step.inValid?(element.addClass("invalid"),element.removeClass("completed"),scope.step.completed=!1):scope.step.completed=!0),scope.step.completed&&element.addClass("completed")})}}})}(),function(){"use strict";angular.module("vlocity-business-process").directive("vlcAnimationSlider",function($compile,$rootScope,$animate){return{restrict:"A",link:function(scope,element,attrs){var el;element.bind("click keydown",function(evt){var keyCode=evt.which||evt.keyCode;"keydown"==evt.type&&13!=keyCode&&32!=keyCode||($animate.enabled()||$animate.enabled(!0),el&&el.stop(!0),"true"==attrs.reverse?((el=angular.element("section.step-step")).stop(!0),el.removeClass("animate-if"),el.removeClass("animate-ifMod"),el.addClass("animate-rev")):((el=angular.element("section.step-step")).stop(!0),el.removeClass("animate-ifMod"),el.removeClass("animate-rev"),el.addClass("animate-if"),scope.child.isAction&&(element.closest("section.step-step").removeClass("animate-if"),el.addClass("animate-ifMod")),$rootScope.$emit("scroll")))}),$rootScope.$on("disAnim",function(){console.log("event received"),$animate.enabled(!1),setTimeout(function(){$animate.enabled(!0)})})}}})}()},{}],61:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsSvgSize",function($templateCache,bpService){return{restrict:"A",scope:!1,link:function(scope,element,attrs){var symbol=scope.control.propSetMap.currencySymbol||"";symbol=symbol.length||0,element.css({width:10*symbol+10,background:"#fff",zIndex:"2"})}}})}()},{}],62:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsTimePicker",function(dateFilter,$window){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){console.log("time picker response is ### "+scope.control.response);ngModelCtrl.$formatters.unshift(function(modelValue){if(console.log("time formatters run "+modelValue),modelValue&&null!==modelValue)return moment(new Date(modelValue)).format("hh:mmA")}),ngModelCtrl.$parsers.unshift(function(viewValue){console.log("time parsers run"+viewValue);var twentyFourTime=moment(viewValue,"h:mm a").format("HH:mm:ss"),tempTime=moment(new Date("1 Jan 1970 "+twentyFourTime));return tempTime.isValid()&&viewValue.match(/^(0?[1-9]|1[012])(:[0-5]\d)[APap][mM]$/)?(ngModelCtrl.$setValidity("valid",!0),tempTime.toISOString()):(""!==viewValue?ngModelCtrl.$setValidity("valid",!1):ngModelCtrl.$setValidity("valid",!0),null)});var rtl=angular.element("html").css("direction"),dfn=$.fn.clockpicker,config={donetext:"Done",twelvehour:!0,autoClose:!0,align:"rtl"===rtl?"right":"left",afterDone:function(){}};dfn.call(element,config);$(element).parents(".vlc-slds-edit-block--modal").length>0&&element.bind("click",function(event){$window.editBlockModalDate&&("openTop"===$window.editBlockModalDate.position?(element.data("clockpicker").options.placement="top",element.clockpicker("locate")):"openBottom"===$window.editBlockModalDate.position&&(element.data("clockpicker").options.placement="bottom",element.clockpicker("locate")))})}}})}()},{}],63:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsToggle",["$aria",function($aria){return{restrict:"A",scope:!1,link:function(scope,element,attrs){function callback(event){event.preventDefault(),event.stopPropagation(),element.toggleClass("clicked"),scope.$emit("toggle",{toggle:!0})}$aria.config("bindRoleForClick")&&!element.attr("role")&&element.attr("role","button"),$aria.config("tabindex")&&!element.attr("tabindex")&&element.attr("tabindex",0),!$aria.config("bindKeydown")||attrs.ngKeydown||attrs.ngKeypress||attrs.ngKeyup||element.on("keydown",function(event){var keyCode=event.which||event.keyCode;32!==keyCode&&13!==keyCode||callback(event)}),element.on("click",callback),scope.control.propSetMap.collapse||(scope.$emit("toggle",{toggle:!0}),element.toggleClass("clicked"))}}}])}(),function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsToggleElem",function(){return{restrict:"A",link:function(scope,element,attrs){if(scope.control.propSetMap.label)scope.$on("toggle",function($event,data){$event.defaultPrevented||(element.toggleClass("ng-hide"),element.hasClass("ng-hide")?(element.attr("aria-hidden","true"),element.attr("aria-expanded","false")):(element.attr("aria-hidden","false"),element.attr("aria-expanded","true")),$event.preventDefault())});else element.removeClass("ng-hide")}}})}(),function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsToggleElement",function($compile,$templateCache){return{restrict:"A",scope:{},transclude:!0,replace:!0,template:"<div ng-transclude></div>",link:function(scope,element,attrs){scope.$on("expand",function(){element.toggleClass("expand"),element.hasClass("expand")?(element.attr("aria-hidden","false"),element.attr("aria-expanded","true")):(element.attr("aria-hidden","true"),element.attr("aria-expanded","false")),angular.element("body").toggleClass("slds-modal--shown"),setTimeout(function(){element.scrollTop(!0)})})}}})}(),function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsExpand",["$rootScope","$aria",function($rootScope,$aria){return{restrict:"A",link:function(scope,element,attrs){function callback(){$rootScope.$broadcast("expand")}$aria.config("bindRoleForClick")&&!element.attr("role")&&element.attr("role","button"),$aria.config("tabindex")&&!element.attr("tabindex")&&element.attr("tabindex",0),!$aria.config("bindKeydown")||attrs.ngKeydown||attrs.ngKeypress||attrs.ngKeyup||element.on("keydown",function(event){var keyCode=event.which||event.keyCode;32!==keyCode&&13!==keyCode||(callback(),event.preventDefault())}),element.on("click",callback)}}}])}(),function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsToggleCustElem",function(){return{restrict:"A",link:function(scope,element,attrs){if(scope.control.propSetMap.label)scope.$on("toggle",function($event,data){$event.defaultPrevented||(element.toggleClass("toggleElement"),element.hasClass("toggleElement")?(element.attr("aria-hidden","true"),element.attr("aria-expanded","false")):(element.attr("aria-hidden","false"),element.attr("aria-expanded","true")),$event.preventDefault())});else element.removeClass("toggleElement")}}})}()},{}],64:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsToggleHelpText",function(){return{restrict:"A",scope:!1,link:function(scope,element,attrs){var control=scope.control;function getHelpTextElement(){return $(".nds-form-element__control-help",element.parents(".nds-input__tooltip"))}element.bind("focus",function(){control.propSetMap.help&&getHelpTextElement().addClass("nds-helptext-focus")}).bind("blur",function(){control.propSetMap.help&&getHelpTextElement().removeClass("nds-helptext-focus")})}}})}()},{}],65:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsTypeaheadPrefill",function($timeout){return{restrict:"A",scope:!1,link:function(scope,elem,attrs){scope.control&&scope.control[attrs.vlcSldsTypeaheadPrefill]&&elem.attr("cloned","dirty");var sldsWatcher=scope.$watch(function(){return elem.val()},function(newVal){newVal&&(elem.attr("cloned","dirty"),sldsWatcher())})}}})}()},{}],66:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsValWatchProdConf",function($timeout){return console.log("inside the val watch"),{restrict:"A",scope:!1,link:function(scope,elem,attrs){if(attrs.vlcSldsValWatchProdConf)var sldsWatcher=scope.$watch(function(){return elem.val()},function(newVal){newVal&&(elem.attr("cloned","dirty"),sldsWatcher())});else;}}})}()},{}],67:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcSldsWindowScroll",["$rootScope","$window","$timeout",function($rootScope,$window,$timeout){var isNative=/(ip[ao]d|iphone|android)/gi.test(window.navigator.userAgent),isTouch=("createTouch"in $window.document||"ontouchstart"in $window.document)&&isNative;return $window.vlocScrollToEle=$window.vlocScrollToEle||function(element){"string"==typeof element&&(element=this.document.getElementById(element)),element&&this.scrollTo(0,element.getBoundingClientRect().top)},{restrict:"A",link:function(scope,element,attrs){var nextIndex=scope.child.nextIndex;if(nextIndex){var child=scope.$parent&&scope.$parent.children&&scope.$parent.children[nextIndex];/action/i.test(child.type)&&(scope.child.isAction=!0)}void 0===$rootScope.scrollListener&&($rootScope.scrollListener=$rootScope.$on("scroll",function(){void 0!==$rootScope.scrollPromise&&$timeout.cancel($rootScope.scrollPromise),$rootScope.scrollPromise=$timeout(isTouch?function(){$window.vlocScrollEleToTop("VlocityBP")}:function(){$window.vlocScrollToEle("VlocityBP")},50,!0)}))}}}])}()},{}],68:[function(require,module,exports){!function(){"use strict";angular.module("vlocity-business-process").directive("vlcTimePicker",function($timeout){return{restrict:"A",link:function(scope,element,attrs){$.fn.clockpicker.call(angular.element(element),{donetext:"Done",twelvehour:!0});scope.$watch(function(){return angular.element(element).val()},function(newVal){var twentyFourTime=moment(newVal,"h:mm a").format("HH:mm:ss");scope.control.response=moment(new Date("1 Jan 1970"+twentyFourTime)).toISOString()})}}})}()},{}],69:[function(require,module,exports){angular.module("vlocity-oui-common").factory("bpService",["ouiBaseService","$q","$rootScope","$timeout","$sce","force","$injector","uiStateService",function(ouiBaseService,$q,$rootScope,$timeout,$sce,force,$injector,uiStateService){var factory={};if($rootScope.loading=!1,$rootScope.loadingMessage="",window.VOmniServicesInject&&angular.isArray(window.VOmniServicesInject)&&window.VOmniServicesInject.length>0)for(var i=0;i<window.VOmniServicesInject.length;i++)factory[window.VOmniServicesInject[i]]=$injector.get(window.VOmniServicesInject[i]);factory.BuildJSONV3=function(sId,scriptState,bPreview,multiLangCode){var deferred=$q.defer();return VOUINS.BuildJSONV3(sId,scriptState,bPreview,multiLangCode,function(result,event){$rootScope.$apply(function(){event.status?deferred.resolve(result):deferred.reject(event)})}),deferred.promise},factory.SaveBP=function(bpTree,files){var deferred=$q.defer();return VOUINS.SaveBP(bpTree,files,function(result,event){$rootScope.$apply(function(){event.status?deferred.resolve(result):deferred.reject(event)})}),deferred.promise},factory.GenericInvoke=ouiBaseService.GenericInvoke,factory.handleFilterBlock=ouiBaseService.handleFilterBlock,factory.OmniRestInvoke=function(configObj){return window.customVOmniRestInvoke&&window.customVOmniRestInvoke.constructor===Function?window.customVOmniRestInvoke(configObj,this):window.OmniOut?window.OmniForce.apexrest({path:configObj.path,params:{},data:configObj.input,method:configObj.method}):window.forceTKClient.apexrest(configObj.path,function(result){return result},function(error){},configObj.method,angular.toJson(configObj.input),configObj.params,!1,configObj.label)},factory.OmniRemoteInvoke=function(configObj,scp,element,bpScp){var fnScp=scp||bpScp,invokePromise=this.OmniRemoteInvokeBase(configObj);return element&&element.propSetMap&&["Remote Action","Integration Procedure Action"].includes(element.type)&&(element.propSetMap.invokeMode&&0===element.level&&fnScp&&fnScp.nextRepeater&&angular.isFunction(fnScp.nextRepeater)&&fnScp.nextRepeater(element.nextIndex,element.indexInParent),"fireAndForget"===element.propSetMap.invokeMode?(invokePromise={then:function(){}},uiStateService.logAction($timeout(function(){},500),null,scp,element)):uiStateService.logAction(invokePromise,configObj,scp,element)),invokePromise},factory.OmniRemoteInvokeBase=function(configObj){var prom=ouiBaseService.OmniRemoteInvokeAux(configObj,this);return!1===prom?"Vlocity SaveBP"===configObj.sClassName?this.SaveBP(configObj.input,configObj.files):"Vlocity BuildJSONV3"===configObj.sClassName?this.BuildJSONV3(configObj.sId,configObj.scriptState,configObj.bPreview,configObj.multiLangCode):"Vlocity CompleteScript"===configObj.sClassName?this.CompleteScript(configObj.sInstanceId):"Vlocity CreateOSAttachment"===configObj.sClassName?this.CreateOSAttachment(configObj.input,configObj.parentId,configObj.fileName,configObj.options):"Vlocity DeleteOSAttachment"===configObj.sClassName?this.DeleteOSAttachment(configObj.attachmentId,configObj.deleteParent,configObj.options):"Vlocity VlocityTrack"===configObj.sClassName?this.VlocityTrack(configObj.trackingData):"Vlocity BuildJSONWithPrefill"===configObj.sClassName?this.BuildJSONWithPrefill(configObj.sType,configObj.sSubType,configObj.sLang,configObj.sPFRPBundleName,configObj.drParams,configObj.multiLangCode):"Vlocity GetUserInfo"===configObj.sClassName&&this.UserInfo||this.GenericInvoke(configObj.sClassName,configObj.sMethodName,configObj.input,configObj.options,configObj.iTimeout,configObj.label):prom},factory.BuildJSONWithPrefill=function(sType,sSubType,sLang,sPfBundle,sDrParams,multiLangCode){var userInfoResultStor,buildFnResultStor,buildfn,userInfoPromise,deferred=$q.defer(),thisService=this;if(window.OmniForce&&window.forceLocalDef){if(buildfn=VOUINS.BuildJSONWithPrefillLocalDef,window.OmniForce.isAuthenticated()&&window.callUserInfo){userInfoPromise=this.OmniRemoteInvoke({sClassName:"Vlocity GetUserInfo"}).then(function(userInfoResult){buildFnResultStor?deferred.resolve(buildFnResultStor):userInfoResultStor=userInfoResult,window.userInfoResult=userInfoResult,thisService.UserInfo=$q.defer(),thisService.UserInfo.resolve(userInfoResult)},function(error){deferred.reject(angular.toJson(error))})}}else buildfn=VOUINS.BuildJSONWithPrefill;return buildfn(sType,sSubType,sLang,sPfBundle,sDrParams,multiLangCode,function(result,event){$rootScope.$apply(function(){!0===event.status||200===event.status?!userInfoPromise||userInfoResultStor?deferred.resolve(result):buildFnResultStor=result:deferred.reject(event)})}),deferred.promise},factory.CompleteScript=function(sInstanceId){var deferred=$q.defer();return VOUINS.CompleteScript(sInstanceId,function(result,event){$rootScope.$apply(function(){event.status?deferred.resolve(result):deferred.reject(event)})}),deferred.promise},factory.VlocityTrack=function(trackingData){VOUINS.VlocityTrack(trackingData)},factory.CreateOSAttachment=function(bodyData,parentId,filename,options,callback){var deferred=$q.defer();return VOUINS.CreateOSAttachment(bodyData,parentId,filename,options,function(result,event){$rootScope.$apply(function(){event.status?deferred.resolve(result):deferred.reject(event)})}),deferred.promise},factory.CreateOSDocumentAttachment=function(bodyData,filename,folderId,contentType,callback){var deferred=$q.defer();return VOUINS.CreateOSDocumentAttachment(bodyData,filename,folderId,contentType,function(result,event){$rootScope.$apply(function(){event.status?deferred.resolve(result):deferred.reject(result)})}),deferred.promise},factory.UpdateOSAttachment=ouiBaseService.UpdateOSAttachment,factory.DeleteOSAttachment=function(attachmentId,deleteParent,options,callback){var deferred=$q.defer();return VOUINS.DeleteOSAttachment(attachmentId,deleteParent,options,function(result,event){$rootScope.$apply(function(){event.status?deferred.resolve(result):deferred.reject(event)})}),deferred.promise},factory.fakeAsync=function(num,fromIndex,input,stage,bSkipSFL){var d=$q.defer();return $timeout(function(){d.resolve(20*num)},0),d.promise},factory.sNS=ouiBaseService.sNS,factory.sNSC=ouiBaseService.sNSC,factory.bpId=sfdcVars.bpId,factory.bpType=sfdcVars.bpType,factory.bpSubType=sfdcVars.bpSubType,factory.bpLang=sfdcVars.bpLang,factory.parentObjectId=sfdcVars.parentObjectId,factory.pfDRBundle=sfdcVars.pfDRBundle,factory.scriptState=ouiBaseService.scriptState,"review"===factory.scriptState?factory.resumeMode=!0:"new"===factory.scriptState?factory.resumeMode=!1:(factory.resumeMode=!1,factory.sflMode=!0),factory.previewMode=ouiBaseService.previewMode,factory.debugInformation=[],factory.layout=ouiBaseService.layout,factory.verticalMode=sfdcVars.verticalMode,"lightning"!==factory.layout&&"newport"!==factory.layout||(factory.verticalMode=!0),factory.appId=sfdcVars.appId,factory.instanceId=sfdcVars.instanceId,factory.redirectPageTemplateMap={},factory.restResponse={},factory.rootEleTypes=ouiBaseService.rootEleTypes,factory.actionEleTypes=ouiBaseService.actionEleTypes,factory.remoteInvokePrePostEleTypes=ouiBaseService.remoteInvokePrePostEleTypes,factory.remoteInvokePostEleTypes=ouiBaseService.remoteInvokePostEleTypes,factory.remoteInvokePreEleTypes=ouiBaseService.remoteInvokePreEleTypes,factory.noneDataControlTypeListV2=ouiBaseService.noneDataControlTypeListV2,factory.applyRespSkipTypeList=ouiBaseService.applyRespSkipTypeList,factory.groupEleTypeList=ouiBaseService.groupEleTypeList,factory.readOnlyReqEleTypeList=ouiBaseService.readOnlyReqEleTypeList,factory.repeatEleTypeList=ouiBaseService.repeatEleTypeList,factory.selectTypeList=ouiBaseService.selectTypeList,factory.placeholderEleTypeList=ouiBaseService.placeholderEleTypeList,factory.blockEleTypeList=ouiBaseService.blockEleTypeList,factory.jsonTreeHTMLTmpl=sfdcVars.jsonTreeHTMLTmpl,factory.bpW=12,factory.elementTypeToHTMLMap=ouiBaseService.elementTypeToHTMLMap;return $.extend(factory.elementTypeToHTMLMap,{Block:"vlcBlock.html",Color:"vlcColor.html","Radio Hor":"vlcHorRadio.html","Remote Action":"vlcRemoteAction.html","Rest Action":"vlcRemoteAction.html","DataRaptor Extract Action":"vlcRemoteAction.html","DataRaptor Post Action":"vlcRemoteAction.html","DataRaptor Transform Action":"vlcRemoteAction.html","Matrix Action":"vlcRemoteAction.html","Integration Procedure Action":"vlcRemoteAction.html",Formula:"vlcFormula.html",Aggregate:"vlcFormula.html",Validation:"vlcValidation.html","Calculation Action":"vlcRemoteAction.html","Calculation Action Btn":"vlcRemoteActionBtn.html","Done Action":"vlcDoneAction.html","Done Action Btn":"vlcRemoteActionBtn.html","Delete Action":"vlcRemoteAction.html","Delete Action Btn":"vlcRemoteActionBtn.html","Post to Object Action":"vlcRemoteAction.html","Review Action":"vlcDoneAction.html","Remote Action Btn":"vlcRemoteActionBtn.html","Rest Action Btn":"vlcRemoteActionBtn.html","DataRaptor Extract Action Btn":"vlcRemoteActionBtn.html","DataRaptor Post Action Btn":"vlcRemoteActionBtn.html","DataRaptor Transform Action Btn":"vlcRemoteActionBtn.html","Matrix Action Btn":"vlcRemoteActionBtn.html","Integration Procedure Action Btn":"vlcRemoteActionBtn.html","Post to Object Action Btn":"vlcRemoteActionBtn.html","Review Action Btn":"vlcRemoteActionBtn.html",Submit:"vlcSubmit.html","Filter Block":"vlcFilterBlock.html","Filter Select":"vlcFilterItemSelect.html","Filter Multi-select":"vlcFilterItemMSelect.html","Selectable Item":"vlcSelectableItemV2.html","Horizontal Mode Persistent Component":["vlcHCart.html","vlcHKnowledge.html"],"Vertical Mode Persistent Component":["vlcVCart.html","vlcVKnowledge.html"],SideBar:"vlcSideBar.html",StepChart:"vlcStepChart.html",OmniMain:"vlcBPTreeMain.html","PDF Action":"vlcRemoteAction.html","PDF Action Btn":"vlcRemoteActionBtn.html","Redirect Action Footer":"vlcRedirectActionFooter.html","Redirect Action Button Footer":"vlcRedirectActionBtnFooter.html","Review Action Footer":"vlcReviewActionFooter.html","Review Action Button Footer":"vlcReviewActionBtnFooter.html",Geolocation:"vlcGeolocation.html","Auto Save for Later Message":"vlcAutoSFLMsg.html","Set Values":"vlcEmpty.html","Set Values Btn":"vlcRemoteActionBtn.html","Set Errors":"vlcEmpty.html","Set Errors Btn":"vlcRemoteActionBtn.html",ProdConfText:"vlcProdConfText.html",ProdConfNumber:"vlcProdConfNumber.html",ProdConfCurrency:"vlcProdConfCurrency.html",ProdConfPercent:"vlcProdConfPercent.html",ProdConfCheckbox:"vlcProdConfCheckbox.html",ProdConfPicklist:"vlcProdConfPicklist.html","ProdConfMulti Picklist":"vlcProdConfMultiPicklist.html",ProdConfDate:"vlcProdConfDate.html",ProdConfDatetime:"vlcProdConfDatetime.html","Input Block":"vlcInputBlock.html","DocuSign Envelope Action":"vlcRemoteAction.html","DocuSign Envelope Action Btn":"vlcRemoteActionBtn.html","DocuSign Signature Action Btn":"vlcRemoteActionBtn.html","Type Ahead Block":"vlcTypeAheadBlock.html","Type Ahead":"vlcTypeAhead.html","Email Action":"vlcRemoteAction.html","Email Action Btn":"vlcRemoteActionBtn.html","Error Sub Block":"vlcErrorSubBlock.html","Typeahead Dropdown":"vlcTypeAheadDropdown.html","Edit Block":"vlcEditBlock.html","Radio Group":"vlcRadioGroup.html"}),factory.isMobileBrowser=/mobile|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),factory.bMobile=sfdcVars.bMobile,factory.eleTypeToHTMLTemplateMap=sfdcVars.eleTypeToHTMLTemplateMap,factory.channel=sfdcVars.channel,0===Object.getOwnPropertyNames(factory.eleTypeToHTMLTemplateMap).length&&("community"===factory.channel?factory.eleTypeToHTMLTemplateMap={Step:"vlcCommunitiesStep.html"}:"mobile"===factory.channel&&(factory.eleTypeToHTMLTemplateMap={Checkbox:"vlcSwitch.html",Radio:"vlcMobileRadio.html",SideBar:"vlcMobileSideBar.html",Disclosure:"vlcMobileDisclosure.html",Select:"vlcMobileSelect.html","Multi-select":"vlcMobileSelectItem.html",Range:"vlcMobileRange.html",Step:"vlcMobileStep.html",Time:"vvlcMobileTime.html","Date/Time (Local)":"vlcMobileDatetime-local.html",Currency:"vlcMobileCurrency.html",Date:"vlcMobileDate.html","Review Action Footer":"vlcMobileReviewActionFooter.html",Geolocation:"vlcMobileGeolocation.html","Selectable Items":"vlcMobileSelectableItems.html","Selectable Item":"vlcMobileSelectableItem.html","Filter Block":"vlcMobileFilterBlock.html","Horizontal Mode Persistent Component":"vlcMobileHCart.html","Vertical Mode Persistent Component":"vlcMobileVCart.html","Filter Multi-select":"vlcMobileFilterItemMSelect.html",OmniMain:"vlcMobileBPTreeMain.html","Auto Save for Later Message":"vlcEmpty.html"},factory.bMobile=!0)),factory.internalUrlKeyList=["tabKey","previewEmbedded","designerPreviewId","OmniScriptType","OmniScriptSubType","OmniScriptLang","PrefillDataRaptorBundle","scriptMode","OmniScriptInstanceId","OmniScriptId","OmniScriptApplicationId","loadWithPage"],factory.showExprData={},factory.overwriteHTMLTemplateMapping=sfdcVars.overwriteHTMLTemplateMapping,factory.oSCurrencyCode=sfdcVars.oSCurrencyCode,factory.oSCurrencyCodeAttr=sfdcVars.oSCurrencyCodeAttr,0===Object.getOwnPropertyNames(factory.overwriteHTMLTemplateMapping).length&&"mobile"===factory.channel&&(factory.overwriteHTMLTemplateMapping={"vlcApplicationConfirmationV2.html":"vlcMobileReview.html","vlcApplicationConfirmation.html":"vlcMobileReview.html","vlcApplicationAcknowledgeV2.html":"vlcMobileConfirmation.html","vlcSaveForLaterAcknowledge.html":"vlcMobileSaveForLater.html","vlcCartSummary.html":"vlcMobileCartSummary.html","vlcAcknowledge.html":"vlcMobileConfirmation.html","vlcSelectableItem.html":"vlcMobileSelectableItem.html","vlcSmallItems.html":"vlcMobileSmallItems.html","vlcSelectableItemV2.html":"vlcMobileSelectableItem.html","vlcSmallItemsV2.html":"vlcMobileSmallItems.html"}),factory.validateExprData={},factory.isInConsole="undefined"!=typeof sforce&&null!==sforce&&void 0!==sforce.console&&null!==sforce.console&&sforce.console.isInConsole(),factory.pfJSON=ouiBaseService.pfJSON,factory.pfJSONFill={},factory.stepKnowledgeKWMap={},factory.stepKnowledgeDataCatMap={},factory.dataPreprocessorMap=ouiBaseService.dataPreprocessorMap,factory.urlMode=!1,factory.incQueryParams={layout:"",LanguageCode:""},factory.generateJSONLookupTable=function(obj,lookup){for(var key in obj)obj.hasOwnProperty(key)&&("object"==typeof obj[key]&&this.generateJSONLookupTable(obj[key],lookup),lookup[key]=obj[key])},factory.aggregate=ouiBaseService.aggregate,factory.handleSelect=ouiBaseService.handleSelect,factory.nameSpaceStep=function(eleNode,ns){if(eleNode){if(eleNode.name=ns+"__"+eleNode.name,eleNode.propSetMap.show&&this.nameSpaceShowProp(eleNode.propSetMap.show,ns),0===eleNode.children.length)return;for(var i=0;i<eleNode.children.length;i++)for(var j=0;j<eleNode.children[i].eleArray.length;j++)this.nameSpaceStep(eleNode.children[i].eleArray[j],ns)}},factory.nameSpaceShowProp=function(showProp,ns){if(showProp&&showProp.group&&showProp.group.rules&&showProp.group.rules.length>0)for(var i=0;i<showProp.group.rules.length;i++)if(showProp.group.rules[i].field){var substrArray=showProp.group.rules[i].field.split(":"),newField="";if(substrArray){for(var j=0;j<substrArray.length;j++)substrArray[j]=ns+"__"+substrArray[j],newField+=substrArray[j],j<substrArray.length-1&&(newField+=":");showProp.group.rules[i].field=newField}}else{if(!showProp.group.rules[i].group)return;this.nameSpaceShowProp(showProp.group.rules[i],ns)}},factory.getHTMLTemplate=function(templateId){return this.overwriteHTMLTemplateMapping[templateId]?this.overwriteHTMLTemplateMapping[templateId]:templateId},factory.generateHyperLinks=function(){function replaceIds(input,dMap,idTag){(!dMap||!input)&&console.log("links were broken");var output=input;for(var key in dMap){var re=new RegExp("docName="+key,"g");dMap.hasOwnProperty(key)&&(output=output.replace(re,idTag+dMap[key]))}return output}return function(input,dMap){if(input.html){var idTag="id=";/FileDownload/.test(input.html)&&(idTag="file=");var replacedOutput=input.html.replace(new RegExp(idTag),"docName=");return input.trustedHtml?replaceIds(replacedOutput,dMap,idTag):$sce.trustAsHtml(replaceIds(replacedOutput,dMap,idTag))}}}(),factory}])},{}],70:[function(require,module,exports){angular.module("vlocity-oui-common").factory("uiStateService",["$rootScope","$injector",function($rootScope,$injector){var $sldsToast;try{$sldsToast=$injector.get("$sldsToast")}catch(error){console.warn("Asynchronous Loading Messaging only works on Lightning and Newport Players. Asynchronously fired actions will not message the UI")}$sldsToast&&$rootScope.$on("uiStateService.actionComplete",function(event,configObj){if(!configObj.label.stage||"PreTransform"!=configObj.label.stage&&"PreTransform"!==configObj.label.stage){var config={title:"Action Completed",content:"The action "+configObj.label.label+" has completed.",templateUrl:"vlcNotifyToast.html",container:".via-slds"};$sldsToast(config)}});var factory={logAction:function(prom,configObj,scpOverride,element){var log,entry,async,scp;element.propSetMap.invokeMode?(async=!scpOverride,scp=scpOverride||$rootScope):(async=!1,scp=$rootScope);scp.hasOwnProperty("actionLogs")||initScopeState(scp);return log=async?"asyncActions":"actions",entry={promise:prom},scp.actionLogs[log].push(entry),prom.finally(function(){var promInd=scp.actionLogs[log].findIndex(function(entry){return angular.equals(prom,entry.promise)});-1!==promInd&&scp.actionLogs[log].splice(promInd,1),element&&element.propSetMap&&element.propSetMap.toastComplete&&configObj&&scp.$emit("uiStateService.actionComplete",configObj)}),prom},logBlocker:function(instance){var scp=$rootScope;scp.hasOwnProperty("blockerLog")||initRootScopeLog(scp);if(!instance.destroy)return;entry={instance:instance},scp.blockerLog.blockers.push(entry);var _destroy=instance.destroy;return instance.destroy=function(){var index;return-1!==(index=scp.blockerLog.blockers.findIndex(function(entry){return angular.equals(instance,entry.instance)}))&&scp.blockerLog.blockers.splice(index,1),_destroy.apply(instance,arguments)},instance}};function initScopeState(scope){scope.actionLogs={actions:[],asyncActions:[],baseflag:$rootScope.loading},Object.defineProperty(scope,"loading",{set:function(val){this.actionLogs.baseflag=val},get:function(){return this.actionLogs.baseflag||this.actionLogs.actions.length>0}})}return function(scope){if(scope.$root!==scope)return!1;scope.blockerLog={blockers:[],baseflag:!1},Object.defineProperty(scope,"locked",{set:function(val){this.blockerLog.baseflag=val},get:function(){var output=!1;if(this.loading||this.blockerLog.baseflag)return!0;for(var entry,empties=[],i=0;i<this.blockerLog.blockers.length;i++)if((entry=this.blockerLog.blockers[i])&&entry.instance){if(!entry.instance.hasOwnProperty("$isShown")||entry.instance.$isShown){output=!0;break}}else empties.push(i);for(i=0;i<empties.length;i++)blockerLog.blockers.splice(empties[i]-i,1);return output}}),initScopeState(scope)}($rootScope),factory}])},{}],71:[function(require,module,exports){if("undefined"==typeof console&&(console={}),void 0===console.log&&(console.log=function(){}),"{!$Api.Session_ID}"===window.sessionId&&(window.OmniOut=!0),"NULL_SESSION_ID"===window.sessionId||window.OmniOut){if(!window.OmniOut){var customPath="";if(void 0!==location.pathname&&null!==location.pathname){var pathList=location.pathname.split("/");void 0!==pathList&&null!==pathList&&pathList.length>1&&"apex"!==pathList[1]&&""!==pathList[1]&&(customPath=pathList[1])}var proxyURL=location.protocol+"//"+location.hostname;""!==customPath&&(proxyURL+="/"+customPath),proxyURL+="/services/proxy",window.forceTKClient=new forcetk.Client(void 0,void 0,proxyURL);var instanceURL=location.hostname;instanceURL="https://"+instanceURL,""!==customPath&&(instanceURL+="/"+customPath),window.forceTKClient.authzHeader=null,window.forceTKClient.setSessionToken(window.sessionId,"v27.0",instanceURL)}}else window.forceTKClient=new forcetk.Client,window.forceTKClient.setSessionToken(window.sessionId);var historyCount=window.history.length;if("default"===moduleList){moduleList=["ngSanitize","ngRoute","ui.mask","json-tree","mgcrea.ngStrap","ui.bootstrap","jsonFormatter","ui.utils.masks","leaflet-directive","viaDirectives","forceng","sharedObjectService","vlocity-oui-common"],window.OmniOut?moduleList.push("vlocity-omni-out"):moduleList.push("vlocity-omni-knowledge");var animate=sfdcVars.animate&&!/animate=false/.test(window.location.href);if(/animate=true/.test(window.location.href)&&(animate=!0),animate&&moduleList.push("ngAnimate"),"lightning"===sfdcVars.layout||"newport"===sfdcVars.layout){var index=moduleList.indexOf("ui.bootstrap");moduleList.splice(index,1,"sldsangular"),moduleList.push("VlocityDynamicForm"),moduleList.push("ngAria"),console.debug(moduleList)}}function nullifySrvErr(eleNode){if(eleNode){if(eleNode.srvErr&&(eleNode.srvErr=null),0===eleNode.children.length)return;for(var i=0;i<eleNode.children.length;i++)for(var j=0;j<eleNode.children[i].eleArray.length;j++)nullifySrvErr(eleNode.children[i].eleArray[j])}}function nullifyBlockResponse(value){var returnVal=value;if(!0===value)returnVal=!1;else if(value.constructor===Object){for(var key in value)if(value.hasOwnProperty(key)){var data=value[key];data&&(returnVal[key]=nullifyBlockResponse(data))}}else if(angular.isArray(value))for(var i=0;i<value.length;i++)value[i]&&(returnVal[i]=nullifyBlockResponse(value[i]));else returnVal=null;return returnVal}function searchSrvErr(eleNode,result){if(eleNode){if(eleNode.srvErr&&(result.bFound=!0),0===eleNode.children.length)return;for(var i=0;i<eleNode.children.length;i++)for(var j=0;j<eleNode.children[i].eleArray.length;j++)searchSrvErr(eleNode.children[i].eleArray[j],result)}}function startWatch(step){step.watchStarted||(step.StartMilliseconds=(new Date).getTime(),step.watchStarted=!0)}function stopWatch(step){!0===step.watchStarted&&(step.ElapsedMilliseconds=(new Date).getTime()-step.StartMilliseconds,step.StartMilliseconds=0)}function checkAgainstOptions(response,options,type){switch(type){case"Select":case"Radio":if(angular.isArray(options))for(var key=response.constructor===Object?response.name:response,i=0;i<options.length;i++)if(options[i].name&&options[i].name===key)return{valid:!0,index:i};break;case"Multi-select":var resp=null;if(angular.isArray(response)&&angular.isArray(options)){if(options.length>0){resp=angular.copy(options);for(i=0;i<resp.length;i++)existInOptions(response,resp[i].name)?(resp[i].selected=!0,options[i].selected=!0):(resp[i].selected=!1,delete options[i].selected)}return{valid:!0,resp:resp}}}return{valid:!1,index:null}}function existInOptions(array,key){if(angular.isArray(array))for(var i=0;i<array.length;i++)if(!0===array[i].selected&&array[i].name===key)return!0;return!1}function resetNoFormatter(control){if(control&&angular.isArray(control.children)&&control.children.length>0)for(var i=0;i<control.children.length;i++)for(j=0;j<control.children[i].eleArray.length;j++)delete control.children[i].eleArray[j].noformatterebmodal}function baseCtrl($scope,$sce,$window,$location,$route,$routeParams,$http,$compile,bpService,ouiBaseService,jsonTreeConfig,$templateCache,$sanitize,$timeout,$rootScope,$modal,$q,$injector,force,NotSupportedElmService,currencySymbol){$injector.invoke(VOUINS.OmniFormCtrl,this,{$scope:$scope});var base_applyCallResp=$scope.applyCallResp;function showUnloadMessage(e){if(!(!1!==$window.baseCtrl.prototype.$scope.bpTree.propSetMap.disableUnloadWarn||$window.baseCtrl.prototype.$scope.previewMode)){var confirmationMessage=!$window.skipUnsavedAlert&&"Test Confirmation Message";return(e||$window.event).returnValue=confirmationMessage,confirmationMessage}}if($scope.bpService=bpService,$scope.knowledge={isToggled:!1},$window.onpopstate=function(event){if($scope.$root.locked)return event.preventDefault(),event.returnValue="",!1;$timeout(function(){event&&event.state&&void 0!==event.state.stepIndex&&!isNaN(event.state.stepIndex)&&$scope.sidebarNav($scope.getStep(event.state.stepIndex),!0)})},$window.addEventListener("beforeunload",showUnloadMessage),(angular.equals(sfdcVars.layout,"lightning")||angular.equals(sfdcVars.layout,"newport"))&&($modal={},$inlineEditBlockCont={},$modal.open=$injector.get("$sldsModal"),$inlineEditBlockCont.open=$injector.get("$sldsInlineBlock")),$scope.setSessionStorageMessage=function(data){if(null!=data){var array,existing=sessionStorage.getItem($scope.bpTree.messagingKey);try{array=JSON.parse(existing)}catch(e){}array||(array=[]),array.push(data),sessionStorage.setItem($scope.bpTree.messagingKey,JSON.stringify(array))}},$scope.saveForLater=function(element,bAuto){if(!0===$scope.bpTree.propSetMap.allowSaveForLater&&"review"!==bpService.scriptState){var input=angular.copy($scope.bpTree);if(input){if(!$scope.bpService.bSflInProgress){if($scope.bpTree.propSetMap.saveNameTemplate&&!input.bpInstanceName&&(input.bpInstanceName=$scope.handleMergeField($scope.bpTree.propSetMap.saveNameTemplate)),void 0!==$scope.bpTree.propSetMap.saveObjectId&&null!==$scope.bpTree.propSetMap.saveObjectId||($scope.bpTree.propSetMap.saveObjectId="%ContextId%"),input.saveObjectId=$scope.handleMergeField($scope.bpTree.propSetMap.saveObjectId),void 0===input.asIndex||null===input.asIndex)input.activeRootIndex=element.indexInParent+1;else if(input.children&&input.children.length>0){var activeStep=input.children[input.asIndex];activeStep&&(activeStep.knowledgeKeyword="",activeStep.articleBody="",activeStep.articleTitle="",activeStep.articleLink="")}var files=input.filesMap;return input.prefillJSON=ouiBaseService.pfJSON,files||(files={}),$scope.prepBeforeSubmit(input,!1,!0),bAuto||($rootScope.loading=!0,$rootScope.loadingMessage="",$scope.bpTree.propSetMap.timeTracking&&($scope.trackOutcome(activeStep||element,"Save"),$scope.calcStepActionTiming(activeStep||element,!1),input.response.vlcTimeTracking=angular.copy($scope.bpTree.response.vlcTimeTracking))),$scope.bpService.bSflInProgress=!0,$q.resolve().then(function(){return $scope.bpService.bSflInProgress=!0,{sClassName:"Vlocity SaveBP",input:angular.toJson(input),files:angular.toJson(VOUINS.getFilesMap(files,$rootScope.isSforce,$rootScope.sforce))}}).then(function(configObj){return bpService.OmniRemoteInvoke(configObj)}).then(function(result){var remoteResp=angular.fromJson(result);return VOUINS.syncFileAttachmentData(remoteResp,!bAuto,$rootScope,$q,$scope,$scope.bpTree.filesMap,bpService,$window).then(function(){return remoteResp&&"OK"!==remoteResp.error?$q.reject(remoteResp.error):($scope.bpTree.sInstanceId=remoteResp.instanceId,bpService.instanceId=remoteResp.instanceId,$scope.bpTree.response.sInstanceId=remoteResp.instanceId,$scope.bpTree.sflTimestamp=remoteResp.sflTimestamp,$scope.handleSFLRedirect(remoteResp,!0,null,bAuto),remoteResp)})}).catch(function(error){var errorMsg=$scope.errorReplace(error,element),separator=/lightning|newport/.test($scope.bpTree.layout)?"<br/><br/>":"\n\n";$window.alert(new Error(errorMsg+separator+customLabels.OmniSavedFailed))}).finally(function(){if(bAuto||($rootScope.loading=!1),$scope.bpService.bSflInProgress=!1,$scope.bpService.bSflQueued)return $scope.bpService.bSflQueued=!1,$scope.saveForLater(element,bAuto)})}$scope.bpService.bSflQueued=!0}}},$scope.prepBeforeSubmit=function(input,bReadonly,bClearLabelKeyMap){if(delete input.filesMap,delete input.submitButton,delete input.IdMode,delete input.scriptState,delete input.responseAsText,delete input.resumeURL,delete input.resumeURLMailTo,delete input.RTTracking,bReadonly&&delete input.prefillJSON,void 0!==input.asIndex&&null!==input.asIndex&&input.children&&input.children.length>0){var activeStep=input.children[input.asIndex];activeStep&&(activeStep.knowledgeKeyword="",activeStep.articleBody="",activeStep.articleTitle="",activeStep.articleLink="")}if(bReadonly){input.asIndex=null;for(var ind=0;ind<input.children.length;ind++)"Step"===input.children[ind].type&&(0==ind?($scope.setStepStatus(input.children[ind],!0,!0,!1,!0,null),input.asIndex=ind):$scope.setStepStatus(input.children[ind],!1,!0,!1,!0,null))}if(bClearLabelKeyMap&&"Multi-Language"===input.bpLang)for(var key in input.labelKeyMap)input.labelKeyMap.hasOwnProperty(key)&&(input.labelKeyMap[key]="");input.verticalMode=bpService.verticalMode,input.layout=bpService.layout},$scope.handleSFLRedirect=function(resp,bSuccess,errorMsg,bAuto){var sflURL=null;if(resp&&resp.instanceId)if(bpService.urlMode){var mode=bpService.verticalMode?"vertical":"horizontal";sflURL=$scope.bpTree.saveURL+"&OmniScriptInstanceId="+resp.instanceId+"&scriptMode="+mode+"&loadWithPage=false"}else sflURL=$scope.bpTree.saveURL+"#/OS/"+resp.instanceId+"/scriptState/saveAndResume/"+bpService.verticalMode+"/true";if(bAuto)return bSuccess||$window.alert(new Error(angular.toJson(errorMsg))),void(sflURL&&($scope.bpTree.resumeURL=sflURL,$scope.bpTree.resumeURLMailTo=sflURL.replace(/&/g,"%26")));bSuccess||(resp.error=errorMsg);var redirect=$scope.bpTree.propSetMap.saveForLaterRedirectPageName,redirectTemplateUrl=$scope.bpTree.propSetMap.saveForLaterRedirectTemplateUrl;redirect||(redirect="sflRedirect"),redirectTemplateUrl||(redirectTemplateUrl="vlcSaveForLaterAcknowledge.html"),redirectTemplateUrl=bpService.getHTMLTemplate(redirectTemplateUrl),bpService.redirectPageTemplateMap[redirect]=redirectTemplateUrl,bpService.restResponse[redirect]={},bpService.restResponse[redirect].bpTree=angular.copy($scope.bpTree),bpService.restResponse[redirect].response=resp,resp&&resp.instanceId&&(bpService.restResponse[redirect].response.saveURL=sflURL,bpService.restResponse[redirect].response.saveURLMailTo=sflURL.replace(/&/g,"%26")),$location.path("/custom/"+redirect)},$scope.adjustshowPC=function(element){if($scope.bpTree.showPC=!1,$scope.bpTree.propSetMap&&$scope.bpTree.propSetMap.persistentComponent){void 0!==$scope.bpTree.showPCNew&&null!==$scope.bpTree.showPCNew||($scope.bpTree.showPCNew=[]),angular.isArray(element.propSetMap.showPersistentComponent)||(element.propSetMap.showPersistentComponent=[element.propSetMap.showPersistentComponent]);for(var i=0;i<$scope.bpTree.propSetMap.persistentComponent.length;i++)!0===$scope.bpTree.propSetMap.persistentComponent[i].render&&!0===element.propSetMap.showPersistentComponent[i]?($scope.bpTree.showPCNew[i]=!0,$scope.bpTree.showPC=!0):$scope.bpTree.showPCNew[i]=!1}},$scope.activateStep=function(step,bTimeTrack,dontPushState){$scope.setStepStatus(step,!0,!1,bTimeTrack,null,dontPushState),$scope.adjustshowPC(step)},$scope.adjustStepState=function(step,bAdjustPrevious){var stepIndex=step.indexInParent,rootElements=$scope.bpTree.children;if(bAdjustPrevious){for(var bHasPrevious=!1,i=stepIndex-1;i>=0;i--)if("Step"===rootElements[i].type&&rootElements[i].show){bHasPrevious=!0;break}step.bHasPrevious=bHasPrevious}var bHasNext=!1;for(i=stepIndex+1;i<rootElements.length;i++)if(rootElements[i].show&&(!bpService.resumeMode||bpService.resumeMode&&"Step"===rootElements[i].type)){bHasNext=!0;break}step.bHasNext=bHasNext},$scope.processBPDef=function(idMode,result,bLoaded){if(bLoaded&&(result=angular.toJson(result).replace(/&lt;\/script/g,"</script")),$scope.bpTree=angular.fromJson(result),window.OmniForce&&window.OmniForce.isAuthenticated()&&($scope.bpTree.userId=window.OmniForce.getUserId()||$scope.bpTree.userId,window.userInfoResult&&Object.assign($scope.bpTree,angular.fromJson(window.userInfoResult))),$scope.bpTree&&Object.getOwnPropertyNames($scope.bpTree).length>0)if("newResume"===$scope.bpTree.osState&&(bpService.scriptState="new",bpService.sflMode=!1,bpService.bpType=$scope.bpTree.bpType,bpService.bpSubType=$scope.bpTree.bpSubType,bpService.bpLang=$scope.bpTree.bpLang),$scope.bpTree.error&&"OK"!==$scope.bpTree.error)$timeout(function(){$rootScope.loading=!1,"ScriptNotFound1"===$scope.bpTree.error?($rootScope.rootCustomLabels=customLabels,$rootScope.scriptNotFound1=!0,$rootScope.scriptNotFound2=!1,$rootScope.type=bpService.bpType,$rootScope.subType=bpService.bpSubType,$rootScope.lang=bpService.bpLang):"ScriptNotFound2"===$scope.bpTree.error?($rootScope.rootCustomLabels=customLabels,$rootScope.scriptNotFound1=!1,$rootScope.scriptNotFound2=!0,$rootScope.id=bpService.bpId):$window.alert(new Error($scope.bpTree.error))},0);else if($scope.bpTree.children&&$scope.bpTree.children.length>0){ouiBaseService.bMultiLang="Multi-Language"===$scope.bpTree.bpLang,bpService.bMultiLang=ouiBaseService.bMultiLang,VOUINS.pickListSeeding($rootScope,ouiBaseService,$scope.bpTree),idMode?"new"===bpService.scriptState&&($scope.bpTree.previewMode=ouiBaseService.previewMode):$scope.bpTree.IdMode=!1,$scope.bpTree.scriptState=bpService.scriptState,$scope.bpTree.labelMap&&($scope.bpTree.labelMap.value="value",$scope.bpTree.labelMap.size="size",$scope.bpTree.labelMap.filename="filename"),"review"!==bpService.scriptState&&(ouiBaseService.pfJSON=angular.fromJson($scope.bpTree.prefillJSON));var startInd,deleteIndex=[];if($scope.bpTree.children){$scope.bpTree.RTTracking={};for(var i=0;i<$scope.bpTree.children.length;i++)"Step"===$scope.bpTree.children[i].type||void 0!==$scope.bpTree.children[i].ui&&null!==$scope.bpTree.children[i].ui||($scope.bpTree.children[i].ui={}),"OmniScript"===$scope.bpTree.children[i].type&&deleteIndex.push(i),"new"===$scope.bpTree.scriptState&&$scope.bpTree.children[i].bEmbed&&void 0!==$scope.bpTree.children[i].offSet&&null!==$scope.bpTree.children[i].offSet&&$scope.adjustOffSet($scope.bpTree.children[i],$scope.bpTree.children[i].offSet),$scope.bpTree.propSetMap.timeTracking&&($scope.bpTree.RTTracking[$scope.bpTree.children[i].name]={},$scope.bpTree.RTTracking[$scope.bpTree.children[i].name].StartMilliseconds=0,$scope.bpTree.RTTracking[$scope.bpTree.children[i].name].ElapsedMilliseconds=0,$scope.bpTree.RTTracking[$scope.bpTree.children[i].name].watchStarted=!1),$scope.bpTree.children[i].propSetMap.failureAbortLabel&&void 0===$scope.bpTree.children[i].propSetMap.failureGoBackLabel&&($scope.bpTree.children[i].propSetMap.failureGoBackLabel=$scope.customLabels.OmnifailureGoBackLabel),"new"===$scope.bpTree.scriptState&&($scope.bpTree.children[i].propSetMap.show?"Optional if False"===$scope.bpTree.children[i].propSetMap.conditionType?$scope.bpTree.children[i].show=!0:"Readonly if False"===$scope.bpTree.children[i].propSetMap.conditionType?$scope.bpTree.children[i].show=!0:$scope.bpTree.children[i].show=!1:$scope.bpTree.children[i].show=!0,$scope.bpTree.children[i].indexInParent>0&&($scope.bpTree.children[i].previousIndex=$scope.bpTree.children[i].indexInParent-1,$scope.bpTree.children[i].bHasPrevious=!0),$scope.bpTree.children[i].nextIndex=$scope.bpTree.children[i].indexInParent+1,$scope.bpTree.children[i].bHasNext=!0);for(var j=0;j<deleteIndex.length;j++)$scope.bpTree.children.splice(deleteIndex[j]-j,1);"new"===$scope.bpTree.scriptState&&$scope.bpTree.children.length>0&&($scope.bpTree.children[$scope.bpTree.children.length-1].nextIndex=null,$scope.bpTree.children[$scope.bpTree.children.length-1].bHasNext=!1)}if(void 0!==$scope.bpTree.propSetMap&&null!==$scope.bpTree.propSetMap||($scope.bpTree.propSetMap={}),void 0===$scope.bpTree.propSetMap.allowSaveForLater||null===$scope.bpTree.propSetMap.allowSaveForLater){var tempPropSetMap=angular.copy($scope.bpTree.propSetMap);tempPropSetMap.allowSaveForLater=!0,$scope.bpTree.propSetMap=tempPropSetMap}if(void 0===$scope.bpTree.propSetMap.allowCancel&&($scope.bpTree.propSetMap.allowCancel=!0),$scope.bpTree.propSetMap.persistentComponent)if($scope.bpTree.propSetMap.persistentComponent.constructor===Object)void 0!==$scope.bpTree.pcId&&null!==$scope.bpTree.pcId||($scope.bpTree.pcId=$scope.bpTree.propSetMap.persistentComponent.id,void 0!==$scope.bpTree.pcId&&null!==$scope.bpTree.pcId||($scope.bpTree.pcId="vlcCart")),void 0!==$scope.bpTree.pcItemsKey&&null!==$scope.bpTree.pcItemsKey||($scope.bpTree.pcItemsKey=$scope.bpTree.propSetMap.persistentComponent.itemsKey,void 0!==$scope.bpTree.pcItemsKey&&null!==$scope.bpTree.pcItemsKey||($scope.bpTree.pcItemsKey="cartItems")),$scope.bpTree.propSetMap.persistentComponent=[$scope.bpTree.propSetMap.persistentComponent],$scope.bpTree.pcId=[$scope.bpTree.pcId],$scope.bpTree.pcItemsKey=[$scope.bpTree.pcItemsKey],$scope.bpTree.propSetMap.persistentComponent[0].pcIndex=0;else if(angular.isArray($scope.bpTree.propSetMap.persistentComponent)){$scope.bpTree.pcId=[],$scope.bpTree.pcItemsKey=[];for(i=0;i<$scope.bpTree.propSetMap.persistentComponent.length;i++)$scope.bpTree.pcId.push($scope.bpTree.propSetMap.persistentComponent[i].id),$scope.bpTree.pcItemsKey.push($scope.bpTree.propSetMap.persistentComponent[i].itemsKey),$scope.bpTree.propSetMap.persistentComponent[i].pcIndex=i}if(bpService.bMultiLang){if($scope.bpTree.labelKeyMap.messages){var errorMsg=$scope.errorReplace($scope.bpTree.labelKeyMap.messages,$scope.bpTree);return void $window.alert(new Error(errorMsg))}VOUINS.handleMultiLangLabel(null,$scope.bpTree.labelKeyMap,$scope.bpTree.propSetMap)}if($scope.bpTree.propSetMap.elementTypeToHTMLTemplateMapping&&$.extend(bpService.elementTypeToHTMLMap,$scope.bpTree.propSetMap.elementTypeToHTMLTemplateMapping),$.extend(bpService.elementTypeToHTMLMap,bpService.eleTypeToHTMLTemplateMap),$scope.bpTree.propSetMap.persistentComponent){$scope.bpTree.dfHPSTmpl=bpService.elementTypeToHTMLMap["Horizontal Mode Persistent Component"],angular.isArray($scope.bpTree.dfHPSTmpl)||($scope.bpTree.dfHPSTmpl=[$scope.bpTree.dfHPSTmpl]),$scope.bpTree.dfVertPSTmpl=bpService.elementTypeToHTMLMap["Vertical Mode Persistent Component"],angular.isArray($scope.bpTree.dfVertPSTmpl)||($scope.bpTree.dfVertPSTmpl=[$scope.bpTree.dfVertPSTmpl]);for(i=0;i<$scope.bpTree.propSetMap.persistentComponent.length-$scope.bpTree.dfHPSTmpl.length;i++)$scope.bpTree.dfHPSTmpl.push("vlcEmpty.html");for(i=0;i<$scope.bpTree.propSetMap.persistentComponent.length-$scope.bpTree.dfVertPSTmpl.length;i++)$scope.bpTree.dfVertPSTmpl.push("vlcEmpty.html")}if($scope.bpTree.dfSITmpl=bpService.elementTypeToHTMLMap["Selectable Item"],$scope.children=$scope.bpTree.children,$scope.child={children:$scope.children},$scope.bpTree.ContextId=bpService.parentObjectId,"saveAndResume"===bpService.scriptState&&($scope.bpTree.userName=$scope.bpTree.userName1,$scope.bpTree.userId=$scope.bpTree.userId1,$scope.bpTree.userProfile=$scope.bpTree.userProfile1,delete $scope.bpTree.userName1,delete $scope.bpTree.userId1,delete $scope.bpTree.userProfile1,$scope.bpTree.response.userId=$scope.bpTree.userId,$scope.bpTree.response.userName=$scope.bpTree.userName,$scope.bpTree.response.userProfile=$scope.bpTree.userProfile),bpService.isInConsole&&($scope.bpTree.propSetMap.consoleTabTitle&&sforce.console.setTabTitle($scope.bpTree.propSetMap.consoleTabTitle),$scope.bpTree.propSetMap.consoleTabIcon&&sforce.console.setTabIcon($scope.bpTree.propSetMap.consoleTabIcon)),"parentIFrame"in window&&("true"==sfdcVars.urlParams.omniIframeEmbedded||1==sfdcVars.urlParams.omniIframeEmbedded)&&($scope.bpTree.propSetMap.consoleTabTitle&&parentIFrame.sendMessage({message:"ltng:setConsoleTabLabel",label:$scope.bpTree.propSetMap.consoleTabTitle}),$scope.bpTree.propSetMap.consoleTabIcon&&parentIFrame.sendMessage({message:"ltng:setConsoleTabIcon",icon:$scope.bpTree.propSetMap.consoleTabIcon})),$scope.extraInfo={},$scope.extraInfo.ContextId=bpService.parentObjectId,$scope.extraInfo.timeStamp=$scope.bpTree.timeStamp,$scope.extraInfo.userId=$scope.bpTree.userId,$scope.extraInfo.userName=$scope.bpTree.userName,$scope.extraInfo.userProfile=$scope.bpTree.userProfile,$scope.extraInfo.userTimeZone=$scope.bpTree.userTimeZone,$scope.extraInfo.userCurrencyCode=$scope.bpTree.userCurrencyCode,void 0===$scope.bpTree.response||null===$scope.bpTree.response){$rootScope.loading&&$rootScope.tabKey&&$scope.previewMode&&($rootScope.testContextId&&($scope.extraInfo.ContextId=$scope.bpTree.ContextId=$rootScope.testContextId),$window.parent.postMessage({key:$rootScope.tabKey+".initialLoad"},"*")),$scope.setSessionStorageMessage("initialLoad");var urlParams=angular.fromJson(sfdcVars.urlParams);if(window.OmniOut){urlParams=angular.copy(VOUINS.getQueryParams());for(i=0;i<bpService.internalUrlKeyList.length;i++)delete urlParams[bpService.internalUrlKeyList[i]]}if(urlParams&&urlParams.constructor===Object){for(var key in urlParams)urlParams.hasOwnProperty(key)&&("true"===urlParams[key]&&(urlParams[key]=!0),"false"===urlParams[key]&&(urlParams[key]=!1));$scope.bpTree.response=$.extend({},urlParams,$scope.bpTree.response)}$scope.bpTree.response=$.extend({},$scope.extraInfo,$scope.bpTree.response),$scope.bpTree.propSetMap&&$scope.bpTree.propSetMap.seedDataJSON&&$scope.bpTree.propSetMap.seedDataJSON.constructor===Object&&(ouiBaseService.pfJSON=$.extend({},$scope.bpTree.propSetMap.seedDataJSON,ouiBaseService.pfJSON)),$scope.bpTree.response=$.extend({},ouiBaseService.pfJSON,$scope.bpTree.response),!$scope.bpTree.propSetMap.persistentComponent||void 0!==$scope.bpTree.response.vlcPersistentComponent&&null!==$scope.bpTree.response.vlcPersistentComponent||($scope.bpTree.response.vlcPersistentComponent={})}if($scope.bpTree.messagingKey=$scope.bpTree.response.messagingKey?$scope.bpTree.response.messagingKey:"OmniScript-Messaging",$scope.bpTree.propSetMap.timeTracking&&!$scope.bpTree.response.vlcTimeTracking&&($scope.bpTree.response.vlcTimeTracking={}),$scope.bpTree.saveURL=VOUINS.constructSFLLink(window.location,bpService),$scope.bpTree.saveURL||($scope.bpTree.saveURL=""),bpService.sflMode&&!0===$scope.bpTree.expired&&$scope.bpTree.children&&$scope.bpTree.children.length>0){$scope.bpTree.asIndex=null;for(var ind=0;ind<$scope.bpTree.children.length;ind++)"Step"===$scope.bpTree.children[ind].type&&(0==ind?($scope.setStepStatus($scope.bpTree.children[ind],!0,!0,!1,null,null),$scope.bpTree.asIndex=ind):$scope.setStepStatus($scope.bpTree.children[ind],!1,!0,!1,null,null))}$scope.errHTMLId=bpService.elementTypeToHTMLMap["Error Sub Block"],$scope.typeaheadHTMLId=bpService.elementTypeToHTMLMap["Typeahead Dropdown"],"saveAndResume"===bpService.scriptState&&$scope.asyncLoadFilesMap(),$scope.getCurrencySymbol($scope,$scope.bpService);var bSkipSFL=!1;if(!bpService.sflMode||bpService.sflMode&&!0===$scope.bpTree.expired?startInd=-1:(startInd=void 0!==$scope.bpTree.asIndex&&null!==$scope.bpTree.asIndex?$scope.bpTree.asIndex-1:$scope.bpTree.activeRootIndex-1,bSkipSFL=!0),ouiBaseService.bPLSeeding){for(var interval,firstVisRootInd=startInd+1;firstVisRootInd<$scope.children.length&&!$scope.children[firstVisRootInd].show;firstVisRootInd++);"Step"!==$scope.children[firstVisRootInd].type?interval=setInterval(function(){!0!==$rootScope.seedingDone&&!0!==$rootScope.seedingFailed||(clearInterval(interval),$scope.nextRepeater(startInd+1,startInd,null,null,bSkipSFL),$rootScope.loading=!1)},10):($scope.nextRepeater(startInd+1,startInd,null,null,bSkipSFL),$rootScope.loading=!1)}else $scope.nextRepeater(startInd+1,startInd,null,null,bSkipSFL),$rootScope.loading=!1}else $rootScope.loading=!1;else $rootScope.loading=!1;console.timeEnd("START")},$scope.adjustOffSet=function(root,offSet){if(root.children)for(var i=0;i<root.children.length;i++)for(var j=0;j<root.children[i].eleArray.length;j++)void 0!==root.children[i].eleArray[j].rootIndex&&null!==root.children[i].eleArray[j].rootIndex&&(root.children[i].eleArray[j].rootIndex+=offSet),$scope.adjustOffSet(root.children[i].eleArray[j],offSet)},$scope.previous=function(scp,step){if(scp&&step){$scope.setStepStatus(scp.bpTree.children[step.indexInParent],!1,!0,!0,null,null);var prevIndex=$scope.findPreShowStep(step.indexInParent);void 0!==prevIndex&&null!==prevIndex&&(scp.activateStep(scp.bpTree.children[prevIndex],!0,null),scp.bpTree.asIndex=prevIndex,$scope.activeIndex=prevIndex),step.ui&&(step.ui.error=!1,step.ui.show=!1)}},$scope.getKnowledgeDataCatLabel=function(step,vlcPC){if(step){var label="";return bpService.stepKnowledgeDataCatMap.hasOwnProperty(step.name)?label=bpService.stepKnowledgeDataCatMap[step.name]:step.propSetMap.knowledgeOptions&&step.propSetMap.knowledgeOptions.dataCategoryCriteria&&(label=(label=(label=(label=step.propSetMap.knowledgeOptions.dataCategoryCriteria).replace("WITH DATA CATEGORY ","")).replace(/__c/g,""))?customLabels.OmniScriptDataCategory+" "+label:"",bpService.stepKnowledgeDataCatMap[step.name]=label),label}},$scope.setStepStatus=function(step,status,bDoNotRefreshKPC,bTimeTrack,bPrep,dontPushState){if(step.bAccordionOpen=status,step.bAccordionActive=status,step.open=!0!==bpService.verticalMode||step.bAccordionOpen,step.knowledgeKeyword="",step.articleBody="",step.articleTitle="",step.articleLink="",bpService.stepKnowledgeKWMap={},step.bAccordionActive&&($window.parent.postMessage(JSON.stringify({name:step.name,type:step.type}),"*"),$scope.setSessionStorageMessage({name:step.name,type:step.type,messageType:"stepStatus"})),!0===status&&!bPrep&&($scope.bpTree.asIndex=step.indexInParent,$scope.activeIndex=step.indexInParent,$scope.adjustStepState(step,!0),dontPushState||(void 0==window.history.state||void 0===typeof window.history.state.stepIndex?window.history.replaceState({stepIndex:step.indexInParent},step.propSetMap.label,window.location.href):window.history.state.stepIndex!==step.indexInParent&&window.history.pushState({stepIndex:step.indexInParent},step.propSetMap.label,window.location.href)),!0!==$scope.bpTree.propSetMap.enableKnowledge||bDoNotRefreshKPC||$scope.searchKnowledgeArticle(step,!1,!0),document.forms&&$scope.bpTree.propSetMap.autoFocus))for(var ind=0;ind<document.forms.length;ind++)if(document.forms[ind].id===$scope.bpTree.sOmniScriptId+"-"+step.indexInParent){if(document.forms[ind].elements)for(var j=0;j<document.forms[ind].elements.length;j++)if(!document.forms[ind].elements[j].disabled&&!document.forms[ind].elements[j].hidden){$timeout(function(){document.forms[ind].elements[j].focus()},0);break}break}$scope.bpTree.propSetMap.timeTracking&&bTimeTrack&&$scope.calcStepActionTiming(step,status)},$scope.calcStepActionTiming=function(element,status){if(element){var rootNode=$scope.bpTree.RTTracking[element.name];status&&!rootNode.clickStarted&&$scope.clickTracking(element,!0,rootNode),status?startWatch(rootNode):stopWatch(rootNode),!1===status&&!0===rootNode.watchStarted&&($scope.trackTime(element,rootNode),void 0!==$scope.bpTree.response.vlcTimeTracking[element.name]&&null!==$scope.bpTree.response.vlcTimeTracking[element.name]||($scope.bpTree.response.vlcTimeTracking[element.name]=0),$scope.bpTree.response.vlcTimeTracking[element.name]+=rootNode.ElapsedMilliseconds,rootNode.ElapsedMilliseconds=0,rootNode.watchStarted=!1,!0===rootNode.clickStarted&&($scope.clickTracking(element,!1),rootNode.clickStarted=!1))}},$scope.getDefaultTrackingData=function(element){$scope.bpTree.response.vlcTimeTracking||($scope.bpTree.response.vlcTimeTracking={}),$scope.bpTree.response.vlcTimeTracking.OmniScriptSessionToken||($scope.bpTree.response.vlcTimeTracking.OmniScriptSessionToken=VOUINS.generateUUID());var defaultData={TrackingService:"OmniScript",VlocityInteractionToken:$scope.bpTree.response.vlcTimeTracking.OmniScriptSessionToken,OmniScriptId:$scope.bpTree.sOmniScriptId,OmniScriptContextId:$scope.handleMergeField("%ContextId%"),OmniScriptType:$scope.bpTree.bpType,OmniScriptSubType:$scope.bpTree.bpSubType,OmniScriptLanguage:$scope.bpTree.bpLang,Timestamp:moment.utc().format()};return element&&(defaultData.ElementType=element.type,defaultData.ElementName=element.name,defaultData.ElementLabel=element.propSetMap.label,defaultData.ElementStepNumber=element.indexInParent+1),$scope.bpTree.propSetMap.trackingCustomData&&angular.forEach($scope.bpTree.propSetMap.trackingCustomData,function(value,key){defaultData[key]=$scope.handleMergeField(value)}),defaultData},$scope.trackOutcome=function(element,outcome){if(element&&outcome){var sendData=angular.extend({Outcome:outcome,TrackingEvent:"Outcome"},$scope.getDefaultTrackingData(element));angular.isArray(sendData)||(sendData=[sendData]),bpService.OmniRemoteInvoke({sClassName:"Vlocity VlocityTrack",trackingData:sendData})}},$scope.trackTime=function(element,timingData){var sendData=angular.extend({TrackingEvent:"StepActionTime",ElapsedTime:timingData.ElapsedMilliseconds},$scope.getDefaultTrackingData(element));angular.isArray(sendData)||(sendData=[sendData]),bpService.OmniRemoteInvoke({sClassName:"Vlocity VlocityTrack",trackingData:sendData})},$scope.clickTracking=function(element,status,rootNode){if(bpService.isInConsole){if(!0===status){if(!0===rootNode.clickStarted)return;rootNode.clickStarted=!0}var msg={command:"event"};"Step"===element.type?msg.type=status?"OmniScript Enter Step":"OmniScript Exit Step":msg.type=status?"OmniScript Start Action":"OmniScript End Action",msg.objID=bpService.bpId?bpService.bpId:$scope.bpTree.sOmniScriptId,msg.tabID=element.name,msg.source=bpService.bpType+"|"+bpService.bpSubType+"|"+bpService.bpLang,msg.value=element.name,sforce.console.fireEvent("VlocityConsoleHelper",JSON.stringify(msg))}},$scope.isLoadingAttachments=function(){var isLoading=!1;return $scope.bpTree.loadingAttachments&&angular.forEach($scope.bpTree.loadingAttachments,function(key){key&&(isLoading=!0)}),isLoading},$scope.asyncLoadFilesMap=function(){$rootScope.isSforce&&sforce.connection&&$scope.bpTree.filesMap&&angular.forEach($scope.bpTree.filesMap,function(attachmentId){sforce.connection.sessionId=window.sessionId,$scope.bpTree.loadingAttachments||($scope.bpTree.loadingAttachments={}),null!=attachmentId&&18==attachmentId.length&&($scope.bpTree.loadingAttachments[attachmentId]=!0,sforce.connection.query("Select Id, Name, Body, ContentType FROM Attachment where Id = '"+attachmentId+"'",{onSuccess:function(result){delete $scope.bpTree.loadingAttachments[attachmentId],$scope.bpTree.filesMap[result.records.Name]&&($scope.bpTree.filesMap[result.records.Name]="data:"+result.records.ContentType+";base64,"+result.records.Body),$scope.isLoadingAttachments()||$scope.$apply()},onFailure:function(result){delete $scope.bpTree.loadingAttachments[attachmentId]}}))})},$scope.prepareInputJSON=function(element){var dataJSON={};return element?bpService.remoteInvokePrePostEleTypes.indexOf(element.type)>=0||"Filter Block"===element.type||"DocuSign Envelope Action"===element.type||"DocuSign Signature Action"===element.type||bpService.placeholderEleTypeList.indexOf(element.type)>=0||bpService.remoteInvokePreEleTypes.indexOf(element.type)>=0?dataJSON=$scope.bpTree.response:"DataRaptor Post Action"!==element.type&&"Post to Object Action"!==element.type&&"DataRaptor Transform Action"!==element.type||(dataJSON=$scope.bpTree):dataJSON=$scope.bpTree.response,dataJSON},$scope.nextRepeater=function(i,fromIndex,input,stage,bSkipSFL){var element=$scope.bpTree.children[i];if(!1===$rootScope.bInitialize)return bpService.fakeAsync(i,fromIndex,input,stage,bSkipSFL).then(function(ret){$scope.nextRepeater(i,fromIndex,input,stage,bSkipSFL),$rootScope.loading=!1}),element&&($scope.activeIndex=element.indexInParent),void($rootScope.bInitialize=!0);if(element&&(!element.show||bpService.resumeMode&&"Step"!==element.type))$scope.nextRepeater(i+1,fromIndex,input,stage,bSkipSFL);else{var fromEle,bPrevStepValid=!0;if(i!==fromIndex&&fromIndex>=0){if((fromEle=$scope.bpTree.children[fromIndex])&&"Step"===fromEle.type&&!0===fromEle.propSetMap.validationRequired){var formId=$scope.bpTree.sOmniScriptId+"-"+fromEle.indexInParent;bPrevStepValid=!$scope.checkValidity($scope,null,null,"StepNext",formId)}if(!bPrevStepValid)return;if(fromEle){if("Step"===fromEle.type){if($scope.clearSrvErr(fromIndex),!stage&&fromEle.propSetMap.remoteClass&&fromEle.propSetMap.remoteMethod)return void $scope.nextRepeater(i,fromIndex,input,"stepRemoteCall");if("stepRemoteCall"===stage)return input=$scope.prepareInputJSON(null),void $scope.remoteCallInvoke(input,fromEle,!1,i,null,null,null,null,fromIndex);$scope.setStepStatus(fromEle,!1,!0,!0,null,null),$scope.bpTree.asIndex=null,!0!==$scope.bpTree.propSetMap.autoSaveOnStepNext||bSkipSFL||$scope.saveForLater(fromEle,!0)}else fromEle.ui.show=!1;void 0!==i&&null!==i||"Step"===fromEle.type||null!==fromEle.nextIndex||!bpService.sflMode||$scope.completeScript(!0)}}if(element){if($scope.activeIndex=element.indexInParent,$scope.bpTree.propSetMap.timeTracking&&(fromIndex>=0&&$scope.calcStepActionTiming(fromEle,!1),$scope.calcStepActionTiming(element,!0)),$scope.adjustshowPC(element),bpService.resumeMode)"Step"!==element.type&&$scope.nextRepeater(element.nextIndex,i);else{var bValid=!0;if("Submit"===element.propSetMap.validationRequired&&(bValid=!$scope.checkValidity($scope,null,null,"Submit")),bValid){if("PreTransform"===stage||"PostTransform"===stage)bpService.remoteInvokePrePostEleTypes.indexOf(element.type)>=0||bpService.remoteInvokePreEleTypes.indexOf(element.type)>=0||bpService.remoteInvokePostEleTypes.indexOf(element.type)>=0&&"PostTransform"===stage?$scope.drTransformInvoke(input,element,!1,fromIndex,null,i,stage):"PreTransform"===stage?$scope.nextRepeater(i,fromIndex,input,"Middle"):"PostTransform"===stage&&$scope.nextRepeater(element.nextIndex,i);else if("Middle"===stage||!stage&&!element.propSetMap.preTransformBundle||"stepRemoteCallDone"===stage&&!element.propSetMap.preTransformBundle)"Middle"!==stage&&(input=$scope.prepareInputJSON(element)),stage="Middle","Remote Action"===element.type||"Calculation Action"===element.type||"Integration Procedure Action"===element.type?$scope.remoteCallInvoke(input,element,!1,i,null,null,null,null,fromIndex):"Rest Action"===element.type?$scope.restCallInvoke(input,element,!1,i,null,fromIndex):"DataRaptor Extract Action"===element.type?$scope.drExtractInvoke(element,!1,i,null,fromIndex):"DataRaptor Post Action"===element.type?$scope.drPostInvoke(input,element,!1,i,null,fromIndex):"DataRaptor Transform Action"===element.type?$scope.drTransformActionInvoke(input,element,!1,i,null,fromIndex):"Matrix Action"===element.type?$scope.matrixActionInvoke(element,!1,i,null,fromIndex):"Delete Action"===element.type?$scope.deleteActionInvoke(element,!1,i,null,fromIndex):"Post to Object Action"===element.type?$scope.objectPostInvoke(input,element,!1,i,null,fromIndex):"PDF Action"===element.type?$scope.pdfInvoke(input,element,!1,i,null,fromIndex,"fetchPDFTemplate"):"Set Values"===element.type||"Set Errors"===element.type?$scope.setValuesErrors(element,!1)&&bpService.fakeAsync().then(function(){$scope.nextRepeater(element.nextIndex,i)}):"DocuSign Envelope Action"===element.type?$scope.sendDocuSigEnvelope(input,element,!1,i,fromIndex):"Email Action"===element.type&&$scope.sendEmail(input,element,!1,i,fromIndex);else{var dataJSON=$scope.prepareInputJSON(element);$scope.nextRepeater(i,fromIndex,dataJSON,"PreTransform")}"Done Action"===element.type&&$scope.doneAction(element,!1,i,null)}else"Review Action"!==element.type&&(element.ui.show=!0,element.ui.error=!0,element.ui.errorMessage=customLabels.OmniActionValidationError);"Review Action"===element.type&&$scope.reviewAction(element,!1,i,null)}"Step"===element.type&&($scope.setStepStatus(element,!0,!1,!1,null,null),$scope.bpTree.asIndex=i,element.dirty=!0)}else $scope.bpTree.propSetMap.timeTracking&&fromIndex>=0&&$scope.calcStepActionTiming(fromEle,!1)}},$scope.remoteCallRepeater=function(element,scp,input,stage,selectedItem,operation,customizer,pcIndex,callback){if("PreTransform"===stage||"PostTransform"===stage)!element||element&&(bpService.remoteInvokePrePostEleTypes.indexOf(element.type)>=0||bpService.remoteInvokePreEleTypes.indexOf(element.type)>=0||bpService.remoteInvokePostEleTypes.indexOf(element.type)>=0&&"PostTransform"===stage||"Filter Block"===element.type||bpService.placeholderEleTypeList.indexOf(element.type)>=0)?$scope.drTransformInvoke(input,element,!0,null,scp,null,stage,selectedItem,operation,customizer,pcIndex,callback):"PreTransform"===stage&&$scope.remoteCallRepeater(element,scp,input,"Middle",selectedItem,operation,customizer,pcIndex);else if("Middle"===stage||!stage&&!element&&$scope.bpTree.propSetMap.persistentComponent&&void 0!==pcIndex&&null!==pcIndex&&!$scope.bpTree.propSetMap.persistentComponent[pcIndex].preTransformBundle||!stage&&element&&!element.propSetMap.preTransformBundle)"Middle"===stage||angular.equals(operation,"vlcEBOperation")||(input=$scope.prepareInputJSON(element)),stage="Middle",!element||"Remote Action"===element.type||"Calculation Action"===element.type||"Filter Block"===element.type||"Integration Procedure Action"===element.type||bpService.placeholderEleTypeList.indexOf(element.type)>=0?$scope.remoteCallInvoke(input,element,!0,null,scp,selectedItem,operation,customizer,null,stage,pcIndex,callback):"Rest Action"===element.type?$scope.restCallInvoke(input,element,!0,null,scp,null,stage,operation,callback):"DataRaptor Post Action"===element.type?$scope.drPostInvoke(input,element,!0,null,scp):"DataRaptor Transform Action"===element.type?$scope.drTransformActionInvoke(input,element,!0,null,scp):"Matrix Action"===element.type?$scope.matrixActionInvoke(element,!0,null,scp):"Delete Action"===element.type?$scope.deleteActionInvoke(element,!0,null,scp):"Post to Object Action"===element.type?$scope.objectPostInvoke(input,element,!0,null,scp):"PDF Action"===element.type&&$scope.pdfInvoke(input,element,!0,null,scp,null,"fetchPDFTemplate");else{var dataJSON=input;angular.equals(operation,"vlcEBOperation")||(dataJSON=$scope.prepareInputJSON(element)),$scope.remoteCallRepeater(element,scp,dataJSON,"PreTransform",selectedItem,operation,customizer,pcIndex,callback)}},$scope.completeScript=function(bDismiss,doneConfig){$rootScope.loading=!0,$rootScope.loadingMessage="";var configObj={sClassName:"Vlocity CompleteScript",sInstanceId:bpService.instanceId};bpService.OmniRemoteInvoke(configObj).then(function(result){var resp=angular.fromJson(result);$rootScope.loading=!1,resp.error&&"OK"!==resp.error?$window.alert(new Error(resp.error)):(bDismiss&&$scope.cancel(),doneConfig&&$scope.doneActionAux(doneConfig.element,doneConfig.bBtn,doneConfig.fromIndex,doneConfig.scp))},function(error){$rootScope.loading=!1,$window.alert(new Error(angular.toJson(error)))})},$scope.copyToClipboard=function(msg,text){$window.prompt(msg,text)},$scope.drTransformInvoke=function(payload,element,bBtn,fromIndex,scp,curIndex,stage,selectedItem,operation,customizer,pcIndex,callback){var iTimeout,input={};input.objectList=payload,"PreTransform"===stage?element?(input.objectList=$scope.getSendResponseJSON(input.objectList,element.propSetMap.sendJSONPath,element.propSetMap.sendJSONNode),input.bundleName=element.propSetMap.preTransformBundle,bBtn||(element.ui.preTransform=!0,element.ui.postTransform=!1)):$scope.bpTree.propSetMap.persistentComponent&&void 0!==pcIndex&&null!==pcIndex&&(input.objectList=$scope.getSendResponseJSON(input.objectList,$scope.bpTree.propSetMap.persistentComponent[pcIndex].sendJSONPath,$scope.bpTree.propSetMap.persistentComponent[pcIndex].sendJSONNode),input.bundleName=$scope.bpTree.propSetMap.persistentComponent[pcIndex].preTransformBundle,input.objectList=payload.response):"PostTransform"===stage&&(element?(input.bundleName=element.propSetMap.postTransformBundle,bBtn||(element.ui.preTransform=!1,element.ui.postTransform=!0)):$scope.bpTree.propSetMap.persistentComponent&&void 0!==pcIndex&&null!==pcIndex&&(input.bundleName=$scope.bpTree.propSetMap.persistentComponent[pcIndex].postTransformBundle)),element?iTimeout=element.propSetMap.remoteTimeout:$scope.bpTree.propSetMap.persistentComponent&&void 0!==pcIndex&&null!==pcIndex&&(iTimeout=$scope.bpTree.propSetMap.persistentComponent[pcIndex].remoteTimeout),$rootScope.loading=!0,$rootScope.loadingMessage="",!bBtn&&element&&(element.ui.show=!0,element.ui.error=!1,element.ui.errorMessage=""),element&&($rootScope.loadingMessage=element.propSetMap.label,"PreTransform"===stage&&($rootScope.loadingMessage+=customLabels.OmniPreTransform),"PostTransform"===stage&&($rootScope.loadingMessage+=customLabels.OmniPostTransform));var option={};option.useQueueableApexRemoting=!0===element.propSetMap.useQueueableApexRemoting;var configObj={sClassName:bpService.sNSC+"DefaultDROmniScriptIntegration",sMethodName:"invokeTransformDR",input:angular.toJson(input),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name,stage:stage}};bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);if(remoteResp&&"OK"!==remoteResp.error)customizer&&customizer.constructor===Function&&customizer(operation,selectedItem,!1,element,pcIndex,scp),$scope.handleRemoteCallError(element,remoteResp.error,bBtn,!1,operation,callback);else{if("PostTransform"===stage)if(angular.equals(operation,"vlcEBOperation")&&angular.isFunction(callback)&&callback(!0),element&&"DataRaptor Post Action"===element.type);else if(remoteResp&&remoteResp.TFDRresp){if(element&&(remoteResp.TFDRresp=$scope.getSendResponseJSON(remoteResp.TFDRresp,element.propSetMap.responseJSONPath,element.propSetMap.responseJSONNode)),$scope.bpTree.propSetMap.persistentComponent&&void 0!==pcIndex&&null!==pcIndex&&(remoteResp.TFDRresp=$scope.getSendResponseJSON(remoteResp.TFDRresp,$scope.bpTree.propSetMap.persistentComponent[pcIndex].responseJSONPath,$scope.bpTree.propSetMap.persistentComponent[pcIndex].responseJSONNode)),angular.equals(operation,"typeAheadSearch")&&angular.isFunction(callback))return $rootScope.loading=!1,void callback(remoteResp.TFDRresp);var validationResp=remoteResp.TFDRresp.vlcValidationErrors,bValidationError=!!(validationResp&&validationResp.constructor===Object&&Object.getOwnPropertyNames(validationResp).length>0);customizer&&customizer.constructor===Function&&customizer(operation,selectedItem,!bValidationError,element,pcIndex,scp);var bContinue=$scope.applyCallRespMain(angular.copy(remoteResp.TFDRresp),element,null,scp);if(bValidationError&&!bContinue)return}$rootScope.loading=!1,$timeout(function(){"PreTransform"===stage?bBtn?$scope.remoteCallRepeater(element,scp,remoteResp.TFDRresp,"Middle",selectedItem,operation,customizer,pcIndex,callback):$scope.nextRepeater(curIndex,fromIndex,remoteResp.TFDRresp,"Middle"):"PostTransform"===stage&&($scope.handleMessaging(element,bBtn),element&&element.propSetMap.redirectPageName&&element.propSetMap.redirectTemplateUrl?bBtn?$scope.processCustomRedirect(element,remoteResp.TFDRresp,!0,scp):(element.ui.show=!1,$scope.processCustomRedirect(element,remoteResp.TFDRresp,!1,null)):bBtn||$scope.nextRepeater(element.nextIndex,curIndex))},0)}},function(error){customizer&&customizer.constructor===Function&&customizer(operation,selectedItem,!1,element,pcIndex,scp),$scope.handleRemoteCallError(element,error,bBtn,!1,operation,callback)})},$scope.reviewAction=function(element,bBtn,fromIndex,scp){$scope.handleMessaging(element,bBtn),element.ui={};var redirect=element.propSetMap.redirectPageName,redirectTemplateUrl=element.propSetMap.redirectTemplateUrl;if(redirect&&redirectTemplateUrl){redirectTemplateUrl=bpService.getHTMLTemplate(redirectTemplateUrl),bpService.redirectPageTemplateMap[redirect]=redirectTemplateUrl;var redirectJSON=angular.copy($scope.bpTree);redirectJSON.responseT=$scope.getSendResponseJSON(redirectJSON.response,element.propSetMap.sendJSONPath,element.propSetMap.sendJSONNode),bBtn?(redirectJSON.reviewActionBtn=angular.copy(element),redirectJSON.parentStepIndex=$scope.findStepIndex(scp,element.index,element.indexInParent)):($scope.adjustStepState(element,!0),redirectJSON.reviewAction=angular.copy(element)),redirectJSON.skipElements=element.propSetMap.skipElements,bpService.restResponse[redirect]=redirectJSON,$scope.redirect("/custom/"+redirect+"/review",element,bBtn)}else $scope.nextRepeater(element.nextIndex,fromIndex)},$scope.drExtractInvoke=function(element,bBtn,fromIndex,scp,lastIndex,operation,callback){if(element){var iTimeout=element.propSetMap.remoteTimeout;element.propSetMap.preTransformBundle=null,element.propSetMap.postTransformBundle=null;var inputParamEle,input={},inputParams=element.propSetMap["dataRaptor Input Parameters"],queryCriteria={};if(inputParams&&angular.isArray(inputParams)){for(var j=0;j<inputParams.length;j++)inputParamEle=scp&&scp.control?void 0===scp.control.blockIndex||null===scp.control.blockIndex?inputParams[j].element:$scope.replaceNIndex(inputParams[j].element,scp.control.blockIndex+1):inputParams[j].element,queryCriteria[inputParams[j].inputParam]=$scope.getElementValue(inputParamEle);input.DRParams=queryCriteria}input.Bundle=element.propSetMap.bundle,$rootScope.loading=!0,$rootScope.loadingMessage="",bBtn||(element.ui.show=!0,element.ui.error=!1,element.ui.errorMessage=""),element&&($rootScope.loadingMessage=element.propSetMap.label);var option={};option.useQueueableApexRemoting=!0===element.propSetMap.useQueueableApexRemoting;var configObj={sClassName:bpService.sNSC+"DefaultDROmniScriptIntegration",sMethodName:"invokeOutboundDR",input:angular.toJson(input),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name}};bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);if(remoteResp&&"OK"!==remoteResp.error)$scope.handleRemoteCallError(element,remoteResp.error,bBtn,!1);else{if(remoteResp&&remoteResp.OBDRresp){if(remoteResp.OBDRresp=$scope.getSendResponseJSON(remoteResp.OBDRresp,element.propSetMap.responseJSONPath,element.propSetMap.responseJSONNode),angular.equals(operation,"typeAheadSearch")&&angular.isFunction(callback))return $rootScope.loading=!1,void callback(remoteResp.OBDRresp);var bContinue=$scope.applyCallRespMain(angular.copy(remoteResp.OBDRresp),element,null,scp);if(remoteResp.OBDRresp.vlcValidationErrors&&!bContinue)return}$scope.handleRemoteCallSuccess(element,remoteResp.OBDRresp,bBtn,!0,fromIndex,lastIndex,scp)}},function(error){$scope.handleRemoteCallError(element,error,bBtn,!1)})}},$scope.drTransformActionInvoke=function(payload,element,bBtn,fromIndex,scp,lastIndex){var input={};input.objectList=angular.copy(payload.response),input.objectList=$scope.getSendResponseJSON(input.objectList,element.propSetMap.sendJSONPath,element.propSetMap.sendJSONNode),input.objectList&&(input.objectList.contextId=input.objectList.ContextId),input.bundleName=element.propSetMap.bundle;var iTimeout=element.propSetMap.remoteTimeout;$rootScope.loading=!0,$rootScope.loadingMessage="",bBtn||(element.ui.show=!0,element.ui.error=!1,element.ui.errorMessage=""),element&&($rootScope.loadingMessage=element.propSetMap.label);var option={};option.useQueueableApexRemoting=!0===element.propSetMap.useQueueableApexRemoting;var configObj={sClassName:bpService.sNSC+"DefaultDROmniScriptIntegration",sMethodName:"invokeTransformDR",input:angular.toJson(input),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name}};bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);if(remoteResp&&"OK"!==remoteResp.error)$scope.handleRemoteCallError(element,remoteResp.error,bBtn,!1);else{if(remoteResp&&remoteResp.TFDRresp){remoteResp.TFDRresp=$scope.getSendResponseJSON(remoteResp.TFDRresp,element.propSetMap.responseJSONPath,element.propSetMap.responseJSONNode);var bContinue=$scope.applyCallRespMain(angular.copy(remoteResp.TFDRresp),element,null,scp);if(remoteResp.TFDRresp.vlcValidationErrors&&!bContinue)return}$scope.handleRemoteCallSuccess(element,remoteResp.TFDRresp,bBtn,!0,fromIndex,lastIndex,scp)}},function(error){$scope.handleRemoteCallError(element,error,bBtn,!1)})},$scope.matrixActionInvoke=function(element,bBtn,fromIndex,scp,lastIndex,operation,callback){if(element){var iTimeout=element.propSetMap.remoteTimeout;element.propSetMap.preTransformBundle=null;var input={matrixData:[{}]},index=NaN;scp&&(void 0!==(index=scp.editBlockIndex)&&null!==index||(index=NaN));var inputParams=element.propSetMap["matrix Input Parameters"];if(inputParams&&angular.isArray(inputParams))for(var j=0;j<inputParams.length;j++){var eleName=inputParams[j].name;angular.equals(index,NaN)||(eleName=$scope.replaceNIndex(eleName,index+1));var inputEleVal=$scope.getElementValue(eleName);if(angular.isArray(inputEleVal))for(i=0;i<inputEleVal.length;i++)input.matrixData.length-1<i&&input.matrixData.push({}),input.matrixData[i][inputParams[j].value]=inputEleVal[i];else input.matrixData[0][inputParams[j].value]=inputEleVal}var option={};option.PricingMatrixId=element.propSetMap.remoteOptions.matrixName,element.propSetMap.remoteOptions.postTransformBundle&&(option.postTransformBundle=element.propSetMap.remoteOptions.postTransformBundle),option.defaultMatrixResult=element.propSetMap.defaultMatrixResult,element.propSetMap.executionDateTime&&(option.executionDateTime=$scope.handleMergeField(element.propSetMap.executionDateTime)),$rootScope.loading=!0,$rootScope.loadingMessage="",bBtn||(element.ui.show=!0,element.ui.error=!1,element.ui.errorMessage=""),element&&($rootScope.loadingMessage=element.propSetMap.label),option.useQueueableApexRemoting=!0===element.propSetMap.useQueueableApexRemoting;var configObj={sClassName:bpService.sNSC+"DefaultOmniScriptMatrix",sMethodName:"calculate",input:angular.toJson(input),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name}};bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);if(remoteResp&&"OK"!==remoteResp.error)$scope.handleRemoteCallError(element,remoteResp.error,bBtn,!1,operation,callback);else{if(remoteResp&&remoteResp.matrixResult&&remoteResp.matrixResult[0]&&(remoteResp.matrixResult=$scope.getSendResponseJSON(remoteResp.matrixResult[0],element.propSetMap.responseJSONPath,element.propSetMap.responseJSONNode),!element.propSetMap.postTransformBundle))$scope.applyCallRespMain(angular.copy(remoteResp.matrixResult),element,null,scp);$scope.handleRemoteCallSuccess(element,remoteResp.matrixResult,bBtn,!0,fromIndex,lastIndex,scp,null,operation,null,null,callback)}},function(error){$scope.handleRemoteCallError(element,error,bBtn,!1,operation,callback)})}},$scope.deleteActionInvoke=function(element,bBtn,fromIndex,scp,lastIndex,operation,callback){if(element){var iTimeout=element.propSetMap.remoteTimeout,index=NaN;scp&&(void 0!==(index=scp.editBlockIndex)&&null!==index||(index=NaN));var inputParams={};inputParams.propSetMap=element.propSetMap;var paramString=angular.toJson(inputParams.propSetMap);paramString=$scope.handleMergeField(paramString,!1,null,bBtn?element:null,null,null,!0),inputParams.propSetMap=angular.fromJson(paramString);var option={};element.propSetMap.executionDateTime&&(option.executionDateTime=element.propSetMap.executionDateTime),$rootScope.loading=!0,$rootScope.loadingMessage="",bBtn||(element.ui.show=!0,element.ui.error=!1,element.ui.errorMessage=""),element&&($rootScope.loadingMessage=element.propSetMap.label),option.useQueueableApexRemoting=!0===element.propSetMap.useQueueableApexRemoting;var configObj={sClassName:bpService.sNSC+"IntegrationProcedureService",sMethodName:"vlcOmniScriptDeleteAction",input:angular.toJson(inputParams),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name}};bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);if(remoteResp&&"OK"!==remoteResp.error)$scope.handleRemoteCallError(element,remoteResp.error,bBtn,!1,operation,callback);else{if(remoteResp&&remoteResp.deleteResult&&remoteResp.deleteResult[0]){remoteResp.deleteResult=$scope.getSendResponseJSON(remoteResp.deleteResult[0],element.propSetMap.responseJSONPath,element.propSetMap.responseJSONNode);$scope.applyCallRespMain(angular.copy(remoteResp.deleteResult),element,null,scp)}$scope.handleRemoteCallSuccess(element,remoteResp.deleteResult,bBtn,!0,fromIndex,lastIndex,scp,null,operation,null,null,callback)}},function(error){$scope.handleRemoteCallError(element,error,bBtn,!1,operation,callback)})}},$scope.pdfInvoke=function(payload,element,bBtn,fromIndex,scp,lastIndex,methodName){if(methodName||!bBtn){var iTimeout=element.propSetMap.remoteTimeout;element.propSetMap.postTransformBundle=null;var input={};"fetchPDFTemplate"===methodName?input.templateName=element.propSetMap.templateName:(input=payload,element.propSetMap.preTransformBundle||(input=$scope.getSendResponseJSON(input,element.propSetMap.sendJSONPath,element.propSetMap.sendJSONNode))),$rootScope.loading=!0,$rootScope.loadingMessage="",bBtn||(element.ui.show=!0,element.ui.preTransform=!1,element.ui.error=!1,element.ui.errorMessage=""),element&&($rootScope.loadingMessage=element.propSetMap.label);var option={};option.useQueueableApexRemoting=!0===element.propSetMap.useQueueableApexRemoting;var configObj={sClassName:bpService.sNSC+"DefaultPDFOmniScriptIntegration",sMethodName:methodName,input:angular.toJson(input),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name}};bpService.OmniRemoteInvoke(configObj).then(function(result){var respError,formFields,remoteResp=angular.fromJson(result);if("OK"!==remoteResp.error)respError=remoteResp.error;else if("fetchPDFTemplate"===methodName)if(remoteResp.templateBody){var pdfDocument=new buffer.Buffer(remoteResp.templateBody,"base64");pdfDocument?(void 0===(formFields=vlocityPdfWriter.getFormFields(pdfDocument))||null===formFields||!angular.isArray(formFields)||formFields.length<=0)&&(respError=customLabels.OmniPDFError):respError=customLabels.OmniPDFError}else respError=customLabels.OmniPDFError;if(respError)$scope.handleRemoteCallError(element,respError,bBtn,!1);else if("fetchPDFTemplate"===methodName){var options={};options.dateFormat=element.propSetMap.dateFormat,options.dateTimeFormat=element.propSetMap.dateTimeFormat,options.timeFormat=element.propSetMap.timeFormat,options.readOnly=element.propSetMap.readOnly;try{var filledinForm=vlocityPdfWriter.fillPdfForm(pdfDocument,payload,options),tempInput={};tempInput.vlcAttachmentBody=filledinForm.toString("base64"),$scope.handleRemoteCallSuccess(element,tempInput,bBtn,!0,fromIndex,lastIndex,scp)}catch(e){$scope.handleRemoteCallError(element,element.propSetMap.label+" - "+customLabels.OmniPDFError+" - "+e,bBtn,!1)}}},function(error){$scope.handleRemoteCallError(element,error,bBtn,!1)})}else $scope.remoteCallRepeater(element,scp,payload,methodName)},$scope.drPostInvoke=function(payload,element,bBtn,fromIndex,scp,lastIndex,operation,callback){var input={};input.objectList=angular.copy(payload.response),input.objectList=$scope.getSendResponseJSON(input.objectList,element.propSetMap.sendJSONPath,element.propSetMap.sendJSONNode),input.objectList&&(input.objectList.contextId=input.objectList.ContextId),input.bundleName=element.propSetMap.bundle,input.filesMap=VOUINS.getFilesMap(payload.filesMap,$rootScope.isSforce,$rootScope.sforce);var iTimeout=element.propSetMap.remoteTimeout;$rootScope.loading=!0,$rootScope.loadingMessage="",bBtn||(element.ui.show=!0,element.ui.error=!1,element.ui.errorMessage=""),element&&($rootScope.loadingMessage=element.propSetMap.label);var option={};option.useQueueableApexRemoting=!0===element.propSetMap.useQueueableApexRemoting;var configObj={sClassName:bpService.sNSC+"DefaultDROmniScriptIntegration",sMethodName:"invokeInboundDR",input:angular.toJson(input),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name}};bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);if(remoteResp&&"OK"!==remoteResp.error)$scope.handleRemoteCallError(element,remoteResp.error,bBtn,!1,operation,callback);else if(angular.equals(operation,"vlcEBOperation")&&angular.isFunction(callback)&&callback(!0),remoteResp&&remoteResp.IBDRresp){var bContinue=$scope.applyCallRespMain(remoteResp.IBDRresp,element,null,scp);if(remoteResp.IBDRresp.vlcValidationErrors&&!bContinue)return;if(remoteResp.IBDRresp.createdObjectsByType){var recMap=remoteResp.IBDRresp.createdObjectsByType[element.propSetMap.bundle];if(recMap){var recCreatedJSON={};for(var key in recMap)if(recMap.hasOwnProperty(key)){var data=recMap[key];void 0!==data&&null!=data&&angular.isArray(data)&&1===data.length&&(recCreatedJSON["DRId_"+key]=data[0])}$scope.bpTree.response=$.extend({},$scope.bpTree.response,recCreatedJSON)}}$scope.handleRemoteCallSuccess(element,remoteResp.IBDRresp,bBtn,!0,fromIndex,lastIndex,scp)}else $scope.handleRemoteCallSuccess(element,remoteResp.IBDRresp,bBtn,!0,fromIndex,lastIndex,scp)},function(error){$scope.handleRemoteCallError(element,error,bBtn,!1,operation,callback)})},$scope.handleRemoteCallError=function(element,errorMsg,bBtn,bApply,operation,callback){errorMsg=$scope.errorReplace(errorMsg,element),angular.equals(operation,"vlcEBOperation")&&angular.isFunction(callback)&&callback(!1),element.propSetMap.invokeMode||($rootScope.loading=!1),!element||bBtn||element.propSetMap.invokeMode||"Step"===element.type?errorMsg?"string"==typeof errorMsg?$window.alert(new Error(errorMsg)):$window.alert(new Error(angular.toJson(errorMsg))):$window.alert(new Error(customLabels.OmniError)):(element.ui.error=!0,element.ui.errorMessage=errorMsg),bApply&&$scope.$apply()},$scope.handleRemoteCallRedirect=function(element,resp,bBtn,scp){bBtn?$scope.processCustomRedirect(element,resp,!0,scp):(element.ui.show=!1,$scope.processCustomRedirect(element,resp,!1,null))},$scope.handleRemoteCallSuccess=function(element,resp,bBtn,bApply,fromIndex,lastIndex,scp,selectedItem,operation,customizer,pcIndex,callback){var syncProm;angular.equals(operation,"vlcEBOperation")&&angular.isFunction(callback)&&callback(!0),element.propSetMap.invokeMode?syncProm={then:function(successCallback){successCallback()}}:($rootScope.loading=!1,syncProm=VOUINS.syncFileAttachmentData(resp,!0,$rootScope,$q,$scope,$scope.bpTree.filesMap,bpService,$window)),syncProm.then(function(){$timeout(function(){if(element)if(element.propSetMap.postTransformBundle)bBtn?$scope.remoteCallRepeater(element,scp,resp,"PostTransform",selectedItem,operation,customizer,pcIndex,callback):$scope.nextRepeater(fromIndex,lastIndex,resp,"PostTransform");else{$scope.handleMessaging(element,bBtn);var hasRedirect=element.propSetMap.redirectPageName&&element.propSetMap.redirectTemplateUrl;if(element&&"PDF Action"===element.type&&resp&&resp.vlcAttachmentBody){var parentId=$scope.handleMergeField(element.propSetMap.attachmentParentId),customFileName=$scope.handleMergeField(element.propSetMap.attachmentName).replace(/\.pdf/,"").replace(/\./g,""),configObj={sClassName:"Vlocity CreateOSAttachment",input:resp.vlcAttachmentBody,parentId:parentId||"TEMP",fileName:(customFileName||element.name)+".pdf",options:"{}"};bpService.OmniRemoteInvoke(configObj).then(function(attachmentId){$rootScope.loading=!1,resp.attachmentUrl=$scope.instanceHost+"/servlet/servlet.FileDownload?file="+attachmentId,hasRedirect?$scope.handleRemoteCallRedirect(element,resp,bBtn,scp):(element.propSetMap.showPopup&&!$window.open(resp.attachmentUrl)&&$window.alert(customLabels.OmniPopupBlocked),bBtn||$scope.nextRepeater(element.nextIndex,fromIndex)),parentId||$timeout(function(){var configObj={sClassName:"Vlocity DeleteOSAttachment",attachmentId:attachmentId,deleteParent:!0};bpService.OmniRemoteInvoke(configObj)},1e4);var temp={};temp[element.name]={attachmentId:attachmentId},$scope.applyCallResp(temp)},function(error){if($rootScope.loading=!1,error.attachmentId){var configObj={sClassName:"Vlocity DeleteOSAttachment",attachmentId:error.attachmentId,deleteParent:!0};bpService.OmniRemoteInvoke(configObj)}var errorMsg=$scope.errorReplace(error,element);$window.alert(new Error(customLabels.OmniPDFError+": "+errorMsg))}),$rootScope.loading=!0}else hasRedirect?$scope.handleRemoteCallRedirect(element,resp,bBtn,scp):element&&"Step"===element.type?$scope.nextRepeater(element.nextIndex,lastIndex,null,"stepRemoteCallDone"):bBtn||element.propSetMap.invokeMode||$scope.nextRepeater(element.nextIndex,fromIndex)}else $scope.bpTree.propSetMap.persistentComponent&&void 0!==pcIndex&&null!==pcIndex&&$scope.bpTree.propSetMap.persistentComponent[pcIndex].postTransformBundle&&$scope.remoteCallRepeater(element,scp,resp,"PostTransform",selectedItem,operation,customizer,pcIndex,callback)},0)})},$scope.processCustomRedirect=function(element,resp,bBtn,scp){!bBtn&&bpService.sflMode&&element&&null===element.nextIndex&&$scope.completeScript(!1);var redirect=element.propSetMap.redirectPageName,redirectTemplateUrl=element.propSetMap.redirectTemplateUrl;$scope.adjustshowPC(element),redirect&&redirectTemplateUrl&&(redirectTemplateUrl=bpService.getHTMLTemplate(redirectTemplateUrl),bpService.redirectPageTemplateMap[redirect]=redirectTemplateUrl,bpService.restResponse[redirect]={},bpService.restResponse[redirect].bpTree=angular.copy($scope.bpTree),bBtn?(bpService.restResponse[redirect].bpTree.redirectActionBtn=angular.copy(element),bpService.restResponse[redirect].bpTree.parentStepIndex=$scope.findStepIndex(scp,element.index,element.indexInParent)):($scope.adjustStepState(element,!1),bpService.restResponse[redirect].bpTree.redirectAction=angular.copy(element)),bpService.restResponse[redirect].response=resp,$scope.redirect("/custom/"+redirect,element,bBtn))},$scope.removeItem=function(scp,control,index){control.eleArray.splice(index,1);for(var i=index;i<control.eleArray.length;i++){control.eleArray[i].index=control.eleArray[i].index-1;for(var j=0;j<control.eleArray[i].children.length;j++)"Type Ahead Block"===control.eleArray[i].children[j].eleArray[0].type&&(control.eleArray[i].children[j].blockIndex=control.eleArray[i].index,control.eleArray[i].children[j].eleArray[0].blockIndex=control.eleArray[i].index,control.eleArray[i].children[j].eleArray[0].children[0].eleArray[0].blockIndex=control.eleArray[i].index)}if("Block"===control.eleArray[0].type&&scp.$parent&&scp.$parent.$parent){var parentNode=scp.$parent.$parent.$parent;parentNode&&bpService.aggregate(parentNode,control.index,control.indexInParent,!1,index)}else bpService.aggregate(scp,control.index,control.indexInParent,!1,index)},$scope.nullifyResponse=function(eleNode){if(eleNode){if(bpService.blockEleTypeList.indexOf(eleNode.type)>=0){var blkResp=eleNode.response;blkResp&&(eleNode.response=nullifyBlockResponse(blkResp))}else eleNode.response=null;if("Multi-select"===eleNode.type&&angular.isArray(eleNode.propSetMap.options))for(var k=0;k<eleNode.propSetMap.options.length;k++)delete eleNode.propSetMap.options[k].selected;if(0===eleNode.children.length)return;for(var i=0;i<eleNode.children.length;i++){eleNode.children[i].response&&(eleNode.children[i].response=nullifyBlockResponse(eleNode.children[i].response));for(var j=0;j<eleNode.children[i].eleArray.length;j++)$scope.nullifyResponse(eleNode.children[i].eleArray[j])}}},$scope.aggregate=function(scp,arrayIndex,indexInParent,bUIUpdate,removeIndex){bpService.aggregate(scp,arrayIndex,indexInParent,bUIUpdate,removeIndex)},$scope.resetSrvErr=function(control){control.srvErr&&(control.srvErr=null);var result={};searchSrvErr($scope.bpTree.children[$scope.bpTree.asIndex],result),result.bFound||($scope.bpTree.children[$scope.bpTree.asIndex].bSrvErr=!1),window.event&&"focus"===window.event.type&&($window.parent.postMessage(JSON.stringify({name:control.name,type:control.type}),"*"),$scope.setSessionStorageMessage({name:control.name,type:control.type,messageType:"focus"}))},$scope.clearSrvErr=function(stepIndex){for(var step=$scope.bpTree.children[stepIndex],i=0;i<step.children.length;i++)for(var j=0;j<step.children[i].eleArray.length;j++)nullifySrvErr(step.children[i].eleArray[j]);$scope.children[stepIndex].bSrvErr=!1},$scope.submit=function(scp,control){if(!$scope.checkValidity(scp,control.index,control.indexInParent,"Submit")){var confirmRedirect=control.propSetMap?control.propSetMap.confirmRedirectPageName:control.confirmRedirectPageName,confirmRedirectTemplateUrl=control.propSetMap?control.propSetMap.confirmRedirectTemplateUrl:control.confirmRedirectTemplateUrl;if(confirmRedirect&&confirmRedirectTemplateUrl){confirmRedirectTemplateUrl=bpService.getHTMLTemplate(confirmRedirectTemplateUrl),$scope.bpTree.response&&($scope.bpTree.response.userId=$scope.bpTree.userId,$scope.bpTree.response.userName=$scope.bpTree.userName,$scope.bpTree.response.userProfile=$scope.bpTree.userProfile,$scope.bpTree.response.timeStamp=$scope.bpTree.timeStamp,$scope.bpTree.ContextId=bpService.parentObjectId,$scope.bpTree.response.ContextId=bpService.parentObjectId,$scope.bpTree.response.userCurrencyCode=$scope.bpTree.userCurrencyCode),control.propSetMap.postNameTemplate&&!$scope.bpTree.bpApplicationName&&($scope.bpTree.bpApplicationName=$scope.handleMergeField(control.propSetMap.postNameTemplate)),bpService.redirectPageTemplateMap[confirmRedirect]=confirmRedirectTemplateUrl;var ctrl=angular.copy(control);ctrl.type="Button",$scope.bpTree.submitButton=ctrl,bpService.restResponse[confirmRedirect]=angular.fromJson(angular.toJson($scope.bpTree)),$location.path("/custom/"+confirmRedirect)}}},$scope.navigateAux=function(bpTree,control,redirect,direction){if(control&&bpTree){var path;if(bpTree.responseT&&delete bpTree.responseT,!1===bpTree.IdMode)path=bpService.urlMode?"/"+bpService.verticalMode+"/false/"+redirect:"/OmniScriptType/"+bpTree.bpType+"/OmniScriptSubType/"+bpTree.bpSubType+"/OmniScriptLang/"+bpTree.bpLang+"/ContextId/"+bpService.parentObjectId+"/PrefillDataRaptorBundle/"+bpService.pfDRBundle+"/"+bpService.verticalMode+"/false/"+redirect;else{var sId=bpService.resumeMode?bpService.appId:bpService.bpId;bpService.sflMode&&(sId=bpService.instanceId),path=bpService.urlMode?"/"+bpService.verticalMode+"/false/"+redirect:"/OS/"+sId+"/scriptState/"+bpService.scriptState+"/"+bpService.verticalMode+"/false/"+redirect}direction&&(path+="/"+direction),$location.path(path)}},$scope.goBack=function(bpTree,control){$scope.navigateAux(bpTree,control,control.propSetMap.confirmRedirectPageName)},$scope.navigate=function(bpTree,control,direction){$scope.navigateAux(bpTree,control,control.propSetMap.redirectPageName,direction)},$scope.navigateBackToStep=function(bpTree,control){$scope.navigateAux(bpTree,control,control.propSetMap.redirectPageName)},$scope.cancel=function(){if(!0===$scope.bpTree.propSetMap.allowCancel)if($scope.bpTree.propSetMap.timeTracking&&$scope.trackOutcome($scope.bpTree.children[$scope.bpTree.asIndex],"Cancel"),"Dismiss"===$scope.bpTree.propSetMap.cancelType)$location.path("/cancel");else{$scope.bpTree.propSetMap.cancelType=void 0===$scope.bpTree.propSetMap.cancelType?"SObject":$scope.bpTree.propSetMap.cancelType,$scope.bpTree.propSetMap.cancelSource=void 0===$scope.bpTree.propSetMap.cancelSource?"%ContextId%":$scope.bpTree.propSetMap.cancelSource,$scope.bpTree.propSetMap.cancelRedirectPageName=void 0===$scope.bpTree.propSetMap.cancelRedirectPageName?"mobileDone":$scope.bpTree.propSetMap.cancelRedirectPageName,$scope.bpTree.propSetMap.cancelRedirectTemplateUrl=void 0===$scope.bpTree.propSetMap.cancelRedirectTemplateUrl?"vlcMobileConfirmation.html":$scope.bpTree.propSetMap.cancelRedirectTemplateUrl;var fakeEle={type:"Cancel Script"};fakeEle.propSetMap={type:$scope.bpTree.propSetMap.cancelType,source:$scope.bpTree.propSetMap.cancelSource,redirectPageName:$scope.bpTree.propSetMap.cancelRedirectPageName,redirectTemplateUrl:$scope.bpTree.propSetMap.cancelRedirectTemplateUrl,wpm:$scope.bpTree.propSetMap.wpm,ssm:$scope.bpTree.propSetMap.ssm,message:$scope.bpTree.propSetMap.message},$scope.handleMessaging(fakeEle,!1),$scope.doneCancelAux(fakeEle.propSetMap,!0)}},$rootScope.tabKey){var handle_message=function(e){if(e||(e=window.event),e=e.data,angular.isString(e)&&(e=JSON.parse(e)),e.key){var keyParts=e.key.split(".");if(keyParts[0]===$rootScope.tabKey&&"ouiTestJson"===keyParts[1])switch(keyParts[1]){case"ouiTestJson":if(pendingInitialLoad=!1,$scope.bpTree){var newValue=JSON.stringify(JSON.parse(e.newValue),null,4);pendingBpTreeIfNonExisting&&"null"===newValue?$scope.$evalAsync(function(){$scope.bpTree.responseAsText=pendingBpTreeIfNonExisting,$scope.applyCallResp($scope.bpTree.responseAsText)}):newValue!==$scope.bpTree.responseAsText&&$scope.$evalAsync(function(){$scope.bpTree.responseAsText=newValue,$scope.applyCallResp($scope.bpTree.responseAsText)})}}}};window.addEventListener?window.addEventListener("message",handle_message,!1):window.attachEvent("onmessage",handle_message,!1),$scope.$watch("bpTree.responseAsText",function(newValue,oldValue){if(newValue&&newValue!==oldValue)try{JSON.parse(newValue)&&(Object.keys($scope.bpTree.response).length<8&&$timeout(function(){$("[ng-blur]").blur()},200),$window.parent.postMessage({key:$rootScope.tabKey+".ouiTestJson",newValue:newValue},"*"))}catch(e){}})}function checkRemoteCallError(remoteResp){if(remoteResp&&void 0!==remoteResp.error&&"OK"!==remoteResp.error)return!0;if(remoteResp&&void 0===remoteResp.error&&!remoteResp.records&&angular.isArray(remoteResp.messages)&&remoteResp.messages.length>0){remoteResp.error=[];for(var i=0;i<remoteResp.messages.length;i++)angular.equals(remoteResp.messages[i].severity,"ERROR")&&remoteResp.error.push(remoteResp.messages[i]);if(remoteResp.error.length>0)return!0}return!1}if($scope.invokeDR=function(bundleName,ctxObjId){var inputMap={bundleName:bundleName,ctxObjId:ctxObjId};inputMap=JSON.stringify(inputMap);$rootScope.loading=!0,$rootScope.loadingMessage="";var configObj={sClassName:"DefaultDROmniScriptIntegration",sMethodName:"processDRQuery",input:inputMap,options:angular.toJson({}),iTimeout:2e3,label:null};bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);$scope.previewMode&&$scope.addDebugLog("invoke Prefill test",result),remoteResp?"OK"!==remoteResp.error?($rootScope.loading=!1,$window.alert(new Error(remoteResp.error))):($scope.applyCallResp(remoteResp.result),$rootScope.loading=!1):$rootScope.loading=!1},function(error){$rootScope.loading=!1,$window.alert(new Error(angular.toJson(error)))})},$scope.getSendResponseJSON=function(response,path,rootNode){var resp,rNode;if(path){var propArray=$scope.preprocessElementInput(path);propArray&&propArray.length>0&&(resp=$scope.getJSONNode(response,propArray)||{},rNode=propArray[propArray.length-1][0])}else resp=angular.copy(response);if(response={},!path&&!rootNode||"VlocityNoRootNode"===rootNode)response=resp;else if(rootNode.indexOf(":")>-1){var nodeKeys=$scope.preprocessElementInput(rootNode);if(nodeKeys&&nodeKeys.length>0){for(var element,reference=response={},i=0;i<nodeKeys.length;i++)element&&(reference=reference[element]),reference[element=nodeKeys[i][0]]={};reference[element]=resp}}else response[rNode=rootNode||rNode]=resp;return response},$scope.handleExtraPayload=function(extraPayloadProp,input,bBtn,element,scp){var ePayloadString=angular.toJson(angular.copy(extraPayloadProp));ePayloadString=scp&&scp.control&&void 0!==scp.control.blockIndex&&null!==scp.control.blockIndex?$scope.handleMergeField(ePayloadString,!1,null,bBtn?element:null,null,scp.control.blockIndex,!0):$scope.handleMergeField(ePayloadString,!1,null,bBtn?element:null,null,scp?scp.editBlockIndex:null,!0);var ePayload=angular.fromJson(ePayloadString),tempPayload=angular.copy(input);return(_.mergeWith||_.merge)(tempPayload,ePayload,VOUINS.mergeJSONLogic),input=tempPayload},$scope.restCallInvoke=function(payload,element,bBtn,fromIndex,scp,lastIndex,stage,operation,callback){if(element){var restType=element.propSetMap.type;void 0!==restType&&null!==restType||(restType="Apex");var input=payload;if(stage||!bBtn){var path=element.propSetMap.restPath,method=element.propSetMap.restMethod;switch(element.propSetMap.preTransformBundle||"Named Credential"===restType||"SOAP/XML"===restType||(input=$scope.getSendResponseJSON(input,element.propSetMap.sendJSONPath,element.propSetMap.sendJSONNode)),bBtn||(element.ui.preTransform=!1),$rootScope.loading=!0,$rootScope.loadingMessage="",bBtn||(element.ui.show=!0,element.ui.error=!1,element.ui.errorMessage=""),element&&($rootScope.loadingMessage=element.propSetMap.label),element.propSetMap.extraPayload&&Object.getOwnPropertyNames(element.propSetMap.extraPayload).length>0&&(input=$scope.handleExtraPayload(element.propSetMap.extraPayload,input,bBtn,element,scp)),path=scp&&scp.control&&void 0!==scp.control.blockIndex&&null!==scp.control.blockIndex?$scope.handleMergeField(path,!1,null,bBtn?element:null,null,scp.control.blockIndex):$scope.handleMergeField(path,!1,null,bBtn?element:null,null,scp?scp.editBlockIndex:null),restType){case"Apex":$scope.bpTree.filesMap&&(input.vlcFilesMap=VOUINS.getFilesMap($scope.bpTree.filesMap,$rootScope.isSforce,$rootScope.sforce));var configObj={path:path,input:input,method:method,label:{label:element&&element.name||!1}};bpService.OmniRestInvoke(configObj).then(function(data){if(element.propSetMap.postTransformBundle||(data=$scope.getSendResponseJSON(data,element.propSetMap.responseJSONPath,element.propSetMap.responseJSONNode)),data&&!element.propSetMap.postTransformBundle){if(angular.equals(operation,"typeAheadSearch")&&angular.isFunction(callback))return $rootScope.loading=!1,void callback(data);var bContinue=$scope.applyCallRespMain(angular.copy(data),element,null,scp);if(data.vlcValidationErrors&&!bContinue)return}$scope.handleRemoteCallSuccess(element,data,bBtn,!0,fromIndex,lastIndex,scp,null,operation,null,null,callback)},function(jqXHR){$scope.handleRemoteCallError(element,jqXHR.responseText,bBtn,!0,operation,callback)});break;case"Web":case"Named Credential":case"SOAP/XML":var headerObj={},paramObj={},eleCopy=angular.copy(element),cache=!(!element.propSetMap.restOptions||void 0===element.propSetMap.restOptions.cache||null===element.propSetMap.restOptions.cache)&&element.propSetMap.restOptions.cache;eleCopy.propSetMap.restOptions.cache=cache;var URIEncode=!(!element.propSetMap.restOptions||void 0===element.propSetMap.restOptions.URIEncode||null===element.propSetMap.restOptions.URIEncode)&&element.propSetMap.restOptions.URIEncode;eleCopy.propSetMap.restOptions.URIEncode=URIEncode;var timeout=element.propSetMap.restOptions&&void 0!==element.propSetMap.restOptions.timeout&&null!==element.propSetMap.restOptions.timeout?element.propSetMap.restOptions.timeout:null;eleCopy.propSetMap.restOptions.timeout=timeout;var withCredentials=!(!element.propSetMap.restOptions||void 0===element.propSetMap.restOptions.withCredentials||null===element.propSetMap.restOptions.withCredentials)&&element.propSetMap.restOptions.withCredentials;if(eleCopy.propSetMap.restOptions.withCredentials=withCredentials,responseType="json",element.propSetMap.restOptions&&element.propSetMap.restOptions.headers){var headerString=angular.toJson(element.propSetMap.restOptions.headers);headerString=scp&&scp.control&&void 0!==scp.control.blockIndex&&null!==scp.control.blockIndex?$scope.handleMergeField(headerString,!1,null,bBtn?element:null,null,scp.control.blockIndex,!0):$scope.handleMergeField(headerString,!1,null,bBtn?element:null,null,scp?scp.editBlockIndex:null,!0),headerObj=angular.fromJson(headerString),eleCopy.propSetMap.restOptions.headers=headerObj}if(element.propSetMap.restOptions&&element.propSetMap.restOptions.params){var paramString=angular.toJson(element.propSetMap.restOptions.params);if(paramString=scp&&scp.control&&void 0!==scp.control.blockIndex&&null!==scp.control.blockIndex?$scope.handleMergeField(paramString,!1,null,bBtn?element:null,null,scp.control.blockIndex,!0):$scope.handleMergeField(paramString,!1,null,bBtn?element:null,null,scp?scp.editBlockIndex:null,!0),paramObj=angular.fromJson(paramString),URIEncode)for(var key in paramObj)paramObj.hasOwnProperty(key)&&(paramObj[key]=encodeURI(paramObj[key]));eleCopy.propSetMap.restOptions.params=paramObj}if(URIEncode&&(path=encodeURI(path)),eleCopy.propSetMap.restPath=path,input=element.propSetMap.restOptions.sendBody?input:null,"Web"===restType){var req={method:method,url:path,headers:headerObj,data:input,params:paramObj,cache:cache,timeout:timeout,withCredentials:withCredentials,responseType:responseType,label:element&&element.name||"WebElement"};$http(req).then(function(data){if(element.propSetMap.postTransformBundle||(data=$scope.getSendResponseJSON(data,element.propSetMap.responseJSONPath,element.propSetMap.responseJSONNode)),data&&!element.propSetMap.postTransformBundle){if(angular.equals(operation,"typeAheadSearch")&&angular.isFunction(callback))return $rootScope.loading=!1,void callback(data);var bContinue=$scope.applyCallRespMain(angular.copy(data),element,null,scp);if(data.vlcValidationErrors&&!bContinue)return}$scope.handleRemoteCallSuccess(element,data,bBtn,!0,fromIndex,lastIndex,scp,null,operation,null,null,callback)},function(error){var errMsg=customLabels.OmniScriptWebCalloutFailed+"\nStatus Code - "+error.status+"\nStatus -"+error.statusText+"\n";errMsg+="Response - "+angular.toJson(error.data)+".",$scope.handleRemoteCallError(element,errMsg,bBtn,!1,operation,callback)})}else{var ele=angular.copy(eleCopy);ele.type="Remote Action",delete ele.propSetMap.extraPayload,ele.propSetMap.remoteClass=bpService.sNSC+"DefaultOmniScriptNamedCredentialCallout",ele.propSetMap.remoteOptions={},ele.propSetMap.remoteOptions.restOptions=eleCopy.propSetMap.restOptions,ele.propSetMap.remoteOptions.restOptions.restPath=eleCopy.propSetMap.restPath,ele.propSetMap.remoteOptions.restOptions.namedCredential=eleCopy.propSetMap.namedCredential,ele.propSetMap.remoteOptions.restOptions.restMethod=eleCopy.propSetMap.restMethod,ele.propSetMap.remoteOptions.restOptions.xmlPreTransformBundle=eleCopy.propSetMap.xmlPreTransformBundle,ele.propSetMap.remoteOptions.restOptions.xmlPostTransformBundle=eleCopy.propSetMap.xmlPostTransformBundle,ele.propSetMap.remoteMethod="NCCallout","SOAP/XML"!==restType&&delete ele.propSetMap.preTransformBundle,$scope.remoteCallInvoke(input,ele,bBtn,fromIndex,scp,null,operation,null,lastIndex,"Middle",null,callback)}}}else $scope.remoteCallRepeater(element,scp,input,stage,null,operation,null,null,callback)}},$scope.objectPostInvoke=function(payload,element,bBtn,fromIndex,scp,lastIndex){if(payload){var path=element.propSetMap.restPath,restMethod=element.propSetMap.restMethod,remoteClass="DefaultOmniScriptApplicationService"==element.propSetMap.remoteClass?bpService.sNSC+element.propSetMap.remoteClass:element.propSetMap.remoteClass,useRest=element.propSetMap.useRest,remoteMethod=element.propSetMap.remoteMethod,configObj={},bClearLabelKeyMap=!1;(useRest&&path&&path.indexOf("/v1/application/")>=0||!useRest&&remoteClass&&remoteClass.indexOf("DefaultOmniScriptApplicationService")>=0)&&(bClearLabelKeyMap=!0);var input=angular.copy(payload);element.propSetMap.postNameTemplate&&!input.bpApplicationName&&(input.bpApplicationName=$scope.handleMergeField(element.propSetMap.postNameTemplate,!1,null,bBtn?element:null)),input.response||(input.response={});var sendPayload={};sendPayload.filesMap=angular.toJson(VOUINS.getFilesMap(input.filesMap,$rootScope.isSforce,$rootScope.sforce));var tempPayload=angular.copy(input);$scope.prepBeforeSubmit(tempPayload,!0,bClearLabelKeyMap),sendPayload.fullJSON=angular.toJson(tempPayload);var iTimeout=element.propSetMap.remoteTimeout||3e4;$rootScope.loading=!0,$rootScope.loadingMessage="",bBtn||(element.ui.show=!0,element.ui.error=!1,element.ui.errorMessage=""),element&&($rootScope.loadingMessage=element.propSetMap.label);var option={};option.useQueueableApexRemoting=!0===element.propSetMap.useQueueableApexRemoting,!1!==useRest?(configObj={path:path,input:sendPayload,method:restMethod,label:{label:element&&element.name||!1}},bpService.OmniRestInvoke(configObj).then(invokeResolve,invokeReject)):(configObj={sClassName:remoteClass,sMethodName:remoteMethod,input:angular.toJson(sendPayload),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name}},bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);remoteResp&&"OK"===remoteResp.error&&remoteResp.PTsOBJresp?invokeResolve(angular.fromJson(remoteResp.PTsOBJresp)):invokeReject({responseText:remoteResp.error})},function(error){$scope.handleRemoteCallError(element,error,bBtn,!1)}))}function invokeResolve(data){if(element.propSetMap.postTransformBundle||(data=$scope.getSendResponseJSON(data,element.propSetMap.responseJSONPath,element.propSetMap.responseJSONNode)),data&&element&&!element.propSetMap.postTransformBundle){var bContinue=$scope.applyCallRespMain(angular.copy(data),element);if(data.vlcValidationErrors&&!bContinue)return}delete element.propSetMap.retrialNum,$scope.handleRemoteCallSuccess(element,data,bBtn,!0,fromIndex,lastIndex,scp)}function invokeReject(jqXHR){element.propSetMap.retrial&&element.propSetMap.retrial.constructor===Number&&element.propSetMap.retrial>0?(element.propSetMap.retrialNum||(element.propSetMap.retrialNum=0),element.propSetMap.retrialNum++,element.propSetMap.retrialNum<=element.propSetMap.retrial?bBtn?$scope.remoteCallRepeater(element,scp,payload):$scope.nextRepeater(fromIndex,lastIndex,payload):(delete element.propSetMap.retrialNum,$scope.handleRemoteCallError(element,jqXHR.responseText,bBtn,!0))):$scope.handleRemoteCallError(element,jqXHR.responseText,bBtn,!0)}},$scope.getArticleBody=function(element,article,openInModal){if(!0!==$scope.bpTree.propSetMap.enableKnowledge)return!0;if(element&&"Step"===element.type){var iTimeout,sClassName=bpService.sNSC+"DefaultKnowledgeOmniScriptIntegration",stepOption=angular.copy(element.propSetMap.knowledgeOptions);void 0!==stepOption&&null!==stepOption||(stepOption={}),iTimeout=stepOption.remoteTimeout;var option={};option.aType=article.articleType,option.articleId=article.articleId,option.useQueueableApexRemoting=!0===element.propSetMap.useQueueableApexRemoting;var searchFlds=$scope.bpTree.propSetMap.knowledgeArticleTypeQueryFieldsMap;searchFlds&&(option.bodyFields=searchFlds[option.aType]),!0===$scope.bpTree.propSetMap.bLK&&(option.aType=$scope.bpTree.propSetMap.lkObjName);var configObj={sClassName:sClassName,sMethodName:"getArticleBody",input:angular.toJson({}),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name}};bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);if(remoteResp&&"OK"!==remoteResp.error);else if(remoteResp&&remoteResp.vlcArticleBody){for(var Body="",i=0;i<remoteResp.vlcArticleBody.length;i++)for(var key in remoteResp.vlcArticleBody[i])remoteResp.vlcArticleBody[i].hasOwnProperty(key)&&(0!==i&&(Body+="lightning"===bpService.layout?"<br/><hr/>":"<br/>"),Body+=remoteResp.vlcArticleBody[i][key]);if(openInModal){var modalContent={};modalContent.articleBody=$sce.trustAsHtml(Body),modalContent.articleTitle=article.title,modalContent.articleLink="/articles/"+article.aType+"/"+article.urlName,$scope.openKnowledgeModal(modalContent)}else element.articleBody=$sce.trustAsHtml(Body),element.articleTitle=article.title,element.articleLink="/articles/"+article.aType+"/"+article.urlName}},function(error){})}return!0},$scope.closeArticle=function(step){step.articleBody="",step.articleTitle="",step.articleLink=""},$scope.searchKnowledgeArticle=function(element,bUserInput,bRefresh){if(!0===$scope.bpTree.propSetMap.enableKnowledge&&element&&"Step"===element.type){var option=angular.copy(element.propSetMap.knowledgeOptions);void 0!==option&&null!==option||(option={});var iTimeout=option.remoteTimeout,elementKeyword=element.knowledgeKeyword,optionKeyword=option.keyword;optionKeyword&&(optionKeyword=$scope.handleMergeField(optionKeyword));var keyword="";if(bUserInput?(element.userKWKeyword=elementKeyword,keyword=elementKeyword):(element.userKWKeyword&&(keyword+=element.userKWKeyword+" "),keyword+=optionKeyword),bpService.stepKnowledgeKWMap[element.name]===keyword&&!0!==bRefresh)return;element.knowledgeKeyword=keyword;var sClassName=bpService.sNSC+"DefaultKnowledgeOmniScriptIntegration";option.keyword=keyword,!0===$scope.bpTree.propSetMap.bLK&&(option.lkObj=$scope.bpTree.propSetMap.lkObjName);bpService.stepKnowledgeKWMap[element.name]=keyword;var configObj={sClassName:sClassName,sMethodName:"searchArticle",input:angular.toJson({}),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name}};bpService.OmniRemoteInvoke(configObj).then(function(result){var remoteResp=angular.fromJson(result);if(remoteResp&&"OK"!==remoteResp.error);else if(remoteResp){$scope.applyCallRespMain(angular.copy(remoteResp),null,!0);"newport"===bpService.layout&&remoteResp&&remoteResp.vlcKnowledge&&remoteResp.vlcKnowledge.knowledgeItems&&angular.isArray(remoteResp.vlcKnowledge.knowledgeItems)&&remoteResp.vlcKnowledge.knowledgeItems.length>0&&($scope.knowledge.isToggled=!0)}},function(error){})}},$scope.remoteCallInvoke=function(payload,element,bBtn,fromIndex,scp,selectedItem,operation,customizer,lastIndex,stage,pcIndex,callback){var sClassName,sMethodName,iTimeout,option,input=payload;if(["Remote Action","Integration Procedure Action"].includes(element.type)||($rootScope.loading=!0),stage||!bBtn){var restOptions;element?(sClassName=element.propSetMap.remoteClass,sMethodName=element.propSetMap.remoteMethod,iTimeout=element.propSetMap.remoteTimeout,option=element.propSetMap.remoteOptions,bBtn||"Step"===element.type||(element.ui.preTransform=!1),element.propSetMap.preTransformBundle||element.propSetMap.transformBundle||(input=$scope.getSendResponseJSON(input,element.propSetMap.sendJSONPath,element.propSetMap.sendJSONNode)),"Integration Procedure Action"===element.type&&(sClassName=bpService.sNSC+"IntegrationProcedureService",sMethodName=element.propSetMap.integrationProcedureKey,null==option&&(option={}),option.useContinuation=element.propSetMap.useContinuation)):$scope.bpTree.propSetMap.persistentComponent&&void 0!==pcIndex&&null!==pcIndex&&(sClassName=$scope.bpTree.propSetMap.persistentComponent[pcIndex].remoteClass,sMethodName=$scope.bpTree.propSetMap.persistentComponent[pcIndex].remoteMethod,iTimeout=$scope.bpTree.propSetMap.persistentComponent[pcIndex].remoteTimeout,option=$scope.bpTree.propSetMap.persistentComponent[pcIndex].remoteOptions,$scope.bpTree.propSetMap.persistentComponent[pcIndex].preTransformBundle||(input=$scope.getSendResponseJSON(input,$scope.bpTree.propSetMap.persistentComponent[pcIndex].sendJSONPath,$scope.bpTree.propSetMap.persistentComponent[pcIndex].sendJSONNode))),void 0!==option&&null!==option||(option={}),element&&(bpService.placeholderEleTypeList.indexOf(element.type)>=0&&(option.vlcJSONNode=element.name,element.JSONPath&&(option.jsonPath=element.JSONPath)),"Filter Block"===element.type&&(option.vlcFilters=element.vlcJSONPath)),selectedItem&&element?("Selectable Items"===element.type&&(option.vlcSelectedItem=selectedItem),"Input Block"===element.type&&(option.vlcInputBlock=selectedItem)):selectedItem&&(option.vlcSelectedItem=selectedItem),operation&&(option.vlcOperation=operation),!bBtn&&element&&"Step"!==element.type&&(element.ui.show=!0,element.ui.error=!1,element.ui.errorMessage=""),option.vlcClass=sClassName,!element||"Named Credential"!==element.propSetMap.type&&"SOAP/XML"!==element.propSetMap.type||(restOptions=void 0===option.restOptions?null:angular.copy(option.restOptions),delete option.restOptions);var optionString=angular.toJson(option);optionString=scp&&scp.control&&void 0!==scp.control.blockIndex&&null!==scp.control.blockIndex?$scope.handleMergeField(optionString,!1,null,bBtn?element:null,null,scp.control.blockIndex,!0):$scope.handleMergeField(optionString,!1,null,bBtn?element:null,null,scp?scp.editBlockIndex:null,!0),option=angular.fromJson(optionString),restOptions&&element&&("Named Credential"===element.propSetMap.type||"SOAP/XML"===element.propSetMap.type)&&(option.restOptions=restOptions),$scope.bpTree.filesMap&&(option.vlcFilesMap=VOUINS.getFilesMap($scope.bpTree.filesMap,$rootScope.isSforce,$rootScope.sforce)),element&&element.propSetMap.extraPayload&&Object.getOwnPropertyNames(element.propSetMap.extraPayload).length>0&&(input=$scope.handleExtraPayload(element.propSetMap.extraPayload,input,bBtn,element,scp));var dLabel=null!==pcIndex&&pcIndex>=0&&$scope.bpTree.propSetMap.persistentComponent&&$scope.bpTree.propSetMap.persistentComponent[pcIndex].id;!function bpServiceFunction(configObj){bpService.OmniRemoteInvoke(configObj,scp,element,$scope).then(function(result){var remoteResp=angular.fromJson(result);if(checkRemoteCallError(remoteResp))customizer&&customizer.constructor===Function&&customizer(operation,selectedItem,!1,element,pcIndex,scp),$scope.handleRemoteCallError(element,remoteResp.error,bBtn,!1,operation,callback);else{if(element&&("Named Credential"===element.propSetMap.type||"SOAP/XML"===element.propSetMap.type)){remoteResp=remoteResp.NCCallresp;try{remoteResp&&(remoteResp=angular.fromJson(remoteResp))}catch(e){return void $scope.handleRemoteCallError(element,customLabels.OmniDesInvalidJson,bBtn,!1)}"SOAP/XML"===element.propSetMap.type&&delete element.propSetMap.postTransformBundle}if(element&&"Integration Procedure Action"===element.type&&remoteResp.IPResult&&(remoteResp=remoteResp.IPResult).hasOwnProperty("vlcIPData")&&remoteResp.hasOwnProperty("vlcStatus")&&"InProgress"===remoteResp.vlcStatus){if($rootScope.loading=!0,$rootScope.loadingMessage={actionMessage:remoteResp.vlcMessage},configObj.options=angular.toJson(remoteResp),configObj.input="{}",!remoteResp.hasOwnProperty("vlcAsync"))return bpServiceFunction(configObj);setTimeout(function(){return bpServiceFunction(configObj)},5e3)}if(element&&!element.propSetMap.postTransformBundle&&(remoteResp=$scope.getSendResponseJSON(remoteResp,element.propSetMap.responseJSONPath,element.propSetMap.responseJSONNode)),element||!$scope.bpTree.propSetMap.persistentComponent||void 0===pcIndex||null===pcIndex||$scope.bpTree.propSetMap.persistentComponent[pcIndex].postTransformBundle||(remoteResp=$scope.getSendResponseJSON(remoteResp,$scope.bpTree.propSetMap.persistentComponent[pcIndex].responseJSONPath,$scope.bpTree.propSetMap.persistentComponent[pcIndex].responseJSONNode)),remoteResp&&(element&&!element.propSetMap.postTransformBundle||!element&&$scope.bpTree.propSetMap.persistentComponent&&void 0!==pcIndex&&null!==pcIndex&&!$scope.bpTree.propSetMap.persistentComponent[pcIndex].postTransformBundle)){if(angular.equals(operation,"typeAheadSearch")&&angular.isFunction(callback))return $rootScope.loading=!1,void callback(remoteResp);angular.equals(operation,"emailAction")&&angular.isFunction(callback)&&callback(remoteResp);var validationResp=remoteResp.vlcValidationErrors,bValidationError=!!(validationResp&&validationResp.constructor===Object&&Object.getOwnPropertyNames(validationResp).length>0);customizer&&customizer.constructor===Function&&customizer(operation,selectedItem,!bValidationError,element,pcIndex,scp);var bContinue=$scope.applyCallRespMain(angular.copy(remoteResp),element,null,scp);if(bValidationError&&!bContinue)return}$scope.handleRemoteCallSuccess(element,remoteResp,bBtn,!0,fromIndex,lastIndex,scp,selectedItem,operation,customizer,pcIndex,callback)}},function(error){customizer&&customizer.constructor===Function&&customizer(operation,selectedItem,!1,element,pcIndex,scp),$scope.handleRemoteCallError(element,error,bBtn,!1,operation,callback)})}({sClassName:sClassName,sMethodName:sMethodName,input:angular.toJson(input),options:angular.toJson(option),iTimeout:iTimeout,label:{label:element&&element.name||dLabel}})}else $scope.remoteCallRepeater(element,scp,input,stage,selectedItem,operation,customizer,pcIndex,callback)},$scope.applyCallRespMain=function(respToApply,element,bKnowledgePC,scp){var editBlockElementIndex=scp?scp.editBlockIndex:null,remoteResp=null;void 0!==editBlockElementIndex&&null!==editBlockElementIndex&&((remoteResp={})[scp.control?scp.control.name:scp.editBlockName]=respToApply);null===remoteResp&&(remoteResp=respToApply);var bContinue=!0;$scope.invalidStepIndex=null;var validationResp=remoteResp.vlcValidationErrors;if(validationResp&&!(validationResp.constructor===Object&&Object.getOwnPropertyNames(validationResp).length<=0)||element&&"DataRaptor Post Action"===element.type){if($scope.applyCallResp(remoteResp.vlcValidationErrors,!0,element,editBlockElementIndex),$rootScope.loading=!1,void 0!==$scope.invalidStepIndex&&null!==$scope.invalidStepIndex){var currentIndex,activeStepIndex,ind=$scope.invalidStepIndex;void 0!==$scope.bpTree.asIndex&&null!==$scope.bpTree.asIndex?(currentIndex=$scope.bpTree.asIndex,activeStepIndex=$scope.bpTree.asIndex):element&&0===element.level&&"Step"!==element.type&&(currentIndex=element.indexInParent),void 0!==currentIndex&&null!==currentIndex&&($scope.bpTree.propSetMap.timeTracking&&$scope.calcStepActionTiming($scope.bpTree.children[currentIndex],!1),ind<=currentIndex?(void 0!==activeStepIndex&&null!==activeStepIndex&&$scope.setStepStatus($scope.bpTree.children[activeStepIndex],!1,!0,!0,null,null),$scope.activateStep($scope.bpTree.children[ind],!0,null),$scope.bpTree.asIndex=ind,$window.alert(new Error(customLabels.OmniStepValidationError)),bContinue=!1):$window.alert(new Error(customLabels.OmniStepValidationError)))}}else element&&"Step"===element.type&&bpService.resumeMode||$scope.applyCallResp(remoteResp,!1,bKnowledgePC,element,editBlockElementIndex);return bContinue},$scope.applyCallResp=function(resp,bValidation,bKnowledge,element,editBlockElementIndex){base_applyCallResp(resp,bValidation,bKnowledge,element,editBlockElementIndex),bKnowledge||!0!==$scope.bpTree.propSetMap.enableKnowledge||void 0===$scope.bpTree.asIndex||null===$scope.bpTree.asIndex||$scope.searchKnowledgeArticle($scope.bpTree.children[$scope.bpTree.asIndex],!1,!0)},$scope.checkFldError=function(error){var trueKeyArray=[];for(var key in error)error.hasOwnProperty(key)&&!0===error[key]&&trueKeyArray.push(key);return 1===trueKeyArray.length&&("required"===trueKeyArray[0]||"vlcsrverror"===trueKeyArray[0])},$scope.ngInitValidation=function(scp,control){try{var bCalledAggregate=!1;bpService.pfJSONFill&&Object.getOwnPropertyNames(bpService.pfJSONFill).length>0&&bpService.pfJSONFill.hasOwnProperty(control.name)&&scp.loopform&&scp.loopform.$pristine&&scp.loopform.$invalid&&(control.response=null,"Checkbox"!==control.type&&"Disclosure"!==control.type||(control.response=!1),scp.aggregate(scp,control.index,control.indexInParent,!0,-1),bCalledAggregate=!0,delete bpService.pfJSONFill[control.name]);var key=control.name+control.$$hashKey;ouiBaseService.invokeResp&&Object.getOwnPropertyNames(ouiBaseService.invokeResp).length>0&&ouiBaseService.invokeResp.hasOwnProperty(key)&&scp.loopform&&scp.loopform.$invalid&&angular.equals(ouiBaseService.invokeResp[key],control.response)&&scp.loopform.loopname&&!$scope.checkFldError(scp.loopform.loopname.$error)&&!bCalledAggregate&&(control.response=null,scp.aggregate(scp,control.index,control.indexInParent,!0,-1),delete ouiBaseService.invokeResp[key]),"Multi-select"===control.type&&control.req&&scp.$parent.loopform.$setValidity("required",$scope.MultiSelectFilled(control)),"Radio Group"===control.type&&control.req&&scp.$parent.loopform.$setValidity("required",$scope.radioGroupFilled(control))}catch(err){console.log(err)}return!0},$scope.htmlEntities=function(str){return String(str).replace(/</g,"&lt;").replace(/>/g,"&gt;")},$scope.handleConditionData=function(data,mfMap){var fields;null!==data&&void 0!=data&&data.constructor===String&&(data.indexOf("%")>=0&&(fields=data.match(/%([^[%]+)%/g)),fields?(mfMap[data]=null,data="mergeField['"+data+"']"):("true"===data?data=!0:"false"===data&&(data=!1),null!==data&&void 0!==data&&data.constructor===String&&""!==data&&(data="'"+data+"'"),""===data&&(data=null)));return data},$scope.operatorMap={AND:"&&",OR:"||"},$scope.conditionMap={"=":"==","<>":"!=","<":"<","<=":"<=",">":">",">=":">="},$scope.computed=function(group){var result={expression:"",data:{},mergeField:{}};if(!group)return result;for(var dataMap={},mfMap={},str="(",i=0;i<group.rules.length;i++)if(i>0&&(str+=" "+$scope.operatorMap[group.operator]+" "),group.rules[i].group){var s=$scope.computed(group.rules[i].group);for(var key in str+=s.expression,s.data)s.data.hasOwnProperty(key)&&(dataMap[key]=s.data[key]);for(var key in s.mergeField)s.mergeField.hasOwnProperty(key)&&(mfMap[key]=s.mergeField[key]);s.repeat&&!result.repeat&&(result.repeat=!0)}else{var val=$scope.handleConditionData(group.rules[i].data,mfMap);dataMap[group.rules[i].field]=null,str+="data['"+group.rules[i].field+"'] "+$scope.conditionMap[group.rules[i].condition]+" "+val,VOUINS.isRepeatNotation(group.rules[i].field)&&(result.repeat=!0),!result.repeat&&VOUINS.isRepeatNotation(group.rules[i].data)&&(result.repeat=!0)}return result.expression=str+")",result.data=dataMap,result.mergeField=mfMap,result},$scope.refresh=function(control,bReturnVal){var formula=null;return void 0!==control.rootIndex&&null!==control.rootIndex&&control.rootIndex!==$scope.bpTree.asIndex?(void 0!==control.propSetMap.value&&null!==control.propSetMap.value&&control.propSetMap.value.constructor!==String||(control.propSetMap.value=bReturnVal?"":$sce.trustAsHtml("")),!bReturnVal||control.propSetMap.value):((control.propSetMap.text||control.propSetMap.label)&&(formula=control.propSetMap.text?control.propSetMap.text:control.propSetMap.label,null!==(formula=$scope.handleMergeField(formula,!1,null,control,!0))&&formula.constructor!==String&&(formula=""+formula),control.propSetMap.value=bReturnVal?formula:$sce.trustAsHtml(formula)),"Text Block"===control.type&&!0===control.propSetMap.dataJSON&&($scope.bpTree.response[control.name]=formula),!bReturnVal||formula)},$scope.compareWindowWidth=function(prop,returnVal,altVal){return $window.innerWidth<prop?returnVal:void 0!==altVal?altVal:null},$scope.selectTimezoneOffset=function(timezone){switch(timezone){case"User":return-1*$scope.bpTree.userTimeZone;case"Local":default:return(new Date).getTimezoneOffset()}},$scope.digestOnResize=function(){$window.addEventListener("resize",function(){$scope.$digest()})},$scope.getOptions=function(control,scp){var oldOptions=control.propSetMap.options;if(ouiBaseService.bPLSeeding&&$rootScope.VlocPicklistSeeding){var key="";"SObject"===control.propSetMap.controllingField.type?key=control.propSetMap.optionSource.source+"/"+control.propSetMap.controllingField.source:"Custom"===control.propSetMap.controllingField.type?key=control.propSetMap.controllingField.element+"/"+control.propSetMap.controllingField.source:"SObject"!==control.propSetMap.optionSource.type&&"Custom"!==control.propSetMap.optionSource.type||(key=control.propSetMap.optionSource.source),"Multi-select"===control.type&&key&&$rootScope.VlocPicklistSeeding[key]&&void 0===$rootScope.VlocPicklistSeeding[control.name+":"+control.$$hashKey+":"+key]&&($rootScope.VlocPicklistSeeding[control.name+":"+control.$$hashKey+":"+key]=angular.copy($rootScope.VlocPicklistSeeding[key]));var plKey="Multi-select"===control.type?control.name+":"+control.$$hashKey+":"+key:key;"SObject"===control.propSetMap.controllingField.type?control.propSetMap.dependency=$rootScope.VlocPicklistSeeding[plKey]:"Custom"===control.propSetMap.controllingField.type?control.propSetMap.dependency=$rootScope.VlocPicklistSeeding[plKey]:"SObject"!==control.propSetMap.optionSource.type&&"Custom"!==control.propSetMap.optionSource.type||VOUINS.resetOptions(control,$rootScope.VlocPicklistSeeding[plKey])}var newOptions=control.propSetMap.options,options=[];if(control.propSetMap.dependency){var eleName=control.propSetMap.controllingField.element;if(VOUINS.isRepeatNotation(eleName)){var blkIndex=$scope.findParentBlockIndex(scp.$parent);angular.equals(blkIndex,NaN)||(eleName=$scope.replaceNIndex(eleName,blkIndex+1))}var elemValue=$scope.getElementValue(eleName);options=control.propSetMap.dependency[elemValue]?control.propSetMap.dependency[elemValue]:[],newOptions=control.propSetMap.options=options}else;if(control.propSetMap.dependency||ouiBaseService.bPLSeeding&&$rootScope.VlocPicklistSeeding)if(angular.equals(oldOptions,newOptions))"Multi-select"===control.type&&checkAgainstOptions(control.response,newOptions,control.type);else if(null!==control.response&&void 0!==control.response){var checkResult=checkAgainstOptions(control.response,newOptions,control.type);if(checkResult.valid)"Select"===control.type?control.response=newOptions[checkResult.index]:"Radio"===control.type?control.response=newOptions[checkResult.index].name:"Multi-select"===control.type&&(control.response=checkResult.resp);else{control.response=null;for(var i=0;i<newOptions.length;i++)delete newOptions[i].selected}scp.aggregate(scp,control.index,control.indexInParent,!0,-1)}return newOptions},$scope.findParentBlockIndex=function(scp){return scp&&scp.$parent&&scp.$parent.control&&bpService.blockEleTypeList.indexOf(scp.$parent.control.type)>=0?$scope.findRepeatIndex(scp.$parent.control):NaN},$scope.findSibling=function(scp,control){return scp&&scp.child&&scp.child.eleArray?scp.child.eleArray:null},$scope.evalCondition=function(control,type,scp){var storedExpr="show"===type?bpService.showExprData:bpService.validateExprData,ctrlShowCondition="show"===type?control.propSetMap.show:control.propSetMap.validateExpression;if(null===ctrlShowCondition)return!0;var index=NaN,result=!1,ctrlShowExprData={};storedExpr.hasOwnProperty(control.name)?ctrlShowExprData=storedExpr[control.name]:(ctrlShowExprData=$scope.computed(ctrlShowCondition.group),("show"===type&&(0===control.level&&!0===control.bInit||0!==control.level)||"show"!==type)&&(storedExpr[control.name]=ctrlShowExprData));var ctrlShowExpression=ctrlShowExprData.expression;ctrlShowExprData.repeat&&(index="show"!==type?$scope.findRepeatIndex(control):$scope.findParentBlockIndex(scp));var data=angular.copy(ctrlShowExprData.data);for(var key in data)if(data.hasOwnProperty(key)){var eleName=key;!angular.equals(index,NaN)&&VOUINS.isRepeatNotation(key)&&(eleName=$scope.replaceNIndex(key,index+1)),data[key]=$scope.getElementValue(eleName),"ContextId"===key&&""===data[key]&&(data[key]=null)}var mergeField=angular.copy(ctrlShowExprData.mergeField);for(var key in mergeField)mergeField.hasOwnProperty(key)&&(mergeField[key]=$scope.handleMergeField(key,!1,index,null),""===mergeField[key]&&(mergeField[key]=null));return"()"!==ctrlShowExpression&&""!=ctrlShowExpression&&(result=eval(ctrlShowExpression)),result},$scope.cascadeReadonly=function(control,result){var cType=control.type;switch(control.ro=!result,"Filter"===control.type&&(cType+=" "+control.propSetMap.type),cType){case"Checkbox":case"Currency":case"Date":case"Date/Time (Local)":case"Disclosure":case"Email":case"Lookup":case"Multi-select":case"Number":case"Password":case"Radio":case"Radio Group":case"Range":case"Select":case"Signature":case"Telephone":case"Text":case"Text Area":case"Time":case"URL":case"Type Ahead":control.ro=!1===result||control.propSetMap.readOnly;break;case"Step":case"Block":case"Type Ahead Block":case"Edit Block":if("Edit Block"===cType&&control.childrenC)for(var i=0;i<control.childrenC.length;i++)for(var j=0;j<control.childrenC[i].eleArray.length;j++)$scope.cascadeReadonly(control.childrenC[i].eleArray[j],result);for(i=0;i<control.children.length;i++)for(j=0;j<control.children[i].eleArray.length;j++)$scope.cascadeReadonly(control.children[i].eleArray[j],result)}},$scope.cascadeRequired=function(control,result){var cType=control.type;switch(control.req=result,"Filter"===control.type&&(cType+=" "+control.propSetMap.type),cType){case"Checkbox":case"Currency":case"Date":case"Date/Time (Local)":case"Disclosure":case"Email":case"Lookup":case"Multi-select":case"Number":case"Password":case"Radio":case"Radio Group":case"Range":case"Select":case"Signature":case"Telephone":case"Text":case"Text Area":case"Time":case"URL":case"Type Ahead":!1===result&&!0===control.propSetMap.required?control.req=!1:control.req=control.propSetMap.required;break;case"Step":case"Block":case"Type Ahead Block":case"Edit Block":if("Edit Block"===cType&&control.childrenC)for(var i=0;i<control.childrenC.length;i++)for(var j=0;j<control.childrenC[i].eleArray.length;j++)$scope.cascadeRequired(control.childrenC[i].eleArray[j],result);for(i=0;i<control.children.length;i++)for(j=0;j<control.children[i].eleArray.length;j++)$scope.cascadeRequired(control.children[i].eleArray[j],result)}},$scope.getNewValue=function(conditionType,control,result){var newVal=null;if("Hide if False"===conditionType)return result;switch(control.type){case"Checkbox":case"Currency":case"Date":case"Date/Time (Local)":case"Disclosure":case"Email":case"Lookup":case"Multi-select":case"Number":case"Password":case"Radio":case"Radio Group":case"Range":case"Select":case"Signature":case"Text":case"Text Area":case"Time":case"URL":"Optional if False"===conditionType?newVal=(!1!==result||!0!==control.propSetMap.required)&&control.propSetMap.required:"Readonly if False"===conditionType&&(newVal=!result||control.propSetMap.readOnly);break;case"Step":case"Block":case"Type Ahead Block":case"Edit Block":newVal="Optional if False"===conditionType?result:!result}return newVal},$scope.evaluateShow=function(control,scp){if(void 0===$scope.activeIndex||null===$scope.activeIndex)return!1;if(!control.propSetMap.show)return!0;var conditionType=control.propSetMap.conditionType;if(conditionType||(conditionType="Hide if False"),0!==control.level&&void 0===control.rootIndex||0!==control.level&&void 0!==control.rootIndex&&control.rootIndex===$scope.bpTree.asIndex||0===control.level&&control.indexInParent>=$scope.activeIndex&&!bpService.sflMode||0===control.level&&bpService.sflMode){var result=!1;try{result=$scope.evalCondition(control,"show",scp)}catch(err){return console.log(err.message),!1}var oldVal=control.show;if("Readonly if False"===conditionType?oldVal=control.ro:"Optional if False"===conditionType&&(oldVal=control.req),oldVal===$scope.getNewValue(conditionType,control,result))return control.show;if(!0===control.propSetMap.repeat||"Edit Block"===control.type?siblings=$scope.findSibling(scp,control):siblings=[control],siblings){switch(conditionType){case"Readonly if False":for(var i=0;i<siblings.length;i++)$scope.cascadeReadonly(siblings[i],result);result=!0;break;case"Optional if False":for(i=0;i<siblings.length;i++)$scope.cascadeRequired(siblings[i],result);result=!0}for(i=0;i<siblings.length;i++)siblings[i].show=result}return"Hide if False"===conditionType&&0===control.level&&void 0!==$scope.bpTree.asIndex&&null!==$scope.bpTree.asIndex&&control.indexInParent>$scope.bpTree.asIndex&&$scope.adjustStepState($scope.bpTree.children[$scope.bpTree.asIndex],!1),result}return"Hide if False"!==conditionType||(0!==control.level&&void 0!==control.rootIndex&&control.rootIndex>$scope.activeIndex&&(!0===control.propSetMap.accessibleInFutureSteps&&void 0===control.show||control.propSetMap.forceAccessible)&&(control.show=!0),control.show)},$scope.configureItem=function(payload,control,scp,selectedItem,operation,customizer,modalCustomizer,pcIndex){var modalTmpl,modalController,modalSize,bOpenModal=!1;if(modalCustomizer&&modalCustomizer.constructor===Function&&(bOpenModal=modalCustomizer(selectedItem)),bOpenModal){if(control&&control.propSetMap.modalConfigurationSetting?(modalTmpl=control.propSetMap.modalConfigurationSetting.modalHTMLTemplateId,modalController=control.propSetMap.modalConfigurationSetting.modalController,modalSize=control.propSetMap.modalConfigurationSetting.modalSize):$scope.bpTree.propSetMap.persistentComponent&&$scope.bpTree.propSetMap.persistentComponent[pcIndex]&&$scope.bpTree.propSetMap.persistentComponent[pcIndex].modalConfigurationSetting&&(modalTmpl=$scope.bpTree.propSetMap.persistentComponent[pcIndex].modalConfigurationSetting.modalHTMLTemplateId,modalController=$scope.bpTree.propSetMap.persistentComponent[pcIndex].modalConfigurationSetting.modalController,modalSize=$scope.bpTree.propSetMap.persistentComponent[pcIndex].modalConfigurationSetting.modalSize),modalTmpl&&modalController&&modalSize){$rootScope.loading=!0;$modal.open({animation:!0,templateUrl:modalTmpl,controller:modalController,size:modalSize,scope:$scope,show:!0,resolve:{mSelectedItem:function(){return selectedItem},mScp:function(){return scp},mPayload:function(){return payload},mControl:function(){return control},mOperation:function(){return operation},mpcIndex:function(){return pcIndex}}})}}else operation&&$scope.buttonClick(payload,control,scp,selectedItem,operation,customizer)},$scope.updateStepPreRemoteActions=function(scp,element){var stepIndex=$scope.findStepIndex(scp,element.index,element.indexInParent);stepIndex>=0&&stepIndex<$scope.bpTree.children.length&&($scope.bpTree.children[stepIndex].preRemoteActions||($scope.bpTree.children[stepIndex].preRemoteActions=[]),element.propSetMap.preRemoteAction&&element.propSetMap.preRemoteAction.remoteClass&&element.propSetMap.preRemoteAction.remoteMethod&&($scope.bpTree.children[stepIndex].preRemoteActions=[],$scope.bpTree.children[stepIndex].preRemoteActions.add(element.preRemoteAction)))},$scope.buttonClick=function(payload,control,scp,selectedItem,operation,customizer,callback){var form=document.querySelector("form#"+scp.bpTree.sOmniScriptId+"-"+scp.activeIndex);if(form){var lastInput=form.querySelectorAll("input.ng-valid.ng-dirty"),lastTextArea=form.querySelectorAll("textarea.ng-valid.ng-dirty");if(lastInput&&lastInput.length>0)for(var i=0;i<lastInput.length;i++)lastInput[i].blur();if(lastTextArea&&lastTextArea.length>0)for(var j=0;j<lastTextArea.length;j++)lastTextArea[j].blur()}$timeout(function(){if(control){("Submit"!==control.propSetMap.validationRequired&&"Step"!==control.propSetMap.validationRequired||"Set Values"==control.type||"vlcEBOperation"===operation||!$scope.checkValidity(scp,control.index,control.indexInParent,control.propSetMap.validationRequired))&&("vlcEBOperation"===operation&&scp&&(void 0!==scp.editBlockIndex&&null!==scp.editBlockIndex||(scp.editBlockIndex=scp.$index)),"Remote Action"===control.type||"Filter Block"===control.type||bpService.placeholderEleTypeList.indexOf(control.type)>=0||"Calculation Action"===control.type||"Integration Procedure Action"===control.type?$scope.remoteCallInvoke(payload,control,!0,null,scp,selectedItem,operation,customizer,null,null,null,callback):"Rest Action"===control.type?$scope.restCallInvoke(payload,control,!0,null,scp,null,null,operation,callback):"DataRaptor Extract Action"===control.type?$scope.drExtractInvoke(control,!0,null,scp):"Post to Object Action"===control.type?$scope.objectPostInvoke($scope.bpTree,control,!0,null,scp):"DataRaptor Post Action"===control.type?$scope.drPostInvoke($scope.bpTree,control,!0,null,scp,null,operation,callback):"DataRaptor Transform Action"===control.type?$scope.drTransformActionInvoke($scope.bpTree,control,!0,null,scp):"Matrix Action"===control.type?$scope.matrixActionInvoke(control,!0,null,scp,null,operation,callback):"Delete Action"===control.type?$scope.deleteActionInvoke(control,!0,null,scp,null,operation,callback):"PDF Action"===control.type?$scope.pdfInvoke(payload,control,!0,null,scp,null):"Review Action"===control.type?$scope.reviewAction(control,!0,null,scp):"Done Action"===control.type?$scope.doneAction(control,!0,null,scp):"Set Values"===control.type||"Set Errors"===control.type?$scope.setValuesErrors(control,!0):"DocuSign Envelope Action"===control.type?$scope.sendDocuSigEnvelope(payload,control,!0,null,null,scp):"DocuSign Signature Action"===control.type?$scope.sendDocuSigEnvelope(payload,control,!0,null,null,scp,!0):"Email Action"===control.type&&$scope.sendEmail(payload,control,!0,null,null,scp))}})},$scope.pcAction=function(pcIndex,payload,scp,selectedItem,operation,customizer){$scope.remoteCallInvoke(payload,null,!0,null,scp,selectedItem,operation,customizer,null,null,pcIndex)},$scope.handleExpressionEngine=function(inputStr,bReplaceIndex,index,element){if(void 0===inputStr||null===inputStr)return"";void 0!==index&&null!==index||(index=NaN),VOUINS.isRepeatNotation(inputStr)&&element&&(index=$scope.findRepeatIndex(element));var expFields=inputStr.match(/"=(?:(?:\\")|[^"])*"/g),resultName=inputStr;if(expFields)for(var i=0;i<expFields.length;i++){expFields[i]=expFields[i].slice(1,expFields[i].length-1);var exp=expFields[i].slice(1);if(angular.equals(index,NaN)||console.log(""),!0!==bReplaceIndex){var expValue=null;try{expValue=vlocity.expressionEngine.evaluateExpression(exp.replace(/\\"/g,'"'),function(token){return $scope.getElementValue(token,!0)},!0),scope.isInvalid=!1}catch(e){console.log(e.message)}resultName=null===expValue||void 0===expValue?resultName.replace(expFields[i],""):resultName.replace('"'+expFields[i]+'"',angular.toJson(expValue))}else angular.equals(index,NaN)||console.log("dreplaceNIndex behavior is disabled on this function")}return resultName=null===resultName||void 0===resultName?"":resultName},$scope.setValuesErrors=function(element,bBtn){var bContinue=!0,valueMap={};element&&"Set Values"===element.type&&element.propSetMap.elementValueMap&&(valueMap=angular.copy(element.propSetMap.elementValueMap)),element&&"Set Errors"===element.type&&element.propSetMap.elementErrorMap&&(valueMap=angular.copy(element.propSetMap.elementErrorMap));var valueString=angular.toJson(valueMap);if(valueString=$scope.handleExpressionEngine(valueString,!1,null,bBtn?element:null),valueString=$scope.handleMergeField(valueString,!1,null,bBtn?element:null,null,null,!0),valueMap=angular.fromJson(valueString))if("Set Values"===element.type)$scope.applyCallRespMain(valueMap,element,!1);else if("Set Errors"===element.type){var resp={};resp.vlcValidationErrors=valueMap,bContinue=$scope.applyCallRespMain(resp,element,!1)}return $scope.handleMessaging(element,bBtn),bContinue},$scope.handleMessaging=function(element,bBtn){try{var msgMap={};if(element&&element.propSetMap.message&&(element.propSetMap.wpm||element.propSetMap.ssm)){var valueMap=angular.copy(element.propSetMap.message);"Done Action"!==element.type&&"Cancel Script"!==element.type||element.propSetMap.type&&(valueMap[element.propSetMap.type]=element.propSetMap.source),valueMap.Type=element.type;var valueString=angular.toJson(valueMap);valueString=$scope.handleMergeField(valueString,!1,null,bBtn?element:null,null,null,!0),valueMap=angular.fromJson(valueString),msgMap[$scope.bpTree.messagingKey]=valueMap,msgMap&&(element.propSetMap.wpm&&$window.parent.postMessage(msgMap,"*"),element.propSetMap.ssm&&$scope.setSessionStorageMessage(valueMap))}}catch(err){console.log(err.message)}},$scope.doneCancelAux=function(propSetMap,isCancel){var bRedirect=!1;if($window.removeEventListener("beforeunload",showUnloadMessage),bpService.bMobile)bRedirect=!0;else{var dest=propSetMap.source;dest=$scope.handleMergeField(dest),"Redirect"===propSetMap.type?bRedirect=!0:($scope.$root.locked=!0,bpService.isInConsole?sforce.console.getEnclosingTabId(function(result){var tabId=result.id;sforce.console.closeTab(tabId),"SObject"===propSetMap.type&&dest&&(dest="/"+dest),dest&&sforce.console.openPrimaryTab(null,dest,!0,propSetMap.consoleTabLabel?propSetMap.consoleTabLabel:"New")}):"parentIFrame"in window&&1==sfdcVars.urlParams.omniIframeEmbedded?isCancel&&"back"==sfdcVars.urlParams.omniCancelAction?parentIFrame.sendMessage({message:"omni:cancelGoBack"}):parentIFrame.sendMessage({message:"omni:doneCancelAux",type:propSetMap.type,destination:dest,additionalConfig:{action:propSetMap.action||{openUrlIn:"New Tab / Window"},actionConfig:propSetMap.actionConfig,openActionIn:propSetMap.openActionIn,openInPrimaryTab:!0===propSetMap.openInPrimaryTab,closeTab:propSetMap.closeTab||!0,consoleTabLabel:propSetMap.consoleTabLabel?propSetMap.consoleTabLabel:"New"}}):"undefined"!=typeof sforce&&null!==sforce&&void 0!==sforce.one&&null!==sforce.one?isCancel&&"back"==sfdcVars.urlParams.omniCancelAction?historyCount<window.history.length?window.history.go(historyCount-(window.history.length+1)):historyCount==window.history.length&&sforce.one.back():"SObject"===propSetMap.type?sforce.one.navigateToSObject(dest):"URL"===propSetMap.type&&sforce.one.navigateToURL(dest,!0):isCancel&&"back"==sfdcVars.urlParams.omniCancelAction?historyCount<window.history.length?window.history.go(historyCount-(window.history.length+1)):window.history.back():"SObject"===propSetMap.type?window.location="/"+dest:"URL"===propSetMap.type&&(window.location=dest))}if(bRedirect){var redirect=propSetMap.redirectPageName,redirectTemplateUrl=propSetMap.redirectTemplateUrl;redirect&&redirectTemplateUrl&&(redirectTemplateUrl=bpService.getHTMLTemplate(redirectTemplateUrl),bpService.redirectPageTemplateMap[redirect]=redirectTemplateUrl,bpService.restResponse[redirect]={},bpService.restResponse[redirect]=angular.copy($scope.bpTree),$location.path("/custom/"+redirect))}},$scope.doneAction=function(element,bBtn,fromIndex,scp){if(element&&$scope.bpTree.propSetMap.timeTracking){var outcome="Done";element.propSetMap.Outcome&&(outcome=$scope.handleMergeField(element.propSetMap.Outcome)),$scope.trackOutcome(element,outcome)}if(bpService.sflMode||!0===$scope.bpTree.propSetMap.autoSaveOnStepNext&&$scope.bpTree.sInstanceId){var doneConfig={element:element,bBtn:bBtn,fromIndex:fromIndex,scp:scp};$scope.completeScript(!1,doneConfig)}else $scope.doneActionAux(element,bBtn,fromIndex,scp)},$scope.doneActionAux=function(element,bBtn,fromIndex,scp){$window.parent.postMessage(JSON.stringify({name:element.name,type:element.type}),"*"),$scope.setSessionStorageMessage({name:element.name,type:element.type,messageType:"doneAction"}),$scope.handleMessaging(element,bBtn),$scope.doneCancelAux(element.propSetMap)},$scope.sidebarNav=function(step,dontPushState){if(0!==location.indexOf("/custom")){if(step){var currentStep,bCanNav=!1,currentStepIndex=$scope.bpTree.asIndex;if(void 0!==currentStepIndex&&null!==currentStepIndex)if(currentStep=$scope.bpTree.children[currentStepIndex],currentStepIndex>step.indexInParent)bCanNav=!0;else if(currentStepIndex<step.indexInParent)if(!1===currentStep.inValid){var bAction=!1,bStepError=!1;if(currentStep.propSetMap.remoteClass&&currentStep.propSetMap.remoteMethod)bAction=!0;else if(step.indexInParent>currentStep.indexInParent+1)for(var i=currentStep.indexInParent+1;i<step.indexInParent;i++){if("review"!==bpService.scriptState&&"Step"!==$scope.bpTree.children[i].type&&$scope.bpTree.children[i].show){bAction=!0;break}if("Step"===$scope.bpTree.children[i].type&&!0===$scope.bpTree.children[i].inValid){bStepError=!0;break}}bAction||bStepError?bAction?$window.alert(new Error(customLabels.OmniSideBarError1)):bStepError&&$window.alert(new Error(customLabels.OmniSideBarError4)):bCanNav=!0}else $window.alert(new Error(customLabels.OmniSideBarError2));bCanNav&&(currentStep&&$scope.setStepStatus(currentStep,!1,!0,!0,null,dontPushState),$scope.activateStep(step,!0,dontPushState),$scope.bpTree.asIndex=step.indexInParent,step.dirty=!0)}}else $window.alert(new Error(customLabels.OmniSideBarError3))},$scope.getStep=function(dest){var out=null,steps=$scope.bpTree.children;if("number"==typeof dest)out=$scope.bpTree.children[Math.trunc(Math.abs(dest))];else if(isNaN(Number(dest))){for(i=0;i<steps.length;i++)if(steps[i].name.toLowerCase()==dest.toLowerCase()){out=steps[i];break}}else out=$scope.bpTree.children[Math.trunc(Math.abs(Number(dest)))];return out},$scope.autoAdvance=function(dest){if(void 0==dest||null===dest)return!1;var el;(el=angular.element("section.animate-rev")).stop(!0),$timeout(function(){"next"==dest.toLowerCase()?(thisStep=$scope.bpTree.children[$scope.bpTree.asIndex],thisStep.bHasNext&&$scope.nextRepeater(thisStep.nextIndex,thisStep.indexInParent)):$scope.sidebarNav($scope.getStep(dest),!1),el.removeClass("animate-rev"),el.addClass("animate-if"),$rootScope.$emit("scroll")},0)},$scope.apexrest=function(payload,control){var path=control.propSetMap.restPath,method=control.propSetMap.restMethod;if(path&&method){payload.response||(payload.response={});var redirect=control.propSetMap.redirectPageName,redirectTemplateUrl=control.propSetMap.redirectTemplateUrl;if(redirect&&redirectTemplateUrl&&(redirectTemplateUrl=bpService.getHTMLTemplate(redirectTemplateUrl),bpService.redirectPageTemplateMap[redirect]=redirectTemplateUrl),sendPayload={},path.indexOf("/DataRaptor")>=0)sendPayload.objectList=angular.toJson(payload.response),sendPayload.bundleName=payload.RPBundle,sendPayload.filesMap=angular.toJson(VOUINS.getFilesMap(payload.filesMap,$rootScope.isSforce,$rootScope.sforce));else{sendPayload.filesMap=angular.toJson(VOUINS.getFilesMap(payload.filesMap,$rootScope.isSforce,$rootScope.sforce));var tempPayload=angular.copy(payload);$scope.prepBeforeSubmit(tempPayload,!0,path.indexOf("/v1/application/")>=0),sendPayload.fullJSON=angular.toJson(tempPayload)}$scope.previewMode&&$scope.addDebugLog("Calling Apex Rest",sendPayload),$rootScope.loading=!0,$rootScope.loadingMessage="";var configObj={path:path,input:sendPayload,method:method,label:{label:control&&control.name}};bpService.OmniRestInvoke(configObj).then(function(data){VOUINS.syncFileAttachmentData(data,!0,$rootScope,$q,$scope,$scope.bpTree.filesMap,bpService,$window).then(function(){$timeout(function(){$rootScope.loading=!1,console.log("SUCCESS"),$scope.previewMode&&$scope.addDebugLog("Apex Rest SUCCESS",data),redirect&&redirectTemplateUrl&&(data.CallSuccess=!0,bpService.restResponse[redirect]={},bpService.restResponse[redirect].bpTree=$scope.bpTree,bpService.restResponse[redirect].response=data,$location.path("/custom/"+redirect)),$scope.$apply()})})},function(jqXHR){$rootScope.loading=!1,$scope.previewMode&&$scope.addDebugLog("Apex Rest ERROR",jqXHR),redirect&&redirectTemplateUrl?(jqXHR.CallSuccess=!1,bpService.restResponse[redirect]={},bpService.restResponse[redirect].bpTree=$scope.bpTree,bpService.restResponse[redirect].response=jqXHR,$location.path("/custom/"+redirect)):jqXHR.responseText&&$window.alert(jqXHR.responseText),$scope.$apply()})}},$scope.redirect=function(redirect,element,bBtn){bBtn||void 0!==element.nextIndex&&null!==element.nextIndex||!$scope.bpTree.propSetMap.timeTracking||$scope.calcStepActionTiming(element,!1),$location.path(redirect)},$scope.performValidate=function(scp,control){if(void 0!==control.rootIndex&&null!==control.rootIndex&&control.rootIndex!==$scope.bpTree.asIndex)return!1;var oldVal=control.response;try{control.response=$scope.evalCondition(control,"validate",scp)}catch(err){console.log(err.message),control.response=!1}!0===control.response?scp.loopform.$setValidity("vlcValError",!0):!0===control.propSetMap.messages[1].active&&"Requirement"===control.propSetMap.messages[1].type&&scp.loopform.$setValidity("vlcValError",!1);for(var i=0;i<control.propSetMap.messages.length;i++)!0===control.propSetMap.messages[i].active&&control.response===control.propSetMap.messages[i].value&&(control.displayMsg=$scope.handleMergeField(control.propSetMap.messages[i].text,!1,!0,control));return angular.equals(control.response,oldVal)||$scope.aggregate(scp,control.index,control.indexInParent,!0,-1),!1},$scope.performCalculation=function(scp,control){if(void 0!==control.rootIndex&&null!==control.rootIndex&&control.rootIndex!==$scope.bpTree.asIndex)return!0;try{var currentVal,expression,expressionDups,dataType;if(currentVal=control.response,"RANDOM()",expressionDups=expression=control.expression?control.expression:control.propSetMap.expression,dataType=control.propSetMap.dataType,expression)switch(VOUINS.isRepeatNotation(expression)&&(expression=$scope.handleExpression(expression,control)),dataType){case"Number":case"Currency":expression="NUMBER("+expression+")";break;case"Date":expression="DATE("+expression+")";break;case"Boolean":expression="BOOLEAN("+expression+")";break;case"Text":expression="STRING("+expression+")"}if(-1!==expressionDups.search(/RANDOM\(\)/)){var newRandVal=vlocity.expressionEngine.evaluateExpression("RANDOM()",function(token){return $scope.getElementValue(token,!0)});expression=expressionDups.replace(/RANDOM\(\)/g,newRandVal),control.expression=expression}var newVal=vlocity.expressionEngine.evaluateExpression(expression,function(token){return $scope.getElementValue(token,!0)});angular.equals(newVal,currentVal)||(control.response=newVal,$scope.aggregate(scp,control.index,control.indexInParent,!0,-1))}catch(e){}return!0},$scope.handleExpression=function(expression,control){if(!control)return expression;var index=$scope.findRepeatIndex(control);return angular.equals(index,NaN)?void 0:$scope.handleMergeField(expression,!0,index)},$scope.showDebugTabs=!1,$scope.tabs=[{title:"Logs",page:"previewLogs.html"},{title:"Pre Fill",page:"previewDR.html"},{title:"Simulate",page:"previewSimulate.html"},{title:"Form State",page:"previewApplication.html"}],$scope.testJSON="",$scope.currentTab="previewLogs.html",$scope.onClickTab=function(tab,event){$scope.currentTab=tab.page,event.stopPropagation(),event.preventDefault()},$scope.isActiveTab=function(tabUrl){return tabUrl==$scope.currentTab},$rootScope.tabKey){var pendingTimeoutId=null,pendingInitialLoad=!0,pendingBpTreeIfNonExisting=null;$scope.$watch("bpTree.response",function(newValue,oldValue){$scope.bpTree&&(pendingTimeoutId&&$timeout.cancel(pendingTimeoutId),pendingTimeoutId=$timeout(function(){pendingInitialLoad?pendingBpTreeIfNonExisting=JSON.stringify($scope.bpTree.response,null,4):$scope.bpTree.responseAsText=JSON.stringify($scope.bpTree.response,null,4)},500))},!0)}if(sfdcVars.urlParams.omniIframeEmbedded&&sfdcVars.urlParams.vlcOmniEmbeddedInFlow)var inter=setInterval(function(){"parentIFrame"in window&&($scope.bpTree.response&&parentIFrame.sendMessage({message:"omni:sendResponseToFlow",omniScriptOutput:angular.toJson($scope.bpTree.response)}),$scope.$watch("bpTree.response",function(newValue,oldValue){"parentIFrame"in window&&$scope.bpTree&&parentIFrame.sendMessage({message:"omni:sendResponseToFlow",omniScriptOutput:angular.toJson($scope.bpTree.response)})},!0),clearInterval(inter))},1e3);$scope.addDebugLog=function(label,log){var debugLog={};debugLog.label=label,debugLog.log=log,$scope.debugInformation.push(debugLog)},$scope.getLocation=function(scp,control){control.response=null,control.center=null,navigator.geolocation?($rootScope.loading=!0,$rootScope.loadingMessage="",navigator.geolocation.getCurrentPosition(function(position){if($rootScope.loading=!1,position&&position.coords){control.response={},control.response[0]={lat:position.coords.latitude,lng:position.coords.longitude,message:"Current Location",focus:!1,draggable:!1},control.center={lat:position.coords.latitude,lng:position.coords.longitude,zoom:15}}scp.aggregate(scp,control.index,control.indexInParent,!0,-1),$scope.$apply()},function(error){$rootScope.loading=!1,$window.alert(error),$scope.$apply()},{timeout:1e4})):$window.alert(new Error(customLabels.OmniGeoError))},$scope.openModal=function(scp,control){var jsonContent=angular.copy(control.vlcSI),itemsKey=control.propSetMap.itemsKey;if(itemsKey||(itemsKey="recSet"),jsonContent&&jsonContent[itemsKey]&&angular.isArray(jsonContent[itemsKey])){for(var deleteIndex=[],i=0;i<jsonContent[itemsKey].length;i++)!0!==jsonContent[itemsKey][i].vlcCompSelected&&deleteIndex.push(i);for(var j=0;j<deleteIndex.length;j++)jsonContent[itemsKey].splice(deleteIndex[j]-j,1);jsonContent.currencyCode=$scope.bpTree.userCurrencyCode}var modalTmpl=control.propSetMap.modalHTMLTemplateId;modalTmpl||(modalTmpl="vlcModalContent.html"),modalTmpl=bpService.getHTMLTemplate(modalTmpl);var modalController=control.propSetMap.modalController;modalController||(modalController="ModalInstanceCtrl");var size=control.propSetMap.modalSize;$modal.open({animation:!0,templateUrl:modalTmpl,controller:modalController,size:size,scope:$scope,show:!0,resolve:{content:function(){return jsonContent}}})},$scope.openKnowledgeModal=function(step){var jsonContent=angular.copy(step);$modal.open({animation:!0,templateUrl:"vlcKnowledgeBody.html",controller:"ModalInstanceCtrl",size:"lg",scope:$scope,show:!0,resolve:{content:function(){return jsonContent}}})},$scope.onCompSelectItem=function(control){var maxSize=control.propSetMap.maxCompareSize;(void 0===maxSize||null===maxSize||maxSize.constructor!==Number||maxSize<=0)&&(maxSize=4);var itemsKey=control.propSetMap.itemsKey;if(itemsKey||(itemsKey="recSet"),control.vlcSI[itemsKey]&&angular.isArray(control.vlcSI[itemsKey])){for(var j=0,i=0;i<control.vlcSI[itemsKey].length;i++)!0===control.vlcSI[itemsKey][i].vlcCompSelected&&j++;control.compDisable=j>=maxSize}},$scope.setJSDataPreprocessor=function(element,JSFunc){JSFunc&&JSFunc.constructor===Function&&(bpService.placeholderEleTypeList.indexOf(element.type)>=0?ouiBaseService.dataPreprocessorMap[element.name]=JSFunc:ouiBaseService.dataPreprocessorMap[element.id]=JSFunc)},$scope.callBackNextStep=function(operation,selectedItem,bSuccess){bSuccess&&$scope.nextRepeater($scope.bpTree.children[$scope.bpTree.asIndex].nextIndex,$scope.bpTree.children[$scope.bpTree.asIndex].indexInParent)},$scope.findPreShowStep=function(eleIndex){var rootElements=$scope.bpTree.children;if(eleIndex>=1)for(var i=eleIndex-1;i>=0;i--)if("Step"===rootElements[i].type&&rootElements[i].show)return i;return null},$scope.sendDocuSigEnvelope=function(payload,control,isButton,i,fromIndex,scp,embedSignature){var transform,signerInfo,input=payload,docuSignInput={},signerListStr="",options={},promiseArray=[];if(control.propSetMap.remoteOptions={},control.propSetMap.remoteOptions.docuSignTemplatesGroup=[],embedSignature){if(control.propSetMap.docuSignTemplate&&""!==control.propSetMap.docuSignTemplate){if(control.propSetMap.docuSignTemplatesGroupSig=[],docuSignInput.docuSignTemplate=control.propSetMap.docuSignTemplate,signerListStr=angular.toJson(control.propSetMap.signerInformation),""==(signerInfo=angular.fromJson($scope.handleMergeField(signerListStr,!1,null,isButton?control:null,null,null,!0))).templateRole||""==signerInfo.signerEmail||""==signerInfo.signerName)return void $window.alert(customLabels.OmniDocuSignNoRecipients);docuSignInput.signerList=[],docuSignInput.signerList.push(signerInfo),docuSignInput.sendJSONPath=control.propSetMap.sendJSONPath,docuSignInput.sendJSONNode=control.propSetMap.sendJSONNode,docuSignInput.transformBundle=control.propSetMap.transformBundle,docuSignInput.includeToSend=!0,control.propSetMap.docuSignTemplatesGroupSig.push(docuSignInput)}else{signerListStr=angular.toJson(control.propSetMap.signerInformation),signerInfo=angular.fromJson($scope.handleMergeField(signerListStr,!1,null,isButton?control:null,null,null,!0));for(i=0;i<control.propSetMap.docuSignTemplatesGroupSig.length;i++){if(""==control.propSetMap.docuSignTemplatesGroupSig[i].templateRole||""==signerInfo.signerEmail||""==signerInfo.signerName)return void $window.alert(customLabels.OmniDocuSignNoRecipients);control.propSetMap.docuSignTemplatesGroupSig[i].signerList=[];var signerObj={};signerObj.signerEmail=signerInfo.signerEmail,signerObj.signerName=signerInfo.signerName,signerObj.templateRole=control.propSetMap.docuSignTemplatesGroupSig[i].templateRole,control.propSetMap.docuSignTemplatesGroupSig[i].signerList.push(signerObj)}}control.propSetMap.remoteOptions.signerInformation=signerInfo,control.propSetMap.remoteOptions.docuSignTemplatesGroup=control.propSetMap.docuSignTemplatesGroupSig}else if(control.propSetMap.docuSignTemplate&&""!==control.propSetMap.docuSignTemplate){if(control.propSetMap.docuSignTemplatesGroup=[],docuSignInput.docuSignTemplate=control.propSetMap.docuSignTemplate,signerListStr=angular.toJson(control.propSetMap.signerList),docuSignInput.signerList=angular.fromJson($scope.handleMergeField(signerListStr,!1,null,isButton?control:null,null,null,!0)),docuSignInput.sendJSONPath=control.propSetMap.sendJSONPath,docuSignInput.sendJSONNode=control.propSetMap.sendJSONNode,docuSignInput.transformBundle=control.propSetMap.transformBundle,docuSignInput.includeToSend=!0,!validateSigner(docuSignInput))return;control.propSetMap.docuSignTemplatesGroup.push(docuSignInput),control.propSetMap.remoteOptions.docuSignTemplatesGroup=control.propSetMap.docuSignTemplatesGroup}else for(i=0;i<control.propSetMap.docuSignTemplatesGroup.length;i++){signerListStr=angular.toJson(control.propSetMap.docuSignTemplatesGroup[i].signerList);var docuInp={};if(docuInp.signerList=angular.fromJson($scope.handleMergeField(signerListStr,!1,null,isButton?control:null,null,null,!0)),!validateSigner(docuInp))return;control.propSetMap.remoteOptions.docuSignTemplatesGroup[i]={},control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].docuSignTemplate=control.propSetMap.docuSignTemplatesGroup[i].docuSignTemplate,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].sendJSONPath=control.propSetMap.docuSignTemplatesGroup[i].sendJSONPath,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].sendJSONNode=control.propSetMap.docuSignTemplatesGroup[i].sendJSONNode,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].transformBundle=control.propSetMap.docuSignTemplatesGroup[i].transformBundle,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].includeToSend=control.propSetMap.docuSignTemplatesGroup[i].includeToSend,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].signerList=docuInp.signerList}function validateSigner(docuSignInput){for(var isValid=!0,i=0;i<docuSignInput.signerList.length||0===docuSignInput.signerList.length;i++)if(0===docuSignInput.signerList.length||""==docuSignInput.signerList[i].signerEmail||""==docuSignInput.signerList[i].signerName||""==docuSignInput.signerList[i].templateRole){isButton||(control.ui.show=!0),$scope.handleRemoteCallError(control,customLabels.OmniDocuSignNoRecipients,isButton,!1),isValid=!1;break}return isValid}control.propSetMap.emailSubject&&""!==control.propSetMap.emailSubject&&(control.propSetMap.remoteOptions.emailSubject=$scope.handleMergeField(control.propSetMap.emailSubject,!1,null,isButton?control:null)),control.propSetMap.emailBody&&""!==control.propSetMap.emailBody&&(control.propSetMap.remoteOptions.emailBody=$scope.handleMergeField(control.propSetMap.emailBody,!1,null,isButton?control:null)),control.propSetMap.remoteOptions.elementName=control.name,control.propSetMap.remoteClass=bpService.sNSC+"DefaultDocuSignOmniScriptIntegration",control.propSetMap.remoteMethod="sendEnvelope",options.dateFormat=control.propSetMap.dateFormat,options.dateTimeFormat=control.propSetMap.dateTimeFormat,options.timeFormat=control.propSetMap.timeFormat;for(i=0;i<control.propSetMap.remoteOptions.docuSignTemplatesGroup.length;i++)null!=(transform=control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].transformBundle)&&""!==transform?($rootScope.loading=!0,function(i){var bundleInput={},iTimeout=control.propSetMap.remoteTimeout,inptJSON=$scope.prepareInputJSON(control);inptJSON=$scope.getSendResponseJSON(inptJSON,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].sendJSONPath,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].sendJSONNode),bundleInput.objectList=inptJSON,bundleInput.bundleName=transform;var option={};option.useQueueableApexRemoting=!0===control.propSetMap.useQueueableApexRemoting;var configObj={sClassName:bpService.sNSC+"DefaultDROmniScriptIntegration",sMethodName:"invokeTransformDR",input:angular.toJson(bundleInput),options:angular.toJson(option),iTimeout:iTimeout,label:{label:control&&control.name}},promise=bpService.OmniRemoteInvoke(configObj).then(function(result){var resp=angular.fromJson(result);if(resp&&"OK"!==resp.error)$rootScope.loading=!1,$scope.handleRemoteCallError(control,resp.error,!0,!1);else{$scope.applyDateFormat(resp.TFDRresp,options);input=$scope.getSendResponseJSON(input,control.propSetMap.sendJSONPath,control.propSetMap.sendJSONNode),control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].TFDRresp&&delete control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].TFDRresp,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].TFDRresp=resp.TFDRresp}},function(error){$rootScope.loading=!1,$scope.handleRemoteCallError(control,error,!0,!1)});promiseArray.push(promise)}(i)):(control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].sendJSONPath&&""!==control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].sendJSONPath?(control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].input=$scope.getSendResponseJSON(input,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].sendJSONPath,control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].sendJSONNode),control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].input=$scope.applyDateFormat(control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].input,options)):input=$scope.applyDateFormat(input,options),control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].TFDRresp&&delete control.propSetMap.remoteOptions.docuSignTemplatesGroup[i].TFDRresp,promiseArray.push($q.when(!0)));$q.all(promiseArray).then(function(promiseArray){embedSignature?($rootScope.loading=!1,$modal.open({animation:!0,templateUrl:"vlcDocuSignSignatureModal.html",controller:"ModalDocuSignEmbeddedCtrl",size:"lg",backdrop:"static",scope:$scope,show:!0,resolve:{mElementScp:function(){return $scope},mInput:function(){return input},mControl:function(){return control}}})):$scope.remoteCallInvoke(input,control,isButton,i,scp,null,null,null,fromIndex,!0)})},$scope.applyDateFormat=function(data,options){for(var root in data)if("object"==typeof data[root])for(childs in data[root])if("object"==typeof data[root][childs])for(prop in data[root][childs])if("object"==typeof data[root][childs][prop])for(keys in data[root][childs][prop])"string"==typeof data[root][childs][prop][keys]&&(data[root][childs][prop][keys]=vlocityPdfWriter.getAsDate(String(data[root][childs][prop][keys]),options));else"string"==typeof data[root][childs][prop]&&data[root][childs][prop].indexOf(":")>0&&(data[root][childs][prop]=vlocityPdfWriter.getAsDate(String(data[root][childs][prop]),options));else"string"==typeof data[root][childs]&&data[root][childs].indexOf(":")>0&&(data[root][childs]=vlocityPdfWriter.getAsDate(String(data[root][childs]),options));return data},$scope.runActiveScript=function(OSType,OSSubType,OSLangCode,parentObjectId,pfBundleName,bLoaded,bNew,multiLangCode){var sType=OSType,sSubType=OSSubType,sLang=OSLangCode,sParentObjectId=parentObjectId;sParentObjectId&&sParentObjectId.length>=1?"?"===sParentObjectId.charAt(sParentObjectId.length-1)&&(sParentObjectId=sParentObjectId.substring(0,sParentObjectId.length-1)):sParentObjectId="",bpService.parentObjectId=sParentObjectId;var sPFRPBundleName=pfBundleName;if(sPFRPBundleName&&sPFRPBundleName.length>=1?"?"===sPFRPBundleName.charAt(sPFRPBundleName.length-1)&&(sPFRPBundleName=sPFRPBundleName.substring(0,sPFRPBundleName.length-1)):sPFRPBundleName="",bpService.bpType=sType,bpService.bpSubType=sSubType,bpService.bpLang=sLang,bpService.parentObjectId=sParentObjectId,bpService.pfDRBundle=sPFRPBundleName,"false"!==bNew&&sType&&sSubType&&sLang)if($rootScope.loading=!0,$rootScope.loadingMessage="",bLoaded)sfdcVars.bpDef&&$timeout(function(){$scope.processBPDef(!1,sfdcVars.bpDef,bLoaded)},0);else{var drParams={};sParentObjectId&&(drParams.Id=sParentObjectId);var configObj={sClassName:"Vlocity BuildJSONWithPrefill",sType:sType,sSubType:sSubType,sLang:sLang,sPFRPBundleName:sPFRPBundleName,drParams:angular.toJson(drParams),multiLangCode:multiLangCode};bpService.OmniRemoteInvoke(configObj).then(function(result){$rootScope.scriptNotFound1=!1,$rootScope.scriptNotFound2=!1,$scope.processBPDef(!1,result)},function(error){if(window.forceLocalDef)return window.forceLocalDef=!1,$scope.runActiveScript(OSType,OSSubType,OSLangCode,parentObjectId,pfBundleName,bLoaded,bNew,multiLangCode);$rootScope.loading=!1,window.OmniOut&&"LocalScriptDefNotFound"===error.errType?($rootScope.rootCustomLabels=customLabels,$rootScope.scriptNotFound1=!0,$rootScope.scriptNotFound2=!1,$rootScope.type=bpService.bpType,$rootScope.subType=bpService.bpSubType,$rootScope.lang=bpService.bpLang):$window.alert(new Error(angular.toJson(error)))})}},$scope.getbVertParam=function(bVert){return null!==bVert&&void 0!==bVert&&bVert.constructor===Boolean?$scope.bVert=bVert:(bVert&&"?"===bVert.charAt(bVert.length-1)&&(bVert=bVert.substring(0,bVert.length-1)),$scope.bVert="false"!==bVert),"lightning"!==bpService.layout&&"newport"!==bpService.layout||($scope.bVert=!0),bpService.verticalMode=$scope.bVert,$scope.bVert?(bpService.bpW=12,$scope.bpW=12):(bpService.bpW=8,$scope.bpW=8),bVert},$scope.runScriptById=function(sId,osState,bNew,bLoaded,multiLangCode){if(bpService.scriptState=osState,"new"===osState?(bpService.bpId=sId,bpService.resumeMode=!1):"review"===osState?(bpService.appId=sId,bpService.resumeMode=!0):(bpService.instanceId=sId,bpService.resumeMode=!1,bpService.sflMode=!0),"false"!==bNew&&sId)if($rootScope.loading=!0,$rootScope.loadingMessage="",bLoaded)sfdcVars.bpDef&&$timeout(function(){$scope.processBPDef(!1,sfdcVars.bpDef)},0);else{var configObj={sClassName:"Vlocity BuildJSONV3",sId:sId,scriptState:osState,bPreview:ouiBaseService.previewMode,multiLangCode:multiLangCode};bpService.OmniRemoteInvoke(configObj).then(function(result){$scope.processBPDef(!0,result)},function(error){$rootScope.loading=!1,$window.alert(new Error(angular.toJson(error)))})}};var typeAheadSearchTimeouts={};$scope.typeAheadSearch=function(searchString,payload,control,scp,isLookup){var element=control.name,debounce=(control.children,control.propSetMap.callFrequency),dataProcessor=control.propSetMap.dataProcessorFunction,deferred=$q.defer(),actionCtrl=control.propSetMap.taAction,typeAheadKey=control.propSetMap.typeAheadKey,useDataJson=control.propSetMap.useDataJson,dataJsonPath=control.propSetMap.dataJsonPath,actionCtrlList=["Remote Action","Calculation Action","Integration Procedure Action"];if(control.noformatterebmodal&&control.selectedFromInlineEB&&angular.equals(searchString,control.selectedFromEB)&&!control.propSetMap.enableLookup)return[];if(control.noformatterebmodal&&""!==searchString&&angular.equals(searchString,control.selectedFromEB)&&!control.propSetMap.enableLookup||baseCtrl.prototype.modalClosed)return control.selectedFromEB="",scp.selectedFlag=!0,[];if(control.noformatterebmodal&&typeAheadKey&&""!==typeAheadKey&&(""===searchString||null===searchString)&&scp.elementScp&&!scp.elementScp.inlineEditBlock&&!angular.isUndefined(scp.selectedFlag)&&!control.propSetMap.enableLookup)return $scope.toggleTypeAheadEditMode(scp,!0,!0,null,control.blockIndex),$timeout(function(){scp.aggregate(scp.elementScp.$parent,control.index,control.indexInParent,!0,-1)}),[];if(isLookup)control.propSetMap.options=null,control.response=null,$scope.toggleTypeAheadEditMode(scp,!0,!0,null,control.blockIndex),"lightning"!==sfdcVars.layout&&"newport"!==sfdcVars.layout||$scope.onClickTypeAheadWrapper(scp,control);else if(!isLookup){if(angular.isObject(searchString))return 1===Object.keys(searchString).length&&searchString[Object.keys(searchString)[0]].search("</a>")>0?control.response="":control.response=String(searchString[typeAheadKey]),[];if(!searchString||angular.isUndefined(searchString)||""===searchString||" "===searchString||scp.selectedFlag||!useDataJson&&!actionCtrl||angular.isUndefined(scp.selectedFlag))return!typeAheadKey||""===typeAheadKey||""!=searchString||angular.isUndefined(scp.selectedFlag)||control.noformatterebmodal||$scope.toggleTypeAheadEditMode(scp,!0,!0,null,control.blockIndex),scp.selectedFlag=!1,[];if(""!==searchString&&!scp.selectedFlag&&!scp.isKeyPressed)return[];typeAheadSearchTimeouts[element]&&$timeout.cancel(typeAheadSearchTimeouts[element]),debounce&&""!==debounce||(debounce=300)}function checkObjectNumber(retArr,typeAheadKey){if(retArr&&retArr.length>0&&angular.isNumber(retArr[0][typeAheadKey]))for(var i=0;i<retArr.length;i++)retArr[i][typeAheadKey]=String(retArr[i][typeAheadKey]);return retArr}return!dataProcessor&&""===dataProcessor||scp.isDataProcessorSearched||(scp.dataProcessorFunc=window[dataProcessor]||baseCtrl.prototype[dataProcessor],scp.isDataProcessorSearched=!0),control.show||(control.show=!0),typeAheadSearchTimeouts[element]=$timeout(function(){if(typeAheadKey&&""!==typeAheadKey&&!angular.isUndefined(scp.selectedFlag)&&$scope.toggleTypeAheadEditMode(scp,!0,!0,null,control.blockIndex),control.noformatterebmodal&&scp.elementScp?$timeout(function(){scp.aggregate(scp.elementScp.$parent,control.index,control.indexInParent,!0,-1)}):scp.aggregate(scp,control.index,control.indexInParent,!0,-1),useDataJson&&null!=dataJsonPath&&!angular.equals("",dataJsonPath)){var propArray=$scope.preprocessElementInput(dataJsonPath),result=$scope.getJSONNode(payload,propArray);result=scp.dataProcessorFunc&&angular.isFunction(scp.dataProcessorFunc)?scp.dataProcessorFunc(result,control,scp,actionCtrl,searchString):isLookup?$scope.typeAheadCallBack(result,control,scp,actionCtrl,searchString,isLookup):$scope.typeAheadCallBack(result,control,scp,actionCtrl,searchString),searchString&&result&&!control.propSetMap.disableDataFilter?(sString=searchString,result=result.filter(function(obj){return typeAheadKey&&""!==typeAheadKey&&obj.hasOwnProperty(typeAheadKey)?-1!==obj[typeAheadKey].toLocaleLowerCase().search(sString.toLocaleLowerCase()):angular.isString(obj)?-1!==obj.toLocaleLowerCase().search(sString.toLocaleLowerCase()):void 0})):result=result,isLookup?isLookup&&deferred.resolve(control.propSetMap.options=checkObjectNumber(result,typeAheadKey)):(scp.selectedFlag=!0,deferred.resolve(result))}else actionCtrl&&-1!==actionCtrlList.indexOf(actionCtrl.type)?(actionCtrl.propSetMap.remoteOptions.searchString=searchString,$scope.remoteCallInvoke(payload,actionCtrl,!0,null,scp,null,"typeAheadSearch",null,null,null,null,function(result){isLookup?isLookup&&(scp.dataProcessorFunc&&angular.isFunction(scp.dataProcessorFunc)?deferred.resolve(control.propSetMap.options=scp.dataProcessorFunc(result,control,scp,actionCtrl,searchString)):deferred.resolve(control.propSetMap.options=checkObjectNumber($scope.typeAheadCallBack(result,control,scp,actionCtrl,searchString,isLookup),typeAheadKey)),$scope.$$phase||$scope.$apply()):(scp.selectedFlag=!0,scp.dataProcessorFunc&&angular.isFunction(scp.dataProcessorFunc)?deferred.resolve(scp.dataProcessorFunc(result,control,scp,actionCtrl,searchString)):deferred.resolve($scope.typeAheadCallBack(result,control,scp,actionCtrl,searchString)))})):actionCtrl&&angular.equals(actionCtrl.type,"Rest Action")?$scope.restCallInvoke(payload,actionCtrl,!0,null,scp,null,null,"typeAheadSearch",function(result){isLookup?isLookup&&(scp.dataProcessorFunc&&angular.isFunction(scp.dataProcessorFunc)?deferred.resolve(control.propSetMap.options=scp.dataProcessorFunc(result,control,scp,actionCtrl,searchString)):deferred.resolve(control.propSetMap.options=checkObjectNumber($scope.typeAheadCallBack(result,control,scp,actionCtrl,searchString,isLookup),typeAheadKey)),$scope.$$phase||$scope.$apply()):(scp.selectedFlag=!0,scp.dataProcessorFunc&&angular.isFunction(scp.dataProcessorFunc)?deferred.resolve(scp.dataProcessorFunc(result,control,scp,actionCtrl,searchString)):deferred.resolve($scope.typeAheadCallBack(result,control,scp,actionCtrl,searchString)))}):actionCtrl&&angular.equals(actionCtrl.type,"DataRaptor Extract Action")&&$scope.drExtractInvoke(actionCtrl,!0,null,scp,null,"typeAheadSearch",function(result){null==result||angular.isArray(result)||(result=0===Object.keys(result).length?[]:[result]),isLookup?isLookup&&(scp.dataProcessorFunc&&angular.isFunction(scp.dataProcessorFunc)?deferred.resolve(control.propSetMap.options=scp.dataProcessorFunc(result,control,scp,actionCtrl)):deferred.resolve(control.propSetMap.options=checkObjectNumber($scope.typeAheadCallBack(result,control,scp,actionCtrl,searchString,isLookup),typeAheadKey)),$scope.$$phase||$scope.$apply()):(scp.selectedFlag=!0,scp.dataProcessorFunc&&angular.isFunction(scp.dataProcessorFunc)?deferred.resolve(scp.dataProcessorFunc(result,control,scp,actionCtrl)):deferred.resolve($scope.typeAheadCallBack(result,control,scp,actionCtrl,searchString)))});var sString},debounce),deferred.promise},$scope.$on("$typeahead.select",function(event,selected,selectedIndex,typeaheadScope){var ctrl=typeaheadScope.$scope.control,selectedItem=angular.copy(selected),typeAheadBlock={},scope=event.currentScope;ctrl.noformatterebmodal&&(ctrl.selectedFromEB=selected[ctrl.propSetMap.typeAheadKey],ctrl.selectedFromInlineEB=!!typeaheadScope.$scope.elementScp.inlineEditBlock||null),angular.isObject(selectedItem)?(ctrl.propSetMap.enableLookup&&(ctrl.propSetMap.options=null,ctrl.response=selectedItem[ctrl.propSetMap.typeAheadKey]),1===Object.keys(selectedItem).length&&selectedItem[Object.keys(selectedItem)[0]].search("</a>")>0?scope.toggleTypeAheadEditMode(typeaheadScope.$scope.$parent,!0,null,null,ctrl.blockIndex):(selectedItem[ctrl.name]=selectedItem[ctrl.propSetMap.typeAheadKey],delete selectedItem[ctrl.propSetMap.typeAheadKey],typeAheadBlock[ctrl.name+"-Block"]=selectedItem,scope.applyCallResp(typeAheadBlock,null,null,null,ctrl.blockIndex)),scope.$apply()):ctrl.propSetMap.enableLookup&&selectedItem.constructor===String&&(ctrl.response=selectedItem),ctrl.noformatterebmodal&&typeaheadScope.$scope.elementScp?typeaheadScope.$scope.aggregate(typeaheadScope.$scope.elementScp.$parent,ctrl.index,ctrl.indexInParent,!0,-1):typeaheadScope.$scope.aggregate(typeaheadScope.$scope,ctrl.index,ctrl.indexInParent,!0,-1)}),$scope.typeAheadOnChange=function(evt,scp){scp.isKeyPressed=!0;try{37!==evt.keyCode&&38!==evt.keyCode&&39!==evt.keyCode&&40!==evt.keyCode&&13!==evt.keyCode&&(scp.control.selectedFromInlineEB=scp.selectedFlag=!1)}catch(e){console.log(e)}},$scope.typeAheadCallBack=function(result,control,scp,actionCtrl,searchString,isLookup){var returnArray,isAppendLink=!1,addNewLink={},typeAheadKey=control.propSetMap.typeAheadKey,newItemLabel=control.propSetMap.newItemLabel;if(!isLookup&&typeAheadKey&&""!==typeAheadKey&&newItemLabel&&""!==newItemLabel&&(angular.equals(sfdcVars.layout,"lightning")||angular.equals(sfdcVars.layout,"newport")?addNewLink[typeAheadKey]='<a><font size="4" face="verdana" color="#49739C"> +</font><span> </span><font size="4" color="#49739C">'+control.propSetMap.newItemLabel+'</font></a><span class="vlc-typeahead-newopt-displaynone">'+searchString+"</span>":addNewLink[typeAheadKey]='<a><font size="3">+ </font>'+control.propSetMap.newItemLabel+'</a><span class="vlc-typeahead-newopt-displaynone">'+searchString+"</span>",isAppendLink=!0),angular.isArray(result))return(returnArray=getArrayFromResp(result)).length>2e3&&(returnArray=returnArray.slice(0,2e3)),isAppendLink&&returnArray.push(addNewLink),returnArray;if(angular.isObject(result)&&Object.getOwnPropertyNames(result).length>=1){for(key in result){if(angular.isArray(result[key]))return result[key].length>2e3&&(result[key]=result[key].slice(0,2e3)),isAppendLink&&result[key].push(addNewLink),result[key];if(angular.isString(result[key])&&-1!==result[key].indexOf("[")&&-1!==result[key].lastIndexOf("]")&&angular.isArray(angular.fromJson(result[key])))return(returnArray=getArrayFromResp(angular.fromJson(result[key]))).length>2e3&&(returnArray=returnArray.slice(0,2e3)),isAppendLink&&returnArray.push(addNewLink),returnArray;if(angular.isObject(result[key])&&result[key][typeAheadKey])return returnArray=[result[key]],isAppendLink&&returnArray.push(addNewLink),returnArray}if(isAppendLink)return[addNewLink]}function getArrayFromResp(resp){if(resp){for(var isNestedArray=!1,i=0;i<=1;i++)if(angular.isArray(resp[i]))return isNestedArray=!0,resp[i];return isNestedArray?void 0:resp}}},$scope.toggleTypeAheadEditMode=function(scp,isNewClicked,onChange,clearAll,blockIndex){function doToggle(){var typeAheadBlock=scp.$parent.$parent.control;if(isNewClicked){var childs=typeAheadBlock.children,tAObject={},i=0;for(onChange&&!clearAll&&(i=1);i<childs.length;i++)tAObject[childs[i].eleArray[0].name]=null;var obj={};obj[scp.$parent.$parent.control.name]=tAObject,$scope.applyCallResp(obj,null,null,null,blockIndex),onChange||(typeAheadBlock.propSetMap.isTypeaheadEdit=!0)}else typeAheadBlock.propSetMap.isTypeaheadEdit=!typeAheadBlock.propSetMap.isTypeaheadEdit}isNewClicked&&clearAll?doToggle():$timeout(doToggle)},$scope.onClickTypeAheadWrapper=function(scp,control){var ctrlEleName=scp.control.name;void 0!=control.blockIndex&&null!=control.blockIndex||(null===$scope.prevTACtrlEleName||angular.equals($scope.prevTACtrlEleName,ctrlEleName)||$("[id='"+$scope.prevTACtrlEleName+"']").parent(".vlc-control-wrapper").removeAttr("style"),$("[id='"+ctrlEleName+"']").parent(".vlc-control-wrapper").css("z-index",2)),$scope.prevTACtrlEleName=ctrlEleName,$scope.resetSrvErr(control)},$scope.initAutocomplete=function(scp,control){var url="https://maps.googleapis.com/maps/api/js?libraries=places&key="+control.propSetMap.googleMapsAPIKey+"&language="+sfdcVars.sUserLanguage,ctrlName=control.name,country=(control.propSetMap.transformBundle,control.propSetMap.googleAddressCountry),googleTransformation=control.propSetMap.googleTransformation;if(document.getElementsByTagName("script")[0].src.indexOf(url)>=0||$scope.googleMapInitialized||"object"==typeof google)return"object"==typeof google&&($scope.googleMapInitialized=!0),void $timeout(callbackLoadAPI,1e3);function callbackLoadAPI(){var taElement,taElementMap,modalEle,clsPrefix=angular.equals(sfdcVars.layout,"lightning")?"slds-":angular.equals(sfdcVars.layout,"newport")?"nds-":"";if("true"===control.noformatterebmodal){if(!((modalEle=$("."+clsPrefix+"modal").length>0?$("."+clsPrefix+"modal"):$("."+clsPrefix+"edit-block-edit__container")).length>0))return;taElement=modalEle.find("[id='"+ctrlName+"']")[0],taElementMap=modalEle.find("[id='"+ctrlName+"_map']")[0]}else taElement=void 0!==control.blockIndex&&null!==control.blockIndex?$("[id='"+ctrlName+"']")[control.blockIndex]:document.getElementById(ctrlName),taElementMap=void 0!==control.blockIndex&&null!==control.blockIndex?$("[id='"+ctrlName+"_map']")[control.blockIndex]:document.getElementById(ctrlName+"_map");if("object"==typeof google){scp.autocomplete=new google.maps.places.Autocomplete(taElement,{types:["geocode"]}),country&&""!==country&&"all"!==country.toLocaleLowerCase()&&scp.autocomplete.setComponentRestrictions({country:country});var address=$(taElement).val();if(void 0===control.blockIndex||null===control.blockIndex||angular.isUndefined(address)||angular.equals(address,"")||(control.selectedFlg=!0),!angular.isUndefined(address)&&!angular.equals(address,"")&&control.selectedFlg)(new google.maps.Geocoder).geocode({address:address},function(results,status){if(status==google.maps.GeocoderStatus.OK&&$(taElementMap).length>0){$(taElementMap).show();var ltLng={lat:results[0].geometry.location.lat(),lng:results[0].geometry.location.lng()},mpObj={center:ltLng,zoom:15},mp=new google.maps.Map(taElementMap,mpObj);new google.maps.Marker({position:ltLng,map:mp,title:address})}});scp.autocomplete.addListener("place_changed",function(){var place=scp.autocomplete.getPlace();if(!place.address_components)return!1;var addrMap={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",administrative_area_level_2:"short_name",country:"long_name",postal_code:"short_name"},latLang={lat:place.geometry.location.lat(),lng:place.geometry.location.lng()},mapObj={center:latLang,zoom:15},addrObject={},typeAheadBlock={};if(control.response=place.formatted_address,control.selectedFlg=!0,control.noformatterebmodal&&scp.elementScp?$timeout(function(){scp.aggregate(scp.elementScp.$parent,control.index,control.indexInParent,!0,-1)}):scp.aggregate(scp,control.index,control.indexInParent,!0,-1),!control.propSetMap.hideMap){$(taElementMap).show();var map=new google.maps.Map(taElementMap,mapObj);new google.maps.Marker({position:latLang,map:map,title:place.formatted_address})}for(var street="",i=0;i<place.address_components.length;i++){var addressType=place.address_components[i].types[0];addrMap[addressType]&&(void 0!=googleTransformation[addressType]&&""!=googleTransformation[addressType]?addrObject[googleTransformation[addressType]]=place.address_components[i][addrMap[addressType]]:addrObject[addressType]=place.address_components[i][addrMap[addressType]],"street_number"!==addressType&&"route"!==addressType||(street="rtl"===angular.element("html").css("direction")?place.address_components[i][addrMap[addressType]]+" "+street:street+" "+place.address_components[i][addrMap[addressType]]))}void 0!=googleTransformation.street&&""!=googleTransformation.street&&(addrObject[googleTransformation.street]=street.trim(),delete addrObject.street_number,delete addrObject.route),typeAheadBlock[scp.control.name+"-Block"]=addrObject,scp.applyCallResp(typeAheadBlock,null,null,null,control.blockIndex),scp.$apply()});var a=navigator.userAgent;if(-1!=a.indexOf("Salesforce")&&(-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPad"))&&-1==a.indexOf("Safari")){var styleEl=document.getElementById(ctrlName+"-style");if(null==styleEl)(styleEl=document.createElement("style")).id=ctrlName+"style",document.getElementsByTagName("head")[0].appendChild(styleEl);function fixPositionOfDropdown(ctrlName){var el=$(document.getElementById(ctrlName)),newTop=Math.abs($("body>div").offset().top)+el.offset().top+el.outerHeight();$(".pac-container").each(function(){"none"!==$(this).css("display")&&(styleEl.innerText=".pac-container{ top :"+newTop+"px !important;}")})}$(document.getElementById(ctrlName)).on("focus keydown keyup",function(){fixPositionOfDropdown(ctrlName)}),$("body").scroll(function(){fixPositionOfDropdown(ctrlName)})}}else $scope.initAutocomplete(scp,control)}$.when($.getScript(url),$.Deferred(function(deferred){$(deferred.resolve)})).then(callbackLoadAPI),$scope.googleMapInitialized=!0,window.gm_authFailure=function(){(angular.equals(sfdcVars.layout,"lightning")||angular.equals(sfdcVars.layout,"newport"))&&($scope.$apply($scope.googleInvalidKey=!0),$(document.getElementById(ctrlName)).next("label").hide(),$(document.getElementById(ctrlName)).css("background-repeat","no-repeat"),$(document.getElementById(ctrlName)).css("padding-left","50px")),$(document.getElementById(ctrlName)).after("<span style='color: #FF0000'>Google Maps API error: InvalidKeyMapError</span>")},$scope.init(scp,control)},$scope.onFocusAutocomplete=function(scp,control){if(""===control.propSetMap.googleMapsAPIKey&&$scope.googleMapInitialized){var ele,modalEle,ctrlName=control.name,clsPrefix=angular.equals(sfdcVars.layout,"lightning")?"slds-":angular.equals(sfdcVars.layout,"newport")?"nds-":"";"true"===control.noformatterebmodal?(modalEle=$("."+clsPrefix+"modal").length>0?$("."+clsPrefix+"modal"):$("."+clsPrefix+"edit-block-edit__container")).length>0&&(ele=modalEle.find("[id='"+ctrlName+"']")[0]):ele=void 0!==control.blockIndex&&null!==control.blockIndex?$("[id='"+ctrlName+"']")[control.blockIndex]:document.getElementById(ctrlName),$(ele).next("#googleWarning").length>0&&$(ele).next("#googleWarning").remove(),$(ele).after("<span id='googleWarning' style='color: #FFA07A'>Google Maps API warning: NoApiKeys</span>")}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(position){var geolocation={lat:position.coords.latitude,lng:position.coords.longitude},circle=new google.maps.Circle({center:geolocation,radius:position.coords.accuracy});scp.autocomplete.setBounds(circle.getBounds())}),$scope.googleMapInitialized=!1,$scope.resetSrvErr(control)},$scope.onKeyDownAutocomplete=function(evt,scp,control){try{var taElementMap,modalEle,cmaKeys=evt.ctrlKey||evt.metaKey||evt.altKey,ctrlName=control.name,clsPrefix=angular.equals(sfdcVars.layout,"lightning")?"slds-":angular.equals(sfdcVars.layout,"newport")?"nds-":"";"true"===control.noformatterebmodal?(modalEle=$("."+clsPrefix+"modal").length>0?$("."+clsPrefix+"modal"):$("."+clsPrefix+"edit-block-edit__container")).length>0&&(taElementMap=modalEle.find("[id='"+ctrlName+"_map']")[0]):taElementMap=void 0!==control.blockIndex&&null!==control.blockIndex?$("[id='"+ctrlName+"_map']")[control.blockIndex]:document.getElementById(ctrlName+"_map"),!cmaKeys||86!==evt.keyCode&&88!==evt.keyCode||(cmaKeys=!1),cmaKeys||37===evt.keyCode||38===evt.keyCode||39===evt.keyCode||40===evt.keyCode||13===evt.keyCode||9===evt.keyCode||20===evt.keyCode||16===evt.keyCode||17===evt.keyCode||18===evt.keyCode||91===evt.keyCode||93===evt.keyCode||35===evt.keyCode||36===evt.keyCode||112===evt.keyCode||113===evt.keyCode||114===evt.keyCode||115===evt.keyCode||116===evt.keyCode||117===evt.keyCode||118===evt.keyCode||119===evt.keyCode||120===evt.keyCode||121===evt.keyCode||122===evt.keyCode||123===evt.keyCode||124===evt.keyCode||125===evt.keyCode||126===evt.keyCode||127===evt.keyCode||128===evt.keyCode||129===evt.keyCode||130===evt.keyCode||27===evt.keyCode||33===evt.keyCode||34===evt.keyCode||(control.selectedFlg=!1,$(taElementMap).hide(),$scope.toggleTypeAheadEditMode(scp,!0,!0,null,control.blockIndex),control.noformatterebmodal&&scp.elementScp&&$timeout(function(){scp.aggregate(scp.elementScp.$parent,control.index,control.indexInParent,!0,-1)})),13===evt.keyCode&&(evt.preventDefault(),evt.stopPropagation())}catch(e){console.log(e)}},$scope.sendEmail=function(payload,control,isButton,i,fromIndex,scp){var fileAttachments,attachment,fileElementName,promiseArray=[],largeFile=!1,totalAttachmentSize=0;if(control.propSetMap.remoteClass=bpService.sNSC+"DefaultOmniScriptSendEmail",control.propSetMap.remoteMethod="sendEmail",control.propSetMap.remoteOptions={},control.propSetMap.remoteOptions.emailElementName=control.name,control.propSetMap.remoteOptions.useTemplate=control.propSetMap.useTemplate,control.propSetMap.remoteOptions.emailTemplateName=angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.emailTemplateInformation.emailTemplateName),!1,null,isButton?control:null,null,null,!0)),control.propSetMap.remoteOptions.emailTargetObjectId=angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.emailTemplateInformation.emailTargetObjectId),!1,null,isButton?control:null,null,null,!0)),control.propSetMap.remoteOptions.whatId=angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.emailTemplateInformation.whatId),!1,null,isButton?control:null,null,null,!0)),control.propSetMap.remoteOptions.saveAsActivity=control.propSetMap.emailTemplateInformation.saveAsActivity,control.propSetMap.remoteOptions.toAddressList=$scope.parseEmailAddresses(angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.emailInformation.toAddressList),!1,null,isButton?control:null,null,null,!0))),control.propSetMap.remoteOptions.OrgWideEmailAddress=$scope.handleMergeField(control.propSetMap.OrgWideEmailAddress),control.propSetMap.remoteOptions.useTemplate&&(""===control.propSetMap.remoteOptions.emailTemplateName||void 0===control.propSetMap.remoteOptions.emailTemplateName))return isButton||(control.ui.show=!0),void $scope.handleRemoteCallError(control,customLabels.OmniSendEmailNoTemplate,isButton,!1);if(!control.propSetMap.remoteOptions.useTemplate&&0===control.propSetMap.remoteOptions.toAddressList.length)return isButton||(control.ui.show=!0),void $scope.handleRemoteCallError(control,customLabels.OmniDocuSignNoRecipients,isButton,!1);control.propSetMap.remoteOptions.ccAddressList=$scope.parseEmailAddresses(angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.emailInformation.ccAddressList),!1,null,isButton?control:null,null,null,!0))),control.propSetMap.remoteOptions.bccAddressList=$scope.parseEmailAddresses(angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.emailInformation.bccAddressList),!1,null,isButton?control:null,null,null,!0))),control.propSetMap.remoteOptions.emailSubject=angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.emailInformation.emailSubject),!1,null,isButton?control:null,null,null,!0)),control.propSetMap.remoteOptions.emailBody=angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.emailInformation.emailBody),!1,null,isButton?control:null,null,null,!0)),control.propSetMap.remoteOptions.setHtmlBody=control.propSetMap.emailInformation.setHtmlBody,(fileAttachments=angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.fileAttachments),!1,null,isButton?control:null,null,null,!0))).length>0&&(fileElementName=angular.toJson(control.propSetMap.fileAttachments).match(/%([^[%]+)%/g)[0].replace(/%/g,""),control.propSetMap.remoteOptions.uploadContDoc=$scope.getElement(fileElementName)[0].control.propSetMap.uploadContDoc);for(i=0;i<fileAttachments.length;i++)!function(i){var leng=angular.toJson($scope.bpTree.filesMap[fileAttachments[i].data]).length;if(totalAttachmentSize+=leng,leng>=6653348||totalAttachmentSize>=6653348||largeFile)largeFile=!0;else if((leng>1e6||totalAttachmentSize>1e6)&&$rootScope.isSforce&&sforce.connection){$rootScope.loading=!0;var attachmentBody=$scope.bpTree.filesMap[fileAttachments[i].data],contentType=attachmentBody.substring(attachmentBody.indexOf("data:")+5,attachmentBody.indexOf(";base64,"));attachmentBody=attachmentBody.substring(attachmentBody.indexOf("base64,")+7,attachmentBody.length);var promise=bpService.CreateOSDocumentAttachment(attachmentBody,fileAttachments[i].filename,payload.userId,contentType).then(function(attachmentId){fileAttachments[i].attachmentId=attachmentId},function(error){$window.alert(new Error(customLabels.OmniPDFError))});promiseArray.push(promise)}else fileAttachments[i].content=$scope.bpTree.filesMap[fileAttachments[i].data],promiseArray.push($q.when(!0))}(i);if(largeFile)return $rootScope.loading=!1,void $window.alert(customLabels.OmniEmailActionLargeFileErr);$q.all(promiseArray).then(function(promiseArray){!function(){if(void 0!==control.propSetMap.attachmentList){var osAtt=angular.fromJson($scope.handleMergeField('{"osAttList":"'+control.propSetMap.attachmentList+'"}',!1,null,isButton?control:null,null,null,!0));osAtt.osAttList&&!angular.isArray(osAtt.osAttList)&&(osAtt.osAttList=[osAtt.osAttList]),angular.isArray(osAtt.osAttList)&&(control.propSetMap.remoteOptions.osAttList=osAtt.osAttList)}angular.equals(fileAttachments,"")&&(fileAttachments=[]);control.propSetMap.remoteOptions.fileAttachments=fileAttachments;for(var docLst=[],i=0;i<control.propSetMap.staticDocList.length;i++)docLst.push(control.propSetMap.staticDocList[i]);(attachment=angular.fromJson($scope.handleMergeField(angular.toJson(control.propSetMap.docList),!1,null,isButton?control:null,null,null,!0)))&&""!==attachment&&docLst.push(attachment);if(void 0!==control.propSetMap.contentVersionList){var osConVer=angular.fromJson($scope.handleMergeField('{"osContVerList":"'+control.propSetMap.contentVersionList+'"}',!1,null,isButton?control:null,null,null,!0));osConVer.osContVerList&&!angular.isArray(osConVer.osContVerList)&&(osConVer.osContVerList=[osConVer.osContVerList]),angular.isArray(osConVer.osContVerList)&&(control.propSetMap.remoteOptions.contentVersionAttachments=osConVer.osContVerList)}control.propSetMap.remoteOptions.documentAttachments=docLst,$scope.remoteCallInvoke(payload,control,isButton,i,scp,null,"emailAction",null,fromIndex,!0,null,function(resp){for(var input={},opt={},attchIdList=[],isLargeAttachment=!1,j=0;j<fileAttachments.length;j++)fileAttachments[j].attachmentId&&""!==fileAttachments[j].attachmentId&&(attchIdList.push(fileAttachments[j].attachmentId),isLargeAttachment=!0);if(input.documentList=attchIdList,opt.documentList=attchIdList,isLargeAttachment){var configObj={sClassName:bpService.sNSC+"DefaultOmniScriptSendEmail",sMethodName:"deleteAttachedDocuments",input:angular.toJson(input),options:angular.toJson(opt),iTimeout:"",label:{label:control&&control.name}};bpService.OmniRemoteInvoke(configObj).then(function(result){},function(error){$scope.handleRemoteCallError(control,error,!0,!1)})}})}()})},$scope.parseEmailAddresses=function(addresses){var addrArray=[];if(angular.isArray(addresses))for(var i=0;i<addresses.length;i++)if(angular.isArray(addresses[i]))for(var j=0;j<addresses[i].length;j++)if(angular.isObject(addresses[i][j]))for(addr in addresses[i][j])addrArray.push(addresses[i][j][addr]);else angular.isString(addresses[i][j])&&addrArray.push(addresses[i][j]);else angular.isString(addresses[i])&&addrArray.push(addresses[i]);return addrArray},$scope.onClickProductCartQuantity=function(pcIndex,payload,scp,selectedItem,operation,quantity){selectedItem.itemSObject.Quantity=quantity,$scope.remoteCallInvoke(payload,null,!0,null,scp,selectedItem,operation,null,null,null,pcIndex)},$scope.openEditModal=function(ctrl,child,scp,operation,updateIndex,event,isInlineEditBlock){var leng,addObj,modalTemplateHtmlStr,templateURL,isElementAdded={};if(event.preventDefault(),event.stopPropagation(),"edit"!==operation||ctrl.propSetMap.allowEdit){if(templateURL=isInlineEditBlock&&!bpService.isMobileBrowser?"vlcEditBlockInlineChildrenView.html":"vlcEditBlockModal.html",modalTempalte="new"===operation?child.eleArray[0].propSetMap.modalTemplate?child.eleArray[0].propSetMap.modalTemplate:templateURL:ctrl.propSetMap.modalTemplate?ctrl.propSetMap.modalTemplate:templateURL,!isInlineEditBlock&&"parentIFrame"in window&&-1!==(modalTemplateHtmlStr=$templateCache.get(modalTempalte)).indexOf("vlc-slds-edit-block--modal_bottom")&&(modalTemplateHtmlStr=modalTemplateHtmlStr.replace("vlc-slds-edit-block--modal_bottom",""),$templateCache.put(modalTempalte,modalTemplateHtmlStr),$compile($templateCache)),!ctrl){if(leng=child.eleArray.length-1,child.eleArray[leng].childrenC?(child.eleArray[leng].children=angular.copy(child.eleArray[leng].childrenC),child.eleArray[leng].index=0,ctrl=child.eleArray[leng],isElementAdded.index=leng,delete child.eleArray[leng].childrenC):((addObj=angular.copy(child.eleArray[leng])).index=leng+1,scp.nullifyResponse(addObj),child.eleArray.push(addObj),ctrl=child.eleArray[leng+1],isElementAdded.index=leng+1),angular.isArray(child.response))child.response.push(ctrl.response);else{var temp=angular.copy(child.response);child.response=[],child.response.push(temp)}isElementAdded.added=!0,isElementAdded.child=child}/edit$/.test(operation)&&(isElementAdded.index=updateIndex),ctrl.propSetMap.isNewInlineBlock="new"===operation,(isInlineEditBlock&&!bpService.isMobileBrowser?$inlineEditBlockCont:$modal).open({templateUrl:modalTempalte,controller:"ModalEditBlockCtrl",size:"lg",backdrop:"static",keyboard:!1,scope:$scope,show:!0,vlocSlide:!0,resolve:{mElementScp:function(){return scp},mControl:function(){return ctrl},mIsElementAdded:function(){return isElementAdded},mOperation:function(){return operation}}}),null}else $window.alert(customLabels.OmnieditNotAllowedAlert)},$scope.removeItemEditBlock=function(control,index,scp,addedElement,parentScp){parentScp||(parentScp=scp.$parent),!addedElement&&control.eleArray[0].propSetMap.delAction?confirm(customLabels.OmniEditBlockDeleteConfirmation).then(function(success){if(success){var payload,actionCtrl=control.eleArray[0].propSetMap.delAction;scp.editBlockIndex=index,payload=control.eleArray[index].response,actionCtrl?(angular.equals(actionCtrl.type,"Remote Action")&&angular.equals(actionCtrl.propSetMap.remoteClass,"DefaultOmniScriptEditBlock")&&(actionCtrl.propSetMap.remoteOptions.sobjectMapping=control.eleArray[index].propSetMap.sobjectMapping,actionCtrl.propSetMap.remoteOptions.selectSobject=control.eleArray[index].propSetMap.selectSobject),$scope.buttonClick(payload,actionCtrl,scp,null,"vlcEBOperation",null,function(result){result&&$scope.deleteRecordFromDom(control,index,scp,parentScp)})):$scope.deleteRecordFromDom(control,index,scp,parentScp)}}):scp.isElementAdded&&scp.isElementAdded.added?$scope.deleteRecordFromDom(control,index,scp,parentScp):confirm(customLabels.OmniEditBlockDeleteConfirmation).then(function(success){success&&$scope.deleteRecordFromDom(control,index,scp,parentScp)})},$scope.deleteRecordFromDom=function(control,index,scp,parentScp){var i,scope=scp;if(0===index&&1===control.eleArray.length)scp.nullifyResponse(control.eleArray[0]),control.eleArray[0].childrenC=angular.copy(control.eleArray[0].children),control.eleArray[0].children=[],control.eleArray[0].response=null,control.response=null,scp.children=[];else for(control.eleArray.splice(index,1),control.response.splice(index,1),i=index;i<control.eleArray.length;i++){control.eleArray[i].index=control.eleArray[i].index-1;for(var j=0;j<control.eleArray[i].children.length;j++)"Type Ahead Block"===control.eleArray[i].children[j].eleArray[0].type&&(control.eleArray[i].children[j].blockIndex=control.eleArray[i].index,control.eleArray[i].children[j].eleArray[0].blockIndex=control.eleArray[i].index,control.eleArray[i].children[j].eleArray[0].children[0].eleArray[0].blockIndex=control.eleArray[i].index)}parentScp&&(scope=parentScp),scp.aggregate(scope,scp.control.index,scp.control.indexInParent,!0,-1),scp.previewMode||scp.$$phase||scp.$apply()},$scope.showDefaultEditBlockImage=function(control){var i=0;if(control.propSetMap.elementName){for(i=0;i<control.propSetMap.valueSvgMap.length;i++)if(control.response&&control.propSetMap.valueSvgMap[i].value==control.response[control.propSetMap.elementName])return!1;return!0}return!0},$scope.onClickEditBlockRecord=function(control,ind,evt,set,currIndex){if(ind>=0&&!evt.target.type&&(control.children[ind].eleArray[0].response=!control.children[ind].eleArray[0].response,"Single"===control.propSetMap.selectMode&&!0===control.children[ind].eleArray[0].response))for(var i=0;i<set.length;i++)i!==currIndex&&(set[i].children[ind].eleArray[0].response=!1);evt.target.type&&evt.target.className.indexOf("vlc-slds-time-picker")>0&&$(".clockpicker-popover").hide(),evt.stopPropagation(),evt.preventDefault()},$scope.isEditBlockRecordInvalid=function(ind,scp){return scp["vlcEditBlockFormMain_"+ind].$invalid},$scope.initEditBlockControlLimit=function(control,limit,maxLimitCountObj){var userViewLimit=0,controlRef={children:null,maxDispCount:0};void 0===control.childrenC?controlRef.children=control.children:controlRef.children=control.childrenC,$scope.notDispOnTmltObj=NotSupportedElmService.getList();for(var count=0;count<controlRef.children.length;count++){var isSprtedInBaseTmp=!$scope.notDispOnTmltObj.hasOwnProperty(controlRef.children[count].eleArray[0].type),isDisOnTpltPropTrue=void 0===controlRef.children[count].eleArray[0].propSetMap.disOnTplt||controlRef.children[count].eleArray[0].propSetMap.disOnTplt;isSprtedInBaseTmp&&isDisOnTpltPropTrue&&userViewLimit<limit?(controlRef.children[count].displayInView=!0,controlRef.children[count].displayInViewIndex=userViewLimit,userViewLimit++):controlRef.children[count].displayInView=!1}maxLimitCountObj&&(maxLimitCountObj.maxDispCount=userViewLimit)},$scope.editBlockDisplayValue=function(control,scp){var val,type=control.eleArray[0].type;switch(type){case"Multi-select":val=bpService.handleSelect(type,control.eleArray[0].response,!0);break;case"Radio":(val=control.eleArray[0].propSetMap.options.find(function(opt){return opt.name==control.eleArray[0].response}))&&(val=val.value);break;case"Block":val=control.eleArray[0].response;break;case"Date/Time (Local)":if(angular.isString(scp.editblockform.loopform.loopname.$viewValue)&&void 0!==scp.editblockform.loopform.timectrl&&"string"==typeof scp.editblockform.loopform.timectrl.$viewValue){val=scp.editblockform.loopform.loopname.$viewValue+" "+scp.editblockform.loopform.timectrl.$viewValue;break}case"Number":val=isNaN(scp.editblockform.loopform.loopname.$viewValue)?null:scp.editblockform.loopform.loopname.$viewValue;break;default:scp.editblockform&&scp.editblockform.loopform&&scp.editblockform.loopform.loopname&&null!==scp.editblockform.loopform.loopname.$viewValue&&void 0!==scp.editblockform.loopform.loopname.$viewValue&&(val=scp.editblockform.loopform.loopname.$viewValue.value||scp.editblockform.loopform.loopname.$viewValue)}return val},$scope.calculateSumElememt=function(control,scp){if(control.propSetMap.sumElement){var tempEle=document.getElementById(control.propSetMap.sumElement);0!=$(tempEle).length&&(scp.curSymbolFS=$(tempEle).parents(".vlc-slds-formula").find(".vlc-slds-currency-symbol").text(),$scope.$watch(function(){return tempEle.value},function(val){scp.set.sumControlValue=val}))}},$scope.calculateProgressWidth=function(){if($(".nds-progress__list").find(".nds-progress__visited").length>0)return $(".nds-progress__list").find(".nds-progress__visited").last().position().left},$scope.calculateProgressWidthMobile=function(){for(var stepIndexArray=[],steps=this.bpTree.children.filter(function(child,index){return"Step"===child.type&&(!0===child.bAccordionActive?stepIndexArray.push(1):stepIndexArray.push(0)),"Step"===child.type}),count=0;count<stepIndexArray.length;count++)if(1===stepIndexArray[count])return 100*count/(steps.length-1)+"%"},$rootScope.loading=!1,$rootScope.loadingMessage="",baseCtrl.prototype.$scope=$scope;var location=$location.path();$rootScope.isSforce="undefined"!=typeof sforce&&null!=sforce,$rootScope.sforce="undefined"!=typeof sforce?sforce:null,$rootScope.isInConsole=bpService.isInConsole,$rootScope.isPreviewEmbedded=!!/previewEmbedded=true/.test($location.absUrl());var temptabKey=/tabKey=([^\&\#]*)/.exec($location.absUrl());if(temptabKey&&angular.isArray(temptabKey)&&temptabKey.length>1){$rootScope.tabKey=temptabKey[1];var testContextId=/testContextId=([^\&\#]*)/.exec($location.absUrl());testContextId&&angular.isArray(testContextId)&&testContextId.length>1&&($rootScope.testContextId=testContextId[1]),sessionStorage.clear()}$scope.previewMode=ouiBaseService.previewMode,$scope.debugInformation=bpService.debugInformation,$scope.nsPrefix=bpService.sNS,void 0!==$scope.nsPrefix&&null!==$scope.nsPrefix&&""!==$scope.nsPrefix&&($scope.nsPrefix+="__"),$scope.drInvokeResult={},$scope.savedKnowKeyword="",$rootScope.bInitialize=!1;var queryParams=VOUINS.getQueryParams();if(ouiBaseService.LanguageCode=queryParams.LanguageCode,Object.getOwnPropertyNames($routeParams).length>0){var bNew=$routeParams.bNew;if(bNew&&bNew.length>=1&&"?"===bNew.charAt(bNew.length-1)&&(bNew=bNew.substring(0,bNew.length-1)),0===location.indexOf("/OS")){var sId=$routeParams.OSId,osState=$routeParams.osState;$scope.getbVertParam($routeParams.bVert),$scope.runScriptById(sId,osState,bNew,!1,ouiBaseService.LanguageCode)}else if(0===location.indexOf("/OmniScriptType")){var bVert=$scope.getbVertParam($routeParams.bVert);"false"!==bNew&&$scope.runActiveScript($routeParams.OSType,$routeParams.OSSubType,$routeParams.OSLangCode,$routeParams.parentObjectId,$routeParams.pfBundleName,!1,bNew,ouiBaseService.LanguageCode)}if("false"===bNew){$scope.getbVertParam($routeParams.bVert);var redirect=$routeParams.redirect,navDir=$routeParams.navDir;redirect&&redirect.length>=1&&"?"===redirect.charAt(redirect.length-1)&&(redirect=redirect.substring(0,redirect.length-1)),navDir&&navDir.length>=1&&"?"===navDir.charAt(navDir.length-1)&&(navDir=navDir.substring(0,navDir.length-1)),$scope.bpTree=bpService.restResponse[redirect];var isReview=!0;if($scope.bpTree.bpTree&&($scope.bpTree=$scope.bpTree.bpTree,isReview=!1),$scope.bpTree&&$scope.bpTree.children){var eleIndex;if($scope.children=$scope.bpTree.children,$scope.child={children:$scope.children},$scope.bpTree.reviewAction||$scope.bpTree.redirectAction)if(isReview&&$scope.bpTree.reviewAction&&(eleIndex=$scope.bpTree.reviewAction.indexInParent,delete $scope.bpTree.reviewAction),!isReview&&$scope.bpTree.redirectAction&&(eleIndex=$scope.bpTree.redirectAction.indexInParent,delete $scope.bpTree.redirectAction),void 0!==eleIndex&&null!==eleIndex&&eleIndex>=0&&eleIndex<$scope.bpTree.children.length){var currEle=$scope.bpTree.children[eleIndex];if("previous"===navDir){var prevIndex=$scope.findPreShowStep(eleIndex);void 0!==prevIndex&&null!==prevIndex&&(bpService.fakeAsync().then(function(ret){$scope.activateStep($scope.bpTree.children[prevIndex],!0,null)}),$scope.bpTree.asIndex=prevIndex)}else if("next"===navDir&&currEle&&void 0!==currEle.nextIndex&&null!==currEle.nextIndex){var nextIndex=currEle.nextIndex;$scope.nextRepeater(nextIndex,eleIndex)}}if(($scope.bpTree.reviewActionBtn||$scope.bpTree.redirectActionBtn)&&void 0!==$scope.bpTree.parentStepIndex&&null!==$scope.bpTree.parentStepIndex){var parentIndex=$scope.bpTree.parentStepIndex;bpService.fakeAsync().then(function(ret){$scope.activateStep($scope.bpTree.children[parentIndex],!0,null)}),$scope.bpTree.asIndex=$scope.bpTree.parentStepIndex,delete $scope.bpTree.reviewActionBtn,delete $scope.bpTree.redirectActionBtn,delete $scope.bpTree.parentStepIndex}}}}if("/"===location){var pattern;if(queryParams){var bLoaded="false"!==queryParams.loadWithPage;window.OmniOut&&(bLoaded=!1),queryParams.hasOwnProperty("OmniScriptType")&&queryParams.hasOwnProperty("OmniScriptSubType")&&queryParams.hasOwnProperty("OmniScriptLang")?(bpService.urlMode=!0,pattern=1):queryParams.hasOwnProperty("OmniScriptInstanceId")?(bpService.urlMode=!0,pattern=2):queryParams.hasOwnProperty("OmniScriptId")?(bpService.urlMode=!0,pattern=3):queryParams.hasOwnProperty("OmniScriptApplicationId")&&(bpService.urlMode=!0,pattern=4)}if(bpService.urlMode){var mode=void 0===queryParams.scriptMode?"":queryParams.scriptMode,bVert="true";switch("horizontal"===mode&&(bVert="false"),$scope.getbVertParam(bVert),pattern){case 1:$scope.runActiveScript(queryParams.OmniScriptType,queryParams.OmniScriptSubType,queryParams.OmniScriptLang,queryParams.ContextId,queryParams.PrefillDataRaptorBundle,bLoaded,"true",ouiBaseService.LanguageCode);break;case 2:$scope.runScriptById(queryParams.OmniScriptInstanceId,"saveAndResume","true",bLoaded,ouiBaseService.LanguageCode);break;case 3:ouiBaseService.previewMode=!1,$scope.runScriptById(queryParams.OmniScriptId,"new","true",bLoaded,ouiBaseService.LanguageCode);break;case 4:$scope.runScriptById(queryParams.OmniScriptApplicationId,"review","true",bLoaded,ouiBaseService.LanguageCode)}}else{var osState=bpService.resumeMode?"review":"new";$rootScope.tabKey||ouiBaseService.previewMode||(bpService.urlMode=!0,$scope.getbVertParam(bpService.verticalMode));var sId=bpService.resumeMode?bpService.appId:bpService.bpId;bpService.sflMode&&(sId=bpService.instanceId,osState="saveAndResume"),sId?$rootScope.tabKey||ouiBaseService.previewMode?$location.path("/OS/"+sId+"/scriptState/"+bpService.scriptState+"/"+bpService.verticalMode+"/true"):$scope.runScriptById(sId,osState,"true",!1,ouiBaseService.LanguageCode):bpService.bpType&&bpService.bpSubType&&bpService.bpLang&&($rootScope.tabKey||ouiBaseService.previewMode?$location.path("/OmniScriptType/"+bpService.bpType+"/OmniScriptSubType/"+bpService.bpSubType+"/OmniScriptLang/"+bpService.bpLang+"/ContextId/"+bpService.parentObjectId+"/PrefillDataRaptorBundle/"+bpService.pfDRBundle+"/"+bpService.verticalMode+"/true"):$scope.runActiveScript(bpService.bpType,bpService.bpSubType,bpService.bpLang,bpService.parentObjectId,bpService.pfDRBundle,!1,"true",ouiBaseService.LanguageCode))}}}bpModule=angular.module("vlocity-business-process",moduleList),window.bpModule=angular.module("vlocity-business-process"),bpModule.filter("prettify",function(){return function(json){return(json=json.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(match){var cls="number";return/^"/.test(match)?cls=/:$/.test(match)?"key":"string":/true|false/.test(match)?cls="boolean":/null/.test(match)&&(cls="null"),'<span class="'+cls+'">'+match+"</span>"})}}),bpModule.filter("filterMultiple",["$filter",function($filter){return function(items,keyObj){var filterObj={data:items,filteredData:[],applyFilter:function(obj,key){var fData=[];if(0==this.filteredData.length&&(this.filteredData=this.data),obj){var fObj={};if(angular.isString(obj))fObj[key]=obj,fData=fData.concat($filter("filter")(this.filteredData,fObj));else if(angular.isArray(obj)&&obj.length>0)for(var i=0;i<obj.length;i++)angular.isString(obj[i])&&(fObj[key]=obj[i],fData=fData.concat($filter("filter")(this.filteredData,fObj,!0)));this.filteredData=fData}}};return keyObj&&items&&angular.forEach(keyObj,function(obj,key){filterObj.applyFilter(obj,key)}),filterObj.filteredData}}]),bpModule.filter("filterProductsItems",["$filter",function($filter){return function(items,keyObj){var filterObj={data:items,filteredData:[],applyFilter:function(obj,key){var fData=[];if(0==this.filteredData.length&&(this.filteredData=this.data),obj){var fObj={};key=obj[0]+key;if(angular.isArray(obj)&&obj.length>0)for(var i=1;i<obj.length;i++)angular.isString(obj[i])&&(fObj[key]={value:obj[i]},fData=fData.concat($filter("filter")(this.filteredData,fObj,!0)));this.filteredData=fData}}};return keyObj&&items&&angular.forEach(keyObj,function(obj,key){filterObj.applyFilter(obj,key)}),filterObj.filteredData}}]),bpModule.filter("numFormatFilter",function(bpService){return function(input){var formatted="";if(input)for(var i=0;i<input.length;i++)","==input[i]?formatted+=sfdcVars.thousandSep:"."==input[i]?formatted+=sfdcVars.decimalSep:formatted+=input[i];return formatted}}),bpModule.filter("numFormatFilter1",function(bpService){return function(input){var formatted="";return input&&(formatted=input.toFixed(2)),formatted}}),bpModule.directive("ngEnter",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){element.bind("keydown keypress",function(event){13===event.which&&(ngModelCtrl.$commitViewValue(),scope.$apply(function(){scope.$eval(attrs.ngEnter)}),event.preventDefault())})}}}),bpModule.directive("vlcSldsBorder",[function(){return{restrict:"C",link:function(scope,element,attr){scope.loopform&&scope.loopform.loopname&&scope.loopform.loopname.$$element&&(scope.loopform.loopname.$$element.on("focus",function(){element.addClass("vlc-slds__border--focus")}),scope.loopform.loopname.$$element.on("blur",function(){element.removeClass("vlc-slds__border--focus")}))}}}]),bpModule.directive("child",function($compile,$templateCache,bpService,$sce){return{restrict:"E",replace:!0,transclude:!0,require:"?ngModel",scope:!1,link:function(scope,ele,attrs,ngModel){if(0===scope.child.level){if(bpService.bMultiLang&&(scope.child.propSetMap.label=scope.bpTree.labelKeyMap[scope.bpTree.labelMap[scope.child.name]],VOUINS.ootbLabelMap.hasOwnProperty(scope.child.type)&&VOUINS.handleMultiLangLabel(scope.child,scope.bpTree.labelKeyMap)),"Step"===scope.child.type){if(scope.child.propSetMap.saveLabel||(scope.child.propSetMap.saveLabel="Save for later"),scope.child.propSetMap.saveMessage||(scope.child.propSetMap.saveMessage="Are you sure you want to save it for later?"),scope.child.propSetMap.completeLabel||(scope.child.propSetMap.completeLabel="Complete"),scope.child.propSetMap.completeMessage||(scope.child.propSetMap.completeMessage="Are you sure you want to complete the script?"),scope.child.propSetMap.instruction||bpService.bMultiLang&&scope.child.propSetMap.instructionKey){var dMap=scope.bpTree.dMap,instruc=bpService.bMultiLang?scope.child.propSetMap.instructionKey:scope.child.propSetMap.instruction;scope.child.propSetMap.instructionDisplay=bpService.generateHyperLinks({html:instruc,trustedHtml:!1},dMap)}!0===scope.child.bAccordionActive&&(scope.bpTree.asIndex=scope.child.indexInParent)}if(void 0!==scope.child.propSetMap.showPersistentComponent&&null!==scope.child.propSetMap.showPersistentComponent||(scope.child.propSetMap.showPersistentComponent=!0),scope.child.open=!0!==bpService.verticalMode||scope.child.bAccordionOpen,!scope.child.bInit&&"saveAndResume"!==bpService.scriptState&&"review"!==bpService.scriptState){var inheritedShowProp=scope.child.inheritShowProp,eleShowProp=scope.child.propSetMap.show;void 0!==inheritedShowProp&&null!==inheritedShowProp&&(inheritedShowProp&&inheritedShowProp.group&&0===inheritedShowProp.group.rules.length||(void 0!==eleShowProp&&null!==eleShowProp?eleShowProp&&eleShowProp.group&&0===eleShowProp.group.rules.length?scope.child.propSetMap.show=inheritedShowProp:scope.child.propSetMap.show={group:{operator:"AND",rules:[eleShowProp,inheritedShowProp]}}:scope.child.propSetMap.show=inheritedShowProp)),scope.child.bInit=!0}var htmlId=bpService.elementTypeToHTMLMap[scope.child.type];scope.child.propSetMap.HTMLTemplateId&&(scope.child.propSetMap.HTMLTemplateId=bpService.getHTMLTemplate(scope.child.propSetMap.HTMLTemplateId),htmlId=scope.child.propSetMap.HTMLTemplateId);var htmlMarkup=$templateCache.get(htmlId);$compile(htmlMarkup)(scope,function(cloned,scope){ele.append(cloned)})}else if(angular.isArray(scope.child.eleArray[0].children)){void 0!==attrs.noformatterebmodal&&(scope.child.eleArray[0].noformatterebmodal=attrs.noformatterebmodal);for(var i=0;i<scope.child.eleArray.length;i++){if(bpService.bMultiLang){if("Headline"!==scope.child.eleArray[i].type&&"Type Ahead Block"!==scope.child.eleArray[i].type){var nameKey=scope.child.eleArray[i].name;"Type Ahead"===scope.child.eleArray[i].type&&(nameKey+="-Block"),scope.child.eleArray[i].propSetMap.label=scope.bpTree.labelKeyMap[scope.bpTree.labelMap[nameKey]]}VOUINS.ootbLabelMap.hasOwnProperty(scope.child.eleArray[i].type)&&VOUINS.handleMultiLangLabel(scope.child.eleArray[i],scope.bpTree.labelKeyMap),"Disclosure"===scope.child.eleArray[i].type&&(scope.child.eleArray[i].propSetMap.text=scope.child.eleArray[i].propSetMap.textKey)}scope.child.eleArray[i].propSetMap.show?"Optional if False"===scope.child.eleArray[i].propSetMap.conditionType?void 0===scope.child.eleArray[i].show&&(scope.child.eleArray[i].show=!0):"Readonly if False"===scope.child.eleArray[i].propSetMap.conditionType?void 0===scope.child.eleArray[i].show&&(scope.child.eleArray[i].show=!0):void 0===scope.child.eleArray[i].show&&(scope.child.eleArray[i].show=!1):scope.child.eleArray[i].show=!0,bpService.readOnlyReqEleTypeList.indexOf(scope.child.eleArray[0].type)>=0&&(void 0!==scope.child.eleArray[i].ro&&null!==scope.child.eleArray[i].ro||(scope.child.eleArray[i].ro=scope.child.eleArray[i].propSetMap.readOnly),void 0!==scope.child.eleArray[i].req&&null!==scope.child.eleArray[i].req||(scope.child.eleArray[i].req=scope.child.eleArray[i].propSetMap.required)),"Currency"===scope.child.eleArray[i].type&&(void 0!==scope.child.eleArray[i].propSetMap.mask&&null!==scope.child.eleArray[i].propSetMap.mask||(scope.child.eleArray[i].propSetMap.mask=2),void 0!==scope.child.eleArray[i].propSetMap.allowNegative&&null!==scope.child.eleArray[i].propSetMap.allowNegative||(scope.child.eleArray[i].propSetMap.allowNegative=!1),void 0!==scope.child.eleArray[i].propSetMap.hideGroupSep&&null!==scope.child.eleArray[i].propSetMap.hideGroupSep||(scope.child.eleArray[i].propSetMap.hideGroupSep=!1)),"Range"===scope.child.eleArray[i].type&&(void 0!==scope.child.eleArray[i].propSetMap.step&&null!==scope.child.eleArray[i].propSetMap.step||(scope.child.eleArray[i].propSetMap.step=1)),"Date"!==scope.child.eleArray[i].type&&"Date/Time (Local)"!==scope.child.eleArray[i].type||scope.child.eleArray[i].bInit||(scope.child.eleArray[i].bInit=!0)}if("Text Block"!==scope.child.eleArray[0].type||(void 0!==scope.child.eleArray[0].propSetMap.value&&null!==scope.child.eleArray[0].propSetMap.value||bpService.bMultiLang)&&!bpService.bMultiLang)if("Headline"!==scope.child.eleArray[0].type||(void 0!==scope.child.eleArray[0].propSetMap.value&&null!==scope.child.eleArray[0].propSetMap.value||bpService.bMultiLang)&&!bpService.bMultiLang)"Filter Block"===scope.child.eleArray[0].type?void 0!==scope.child.eleArray[0].open&&null!==scope.child.eleArray[0].open||(scope.child.eleArray[0].open=!0):"Selectable Items"===scope.child.eleArray[0].type?(scope.child.eleArray[0].itemsKey=scope.child.eleArray[0].propSetMap.itemsKey,scope.child.eleArray[0].itemsKey||(scope.child.eleArray[0].itemsKey="recSet"),void 0!==scope.child.eleArray[0].vlcSI&&null!==scope.child.eleArray[0].vlcSI||(scope.child.eleArray[0].vlcSI={})):"Input Block"===scope.child.eleArray[0].type?void 0!==scope.child.eleArray[0].vlcInputBlock&&null!==scope.child.eleArray[0].vlcInputBlock||(scope.child.eleArray[0].vlcInputBlock={}):"Edit Block"===scope.child.eleArray[0].type&&scope.child.eleArray[0].children.length>0&&!scope.child.eleArray[0].response&&(bpService.bMultiLang&&VOUINS.handleEditBlockLabel(scope.child.eleArray[0].children,scope.bpTree.labelKeyMap,scope.bpTree.labelMap),scope.child.eleArray[0].childrenC=angular.copy(scope.child.eleArray[0].children),scope.child.eleArray[0].children=[]);else{var headline=scope.child.eleArray[0],labelVal=bpService.bMultiLang?headline.propSetMap.labelKey:headline.propSetMap.label;headline.propSetMap.label=labelVal,labelVal&&labelVal.match(/(href|src)/)&&(headline.propSetMap.label=bpService.generateHyperLinks({html:labelVal,trustedHtml:!0},scope.bpTree.dMap)),scope.child.eleArray[0].propSetMap.value=scope.child.eleArray[0].propSetMap.label}else{var textBlock=scope.child.eleArray[0],textVal=bpService.bMultiLang?textBlock.propSetMap.textKey:textBlock.propSetMap.text;textBlock.propSetMap.text=textVal,textVal&&textVal.match(/(href|src)/)&&(textBlock.propSetMap.text=bpService.generateHyperLinks({html:textVal,trustedHtml:!0},scope.bpTree.dMap)),scope.child.eleArray[0].propSetMap.value=scope.child.eleArray[0].propSetMap.text}var type=scope.child.eleArray[0].type;bpService.actionEleTypes.indexOf(scope.child.eleArray[0].type)>=0&&(type+=" Btn",void 0!==scope.child.eleArray[0].propSetMap.showPersistentComponent&&null!==scope.child.eleArray[0].propSetMap.showPersistentComponent||(scope.child.eleArray[0].propSetMap.showPersistentComponent=!0)),"Filter"===scope.child.eleArray[0].type&&(type=type+" "+scope.child.eleArray[0].propSetMap.type);htmlId=bpService.elementTypeToHTMLMap[type];bpService.placeholderEleTypeList.indexOf(scope.child.eleArray[0].type)<0&&scope.child.eleArray[0].propSetMap.HTMLTemplateId&&(scope.child.eleArray[0].propSetMap.HTMLTemplateId=bpService.getHTMLTemplate(scope.child.eleArray[0].propSetMap.HTMLTemplateId),htmlId=scope.child.eleArray[0].propSetMap.HTMLTemplateId);htmlMarkup=$templateCache.get(htmlId);"Selectable Items"===scope.child.eleArray[0].type&&(scope.child.eleArray[0].propSetMap.HTMLTemplateId||(scope.child.eleArray[0].propSetMap.HTMLTemplateId=scope.bpTree.dfSITmpl),scope.child.eleArray[0].propSetMap.HTMLTemplateId=bpService.getHTMLTemplate(scope.child.eleArray[0].propSetMap.HTMLTemplateId)),"Input Block"===scope.child.eleArray[0].type&&(scope.child.eleArray[0].propSetMap.HTMLTemplateId=bpService.getHTMLTemplate(scope.child.eleArray[0].propSetMap.HTMLTemplateId)),$compile(htmlMarkup)(scope,function(cloned,scope){ele.append(cloned)})}}}}),bpModule.directive("sidebar",function($compile,$templateCache,bpService){return{restrict:"E",replace:!0,transclude:!0,scope:!1,link:function(scope,ele,attrs){var htmlMarkup,customMarkup=VOUINS.loadCustomHTMLJS(scope);window.OmniOut&&VOUINS.loadHeaderHTML(scope,$compile),null!==customMarkup&&($("head").append(customMarkup),$compile(customMarkup)),htmlMarkup="lightning"===bpService.layout||"newport"===bpService.layout||!1===bpService.verticalMode?$templateCache.get(bpService.elementTypeToHTMLMap.SideBar):$templateCache.get("vlcVertPC.html"),$compile(htmlMarkup)(scope,function(cloned,scope){ele.append(cloned)})}}}),bpModule.directive("bptree",function($compile,$templateCache,bpService){return{restrict:"E",replace:!0,transclude:!0,scope:!1,link:function(scope,ele,attrs){htmlMarkup=$templateCache.get(bpService.elementTypeToHTMLMap.OmniMain),$compile(htmlMarkup)(scope,function(cloned,scope){ele.append(cloned)})}}}),bpModule.directive("autoSaveforlaterMsg",function($compile,$templateCache,bpService){return{restrict:"E",replace:!0,transclude:!0,scope:!1,link:function(scope,ele,attrs){var htmlMarkup=$templateCache.get(bpService.elementTypeToHTMLMap["Auto Save for Later Message"]);$compile(htmlMarkup)(scope,function(cloned,scope){ele.append(cloned)})}}}),bpModule.directive("prodconf",function($compile,$templateCache,bpService){return{restrict:"E",replace:!0,transclude:!0,require:"?ngModel",scope:!1,link:function(scope,ele,attrs,prod,ngModel){try{var type="ProdConf"+scope.attr.attributeRunTimeInfo.dataType,htmlMarkup=$templateCache.get(bpService.elementTypeToHTMLMap[type]);$compile(htmlMarkup)(scope,function(cloned,scope){ele.append(cloned)}),angular.equals(scope.attr.attributeRunTimeInfo.dataType,"Multi Picklist")&&scope.$watch("prod.quantity",function(newValue,oldValue){var scp=ele.find('[name="loopform"]').scope();newValue===oldValue||scp.qtyChanged||(scp.qtyChanged=!0)})}catch(e){console.log(e)}}}}),bpModule.config(function($routeProvider){var bPreview=sfdcVars.previewMode;$routeProvider.when("/OS/:OSId/scriptState/:osState/:bVert?/:bNew?/:redirect?/:navDir?",{controller:"ctrlBusinessProcess as baseCtrl",reloadOnSearch:!1,templateUrl:function(urlattr){return bPreview?"bpTreePreview.html":"bpTree.html"}}).when("/OmniScriptType/:OSType/OmniScriptSubType/:OSSubType/OmniScriptLang/:OSLangCode/ContextId/:parentObjectId?/PrefillDataRaptorBundle/:pfBundleName?/:bVert?/:bNew?/:redirect?/:navDir?",{controller:"ctrlBusinessProcess as baseCtrl",reloadOnSearch:!1,templateUrl:"bpTree.html"}).when("/custom/:pageName/:bReview?",{controller:sfdcVars.redirectController+" as redirectCtrl",template:""}).when("/reset",{controller:"ctrlBusinessProcess as baseCtrl",reloadOnSearch:!1,template:""}).when("/cancel",{controller:"ctrlBusinessProcess as baseCtrl",reloadOnSearch:!1,template:""}).when("/",{controller:"ctrlBusinessProcess as baseCtrl",reloadOnSearch:!1,templateUrl:function(urlattr){return bPreview?"bpTreePreview.html":"bpTree.html"}}).when("/:bVert?/:bNew?/:redirect?/:navDir?",{controller:"ctrlBusinessProcess as baseCtrl",reloadOnSearch:!1,templateUrl:"bpTree.html"}).otherwise({redirectTo:""})}),window.baseCtrl=baseCtrl,baseCtrl.prototype.addItem=function(scp,control,index){if(!(void 0!==control.eleArray[0].propSetMap.repeatLimit&&null!==control.eleArray[0].propSetMap.repeatLimit&&control.eleArray[0].propSetMap.repeatLimit.constructor===Number&&control.eleArray[0].propSetMap.repeatLimit+1<=control.eleArray.length)){var newItem=angular.copy(control.eleArray[index]);nullifySrvErr(newItem),newItem.propSetMap&&!0!==newItem.propSetMap.repeatClone&&scp.nullifyResponse(newItem),newItem.index=index+1,control.eleArray.splice(index+1,0,newItem);for(var i=index+2;i<control.eleArray.length;i++)control.eleArray[i].index=control.eleArray[i].index+1;if("Block"===control.eleArray[0].type&&scp.$parent&&scp.$parent.$parent){var parentNode="lightning"===sfdcVars.layout||"newport"===sfdcVars.layout?scp.$parent.$parent.$parent:scp.$parent.$parent;parentNode&&scp.aggregate(parentNode,control.index,control.indexInParent,!1,index)}else scp.aggregate(scp,control.index,control.indexInParent,!1,index)}},baseCtrl.prototype.customHandleSelectedItem=function(operation,selectedItem,bSuccess){void 0!==selectedItem&&null!==selectedItem&&("Add"===operation&&(selectedItem.added=!!bSuccess),"Remove"===operation&&(selectedItem.added=!bSuccess))};var contrlBP=bpModule.controller("ctrlBusinessProcess",baseCtrl);function customRedirectCtrl($scope,$sce,$window,$location,$route,$routeParams,$http,$compile,bpService,ouiBaseService,jsonTreeConfig,$templateCache,$sanitize,$timeout,$rootScope,$modal,$q,$injector,force,NotSupportedElmService,currencySymbol){customRedirectCtrl.prototype.$scope=$scope,baseCtrl.call(this,$scope,$sce,$window,$location,$route,$routeParams,$http,$compile,bpService,ouiBaseService,jsonTreeConfig,$templateCache,$sanitize,$timeout,$rootScope,$modal,$q,$injector,force);var pageName=$routeParams.pageName,isReview=$routeParams.bReview;jsonTreeConfig.templateUrl=bpService.jsonTreeHTMLTmpl;var templateUrl="";pageName&&(templateUrl=bpService.redirectPageTemplateMap[pageName],"review"===isReview?$scope.bpTree=bpService.restResponse[pageName]:bpService.restResponse[pageName].bpTree?($scope.bpTree=bpService.restResponse[pageName].bpTree,$scope.response=bpService.restResponse[pageName].response):$scope.bpTree=bpService.restResponse[pageName],$scope.children=$scope.bpTree.children,$scope.child={children:$scope.children},$scope.bpW=bpService.bpW),templateUrl&&($route.current.templateUrl=templateUrl,$rootScope.loading=!0,$rootScope.loadingMessage="",$timeout(function(){var html=$scope.loadHTMLTemplate(isReview,templateUrl);$("#VlocityBPView").html($compile(html)($scope)),$rootScope.loading=!1},0)),$scope.loadHTMLTemplate=function(isReview,templateUrl){var html="";!1===bpService.verticalMode&&"vlcMobileConfirmation.html"!==templateUrl&&"vlcMobileReview.html"!==templateUrl&&"vlcMobileSaveForLater.html"!==templateUrl&&"vlcMobileCartSummary.html"!==templateUrl&&(html+=$templateCache.get(bpService.elementTypeToHTMLMap.SideBar)),"lightning"===bpService.layout||"newport"===bpService.layout?html+='<div class="slds-box" style="border:none">':html+='<div class="v-col-md-{{bpW}}">';var tempHTML=$templateCache.get(templateUrl);return $scope.response&&$scope.response.vlcAttachmentBody&&(tempHTML=tempHTML.replace("{{response.attachmentUrl}}",$scope.response.attachmentUrl)),html+=tempHTML,$scope.bpTree&&("review"!==isReview?($scope.bpTree.redirectAction&&(html+=$templateCache.get(bpService.elementTypeToHTMLMap["Redirect Action Footer"])),$scope.bpTree.redirectActionBtn&&(html+=$templateCache.get(bpService.elementTypeToHTMLMap["Redirect Action Button Footer"]))):($scope.bpTree.reviewAction&&(html+=$templateCache.get(bpService.elementTypeToHTMLMap["Review Action Footer"])),$scope.bpTree.reviewActionBtn&&(html+=$templateCache.get(bpService.elementTypeToHTMLMap["Review Action Button Footer"])))),html+="</div>"}}customRedirectCtrl.prototype=Object.create(baseCtrl.prototype),window.customRedirectCtrl=customRedirectCtrl,bpModule.controller("ctrlRedirect",customRedirectCtrl),bpModule.controller("ModalInstanceCtrl",function($scope,content){$scope.content=content,$scope.step=content,$scope.cancel=function(){$scope.$dismiss("cancel")}}),baseCtrl.prototype.customIsConfigurable=function(product){return product.isConfigurable},baseCtrl.prototype.createCartHierarchy=function(data){var cartItemsNew=[],prevIdx=0;if(angular.forEach(data.cartItems,function(item,index){if(0===item.indent&&index>0){var tempItemList=data.cartItems.slice(prevIdx,index),tempItemHierarchy=baseCtrl.prototype.prepareCartHierarchy(tempItemList,"cartItems");cartItemsNew.push(tempItemHierarchy[0]),prevIdx=index}}),prevIdx<data.cartItems.length){var tempItemList=data.cartItems.slice(prevIdx,data.cartItems.length),tempItemHierarchy=baseCtrl.prototype.prepareCartHierarchy(tempItemList,"cartItems");cartItemsNew.push(tempItemHierarchy[0])}return data.cartItems=cartItemsNew,data},baseCtrl.prototype.prepareCartHierarchy=function(cartList,children){var item,levels,cartHierarchy=[],rootItem=cartList[0],len=cartList.length;rootItem.isRoot=!0,rootItem.level=1,null!==rootItem.isExpanded&&void 0!==rootItem.isExpanded||(rootItem.isExpanded=!1),rootItem.hasConfigurableAttributes=baseCtrl.prototype.hasConfigurableAttributes(rootItem);for(var idx=1;idx<len;idx++)levels=(item=cartList[idx]).lineNumber.split("."),item.level=levels.length,item.hasConfigurableAttributes=baseCtrl.prototype.hasConfigurableAttributes(item),void 0!==item.minQuantity&&null!==item.minQuantity&&void 0!==item.maxQuantity&&null!==item.maxQuantity&&item.minQuantity===item.maxQuantity&&(item.quantity=item.minQuantity),void 0!==item.quantity&&null!=item.quantity||(item.quantity=item.defaultQuantity),void 0!==item.minQuantity&&null!=item.minQuantity||(item.minQuantity=0),null==item.maxQuantity&&(item.maxQuantity=void 0),baseCtrl.prototype.setItemChildren(rootItem,levels.slice(1),item,children);return baseCtrl.prototype.filterCartHierarchy(rootItem,children),cartHierarchy.push(rootItem),cartHierarchy},baseCtrl.prototype.hasConfigurableAttributes=function(product){var hasConfAttrs=!1;if(!product.isAttrParsed&&product.JSONAttribute&&(product.JSONAttribute=JSON.parse(product.JSONAttribute),product.isAttrParsed=!0),!product.categoryMap)for(var cat in product.categoryMap={},product.JSONAttribute){for(var attrs=product.JSONAttribute[cat],attrCount=0,i=0;i<attrs.length;i++)if(baseCtrl.prototype.parseAttributes(attrs),attrs[i].attributeconfigurable__c&&attrs[i].isactive__c){attrCount++,hasConfAttrs=!0;break}attrs.length>0&&(product.categoryMap[cat]={name:attrs[0].categoryname__c,showCategory:attrCount>0})}return hasConfAttrs},baseCtrl.prototype.setItemChildren=function(rootItem,levels,p,children){1===levels.length?(void 0===rootItem[children]&&(rootItem[children]=[]),rootItem[children][levels[0]-1]=p):arguments.callee(rootItem[children][levels[0]-1],levels.slice(1),p,children)},baseCtrl.prototype.filterCartHierarchy=function(rootItem,childNode){childNode||(childNode="cartItems"),rootItem[childNode]&&(rootItem[childNode]=rootItem[childNode].filter(function(n){return void 0!==n}),angular.forEach(rootItem[childNode],function(item){baseCtrl.prototype.filterCartHierarchy(item,childNode)}))},baseCtrl.prototype.configureAttributes=function(product){if(void 0===product.showAttrConfig||null===product.showAttrConfig)for(var cat in product.isAttrParsed||(product.JSONAttribute=JSON.parse(product.JSONAttribute),product.isAttrParsed=!0),product.JSONAttribute){var attrs=product.JSONAttribute[cat];baseCtrl.prototype.parseAttributes(attrs)}product.showAttrConfig=!product.showAttrConfig},baseCtrl.prototype.parseAttributes=function(attrs){angular.forEach(attrs,function(attr){attr.Name=attr.attributedisplayname__c,attr.Code=attr.attributeuniquecode__c,attr.Filterable=attr.attributefilterable__c,attr.SegmentValue="";var tempSegmentList=[];if(attr.attributeRunTimeInfo&&attr.attributeRunTimeInfo.dataType){if("Text"===attr.attributeRunTimeInfo.dataType&&(void 0===attr.attributeRunTimeInfo.value&&(attr.attributeRunTimeInfo.value=attr.attributeRunTimeInfo.default),attr.SegmentValue=attr.attributeRunTimeInfo.value),"Number"!==attr.attributeRunTimeInfo.dataType&&"Currency"!==attr.attributeRunTimeInfo.dataType&&"Percent"!==attr.attributeRunTimeInfo.dataType||("string"==typeof attr.attributeRunTimeInfo.default&&(attr.attributeRunTimeInfo.default=parseFloat(attr.attributeRunTimeInfo.default)),void 0===attr.attributeRunTimeInfo.value?attr.attributeRunTimeInfo.value=attr.attributeRunTimeInfo.default:"string"==typeof attr.attributeRunTimeInfo.value&&(attr.attributeRunTimeInfo.value=parseFloat(attr.attributeRunTimeInfo.value)),attr.SegmentValue=attr.attributeRunTimeInfo.value+""),"Date"===attr.attributeRunTimeInfo.dataType||"Datetime"===attr.attributeRunTimeInfo.dataType){void 0===attr.attributeRunTimeInfo.value&&(attr.attributeRunTimeInfo.value=attr.attributeRunTimeInfo.default);var dateFormat="Date"===attr.attributeRunTimeInfo.dataType?"shortDate":"short";attr.SegmentValue=angular.injector(["ng"]).get("$filter")("date")(attr.attributeRunTimeInfo.value,dateFormat)}var selectedId;if("Checkbox"===attr.attributeRunTimeInfo.dataType&&(void 0===attr.attributeRunTimeInfo.value&&(attr.attributeRunTimeInfo.value=attr.attributeRunTimeInfo.default),attr.SegmentValue=attr.attributeRunTimeInfo.value?"Yes":"No"),"Picklist"===attr.attributeRunTimeInfo.dataType)void 0===attr.attributeRunTimeInfo.selectedItem||null===attr.attributeRunTimeInfo.selectedItem?void 0!==attr.attributeRunTimeInfo.default&&attr.attributeRunTimeInfo.default.length>0&&(selectedId=attr.attributeRunTimeInfo.default[0].id):selectedId=attr.attributeRunTimeInfo.selectedItem.id,angular.forEach(attr.attributeRunTimeInfo.values,function(value){value.id===selectedId&&(attr.attributeRunTimeInfo.selectedItem=value),tempSegmentList.push(value.displayText)}),attr.SegmentValue=tempSegmentList.join(",");"Multi Picklist"===attr.attributeRunTimeInfo.dataType&&(angular.forEach(attr.attributeRunTimeInfo.values,function(value){tempSegmentList.push(value.displayText)}),attr.SegmentValue=tempSegmentList.join(","),"Checkbox"===attr.attributeRunTimeInfo.uiDisplayType&&angular.forEach(attr.attributeRunTimeInfo.values,function(value){if(void 0===value.checked){var found=attr.attributeRunTimeInfo.default.some(function(el){return el.id===value.id});value.checked=found}}),"Dropdown"===attr.attributeRunTimeInfo.uiDisplayType&&void 0===attr.attributeRunTimeInfo.selectedItems&&(attr.attributeRunTimeInfo.selectedItems=[],angular.forEach(attr.attributeRunTimeInfo.values,function(value){for(var i=0;i<attr.attributeRunTimeInfo.default.length;i++)if(value.id===attr.attributeRunTimeInfo.default[i].id){attr.attributeRunTimeInfo.selectedItems.push(value);break}})))}})},baseCtrl.prototype.addProductToCart=function(product,control,scp){var className=control?control.propSetMap.remoteClass:bpService.sNSC+"CpqAppHandler",methodName=control?control.propSetMap.remoteMethod:"postCartsItems",opt={},timeout=control.propSetMap.remoteTimeout,inputParam=Object.keys(product.actions.addtocart.remote.params).length>0?product.actions.addtocart.remote.params:Object.keys(product.actions.addtocart.rest.params).length>0?product.actions.addtocart.rest.params:null;if(product.actions){var configObj={sClassName:className,sMethodName:methodName,input:angular.toJson(inputParam),options:angular.toJson(opt),iTimeout:timeout,label:{label:control&&control.name}};scp.$root.loading=!0,scp.bpService.OmniRemoteInvoke(configObj).then(function(result){var configObjCart={sClassName:className,sMethodName:"getCarts",input:angular.toJson(inputParam),options:angular.toJson(opt),iTimeout:timeout,label:{label:control&&control.name}};scp.bpService.OmniRemoteInvoke(configObjCart).then(function(result){scp.$root.loading=!1;var resp=angular.fromJson(result);scp.bpTree.response.vlcPersistentComponent[scp.bpTree.pcId[0]+"_Top"]=[resp]},function(error){scp.handleRemoteCallError(control,resp.error,!0,!1)});var resp=angular.fromJson(result),hasError=!1,errorMsg="";if(angular.forEach(resp.messages,function(message){"ERROR"===message.severity&&(hasError=!0,errorMsg=message.message)}),!hasError||resp.records)for(var i=0;i<resp.records.length;i++)scp.bpTree.response.vlcPersistentComponent[scp.bpTree.pcId[0]].records?scp.bpTree.response.vlcPersistentComponent[scp.bpTree.pcId[0]].records.unshift(resp.records[i]):scp.bpTree.response.vlcPersistentComponent[scp.bpTree.pcId[0]].records=resp.records;else scp.handleRemoteCallError(control,errorMsg,!0,!1)},function(error){scp.handleRemoteCallError(control,resp.error,!0,!1)})}},baseCtrl.prototype.loadMoreProducts=function(control,scp){var className=control?control.propSetMap.remoteClass:scp.bpService.sNSC+"CpqAppHandler",timeout=control.propSetMap.remoteTimeout,inputParam=Object.keys(control.vlcSI[control.itemsKey][0].actions.nextproducts.remote.params).length>0?control.vlcSI[control.itemsKey][0].actions.nextproducts.remote.params:Object.keys(control.vlcSI[control.itemsKey][0].actions.nextproducts.rest.params).length>0?control.vlcSI[control.itemsKey][0].actions.nextproducts.rest.params:null,configObj={sClassName:className,sMethodName:"getCartsProducts",input:angular.toJson(inputParam),options:angular.toJson({}),iTimeout:timeout,label:{label:control&&control.name}};scp.$root.loading=!0,scp.bpService.OmniRemoteInvoke(configObj).then(function(result){scp.$root.loading=!1;var resp=angular.fromJson(result),hasError=!1,errorMsg="";angular.forEach(resp.messages,function(message){"ERROR"===message.severity&&(hasError=!0,errorMsg=message.message)}),hasError?scp.handleRemoteCallError(control,errorMsg,!0,!1):(control.vlcSI[control.itemsKey][0].records.push.apply(control.vlcSI[control.itemsKey][0].records,resp.records),control.vlcSI[control.itemsKey][0].actions=resp.actions)},function(error){scp.$root.loading=!1,scp.handleRemoteCallError(control,resp.error,!0,!1)})},baseCtrl.prototype.loadMoreCartItems=function(actions,scp){var inputParam=Object.keys(actions.nextproducts.remote.params).length>0?actions.nextproducts.remote.params:Object.keys(actions.nextproducts.rest.params).length>0?actions.nextproducts.rest.params:null,configObj={sClassName:scp.bpService.sNSC+"CpqAppHandler",sMethodName:"getCartsItems",input:angular.toJson(inputParam),options:angular.toJson({}),iTimeout:null,label:null};scp.$root.loading=!0,scp.bpService.OmniRemoteInvoke(configObj).then(function(result){scp.$root.loading=!1;var resp=angular.fromJson(result),hasError=!1,errorMsg="";angular.forEach(resp.messages,function(message){"ERROR"===message.severity&&(hasError=!0,errorMsg=message.message)}),hasError?scp.handleRemoteCallError(control,errorMsg,!0,!1):(scp.bpTree.response.vlcPersistentComponent[scp.bpTree.pcId[0]].records.push.apply(scp.bpTree.response.vlcPersistentComponent[scp.bpTree.pcId[0]].records,resp.records),scp.bpTree.response.vlcPersistentComponent[scp.bpTree.pcId[0]].actions=resp.actions)},function(error){scp.$root.loading=!1,scp.handleRemoteCallError(null,resp.error,!0,!1)})},bpModule.controller("ModalProductCtrl",function($scope,$rootScope,$window,$timeout,bpService,mSelectedItem,mScp,mPayload,mControl,mOperation,mpcIndex){$scope.OmniConfigProdModalHeader=customLabels.OmniConfigProdModalHeader,$scope.OmniConfigProdName=customLabels.OmniConfigProdName,$scope.OmniConfigProdQTY=customLabels.OmniConfigProdQTY,$scope.OmniConfigProdModalOk=customLabels.OmniConfigProdModalOk,$scope.OmniConfigProdModalCancel=customLabels.OmniConfigProdModalCancel,$scope.OmniConfigProdQtyError0=customLabels.OmniConfigProdQtyError0,$scope.OmniConfigProdQtyError=customLabels.OmniConfigProdQtyError,$scope.OmniConfigProdQtyErrorAnd=customLabels.OmniConfigProdQtyErrorAnd,$scope.OmniConfigProdQtyError1=customLabels.OmniConfigProdQtyError1,$scope.OmniConfigProdQueryError=customLabels.OmniConfigProdQueryError,$scope.OmniConfigProdRequired=customLabels.OmniConfigProdRequired,$scope.contentSelectedItem=mSelectedItem,$scope.contentScp=mScp,$scope.contentResp=mPayload,$scope.contentCtrl=mControl,$scope.contentBpService=bpService,$scope.mOperation=mOperation,$scope.pcIndex=mpcIndex,$scope.cancel=function(){$scope.$dismiss("cancel")},$scope.ok=function(){var list=$scope.createProductList($scope.content);if($scope.contentResp.propSetMap&&$scope.contentResp.propSetMap.persistentComponent){var option={};option.vlcSelectedItem=list,mScp.remoteCallInvoke($scope.contentResp,null,!0,null,$scope.contentScp,option.vlcSelectedItem,"saveProductsPostConfig",null,null,null,$scope.pcIndex)}else mScp.buttonClick($scope.contentResp,$scope.contentCtrl,$scope.contentScp,list,"Add");$scope.$dismiss("cancel")},$scope.initProductModal=function(){var sClassName,sMethodName,cfgProducts,option={},payload=$scope.contentResp;if($scope.contentCtrl&&$scope.contentCtrl.propSetMap.modalConfigurationSetting)sClassName=$scope.contentCtrl.propSetMap.remoteClass,sMethodName=$scope.contentCtrl.propSetMap.remoteMethod;else if($scope.contentResp.propSetMap.persistentComponent&&$scope.contentResp.propSetMap.persistentComponent[$scope.pcIndex]&&$scope.contentResp.propSetMap.persistentComponent[$scope.pcIndex].modalConfigurationSetting){sClassName=$scope.contentResp.propSetMap.persistentComponent[$scope.pcIndex].remoteClass,sMethodName=$scope.contentResp.propSetMap.persistentComponent[$scope.pcIndex].remoteMethod,payload=$scope.contentResp.response;var persistComponentId=$scope.contentResp.propSetMap.persistentComponent[$scope.pcIndex].id}option.vlcSelectedItem=$scope.contentSelectedItem,option.vlcOperation=$scope.mOperation,$scope.contentResp.propSetMap&&$scope.contentResp.propSetMap.persistentComponent&&(sClassName=$scope.contentResp.propSetMap.persistentComponent[$scope.pcIndex].remoteClass,sMethodName=$scope.contentResp.propSetMap.persistentComponent[$scope.pcIndex].remoteMethod,payload=$scope.contentResp.response);var configObj={sClassName:sClassName,sMethodName:sMethodName,input:angular.toJson(payload),options:angular.toJson(option),iTimeout:null,label:{label:$scope.contentCtrl&&$scope.contentCtrl.name||persistComponentId}};$scope.contentBpService.OmniRemoteInvoke(configObj).then(function(result,event){var resp=angular.fromJson(result);$timeout(function(){if("OK"!==resp.error||!resp.productTree)return $rootScope.loading=!1,$scope.$dismiss("cancel"),void $window.alert(new Error(resp.error));cfgProducts=baseCtrl.prototype.prepareCartHierarchy(resp.productTree,"children"),$scope.content=cfgProducts,baseCtrl.prototype.configureAttributes($scope.content[0]),$rootScope.loading=!1})},function(error){$rootScope.loading=!1,$scope.$dismiss("cancel"),$window.alert(new Error(angular.toJson(error)))})},$scope.executeQueryableMethod=function(attr){var queryItems=attr.querycode__c.split("|");if(queryItems.length<2);else{var className=queryItems[0],methodName=queryItems[1],input=queryItems[2];if(void 0===input&&(input=null),""!==attr.attributeRunTimeInfo.value&&void 0!==attr.attributeRunTimeInfo.value){var inputJSON=null===input?{}:JSON.parse(input);inputJSON.userInput=attr.attributeRunTimeInfo.value,input=inputJSON}var options=queryItems[3];void 0!==options&&null!==options||(options={});var persistComponentId=function(){try{return $scope.contentResp.propSetMap.persistentComponent[$scope.pcIndex].id}catch(exception){return""}}(),configObj={sClassName:className,sMethodName:methodName,input:angular.toJson(input),options:angular.toJson(options),iTimeout:null,label:{label:$scope.contentCtrl&&$scope.contentCtrl.name||persistComponentId}};$scope.contentBpService.OmniRemoteInvoke(configObj).then(function(result,event){if(attr.attributeRunTimeInfo.queryresults=[],result.length>0&&$.isArray(result))attr.attributeRunTimeInfo.queryresults=result;else for(key in result=angular.fromJson(result))$.isArray(result[key])&&(attr.attributeRunTimeInfo.queryresults=result[key]);attr.attributeRunTimeInfo.showQueryResults=!0})}},$scope.setQueryResultToAttributeValue=function(attr,value){"Number"!==attr.attributeRunTimeInfo.dataType&&"Currency"!==attr.attributeRunTimeInfo.dataType&&"Percent"!==attr.attributeRunTimeInfo.dataType||(value=parseFloat(value)?parseFloat(value):null),attr.attributeRunTimeInfo.value=value,attr.attributeRunTimeInfo.showQueryResults=!1},$scope.createProductList=function(productHierarchy){var productStructure=$.extend(!0,{},productHierarchy),productList=[];return angular.forEach(productStructure,function(rootProduct){if("object"==typeof rootProduct){var children=rootProduct.children;delete rootProduct.children,delete rootProduct.isRoot,delete rootProduct.level,delete rootProduct.hasConfigurableAttributes,delete rootProduct.$$hashKey,delete rootProduct.showAttrConfig,delete rootProduct.isAttrParsed,delete rootProduct.categoryMap,rootProduct.JSONAttribute=JSON.stringify(rootProduct.JSONAttribute),productList.push(rootProduct),children&&$scope.flattenChildren(productList,children)}}),productList},$scope.flattenChildren=function(productList,products){angular.forEach(products,function(product){var children=product.children;delete product.children,delete product.isRoot,delete product.level,delete product.hasConfigurableAttributes,delete product.$$hashKey,delete product.showAttrConfig,delete product.isAttrParsed,delete product.categoryMap,product.JSONAttribute=JSON.stringify(product.JSONAttribute),productList.push(product),children&&$scope.flattenChildren(productList,children)})},$scope.onClickMultiSelect=function(scp,control,option,quantity){var validForm=!1;if(scp.qtyChanged=!1,"Multi Picklist"===control.attributeRunTimeInfo.dataType){if(control.isrequired__c)if(0==quantity||null==quantity)validForm=!0;else if("Checkbox"===control.attributeRunTimeInfo.uiDisplayType){if(option&&option.checked)validForm=!0;else for(var i=0;i<control.attributeRunTimeInfo.values.length;i++)if(control.attributeRunTimeInfo.values[i].checked){validForm=!0;break}}else control.attributeRunTimeInfo.selectedItems&&control.attributeRunTimeInfo.selectedItems.length>0&&(validForm=!0);else validForm=!0;$timeout(function(){scp.loopform.$setValidity("required",validForm)})}},$scope.onClickConfigProdQuantity=function(prod,quantity){quantity>=0&&(!prod.maxQuantity||quantity<=prod.maxQuantity)&&(!prod.minQuantity||quantity>=prod.minQuantity)&&(prod.quantity=quantity)}}),bpModule.controller("ModalDocuSignEmbeddedCtrl",function($scope,$rootScope,$window,$sce,$timeout,bpService,mElementScp,mInput,mControl,$templateCache){$scope.OmniDocuSignModalClose=customLabels.OmniDocuSignModalClose,$scope.OmniDocuSignModalViewPdf=customLabels.OmniDocuSignModalViewPdf,$scope.OmniDocuSignModalTitle=customLabels.OmniDocuSignModalTitle,$scope.OmniConfigProdModalOk=customLabels.OmniConfigProdModalOk,$scope.elementScp=mElementScp,$scope.input=mInput,$scope.control=mControl,$scope.bpService=bpService,$scope.viewPdf=!1,$scope.disableViewPdf=!1,$scope.elementScp.docStatus="";var currentUrl,sClassName=$scope.bpService.sNSC+"DefaultDocuSignOmniScriptIntegration",options=mControl.propSetMap.remoteOptions,clsPrefix=angular.equals(sfdcVars.layout,"lightning")?"slds-":angular.equals(sfdcVars.layout,"newport")?"nds-":"",redirectUrl=document.location.protocol+"//"+document.location.host,absolutePath=document.location.pathname.substring(0,document.location.pathname.indexOf("/apex")),defaultUrl=window.OmniOut?"/OmniScriptDocuSignReturnPage.html":absolutePath+"/apex/"+$scope.elementScp.nsPrefix+"OmniScriptDocuSignReturnPage",iTimeout=$scope.control.propSetMap.remoteTimeout;redirectUrl+=defaultUrl,void 0!=$scope.control.propSetMap.docuSignReturnUrl&&""!=$scope.control.propSetMap.docuSignReturnUrl&&(defaultUrl=redirectUrl=$scope.control.propSetMap.docuSignReturnUrl),currentUrl=(currentUrl=document.location.href).length>400?currentUrl.substring(0,400):currentUrl,options.returnUrl=currentUrl+"/toOS-"+$scope.control.name+"-fromDoc/",options.elementName=$scope.control.name,$scope.initDocuSignModal=function(){$rootScope.loading=!0;var frameEle,frameHeight,isSFDCPage=!1,eleName=$scope.control.name;if(angular.equals(sfdcVars.layout,"lightning")||angular.equals(sfdcVars.layout,"newport")?($("."+clsPrefix+"modal").find("#docusign-pdf").hide(),frameEle=$("."+clsPrefix+"modal").find("."+clsPrefix+"modal__container").find("#docusign-frame iframe")):($(".vlc-docusign-modal").parents(".modal-dialog").addClass("vlocity"),$(".vlc-docusign-modal").find("#docusign-pdf").hide(),frameEle=$(".vlc-docusign-modal").find("#docusign-frame iframe")),frameHeight=frameEle.height(),!frameEle.length>0)$timeout(function(){$scope.initDocuSignModal()},100);else{$(frameEle).on("load",function(event){if(isSFDCPage){try{var statusString=event.currentTarget.contentWindow.location.href,modalElement=null;if(new RegExp("toOS-"+encodeURI($scope.control.name)+"-fromDoc").test(statusString)||new RegExp("toOS-"+$scope.control.name+"-fromDoc").test(statusString)||new RegExp(defaultUrl).test(statusString)){$scope.frameLoading=!0,modalElement=angular.equals(sfdcVars.layout,"lightning")||angular.equals(sfdcVars.layout,"newport")?"."+clsPrefix+"modal":".vlc-docusign-modal",$(modalElement).find("#docusign-frame iframe").hide();var html="";if("lightning"==bpService.layout)html='<div id="iframeDummy"><div class="mask vlc-slds-mask" ng-show="frameLoading"><div class="center-block spinner slds-spinner_container nds-spinner_container"><div class="slds-spinner--brand slds-spinner slds-spinner--large nds-spinner_brand nds-spinner nds-spinner_large" role="alert"><div class="slds-spinner__dot-a nds-spinner__dot-a"></div><div class="slds-spinner__dot-b nds-spinner__dot-b"></div></div></div></div></div>';else if("newport"==bpService.layout){html='<div id="iframeDummy"><div class="mask vlc-slds-mask" ng-show="frameLoading">'+$templateCache.get("vlcNdsSpinner.html")+"</div>"}if($(modalElement).find("#docusign-frame").append(html),$(modalElement).find("#docusign-frame").find("#iframeDummy").css("height",frameHeight),$(modalElement).find("#docusign-frame").find("#iframeDummy").find(".vlc-slds-mask").css("left","-7%"),statusString.indexOf(defaultUrl)>=0)return $scope.frameLoading=!1,delete $scope.frameLoading,$(modalElement).find("#docusign-frame iframe").show(),$(modalElement).find("#docusign-frame").find("#iframeDummy").remove(),$(modalElement).find("#docusign-frame").find("#iframeDummy").empty(),$(modalElement).find("#docusign-frame iframe").css("height",frameHeight),$scope.$apply(),!1;$timeout(function(){statusString=statusString.substring(statusString.indexOf("event="),statusString.length),event.currentTarget.src=redirectUrl+"?"+statusString,"signing_complete"===(statusString=statusString.substring(statusString.indexOf("=")+1,statusString.length))?(statusString="Completed",$scope.viewPdf=!0,$scope.$digest(),(angular.equals(sfdcVars.layout,"lightning")||angular.equals(sfdcVars.layout,"newport"))&&$(modalElement).find(".vlc-expand-docusign-modal").css("left","177px")):"decline"===statusString?statusString="Declined":"cancel"===statusString&&(statusString="Cancel"),angular.isDefined($scope.elementScp.bpTree.response[eleName])&&($scope.elementScp.bpTree.response[eleName][0].status=statusString),modalElement=null},3e3)}}catch(e){console.log(e.message)}isSFDCPage=!1}isSFDCPage=!0});var configObj={sClassName:sClassName,sMethodName:"sendEnvelopeEmbedded",input:angular.toJson($scope.input),options:angular.toJson(options),iTimeout:iTimeout,label:{label:mControl&&mControl.name}};$scope.bpService.OmniRemoteInvoke(configObj).then(function(result,event){var resp=angular.fromJson(result);if("OK"!==resp.error)return $rootScope.loading=!1,$scope.$dismiss("cancel"),void $window.alert(new Error(resp.error));$scope.redirectUri=$sce.trustAsResourceUrl(resp[eleName].url),$scope.envelopeId=resp[eleName].envelopeId,$scope.envelopeId&&(angular.isUndefined($scope.elementScp.bpTree.response[eleName])&&($scope.elementScp.bpTree.response[eleName]=[]),$scope.elementScp.bpTree.response[eleName].unshift({status:"In Process",envelopeId:$scope.envelopeId})),$timeout(function(){$rootScope.loading=!1},1e3)},function(error){$rootScope.loading=!1,$scope.$dismiss("cancel"),$window.alert(new Error(angular.toJson(error)))})}},$scope.closeModal=function(){$scope.$dismiss("cancel")},$scope.ViewPDF=function(){var sClassName=$scope.bpService.sNSC+"DefaultDocuSignOmniScriptIntegration",options={envelopeId:$scope.envelopeId};$rootScope.loading=!0;var configObj={sClassName:sClassName,sMethodName:"getEnvelopePDF",input:angular.toJson({}),options:angular.toJson(options),iTimeout:null,label:{label:mControl&&mControl.name}};$scope.bpService.OmniRemoteInvoke(configObj).then(function(result,event){$rootScope.loading=!1;var resp=angular.fromJson(result);if("OK"!==resp.error)return $scope.$dismiss("cancel"),void $window.alert(new Error(resp.error));$scope.pdfDocUrl=$sce.trustAsResourceUrl("data:application/pdf;base64,"+resp.docuSignEnvelopePDF),angular.equals(sfdcVars.layout,"lightning")||angular.equals(sfdcVars.layout,"newport")?($("."+clsPrefix+"modal").find("#docusign-frame").hide(),$("."+clsPrefix+"modal").find("#docusign-pdf").show(),$timeout(function(){var ele=$("."+clsPrefix+"modal").find("#docusign-pdf");$("."+clsPrefix+"modal").find("."+clsPrefix+"modal__content").empty(),$("."+clsPrefix+"modal").find("."+clsPrefix+"modal__content").append(ele)})):($(".vlc-docusign-modal").find("#docusign-frame").hide(),$(".vlc-docusign-modal").find("#docusign-pdf").show(),$timeout(function(){var ele=$(".vlc-docusign-modal").find("#docusign-pdf");$(".vlc-docusign-modal").find(".modal-body").empty(),$(".vlc-docusign-modal").find(".modal-body").append(ele)})),$scope.disableViewPdf=!0},function(error){$rootScope.loading=!1,$scope.$dismiss("cancel"),$window.alert(new Error(angular.toJson(error)))})}}),bpModule.controller("hybridCPQCartController",function($scope,$rootScope,$window,$sldsModal,$timeout,$compile,$templateCache,bpService){$scope.configAttributeObj=null,$scope.reRenderAttributesForm=!1,$rootScope.vlocity.userCurrency=$scope.bpTree.userCurrencyCode;var vlcHCartHybStr,queue=[],isConfigInProcess=!1;"parentIFrame"in window&&(parentIFrame.setHeightCalculationMethod("documentElementOffset"),-1===(vlcHCartHybStr=$templateCache.get("vlcHCartHyb.html")).indexOf("vlc-slds-cart-container__parentIFrame")&&(vlcHCartHybStr=vlcHCartHybStr.replace("vlc-slds-cart-container","vlc-slds-cart-container vlc-slds-cart-container__parentIFrame"),$templateCache.put("vlcHCartHyb.html",vlcHCartHybStr),$compile($templateCache))),$scope.initParent=function(scp,prod){scp[scp.gParentId+"_"+scp.prodHierLevel]=prod;var childArray=[];prod.lineItems&&prod.lineItems.records&&angular.forEach(prod.lineItems.records,function(value){childArray.push(value)}),prod.childProducts&&prod.childProducts.records&&angular.forEach(prod.childProducts.records,function(childProd){$scope.checkIfAddonIsNotInCart(prod,childProd)&&childArray.push(childProd)}),prod.productGroups&&prod.productGroups.records&&angular.forEach(prod.productGroups.records,function(value){childArray.push(value)}),prod.childRecords=childArray},$scope.checkIfAddonIsNotInCart=function(parent,addonChildProduct){var parentCardinalityMap;return!((parentCardinalityMap=parent[$scope.nsPrefix+"InCartQuantityMap__c"])&&parentCardinalityMap.value&&!_.isEmpty(parentCardinalityMap.value)&&addonChildProduct.Product2&&addonChildProduct.Product2.Id&&parentCardinalityMap.value[addonChildProduct.Product2.Id])},$scope.checkCardinalityForAdd=function(parent,lineItemChildProduct){var product2Id=lineItemChildProduct.PricebookEntry.Product2.Id,additionalQuantity=lineItemChildProduct.defaultQuantity>0?lineItemChildProduct.defaultQuantity:1;return checkCardinalityForAddOrClone(parent,lineItemChildProduct,product2Id,additionalQuantity)},$scope.checkCardinalityForClone=function(parent,lineItemChildProduct){var product2Id=lineItemChildProduct.PricebookEntry.Product2.Id,additionalQuantity=lineItemChildProduct.Quantity.value;return additionalQuantity>0&&checkCardinalityForAddOrClone(parent,lineItemChildProduct,product2Id,additionalQuantity)},$scope.checkCardinalityForAddon=function(parent,addonChildProduct){var product2Id=addonChildProduct.Product2.Id,additionalQuantity=addonChildProduct.defaultQuantity>0?addonChildProduct.defaultQuantity:1;return parent[$scope.nsPrefix+"InCartQuantityMap__c"]&&parent[$scope.nsPrefix+"InCartQuantityMap__c"].value?checkCardinalityForAddOrClone(parent,addonChildProduct,product2Id,additionalQuantity):additionalQuantity<=parent.groupMaxQuantity};var checkCardinalityForAddOrClone=function(parent,lineItemChildProduct,product2Id,additionalQuantity){var numOfInstancesOfChildProductTypeUnderParent,totalNumOfChildrenUnderParent,productId,parentInCartQuantityMap=parent[$scope.nsPrefix+"InCartQuantityMap__c"].value;if(parentInCartQuantityMap&&(numOfInstancesOfChildProductTypeUnderParent=parentInCartQuantityMap[product2Id]),!(void 0===numOfInstancesOfChildProductTypeUnderParent||numOfInstancesOfChildProductTypeUnderParent+additionalQuantity<=lineItemChildProduct.maxQuantity))return!1;if(void 0!==parent.groupMaxQuantity){for(productId in totalNumOfChildrenUnderParent=0,parentInCartQuantityMap)parentInCartQuantityMap.hasOwnProperty(productId)&&(totalNumOfChildrenUnderParent+=parentInCartQuantityMap[productId]);return totalNumOfChildrenUnderParent+additionalQuantity<=parent.groupMaxQuantity}return!0};$scope.checkCardinalityForClone=function(parent,lineItemChildProduct){var product2Id=lineItemChildProduct.PricebookEntry.Product2.Id,additionalQuantity=lineItemChildProduct.Quantity.value;return additionalQuantity>0&&checkCardinalityForAddOrClone(parent,lineItemChildProduct,product2Id,additionalQuantity)},$scope.checkCardinalityForDelete=function(parent,lineItemChildProduct){var numOfInstancesOfChildProductTypeUnderParent,totalNumOfChildrenUnderParent,productId,parentInCartQuantityMap=parent[$scope.nsPrefix+"InCartQuantityMap__c"].value;if(parentInCartQuantityMap&&(numOfInstancesOfChildProductTypeUnderParent=parentInCartQuantityMap[lineItemChildProduct.PricebookEntry.Product2.Id]),void 0===lineItemChildProduct.Quantity.value)return!0;if(!(numOfInstancesOfChildProductTypeUnderParent-lineItemChildProduct.Quantity.value>=lineItemChildProduct.minQuantity))return!1;if(void 0!==parent.groupMaxQuantity){for(productId in totalNumOfChildrenUnderParent=0,parentInCartQuantityMap)parentInCartQuantityMap.hasOwnProperty(productId)&&(totalNumOfChildrenUnderParent+=parentInCartQuantityMap[productId]);return totalNumOfChildrenUnderParent-lineItemChildProduct.Quantity.value>=parent.groupMinQuantity}return!0};var className=bpService.sNSC+"CpqAppHandler";$scope.addProductFromCart=function(parent,obj,gParent){var parentFromAPI,configAddObject={records:[{}]},parentInCardData=parent,opt={},inputParam=Object.keys(obj.actions.addtocart.remote.params).length>0?obj.actions.addtocart.remote.params:Object.keys(obj.actions.addtocart.rest.params).length>0?obj.actions.addtocart.rest.params:null,product2Name="lineItem"===obj.itemType?obj.PricebookEntry.Product2.Name:obj.Product2.Name;if("lineItem"===obj.itemType?$scope.checkCardinalityForAdd(parentInCardData,obj):$scope.checkCardinalityForAddon(parentInCardData,obj)){configAddObject.records[0]=angular.copy(parent),angular.forEach(["Attachments","actions","messages","childProducts","lineItems","attributeCategories","childRecords"],function(key){delete configAddObject.records[0][key]}),inputParam.items[0].parentRecord=configAddObject,inputParam.hierarchy=20,$rootScope.loading=!0;var configObj={sClassName:className,sMethodName:"postCartsItems",input:angular.toJson(inputParam),options:angular.toJson(opt),iTimeout:null,label:null};bpService.OmniRemoteInvoke(configObj).then(function(result){var configObjCart={sClassName:className,sMethodName:"getCarts",input:angular.toJson(inputParam),options:angular.toJson(opt),iTimeout:null,label:null};bpService.OmniRemoteInvoke(configObjCart).then(function(result){$rootScope.loading=!1;var msgIdArray,resp=angular.fromJson(result),bundlehasError=!1,msgArry=[];$scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[$scope.vlcPC.pcIndex]+"_Top"]=[resp],$scope.showErrorIconInCart($scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[0]+"_Top"][0].messages,$scope),angular.forEach(resp.messages,function(message){msgIdArray=message.messageId.split("|"),"ERROR"===message.severity&&gParent&&gParent.Id.value==msgIdArray[0]&&gParent.PricebookEntry.Product2Id==msgIdArray[1]&&(bundlehasError=!0,msgArry.push(message))}),bundlehasError&&gParent&&(gParent.messages=msgArry)},function(error){$scope.handleRemoteCallError(null,error,!0,!1)});var resp=angular.fromJson(result),hasError=!1,errorMsg="";angular.forEach(resp.messages,function(message){"ERROR"===message.severity&&(hasError=!0,errorMsg=message.message)}),!hasError||resp.records?(parentFromAPI=resp.records[0],parentInCardData[$scope.nsPrefix+"InCartQuantityMap__c"]=parentFromAPI[$scope.nsPrefix+"InCartQuantityMap__c"],toBeAddedLineItem=parentFromAPI.lineItems.records[0],insertLineItemToParent(parentInCardData,toBeAddedLineItem),$scope.initParent($scope,parentInCardData)):$scope.handleRemoteCallError(null,errorMsg,!0,!1)},function(error){$scope.handleRemoteCallError(null,error,!0,!1)})}else alert("Cardinality error: CPQAddItemFailed For :"+product2Name)};var insertLineItemToParent=function(parentInCardData,toBeAddedLineItem){var lineItemListWithTheAddedItem=[];parentInCardData.lineItems?lineItemListWithTheAddedItem=angular.copy(parentInCardData.lineItems.records):parentInCardData.lineItems={records:[{}]},lineItemListWithTheAddedItem.push(toBeAddedLineItem),parentInCardData.lineItems.records=lineItemListWithTheAddedItem,(void 0===toBeAddedLineItem.minQuantity||0===toBeAddedLineItem.minQuantity)&&toBeAddedLineItem.defaultQuantity>0&&removeAddonFromParent(parentInCardData,toBeAddedLineItem.PricebookEntryId.value)},removeAddonFromParent=function(parentInCardData,toBeRemovedAddonId){var addonList,i,addonListWithoutTheRemovedAddon=[];if(parentInCardData.childProducts){for(addonList=angular.copy(parentInCardData.childProducts.records),i=0;i<addonList.length;i++)addonList[i].Id.value!==toBeRemovedAddonId&&addonListWithoutTheRemovedAddon.push(addonList[i]);parentInCardData.childProducts.records=addonListWithoutTheRemovedAddon}};$scope.deleteProductFromCart=function(parent,product,index,gParent){var parentInCardData,itemObject,addonProduct,opt={},inputParam=Object.keys(product.actions.deleteitem.remote.params).length>0?product.actions.deleteitem.remote.params:Object.keys(product.actions.deleteitem.rest.params).length>0?product.actions.deleteitem.rest.params:null;$rootScope.loading=!0;var configObj={sClassName:className,sMethodName:"deleteCartsItems",input:angular.toJson(inputParam),options:angular.toJson(opt),iTimeout:null,label:null};bpService.OmniRemoteInvoke(configObj).then(function(result){var configObjCart={sClassName:className,sMethodName:"getCarts",input:angular.toJson(inputParam),options:angular.toJson(opt),iTimeout:null,label:null},deleteErrorMsg="";bpService.OmniRemoteInvoke(configObjCart).then(function(res){$rootScope.loading=!1;var msgIdArray,resp=angular.fromJson(res),msgArry=[];$scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[$scope.vlcPC.pcIndex]+"_Top"]=[resp],$scope.showErrorIconInCart($scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[0]+"_Top"][0].messages,$scope),angular.forEach(resp.messages,function(message){msgIdArray=message.messageId.split("|"),"ERROR"===message.severity&&gParent&&gParent.Id.value==msgIdArray[0]&&gParent.PricebookEntry.Product2Id==msgIdArray[1]&&msgArry.push(message)}),gParent&&(gParent.messages=msgArry)},function(error){$scope.handleRemoteCallError(null,error,!0,!1)});var data=angular.fromJson(result),hasError=!1;angular.forEach(data.messages,function(message){"ERROR"===message.severity&&(hasError=!0,deleteErrorMsg=message.message)}),hasError?""!==deleteErrorMsg&&$scope.handleRemoteCallError(null,deleteErrorMsg,!0,!1):data.records&&0!==data.records.length?(parentInCardData=parent,itemObject=product,addonProduct=data.records[0].childProducts?data.records[0].childProducts.records[0]:null,deleteLineItem(parentInCardData,itemObject,addonProduct,!1),$scope.initParent($scope,parentInCardData)):$scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[$scope.vlcPC.pcIndex]].records.splice(index,1),$scope.closeAttributePanel()},function(error){$scope.handleRemoteCallError(null,error,!0,!1)})};var deleteLineItem=function(parentInCardData,toBeRemovedLineItem,addonProductFromAPI,cardinalityMapAlreadyUpdated){var parentInCardDataCardinalityMap,toBeRemovedLineItemProduct2Id,toBeRemovedLineItemQuantity,addonProductIsLastInstanceUnderParent,numOfLineItemsUnderParent,numOfChildProductsUnderParent,i,j,cardinalityMap,product2Id,changeQty,productCountAfterChange,productCountInMap,toBeRemovedLineItemId=toBeRemovedLineItem.Id.value;if(cardinalityMapAlreadyUpdated||(parentInCardDataCardinalityMap=parentInCardData[$scope.nsPrefix+"InCartQuantityMap__c"].value,toBeRemovedLineItemProduct2Id=toBeRemovedLineItem.PricebookEntry.Product2.Id,toBeRemovedLineItemQuantity=toBeRemovedLineItem.Quantity.value,parentInCardDataCardinalityMap&&(changeQty=-1*toBeRemovedLineItemQuantity,(productCountInMap=(cardinalityMap=parentInCardDataCardinalityMap)[product2Id=toBeRemovedLineItemProduct2Id])&&((productCountAfterChange=productCountInMap+changeQty)>0?cardinalityMap[product2Id]=productCountAfterChange:delete cardinalityMap[product2Id]))),function(parentInCardData,toBeRemovedLineItemId,addonProductFromAPI){var lineItemList,i,currentLineItem,lineItemListWithoutTheRemovedItem=[];if(parentInCardData.lineItems){for(lineItemList=angular.copy(parentInCardData.lineItems.records),i=0;i<lineItemList.length;i++)(currentLineItem=lineItemList[i]).Id.value!==toBeRemovedLineItemId&&lineItemListWithoutTheRemovedItem.push(currentLineItem);parentInCardData.lineItems.records=lineItemListWithoutTheRemovedItem}}(parentInCardData,toBeRemovedLineItemId),addonProductFromAPI&&(void 0===addonProductFromAPI.minQuantity||0===addonProductFromAPI.minQuantity)&&addonProductFromAPI.defaultQuantity>0){if(!parentInCardData.actions||parentInCardData.actions&&!parentInCardData.actions.getproducts){for(addonProductIsLastInstanceUnderParent=!0,numOfLineItemsUnderParent=parentInCardData.lineItems.records.length,i=0;i<numOfLineItemsUnderParent;i++)parentInCardData.lineItems.records[i].PricebookEntry.Product2.Id===addonProductFromAPI.Product2.Id&&(addonProductIsLastInstanceUnderParent=!1);addonProductIsLastInstanceUnderParent&&(parentInCardData.childProducts||(parentInCardData.childProducts={},parentInCardData.childProducts.records=[]),parentInCardData.childProducts.records.push(addonProductFromAPI))}}else if(addonProductFromAPI&&(void 0===addonProductFromAPI.minQuantity||0===addonProductFromAPI.minQuantity)&&0===addonProductFromAPI.defaultQuantity)if(parentInCardData.actions&&parentInCardData.actions.getproducts)removeAddonFromParent(parentInCardData,toBeRemovedLineItem.PricebookEntryId.value);else for(numOfChildProductsUnderParent=parentInCardData.childProducts.records.length,j=0;j<numOfChildProductsUnderParent;j++)if(parentInCardData.childProducts.records[j].Product2.Id===addonProductFromAPI.Product2.Id){parentInCardData.childProducts.records[j]=addonProductFromAPI;break}};$scope.clone=function(parent,itemObject){var parentFromAPI,configCloneObject={records:[{}]},cloneActionObj=Object.keys(itemObject.actions.cloneitem.remote.params).length>0?itemObject.actions.cloneitem.remote.params:Object.keys(itemObject.actions.cloneitem.rest.params).length>0?itemObject.actions.cloneitem.rest.params:null,parentInCardData=parent,opt={},product2Name=itemObject.PricebookEntry.Product2.Name;if(itemObject[$scope.nsPrefix+"ParentItemId__c"]&&itemObject[$scope.nsPrefix+"ParentItemId__c"].value){product2Name="lineItem"===itemObject.itemType?itemObject.PricebookEntry.Product2.Name:itemObject.Product2.Name;if(!$scope.checkCardinalityForClone(parentInCardData,itemObject))return void alert("Cardinality error: CPQAddItemFailed For :"+product2Name)}cloneActionObj.items=[{itemId:itemObject.Id.value}],parent&&(configCloneObject.records[0]=angular.copy(parent),angular.forEach(["Attachments","actions","messages","childProducts","lineItems","attributeCategories","childRecords"],function(key){delete configCloneObject.records[0][key]}),cloneActionObj.items[0].parentRecord=configCloneObject),cloneActionObj.hierarchy=20,$rootScope.loading=!0;var configObj={sClassName:className,sMethodName:"cloneItems",input:angular.toJson(cloneActionObj),options:angular.toJson(opt),iTimeout:null,label:null};bpService.OmniRemoteInvoke(configObj).then(function(result){var configObjCart={sClassName:className,sMethodName:"getCarts",input:angular.toJson(cloneActionObj),options:angular.toJson(opt),iTimeout:null,label:null};bpService.OmniRemoteInvoke(configObjCart).then(function(res){$rootScope.loading=!1;var resp=angular.fromJson(res);$scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[$scope.vlcPC.pcIndex]+"_Top"]=[resp],$scope.showErrorIconInCart($scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[0]+"_Top"][0].messages,$scope)},function(error){$scope.handleRemoteCallError(null,error,!0,!1)});var data=angular.fromJson(result);data.records[0][$scope.nsPrefix+"RootItemId__c"]&&data.records[0][$scope.nsPrefix+"RootItemId__c"].value&&data.records[0][$scope.nsPrefix+"RootItemId__c"].value===data.records[0].Id.value?$scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[$scope.vlcPC.pcIndex]].records.unshift(data.records[0]):(parentFromAPI=data.records[0],parentInCardData[$scope.nsPrefix+"InCartQuantityMap__c"]=parentFromAPI[$scope.nsPrefix+"InCartQuantityMap__c"],toBeAddedLineItem=parentFromAPI.lineItems.records[0],insertLineItemToParent(parentInCardData,toBeAddedLineItem),$scope.initParent($scope,parentInCardData))},function(error){$scope.handleRemoteCallError(null,error,!0,!1)})},$scope.lineItemIdsWithInvalidQuantity=[],$scope.updateLineField=function(parent,itemObject,quantity,updateAttributeData){var modifiedChildItemObject,parentFromAPI,parentInCardData,updatedLineItemFromAPI,updateItemsActionObj={},configUpdateObject={records:[{}]},deleteArrayList=["Attachments","actions","messages","childProducts","lineItems","childRecords"],opt={};if(quantity&&(itemObject.Quantity.value=quantity),0!==quantity){var errorMessage=lineFieldValidation(itemObject);if(itemObject.fieldValidationMessage="",errorMessage)itemObject.fieldValidationMessage=errorMessage;else{parent?(configUpdateObject.records[0]=angular.copy(parent),angular.forEach(deleteArrayList,function(key){delete configUpdateObject.records[0][key]}),modifiedChildItemObject=angular.copy(itemObject),angular.forEach(deleteArrayList,function(key){delete modifiedChildItemObject[key]}),configUpdateObject.records[0].lineItems={records:[modifiedChildItemObject]}):(configUpdateObject.records[0]=angular.copy(itemObject),angular.forEach(deleteArrayList,function(key){delete configUpdateObject.records[0][key]})),(updateItemsActionObj=Object.keys(itemObject.actions.updateitems.remote.params).length>0?itemObject.actions.updateitems.remote.params:Object.keys(itemObject.actions.updateitems.rest.params).length>0?itemObject.actions.updateitems.rest.params:null).items=configUpdateObject,$rootScope.loading=!0;var configObj={sClassName:className,sMethodName:"putCartsItems",input:angular.toJson(updateItemsActionObj),options:angular.toJson(opt),iTimeout:null,label:null};bpService.OmniRemoteInvoke(configObj).then(function(result){var configObjCart={sClassName:className,sMethodName:"getCarts",input:angular.toJson(updateItemsActionObj),options:angular.toJson(opt),iTimeout:null,label:null};bpService.OmniRemoteInvoke(configObjCart).then(function(res){$rootScope.loading=!1,resp=angular.fromJson(res),$scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[$scope.vlcPC.pcIndex]+"_Top"]=[resp],$scope.showErrorIconInCart($scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[0]+"_Top"][0].messages,$scope)},function(error){$scope.handleRemoteCallError(null,error,!0,!1)});var data=angular.fromJson(result),updateSuccessful=!1;parentInCardData=parent,angular.forEach(data.messages,function(message){"ERROR"===message.severity&&!0,"INFO"===message.severity&&"151"===message.code&&(updateSuccessful=!0)}),data.records[0].lineItems||data.records[0][$scope.nsPrefix+"ParentItemId__c"]&&data.records[0][$scope.nsPrefix+"ParentItemId__c"].value?(parentFromAPI=data.records[0],updatedLineItemFromAPI=data.records[0].lineItems.records[0],updatedLineItemInCardData=findLineItem(updatedLineItemFromAPI.Id.value,parentInCardData.lineItems.records),updatedLineItemInCardData.messages=updatedLineItemFromAPI.messages,parentInCardData.messages=parentFromAPI.messages,parentFromAPI.messages.length&&"142"===parentFromAPI.messages[0].code?recordLineItemQuantityInvalid(updatedLineItemFromAPI):updateSuccessful&&(parentInCardData[$scope.nsPrefix+"InCartQuantityMap__c"]=parentFromAPI[$scope.nsPrefix+"InCartQuantityMap__c"],copyUpdatableFields(updatedLineItemInCardData,updatedLineItemFromAPI,updateAttributeData),recordLineItemQuantityValid(updatedLineItemFromAPI))):(updatedLineItemFromAPI=data.records[0],updatedLineItemInCardData=itemObject,updatedLineItemInCardData.messages=updatedLineItemFromAPI.messages,copyUpdatableFields(updatedLineItemInCardData,updatedLineItemFromAPI,updateAttributeData))},function(error){$scope.handleRemoteCallError(null,error,!0,!1)})}}};var recordLineItemQuantityInvalid=function(item){_.includes($scope.lineItemIdsWithInvalidQuantity,item.Id.value)||$scope.lineItemIdsWithInvalidQuantity.push(item.Id.value)},recordLineItemQuantityValid=function(item){recordLineItemFieldValid($scope.lineItemIdsWithInvalidQuantity,item)},recordLineItemFieldValid=function(invalidList,item){_.includes(invalidList,item.Id.value)&&_.pull(invalidList,item.Id.value)},copyUpdatableFields=function(targetLineItem,sourceLineItem,updateAttributeData){targetLineItem.Quantity.value=sourceLineItem.Quantity.value,targetLineItem[$scope.nsPrefix+"RecurringTotal__c"].value=sourceLineItem[$scope.nsPrefix+"RecurringTotal__c"].value,targetLineItem[$scope.nsPrefix+"OneTimeTotal__c"].value=sourceLineItem[$scope.nsPrefix+"OneTimeTotal__c"].value,targetLineItem[$scope.nsPrefix+"RecurringManualDiscount__c"].value=sourceLineItem[$scope.nsPrefix+"RecurringManualDiscount__c"].value,targetLineItem[$scope.nsPrefix+"OneTimeManualDiscount__c"].value=sourceLineItem[$scope.nsPrefix+"OneTimeManualDiscount__c"].value,targetLineItem.messages=sourceLineItem.messages,updateAttributeData&&(targetLineItem.attributeCategories=sourceLineItem.attributeCategories)},findLineItem=function(searchLineItemId,lineItemList){var i,j,foundLineItem=null;for(i=0;i<lineItemList.length;i++)if(lineItemList[i].Id.value===searchLineItemId){foundLineItem=lineItemList[i];break}if(null!==foundLineItem)return foundLineItem;for(j=0;j<lineItemList.length;j++)if(lineItemList[j].lineItems&&lineItemList[j].lineItems.records.length>0)return findLineItem(searchLineItemId,lineItemList[j].lineItems.records)},lineFieldValidation=function(item){var label,msg="",recurringValue=item[$scope.nsPrefix+"RecurringManualDiscount__c"].value,oneTimeValue=item[$scope.nsPrefix+"OneTimeManualDiscount__c"].value,recurringDiscount=void 0!==recurringValue&&null!==recurringValue,oneTimeDiscount=void 0!==oneTimeValue&&null!==oneTimeValue,isDiscountValid=!(!recurringDiscount||!oneTimeDiscount),isQuantityValid=!!(item.Quantity.value&&item.Quantity.value>=1);return isQuantityValid?recurringDiscount?oneTimeDiscount||(label=item[$scope.nsPrefix+"OneTimeManualDiscount__c"].label):label=item[$scope.nsPrefix+"RecurringManualDiscount__c"].label:label=item.Quantity.label,isQuantityValid?isDiscountValid?item.Quantity.value<item.minQuantity?(msg=item.Name+" can not have less than "+item.minQuantity+" quantity.",recordLineItemQuantityInvalid(item)):item.Quantity.value>item.maxQuantity&&(msg=item.Name+" can not have more than "+item.maxQuantity+" quantity.",recordLineItemQuantityInvalid(item)):msg=label+" cannot be empty.":(msg=label+" cannot be set to 0. Please use the delete option if you would like to delete the item.",recordLineItemQuantityInvalid(item)),msg};function setProcessingLine(obj,flag){obj&&(obj.processingLine=flag)}function removeQueueElement(){queue.length>1&&queue.shift()}$scope.mapVDFObject=function(){return{fieldMapping:{type:"inputType",value:"userValues",label:"label",readonly:"readonly",required:"required",disabled:"disabled",hidden:"ishidden",multiple:"multiselect",customTemplate:"customTemplate",valuesArray:{field:"values",value:"value",label:"label",disabled:"disabled"}},pathMapping:{levels:2,path:"productAttributes.records"}}},$scope.openConfigPan=function(parent,gParent,itemObject,isConfigEnabled){var itemKeys,lookupItem,editableItem,lookupDisplayValueItemKey,cartId,lineItemId;$scope.reRenderAttributesForm=!1,$scope.configAttributeObj=null,$scope.configItemObject=itemObject,$scope.parent=parent,$scope.gParent=gParent,isConfigInProcess?removeQueueElement():queue=[],$timeout(function(){isConfigEnabled&&itemObject?($scope.configAttributeObj=itemObject.attributeCategories&&itemObject.attributeCategories.records||[],updatedAttributes=$scope.attributesObj,$scope.reRenderAttributesForm=isConfigEnabled,queue.push({parent:$scope.parent,gParent:$scope.gParent,configItem:$scope.configItemObject,updatedAttributes:$scope.configAttributeObj}),itemKeys=_.keys(itemObject),$scope.lookupItemList=[],$scope.editableItemList=[],cartId=$scope.bpTree.response.cartId,lineItemId=itemObject.Id.value,angular.forEach(itemKeys,function(key){itemObject[key].editable&&!itemObject[key].hidden&&("REFERENCE"===itemObject[key].dataType?(lookupItem=angular.copy(itemObject[key]),lookupDisplayValueItemKey=key.slice(0,-1)+"r",itemObject[lookupDisplayValueItemKey]&&(lookupItem.displayValue=itemObject[lookupDisplayValueItemKey].Name,lookupItem.cartId=cartId,lookupItem.lineItemId=lineItemId,$scope.lookupItemList.push(lookupItem))):(editableItem=angular.copy(itemObject[key]),$scope.editableItemList.push(editableItem)))})):($scope.configAttributeObj=null,$scope.configItemObject=null,$scope.reRenderAttributesForm=!1)},0)},$scope.closeAttributePanel=function(){$scope.reRenderAttributesForm=!1,$scope.configAttributeObj=null,$scope.configItemObject=null,$scope.parent=null,$scope.gParent=null,removeQueueElement()},$scope.getModifiedAttributes=function(e,alwaysRunRules,alwaysSave){var field,modifyAttributesActionObj=angular.copy($scope.configItemObject.actions.modifyattributes),attributesObj={records:[]},itemObject=angular.copy($scope.configItemObject);if(removeQueueElement(),isConfigInProcess=!0,field=function(path){var lastDotIndex;if(!path)return;-1!=(lastDotIndex=path.lastIndexOf("."))&&(path=path.substring(0,lastDotIndex));return _.get($scope,path)}(e&&e.target&&e.target.getAttribute("ng-model")),!(!angular.isDefined(alwaysRunRules)||!alwaysRunRules)||field&&field.hasRules){$scope.configItemObject.attributeCategories&&$scope.configItemObject.attributeCategories.records&&($scope.configItemObject.attributeCategories.records=$scope.configAttributeObj),attributesObj.records[0]=_.pick(itemObject,["attributeCategories","Id","Product2","PricebookEntry","PricebookEntryId"]),modifyAttributesActionObj.remote.params.items=attributesObj;var configObj={sClassName:className,sMethodName:"putItemAttributes",input:angular.toJson(modifyAttributesActionObj.remote.params),options:angular.toJson({}),iTimeout:null,label:null};$rootScope.loading=!0,bpService.OmniRemoteInvoke(configObj).then(function(data){$rootScope.loading=!1;(data=angular.fromJson(data)).records.length>0&&(data.messages.some(function(msg){return"161"===msg.code})?(document.activeElement,$scope.reRenderAttributesForm=!0,$scope.configItemObject.attributeCategories=data.records[0].attributeCategories,$scope.configAttributeObj=data.records[0].attributeCategories.records||[],$timeout(function(){$scope.reRenderAttributesForm=!1,$timeout(function(){$scope.configSubmit()},800)},0)):$scope.configSubmit())},function(error){$scope.handleRemoteCallError(null,error,!0,!1)})}else alwaysSave&&(saveTimeout=$timeout(function(){$scope.configSubmit()},800))},$scope.configSubmit=function(){var updateItemsActionObj={},configUpdateObject={records:[{}]},deleteArrayList=["Attachments","attributes","childProducts","lineItems","childRecords"],opt={};setProcessingLine($scope.configItemObject,!0),queue[0].configItem.attributeCategories&&queue[0].configItem.attributeCategories.records&&(queue[0].configItem.attributeCategories.records=queue[0].updatedAttributes),queue[0].parent?(configUpdateObject.records[0]=angular.copy(queue[0].parent),angular.forEach(deleteArrayList,function(key){delete configUpdateObject.records[0][key]}),modifiedChildItemObject=angular.copy(queue[0].configItem),angular.forEach(deleteArrayList,function(key){delete modifiedChildItemObject[key]}),configUpdateObject.records[0].lineItems={records:[modifiedChildItemObject]}):(configUpdateObject.records[0]=angular.copy(queue[0].configItem),angular.forEach(deleteArrayList,function(key){delete configUpdateObject.records[0][key]})),(updateItemsActionObj=Object.keys(queue[0].configItem.actions.updateitems.remote.params).length>0?queue[0].configItem.actions.updateitems.remote.params:Object.keys(queue[0].configItem.actions.updateitems.rest.params).length>0?queue[0].configItem.actions.updateitems.rest.params:null).items=configUpdateObject,delete updateItemsActionObj.items.records[0].actions;var configObj={sClassName:className,sMethodName:"putCartsItems",input:angular.toJson(updateItemsActionObj),options:angular.toJson(opt),iTimeout:null,label:null};$rootScope.loading=!0,bpService.OmniRemoteInvoke(configObj).then(function(res){var configObjCart={sClassName:className,sMethodName:"getCarts",input:angular.toJson(updateItemsActionObj),options:angular.toJson(opt),iTimeout:null,label:null};bpService.OmniRemoteInvoke(configObjCart).then(function(result){$rootScope.loading=!1;var resp=angular.fromJson(result);$scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[0]+"_Top"]=[resp],$scope.showErrorIconInCart($scope.bpTree.response.vlcPersistentComponent[$scope.bpTree.pcId[0]+"_Top"][0].messages,$scope);var msgIdArray,bundlehasError=!1,msgArry=[];angular.forEach(resp.messages,function(message){"ERROR"===message.severity&&(bundlehasError=!0),msgIdArray=message.messageId.split("|"),"ERROR"===message.severity&&$scope.gParent&&$scope.gParent.Id.value==msgIdArray[0]&&$scope.gParent.PricebookEntry.Product2Id==msgIdArray[1]&&msgArry.push(message)}),!bundlehasError&&$scope.gParent&&($scope.gParent.messages=resp.messages),bundlehasError&&$scope.gParent&&msgArry.length>0&&($scope.gParent.messages=msgArry)},function(error){$scope.handleRemoteCallError(control,resp.error,!0,!1)});var data=angular.fromJson(res),updatedItemObj=data.records[0],updateSuccessful=!1;if(angular.forEach(data.messages,function(message){"ERROR"===message.severity&&!0,"INFO"===message.severity&&"151"===message.code&&(updateSuccessful=!0)}),updateSuccessful)for(var i=0;i<queue.length;i++){if(queue[i].configItem&&queue[i].configItem.Id.value===data.records[0].Id.value){delete updatedItemObj.actions,_.assign(queue[i].configItem,updatedItemObj);break}if(queue[i].parent&&queue[i].parent.Id.value===updatedItemObj.Id.value){angular.copy(updatedItemObj.messages,queue[i].parent.messages),queue[i].configItem.Id.value===updatedItemObj.lineItems.records[0].Id.value&&_.assign(queue[i].configItem,updatedItemObj.lineItems.records[0]),setProcessingLine(data.records[0],!1);break}}setProcessingLine($scope.configItemObject,!1),isConfigInProcess=!1},function(error){$rootScope.loading=!1})},$scope.showErrorIconInCart=function(msgArr){if(msgArr){for(var i=0;i<msgArr.length;i++)"ERROR"===msgArr[i].severity&&($scope.showErrorIcon=!0);0===msgArr.length&&($scope.showErrorIcon=!1),$scope.bpTree.response.canOrderCheckout=!$scope.showErrorIcon}else $scope.showErrorIcon=!1}}),bpModule.controller("ModalEditBlockCtrl",function($scope,$rootScope,$timeout,bpService,mElementScp,mControl,mIsElementAdded,mOperation){$scope.OmniConfigProdModalOk=customLabels.OmniConfigProdModalOk,$scope.OmniConfigProdModalCancel=customLabels.OmniConfigProdModalCancel,$scope.OmniEditBlockModalTitle=mControl.propSetMap.label,$scope.elementScp=mElementScp,$scope.control=mControl,$scope.bpService=bpService,$scope.isElementAdded=mIsElementAdded,$scope.mOperation=mOperation,$scope.elementScp.editBlockIndex=$scope.isElementAdded.index,$scope.elementScp.editBlockName=mControl.name,$scope.elementScp.inlineEditBlock=mControl.hasOwnProperty("showInlineEBRow"),baseCtrl.prototype.modalClosed=!1;var ctrl=angular.copy(mControl),newAction=ctrl.propSetMap.newAction,editAction=ctrl.propSetMap.editAction,actionCtrl=null,payload={};$scope.saveEditChanges=function(evt){/new$/.test($scope.mOperation)&&newAction?actionCtrl=newAction:/edit$/.test($scope.mOperation)&&editAction&&(actionCtrl=editAction),payload=$scope.control.response,actionCtrl?(angular.equals(actionCtrl.type,"Remote Action")&&angular.equals(actionCtrl.propSetMap.remoteClass,"DefaultOmniScriptEditBlock")&&(actionCtrl.propSetMap.remoteOptions.sobjectMapping=$scope.control.propSetMap.sobjectMapping,actionCtrl.propSetMap.remoteOptions.selectSobject=$scope.control.propSetMap.selectSobject),$scope.buttonClick(payload,actionCtrl,$scope.elementScp,null,"vlcEBOperation",null,function(result){result&&$scope.$dismiss("cancel",evt)})):$scope.$dismiss("cancel",evt),resetNoFormatter($scope.control),$scope.aggregate($scope.elementScp.$parent,$scope.control.index,$scope.control.indexInParent,!0,-1),evt.preventDefault()},$scope.closeModal=function(evt){var resp={};resp[ctrl.name]=angular.copy(ctrl.response),resetNoFormatter($scope.control),baseCtrl.prototype.modalClosed=!0,$scope.isElementAdded.added?$scope.elementScp.removeItemEditBlock($scope.isElementAdded.child,$scope.isElementAdded.index,$scope,$scope.isElementAdded.added,$scope.elementScp):($scope.applyCallResp(resp,!1,null,$scope.control,$scope.elementScp.editBlockIndex),$scope.control.response=ctrl.response,$timeout(function(){$scope.aggregate($scope.elementScp.$parent,$scope.control.index,$scope.control.indexInParent,!0,-1)})),$scope.$dismiss("cancel",evt),evt&&evt.preventDefault()}}),function(){"use strict";if(("lightning"===sfdcVars.layout||"newport"===sfdcVars.layout)&&animate){var dModule=angular.module("vlocity-business-process");dModule.config(function($animateProvider){$animateProvider.classNameFilter([/\banimate\-*\b/,/\bam-fade\-*\b/])}),dModule.config(["remoteActionsProvider",function(remoteActionsProvider){remoteActionsProvider.setRemoteActions(remoteActionMap)}])}}()},{}],72:[function(require,module,exports){"function"!=typeof Object.assign&&(Object.assign=function(target,varArgs){"use strict";if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var to=Object(target),index=1;index<arguments.length;index++){var nextSource=arguments[index];if(null!=nextSource)for(var nextKey in nextSource)Object.prototype.hasOwnProperty.call(nextSource,nextKey)&&(to[nextKey]=nextSource[nextKey])}return to})},{}],73:[function(require,module,exports){angular.module("sharedObjectService",[]).factory("NotSupportedElmService",function(){var NotSupportedElmService;return NotSupportedElmService=function(){function NotSupportedElmService(){}return NotSupportedElmService.prototype.getList=function(){return{Image:"Image",Block:"Block",File:"File",Disclosure:"Disclosure",Headline:"Headline",Validation:"Validation","Line Break":"Line Break","Text Block":"Text Block","Radio Group":"Radio Group","Type Ahead Block":"Type Ahead Block"}},NotSupportedElmService}(),void 0!==window.angularSharedService&&null!==window.angularSharedService||(window.angularSharedService=new NotSupportedElmService),window.angularSharedService})},{}]},{},[1])}();
//# sourceMappingURL=BusinessProcessJS.min.js.map